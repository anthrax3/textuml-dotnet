//     Underscore.js 1.5.1
//     http://underscorejs.org
//     (c) 2009-2013 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
//     Underscore may be freely distributed under the MIT license.

//     (c) 2010-2013 Jeremy Ashkenas, DocumentCloud Inc.

//     Backbone may be freely distributed under the MIT license.

/*
 * Copyright 2012 John Papa and Hans Fjällemark.  
 * All Rights Reserved.  
 * Use, reproduction, distribution, and modification of this code is subject to the terms and 
 * conditions of the MIT license, available at http://www.opensource.org/licenses/mit-license.php
 *
 * Author: John Papa and Hans Fjällemark
 * Project: https://github.com/CodeSeven/toastr
 */

/**
 * KineticJS JavaScript Framework v4.4.3
 * http://www.kineticjs.com/
 * Copyright 2013, Eric Rowell
 * Licensed under the MIT or GPL Version 2 licenses.
 * Date: Apr 14 2013
 *
 * Copyright (C) 2011 - 2013 by Eric Rowell
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */

/*

     StackBlur - a fast almost Gaussian Blur For Canvas

     Version:   0.5
     Author:		Mario Klingemann
     Contact: 	mario@quasimondo.com
     Website:	http://www.quasimondo.com/StackBlurForCanvas
     Twitter:	@quasimondo

     In case you find this class useful - especially in commercial projects -
     I am not totally unhappy for a small donation to my PayPal account
     mario@quasimondo.de

     Or support me on flattr:
     https://flattr.com/thing/72791/StackBlur-a-fast-almost-Gaussian-Blur-Effect-for-CanvasJavascript

     Copyright (c) 2010 Mario Klingemann

     Permission is hereby granted, free of charge, to any person
     obtaining a copy of this software and associated documentation
     files (the "Software"), to deal in the Software without
     restriction, including without limitation the rights to use,
     copy, modify, merge, publish, distribute, sublicense, and/or sell
     copies of the Software, and to permit persons to whom the
     Software is furnished to do so, subject to the following
     conditions:

     The above copyright notice and this permission notice shall be
     included in all copies or substantial portions of the Software.

     THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
     EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
     OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
     NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
     HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
     WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
     FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
     OTHER DEALINGS IN THE SOFTWARE.
     */

/* ===================================================
 * bootstrap-transition.js v2.3.2
 * http://twitter.github.com/bootstrap/javascript.html#transitions
 * ===================================================
 * Copyright 2012 Twitter, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ========================================================== */

/* ==========================================================
 * bootstrap-alert.js v2.3.2
 * http://twitter.github.com/bootstrap/javascript.html#alerts
 * ==========================================================
 * Copyright 2012 Twitter, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ========================================================== */

/* ============================================================
 * bootstrap-button.js v2.3.2
 * http://twitter.github.com/bootstrap/javascript.html#buttons
 * ============================================================
 * Copyright 2012 Twitter, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ============================================================ */

/* ==========================================================
 * bootstrap-carousel.js v2.3.2
 * http://twitter.github.com/bootstrap/javascript.html#carousel
 * ==========================================================
 * Copyright 2012 Twitter, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ========================================================== */

/* =============================================================
 * bootstrap-collapse.js v2.3.2
 * http://twitter.github.com/bootstrap/javascript.html#collapse
 * =============================================================
 * Copyright 2012 Twitter, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ============================================================ */

/* ============================================================
 * bootstrap-dropdown.js v2.3.2
 * http://twitter.github.com/bootstrap/javascript.html#dropdowns
 * ============================================================
 * Copyright 2012 Twitter, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ============================================================ */

/* =========================================================
 * bootstrap-modal.js v2.3.2
 * http://twitter.github.com/bootstrap/javascript.html#modals
 * =========================================================
 * Copyright 2012 Twitter, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ========================================================= */

/* ===========================================================
 * bootstrap-tooltip.js v2.3.2
 * http://twitter.github.com/bootstrap/javascript.html#tooltips
 * Inspired by the original jQuery.tipsy by Jason Frame
 * ===========================================================
 * Copyright 2012 Twitter, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ========================================================== */

/* ===========================================================
 * bootstrap-popover.js v2.3.2
 * http://twitter.github.com/bootstrap/javascript.html#popovers
 * ===========================================================
 * Copyright 2012 Twitter, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =========================================================== */

/* =============================================================
 * bootstrap-scrollspy.js v2.3.2
 * http://twitter.github.com/bootstrap/javascript.html#scrollspy
 * =============================================================
 * Copyright 2012 Twitter, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ============================================================== */

/* ========================================================
 * bootstrap-tab.js v2.3.2
 * http://twitter.github.com/bootstrap/javascript.html#tabs
 * ========================================================
 * Copyright 2012 Twitter, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ======================================================== */

/* =============================================================
 * bootstrap-typeahead.js v2.3.2
 * http://twitter.github.com/bootstrap/javascript.html#typeahead
 * =============================================================
 * Copyright 2012 Twitter, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ============================================================ */

/* ==========================================================
 * bootstrap-affix.js v2.3.2
 * http://twitter.github.com/bootstrap/javascript.html#affix
 * ==========================================================
 * Copyright 2012 Twitter, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ========================================================== */

// moment.js
// version : 2.1.0
// author : Tim Wood
// license : MIT
// momentjs.com

/*!
 * ASP.NET SignalR JavaScript Library v1.1.2
 * http://signalr.net/
 *
 * Copyright Microsoft Open Technologies, Inc. All rights reserved.
 * Licensed under the Apache 2.0
 * https://github.com/SignalR/SignalR/blob/master/LICENSE.md
 *
 */

// Copyright (c) Microsoft Open Technologies, Inc. All rights reserved. See License.md in the project root for license information.

/*!
 * jQuery Migrate - v1.1.1 - 2013-02-16
 * https://github.com/jquery/jquery-migrate
 * Copyright 2005, 2013 jQuery Foundation, Inc. and other contributors; Licensed MIT
 */

/*!
 * jQuery Cookie Plugin v1.3.1
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2013 Klaus Hartl
 * Released under the MIT license
 */

/*
 * jQuery.splitter.js - two-pane splitter window plugin
 *
 * version 1.63 (2012/12/06) 
 * 
 * Dual licensed under the MIT and GPL licenses: 
 *   http://www.opensource.org/licenses/mit-license.php 
 *   http://www.gnu.org/licenses/gpl.html 
 */

(function(){var e=this,t=e._,n={},r=Array.prototype,i=Object.prototype,s=Function.prototype,o=r.push,u=r.slice,a=r.concat,f=i.toString,l=i.hasOwnProperty,c=r.forEach,h=r.map,p=r.reduce,d=r.reduceRight,v=r.filter,m=r.every,g=r.some,y=r.indexOf,b=r.lastIndexOf,w=Array.isArray,E=Object.keys,S=s.bind,x=function(e){if(e instanceof x)return e;if(!(this instanceof x))return new x(e);this._wrapped=e};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=x),exports._=x):e._=x,x.VERSION="1.5.1";var T=x.each=x.forEach=function(e,t,r){if(e==null)return;if(c&&e.forEach===c)e.forEach(t,r);else if(e.length===+e.length){for(var i=0,s=e.length;i<s;i++)if(t.call(r,e[i],i,e)===n)return}else for(var o in e)if(x.has(e,o)&&t.call(r,e[o],o,e)===n)return};x.map=x.collect=function(e,t,n){var r=[];return e==null?r:h&&e.map===h?e.map(t,n):(T(e,function(e,i,s){r.push(t.call(n,e,i,s))}),r)};var N="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(p&&e.reduce===p)return r&&(t=x.bind(t,r)),i?e.reduce(t,n):e.reduce(t);T(e,function(e,s,o){i?n=t.call(r,n,e,s,o):(n=e,i=!0)});if(!i)throw new TypeError(N);return n},x.reduceRight=x.foldr=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(d&&e.reduceRight===d)return r&&(t=x.bind(t,r)),i?e.reduceRight(t,n):e.reduceRight(t);var s=e.length;if(s!==+s){var o=x.keys(e);s=o.length}T(e,function(u,a,f){a=o?o[--s]:--s,i?n=t.call(r,n,e[a],a,f):(n=e[a],i=!0)});if(!i)throw new TypeError(N);return n},x.find=x.detect=function(e,t,n){var r;return C(e,function(e,i,s){if(t.call(n,e,i,s))return r=e,!0}),r},x.filter=x.select=function(e,t,n){var r=[];return e==null?r:v&&e.filter===v?e.filter(t,n):(T(e,function(e,i,s){t.call(n,e,i,s)&&r.push(e)}),r)},x.reject=function(e,t,n){return x.filter(e,function(e,r,i){return!t.call(n,e,r,i)},n)},x.every=x.all=function(e,t,r){t||(t=x.identity);var i=!0;return e==null?i:m&&e.every===m?e.every(t,r):(T(e,function(e,s,o){if(!(i=i&&t.call(r,e,s,o)))return n}),!!i)};var C=x.some=x.any=function(e,t,r){t||(t=x.identity);var i=!1;return e==null?i:g&&e.some===g?e.some(t,r):(T(e,function(e,s,o){if(i||(i=t.call(r,e,s,o)))return n}),!!i)};x.contains=x.include=function(e,t){return e==null?!1:y&&e.indexOf===y?e.indexOf(t)!=-1:C(e,function(e){return e===t})},x.invoke=function(e,t){var n=u.call(arguments,2),r=x.isFunction(t);return x.map(e,function(e){return(r?t:e[t]).apply(e,n)})},x.pluck=function(e,t){return x.map(e,function(e){return e[t]})},x.where=function(e,t,n){return x.isEmpty(t)?n?void 0:[]:x[n?"find":"filter"](e,function(e){for(var n in t)if(t[n]!==e[n])return!1;return!0})},x.findWhere=function(e,t){return x.where(e,t,!0)},x.max=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);if(!t&&x.isEmpty(e))return-Infinity;var r={computed:-Infinity,value:-Infinity};return T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o>r.computed&&(r={value:e,computed:o})}),r.value},x.min=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);if(!t&&x.isEmpty(e))return Infinity;var r={computed:Infinity,value:Infinity};return T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o<r.computed&&(r={value:e,computed:o})}),r.value},x.shuffle=function(e){var t,n=0,r=[];return T(e,function(e){t=x.random(n++),r[n-1]=r[t],r[t]=e}),r};var k=function(e){return x.isFunction(e)?e:function(t){return t[e]}};x.sortBy=function(e,t,n){var r=k(t);return x.pluck(x.map(e,function(e,t,i){return{value:e,index:t,criteria:r.call(n,e,t,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||n===void 0)return 1;if(n<r||r===void 0)return-1}return e.index<t.index?-1:1}),"value")};var L=function(e,t,n,r){var i={},s=k(t==null?x.identity:t);return T(e,function(t,o){var u=s.call(n,t,o,e);r(i,u,t)}),i};x.groupBy=function(e,t,n){return L(e,t,n,function(e,t,n){(x.has(e,t)?e[t]:e[t]=[]).push(n)})},x.countBy=function(e,t,n){return L(e,t,n,function(e,t){x.has(e,t)||(e[t]=0),e[t]++})},x.sortedIndex=function(e,t,n,r){n=n==null?x.identity:k(n);var i=n.call(r,t),s=0,o=e.length;while(s<o){var u=s+o>>>1;n.call(r,e[u])<i?s=u+1:o=u}return s},x.toArray=function(e){return e?x.isArray(e)?u.call(e):e.length===+e.length?x.map(e,x.identity):x.values(e):[]},x.size=function(e){return e==null?0:e.length===+e.length?e.length:x.keys(e).length},x.first=x.head=x.take=function(e,t,n){return e==null?void 0:t!=null&&!n?u.call(e,0,t):e[0]},x.initial=function(e,t,n){return u.call(e,0,e.length-(t==null||n?1:t))},x.last=function(e,t,n){return e==null?void 0:t!=null&&!n?u.call(e,Math.max(e.length-t,0)):e[e.length-1]},x.rest=x.tail=x.drop=function(e,t,n){return u.call(e,t==null||n?1:t)},x.compact=function(e){return x.filter(e,x.identity)};var A=function(e,t,n){return t&&x.every(e,x.isArray)?a.apply(n,e):(T(e,function(e){x.isArray(e)||x.isArguments(e)?t?o.apply(n,e):A(e,t,n):n.push(e)}),n)};x.flatten=function(e,t){return A(e,t,[])},x.without=function(e){return x.difference(e,u.call(arguments,1))},x.uniq=x.unique=function(e,t,n,r){x.isFunction(t)&&(r=n,n=t,t=!1);var i=n?x.map(e,n,r):e,s=[],o=[];return T(i,function(n,r){if(t?!r||o[o.length-1]!==n:!x.contains(o,n))o.push(n),s.push(e[r])}),s},x.union=function(){return x.uniq(x.flatten(arguments,!0))},x.intersection=function(e){var t=u.call(arguments,1);return x.filter(x.uniq(e),function(e){return x.every(t,function(t){return x.indexOf(t,e)>=0})})},x.difference=function(e){var t=a.apply(r,u.call(arguments,1));return x.filter(e,function(e){return!x.contains(t,e)})},x.zip=function(){var e=x.max(x.pluck(arguments,"length").concat(0)),t=new Array(e);for(var n=0;n<e;n++)t[n]=x.pluck(arguments,""+n);return t},x.object=function(e,t){if(e==null)return{};var n={};for(var r=0,i=e.length;r<i;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},x.indexOf=function(e,t,n){if(e==null)return-1;var r=0,i=e.length;if(n){if(typeof n!="number")return r=x.sortedIndex(e,t),e[r]===t?r:-1;r=n<0?Math.max(0,i+n):n}if(y&&e.indexOf===y)return e.indexOf(t,n);for(;r<i;r++)if(e[r]===t)return r;return-1},x.lastIndexOf=function(e,t,n){if(e==null)return-1;var r=n!=null;if(b&&e.lastIndexOf===b)return r?e.lastIndexOf(t,n):e.lastIndexOf(t);var i=r?n:e.length;while(i--)if(e[i]===t)return i;return-1},x.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;var r=Math.max(Math.ceil((t-e)/n),0),i=0,s=new Array(r);while(i<r)s[i++]=e,e+=n;return s};var O=function(){};x.bind=function(e,t){var n,r;if(S&&e.bind===S)return S.apply(e,u.call(arguments,1));if(!x.isFunction(e))throw new TypeError;return n=u.call(arguments,2),r=function(){if(this instanceof r){O.prototype=e.prototype;var i=new O;O.prototype=null;var s=e.apply(i,n.concat(u.call(arguments)));return Object(s)===s?s:i}return e.apply(t,n.concat(u.call(arguments)))}},x.partial=function(e){var t=u.call(arguments,1);return function(){return e.apply(this,t.concat(u.call(arguments)))}},x.bindAll=function(e){var t=u.call(arguments,1);if(t.length===0)throw new Error("bindAll must be passed function names");return T(t,function(t){e[t]=x.bind(e[t],e)}),e},x.memoize=function(e,t){var n={};return t||(t=x.identity),function(){var r=t.apply(this,arguments);return x.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},x.delay=function(e,t){var n=u.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},x.defer=function(e){return x.delay.apply(x,[e,1].concat(u.call(arguments,1)))},x.throttle=function(e,t,n){var r,i,s,o=null,u=0;n||(n={});var a=function(){u=n.leading===!1?0:new Date,o=null,s=e.apply(r,i)};return function(){var f=new Date;!u&&n.leading===!1&&(u=f);var l=t-(f-u);return r=this,i=arguments,l<=0?(clearTimeout(o),o=null,u=f,s=e.apply(r,i)):!o&&n.trailing!==!1&&(o=setTimeout(a,l)),s}},x.debounce=function(e,t,n){var r,i=null;return function(){var s=this,o=arguments,u=function(){i=null,n||(r=e.apply(s,o))},a=n&&!i;return clearTimeout(i),i=setTimeout(u,t),a&&(r=e.apply(s,o)),r}},x.once=function(e){var t=!1,n;return function(){return t?n:(t=!0,n=e.apply(this,arguments),e=null,n)}},x.wrap=function(e,t){return function(){var n=[e];return o.apply(n,arguments),t.apply(this,n)}},x.compose=function(){var e=arguments;return function(){var t=arguments;for(var n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},x.after=function(e,t){return function(){if(--e<1)return t.apply(this,arguments)}},x.keys=E||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)x.has(e,n)&&t.push(n);return t},x.values=function(e){var t=[];for(var n in e)x.has(e,n)&&t.push(e[n]);return t},x.pairs=function(e){var t=[];for(var n in e)x.has(e,n)&&t.push([n,e[n]]);return t},x.invert=function(e){var t={};for(var n in e)x.has(e,n)&&(t[e[n]]=n);return t},x.functions=x.methods=function(e){var t=[];for(var n in e)x.isFunction(e[n])&&t.push(n);return t.sort()},x.extend=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)e[n]=t[n]}),e},x.pick=function(e){var t={},n=a.apply(r,u.call(arguments,1));return T(n,function(n){n in e&&(t[n]=e[n])}),t},x.omit=function(e){var t={},n=a.apply(r,u.call(arguments,1));for(var i in e)x.contains(n,i)||(t[i]=e[i]);return t},x.defaults=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)e[n]===void 0&&(e[n]=t[n])}),e},x.clone=function(e){return x.isObject(e)?x.isArray(e)?e.slice():x.extend({},e):e},x.tap=function(e,t){return t(e),e};var M=function(e,t,n,r){if(e===t)return e!==0||1/e==1/t;if(e==null||t==null)return e===t;e instanceof x&&(e=e._wrapped),t instanceof x&&(t=t._wrapped);var i=f.call(e);if(i!=f.call(t))return!1;switch(i){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if(typeof e!="object"||typeof t!="object")return!1;var s=n.length;while(s--)if(n[s]==e)return r[s]==t;var o=e.constructor,u=t.constructor;if(o!==u&&!(x.isFunction(o)&&o instanceof o&&x.isFunction(u)&&u instanceof u))return!1;n.push(e),r.push(t);var a=0,l=!0;if(i=="[object Array]"){a=e.length,l=a==t.length;if(l)while(a--)if(!(l=M(e[a],t[a],n,r)))break}else{for(var c in e)if(x.has(e,c)){a++;if(!(l=x.has(t,c)&&M(e[c],t[c],n,r)))break}if(l){for(c in t)if(x.has(t,c)&&!(a--))break;l=!a}}return n.pop(),r.pop(),l};x.isEqual=function(e,t){return M(e,t,[],[])},x.isEmpty=function(e){if(e==null)return!0;if(x.isArray(e)||x.isString(e))return e.length===0;for(var t in e)if(x.has(e,t))return!1;return!0},x.isElement=function(e){return!!e&&e.nodeType===1},x.isArray=w||function(e){return f.call(e)=="[object Array]"},x.isObject=function(e){return e===Object(e)},T(["Arguments","Function","String","Number","Date","RegExp"],function(e){x["is"+e]=function(t){return f.call(t)=="[object "+e+"]"}}),x.isArguments(arguments)||(x.isArguments=function(e){return!!e&&!!x.has(e,"callee")}),typeof /./!="function"&&(x.isFunction=function(e){return typeof e=="function"}),x.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},x.isNaN=function(e){return x.isNumber(e)&&e!=+e},x.isBoolean=function(e){return e===!0||e===!1||f.call(e)=="[object Boolean]"},x.isNull=function(e){return e===null},x.isUndefined=function(e){return e===void 0},x.has=function(e,t){return l.call(e,t)},x.noConflict=function(){return e._=t,this},x.identity=function(e){return e},x.times=function(e,t,n){var r=Array(Math.max(0,e));for(var i=0;i<e;i++)r[i]=t.call(n,i);return r},x.random=function(e,t){return t==null&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))};var _={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};_.unescape=x.invert(_.escape);var D={escape:new RegExp("["+x.keys(_.escape).join("")+"]","g"),unescape:new RegExp("("+x.keys(_.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(e){x[e]=function(t){return t==null?"":(""+t).replace(D[e],function(t){return _[e][t]})}}),x.result=function(e,t){if(e==null)return void 0;var n=e[t];return x.isFunction(n)?n.call(e):n},x.mixin=function(e){T(x.functions(e),function(t){var n=x[t]=e[t];x.prototype[t]=function(){var e=[this._wrapped];return o.apply(e,arguments),F.call(this,n.apply(x,e))}})};var P=0;x.uniqueId=function(e){var t=++P+"";return e?e+t:t},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var H=/(.)^/,B={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},j=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(e,t,n){var r;n=x.defaults({},n,x.templateSettings);var i=new RegExp([(n.escape||H).source,(n.interpolate||H).source,(n.evaluate||H).source].join("|")+"|$","g"),s=0,o="__p+='";e.replace(i,function(t,n,r,i,u){return o+=e.slice(s,u).replace(j,function(e){return"\\"+B[e]}),n&&(o+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),r&&(o+="'+\n((__t=("+r+"))==null?'':__t)+\n'"),i&&(o+="';\n"+i+"\n__p+='"),s=u+t.length,t}),o+="';\n",n.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{r=new Function(n.variable||"obj","_",o)}catch(u){throw u.source=o,u}if(t)return r(t,x);var a=function(e){return r.call(this,e,x)};return a.source="function("+(n.variable||"obj")+"){\n"+o+"}",a},x.chain=function(e){return x(e).chain()};var F=function(e){return this._chain?x(e).chain():e};x.mixin(x),T(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=r[e];x.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),(e=="shift"||e=="splice")&&n.length===0&&delete n[0],F.call(this,n)}}),T(["concat","join","slice"],function(e){var t=r[e];x.prototype[e]=function(){return F.call(this,t.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this),define("underscore",function(e){return function(){var t,n;return t||e._}}(this)),function(){var e=this,t=e.Backbone,n=[],r=n.push,i=n.slice,s=n.splice,o;typeof exports!="undefined"?o=exports:o=e.Backbone={},o.VERSION="1.0.0";var u=e._;!u&&typeof require!="undefined"&&(u=require("underscore")),o.$=e.jQuery||e.Zepto||e.ender||e.$,o.noConflict=function(){return e.Backbone=t,this},o.emulateHTTP=!1,o.emulateJSON=!1;var a=o.Events={on:function(e,t,n){if(!l(this,"on",e,[t,n])||!t)return this;this._events||(this._events={});var r=this._events[e]||(this._events[e]=[]);return r.push({callback:t,context:n,ctx:n||this}),this},once:function(e,t,n){if(!l(this,"once",e,[t,n])||!t)return this;var r=this,i=u.once(function(){r.off(e,i),t.apply(this,arguments)});return i._callback=t,this.on(e,i,n)},off:function(e,t,n){var r,i,s,o,a,f,c,h;if(!this._events||!l(this,"off",e,[t,n]))return this;if(!e&&!t&&!n)return this._events={},this;o=e?[e]:u.keys(this._events);for(a=0,f=o.length;a<f;a++){e=o[a];if(s=this._events[e]){this._events[e]=r=[];if(t||n)for(c=0,h=s.length;c<h;c++)i=s[c],(t&&t!==i.callback&&t!==i.callback._callback||n&&n!==i.context)&&r.push(i);r.length||delete this._events[e]}}return this},trigger:function(e){if(!this._events)return this;var t=i.call(arguments,1);if(!l(this,"trigger",e,t))return this;var n=this._events[e],r=this._events.all;return n&&c(n,t),r&&c(r,arguments),this},stopListening:function(e,t,n){var r=this._listeners;if(!r)return this;var i=!t&&!n;typeof t=="object"&&(n=this),e&&((r={})[e._listenerId]=e);for(var s in r)r[s].off(t,n,this),i&&delete this._listeners[s];return this}},f=/\s+/,l=function(e,t,n,r){if(!n)return!0;if(typeof n=="object"){for(var i in n)e[t].apply(e,[i,n[i]].concat(r));return!1}if(f.test(n)){var s=n.split(f);for(var o=0,u=s.length;o<u;o++)e[t].apply(e,[s[o]].concat(r));return!1}return!0},c=function(e,t){var n,r=-1,i=e.length,s=t[0],o=t[1],u=t[2];switch(t.length){case 0:while(++r<i)(n=e[r]).callback.call(n.ctx);return;case 1:while(++r<i)(n=e[r]).callback.call(n.ctx,s);return;case 2:while(++r<i)(n=e[r]).callback.call(n.ctx,s,o);return;case 3:while(++r<i)(n=e[r]).callback.call(n.ctx,s,o,u);return;default:while(++r<i)(n=e[r]).callback.apply(n.ctx,t)}},h={listenTo:"on",listenToOnce:"once"};u.each(h,function(e,t){a[t]=function(t,n,r){var i=this._listeners||(this._listeners={}),s=t._listenerId||(t._listenerId=u.uniqueId("l"));return i[s]=t,typeof n=="object"&&(r=this),t[e](n,r,this),this}}),a.bind=a.on,a.unbind=a.off,u.extend(o,a);var p=o.Model=function(e,t){var n,r=e||{};t||(t={}),this.cid=u.uniqueId("c"),this.attributes={},u.extend(this,u.pick(t,d)),t.parse&&(r=this.parse(r,t)||{});if(n=u.result(this,"defaults"))r=u.defaults({},r,n);this.set(r,t),this.changed={},this.initialize.apply(this,arguments)},d=["url","urlRoot","collection"];u.extend(p.prototype,a,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(e){return u.clone(this.attributes)},sync:function(){return o.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return u.escape(this.get(e))},has:function(e){return this.get(e)!=null},set:function(e,t,n){var r,i,s,o,a,f,l,c;if(e==null)return this;typeof e=="object"?(i=e,n=t):(i={})[e]=t,n||(n={});if(!this._validate(i,n))return!1;s=n.unset,a=n.silent,o=[],f=this._changing,this._changing=!0,f||(this._previousAttributes=u.clone(this.attributes),this.changed={}),c=this.attributes,l=this._previousAttributes,this.idAttribute in i&&(this.id=i[this.idAttribute]);for(r in i)t=i[r],u.isEqual(c[r],t)||o.push(r),u.isEqual(l[r],t)?delete this.changed[r]:this.changed[r]=t,s?delete c[r]:c[r]=t;if(!a){o.length&&(this._pending=!0);for(var h=0,p=o.length;h<p;h++)this.trigger("change:"+o[h],this,c[o[h]],n)}if(f)return this;if(!a)while(this._pending)this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,u.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var n in this.attributes)t[n]=void 0;return this.set(t,u.extend({},e,{unset:!0}))},hasChanged:function(e){return e==null?!u.isEmpty(this.changed):u.has(this.changed,e)},changedAttributes:function(e){if(!e)return this.hasChanged()?u.clone(this.changed):!1;var t,n=!1,r=this._changing?this._previousAttributes:this.attributes;for(var i in e){if(u.isEqual(r[i],t=e[i]))continue;(n||(n={}))[i]=t}return n},previous:function(e){return e==null||!this._previousAttributes?null:this._previousAttributes[e]},previousAttributes:function(){return u.clone(this._previousAttributes)},fetch:function(e){e=e?u.clone(e):{},e.parse===void 0&&(e.parse=!0);var t=this,n=e.success;return e.success=function(r){if(!t.set(t.parse(r,e),e))return!1;n&&n(t,r,e),t.trigger("sync",t,r,e)},j(this,e),this.sync("read",this,e)},save:function(e,t,n){var r,i,s,o=this.attributes;e==null||typeof e=="object"?(r=e,n=t):(r={})[e]=t;if(r&&(!n||!n.wait)&&!this.set(r,n))return!1;n=u.extend({validate:!0},n);if(!this._validate(r,n))return!1;r&&n.wait&&(this.attributes=u.extend({},o,r)),n.parse===void 0&&(n.parse=!0);var a=this,f=n.success;return n.success=function(e){a.attributes=o;var t=a.parse(e,n);n.wait&&(t=u.extend(r||{},t));if(u.isObject(t)&&!a.set(t,n))return!1;f&&f(a,e,n),a.trigger("sync",a,e,n)},j(this,n),i=this.isNew()?"create":n.patch?"patch":"update",i==="patch"&&(n.attrs=r),s=this.sync(i,this,n),r&&n.wait&&(this.attributes=o),s},destroy:function(e){e=e?u.clone(e):{};var t=this,n=e.success,r=function(){t.trigger("destroy",t,t.collection,e)};e.success=function(i){(e.wait||t.isNew())&&r(),n&&n(t,i,e),t.isNew()||t.trigger("sync",t,i,e)};if(this.isNew())return e.success(),!1;j(this,e);var i=this.sync("delete",this,e);return e.wait||r(),i},url:function(){var e=u.result(this,"urlRoot")||u.result(this.collection,"url")||B();return this.isNew()?e:e+(e.charAt(e.length-1)==="/"?"":"/")+encodeURIComponent(this.id)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},isValid:function(e){return this._validate({},u.extend(e||{},{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=u.extend({},this.attributes,e);var n=this.validationError=this.validate(e,t)||null;return n?(this.trigger("invalid",this,n,u.extend(t||{},{validationError:n})),!1):!0}});var v=["keys","values","pairs","invert","pick","omit"];u.each(v,function(e){p.prototype[e]=function(){var t=i.call(arguments);return t.unshift(this.attributes),u[e].apply(u,t)}});var m=o.Collection=function(e,t){t||(t={}),t.url&&(this.url=t.url),t.model&&(this.model=t.model),t.comparator!==void 0&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,u.extend({silent:!0},t))},g={add:!0,remove:!0,merge:!0},y={add:!0,merge:!1,remove:!1};u.extend(m.prototype,a,{model:p,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return o.sync.apply(this,arguments)},add:function(e,t){return this.set(e,u.defaults(t||{},y))},remove:function(e,t){e=u.isArray(e)?e.slice():[e],t||(t={});var n,r,i,s;for(n=0,r=e.length;n<r;n++){s=this.get(e[n]);if(!s)continue;delete this._byId[s.id],delete this._byId[s.cid],i=this.indexOf(s),this.models.splice(i,1),this.length--,t.silent||(t.index=i,s.trigger("remove",s,this,t)),this._removeReference(s)}return this},set:function(e,t){t=u.defaults(t||{},g),t.parse&&(e=this.parse(e,t)),u.isArray(e)||(e=e?[e]:[]);var n,i,o,a,f,l,c=t.at,h=this.comparator&&c==null&&t.sort!==!1,p=u.isString(this.comparator)?this.comparator:null,d=[],v=[],m={};for(n=0,i=e.length;n<i;n++){if(!(o=this._prepareModel(e[n],t)))continue;(f=this.get(o))?(t.remove&&(m[f.cid]=!0),t.merge&&(f.set(o.attributes,t),h&&!l&&f.hasChanged(p)&&(l=!0))):t.add&&(d.push(o),o.on("all",this._onModelEvent,this),this._byId[o.cid]=o,o.id!=null&&(this._byId[o.id]=o))}if(t.remove){for(n=0,i=this.length;n<i;++n)m[(o=this.models[n]).cid]||v.push(o);v.length&&this.remove(v,t)}d.length&&(h&&(l=!0),this.length+=d.length,c!=null?s.apply(this.models,[c,0].concat(d)):r.apply(this.models,d)),l&&this.sort({silent:!0});if(t.silent)return this;for(n=0,i=d.length;n<i;n++)(o=d[n]).trigger("add",o,this,t);return l&&this.trigger("sort",this,t),this},reset:function(e,t){t||(t={});for(var n=0,r=this.models.length;n<r;n++)this._removeReference(this.models[n]);return t.previousModels=this.models,this._reset(),this.add(e,u.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),this},push:function(e,t){return e=this._prepareModel(e,t),this.add(e,u.extend({at:this.length},t)),e},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return e=this._prepareModel(e,t),this.add(e,u.extend({at:0},t)),e},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(e,t){return this.models.slice(e,t)},get:function(e){return e==null?void 0:this._byId[e.id!=null?e.id:e.cid||e]},at:function(e){return this.models[e]},where:function(e,t){return u.isEmpty(e)?t?void 0:[]:this[t?"find":"filter"](function(t){for(var n in e)if(e[n]!==t.get(n))return!1;return!0})},findWhere:function(e){return this.where(e,!0)},sort:function(e){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return e||(e={}),u.isString(this.comparator)||this.comparator.length===1?this.models=this.sortBy(this.comparator,this):this.models.sort(u.bind(this.comparator,this)),e.silent||this.trigger("sort",this,e),this},sortedIndex:function(e,t,n){t||(t=this.comparator);var r=u.isFunction(t)?t:function(e){return e.get(t)};return u.sortedIndex(this.models,e,r,n)},pluck:function(e){return u.invoke(this.models,"get",e)},fetch:function(e){e=e?u.clone(e):{},e.parse===void 0&&(e.parse=!0);var t=e.success,n=this;return e.success=function(r){var i=e.reset?"reset":"set";n[i](r,e),t&&t(n,r,e),n.trigger("sync",n,r,e)},j(this,e),this.sync("read",this,e)},create:function(e,t){t=t?u.clone(t):{};if(!(e=this._prepareModel(e,t)))return!1;t.wait||this.add(e,t);var n=this,r=t.success;return t.success=function(i){t.wait&&n.add(e,t),r&&r(e,i,t)},e.save(null,t),e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(e instanceof p)return e.collection||(e.collection=this),e;t||(t={}),t.collection=this;var n=new this.model(e,t);return n._validate(e,t)?n:(this.trigger("invalid",this,e,t),!1)},_removeReference:function(e){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,r){if((e==="add"||e==="remove")&&n!==this)return;e==="destroy"&&this.remove(t,r),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],t.id!=null&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments)}});var b=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","indexOf","shuffle","lastIndexOf","isEmpty","chain"];u.each(b,function(e){m.prototype[e]=function(){var t=i.call(arguments);return t.unshift(this.models),u[e].apply(u,t)}});var w=["groupBy","countBy","sortBy"];u.each(w,function(e){m.prototype[e]=function(t,n){var r=u.isFunction(t)?t:function(e){return e.get(t)};return u[e](this.models,r,n)}});var E=o.View=function(e){this.cid=u.uniqueId("view"),this._configure(e||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},S=/^(\S+)\s*(.*)$/,x=["model","collection","el","id","attributes","className","tagName","events"];u.extend(E.prototype,a,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(e,t){return this.$el&&this.undelegateEvents(),this.$el=e instanceof o.$?e:o.$(e),this.el=this.$el[0],t!==!1&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=u.result(this,"events")))return this;this.undelegateEvents();for(var t in e){var n=e[t];u.isFunction(n)||(n=this[e[t]]);if(!n)continue;var r=t.match(S),i=r[1],s=r[2];n=u.bind(n,this),i+=".delegateEvents"+this.cid,s===""?this.$el.on(i,n):this.$el.on(i,s,n)}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_configure:function(e){this.options&&(e=u.extend({},u.result(this,"options"),e)),u.extend(this,u.pick(e,x)),this.options=e},_ensureElement:function(){if(!this.el){var e=u.extend({},u.result(this,"attributes"));this.id&&(e.id=u.result(this,"id")),this.className&&(e["class"]=u.result(this,"className"));var t=o.$("<"+u.result(this,"tagName")+">").attr(e);this.setElement(t,!1)}else this.setElement(u.result(this,"el"),!1)}}),o.sync=function(e,t,n){var r=T[e];u.defaults(n||(n={}),{emulateHTTP:o.emulateHTTP,emulateJSON:o.emulateJSON});var i={type:r,dataType:"json"};n.url||(i.url=u.result(t,"url")||B()),n.data==null&&t&&(e==="create"||e==="update"||e==="patch")&&(i.contentType="application/json",i.data=JSON.stringify(n.attrs||t.toJSON(n))),n.emulateJSON&&(i.contentType="application/x-www-form-urlencoded",i.data=i.data?{model:i.data}:{});if(n.emulateHTTP&&(r==="PUT"||r==="DELETE"||r==="PATCH")){i.type="POST",n.emulateJSON&&(i.data._method=r);var s=n.beforeSend;n.beforeSend=function(e){e.setRequestHeader("X-HTTP-Method-Override",r);if(s)return s.apply(this,arguments)}}i.type!=="GET"&&!n.emulateJSON&&(i.processData=!1),i.type==="PATCH"&&window.ActiveXObject&&(!window.external||!window.external.msActiveXFilteringEnabled)&&(i.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var a=n.xhr=o.ajax(u.extend(i,n));return t.trigger("request",t,a,n),a};var T={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};o.ajax=function(){return o.$.ajax.apply(o.$,arguments)};var N=o.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},C=/\((.*?)\)/g,k=/(\(\?)?:\w+/g,L=/\*\w+/g,A=/[\-{}\[\]+?.,\\\^$|#\s]/g;u.extend(N.prototype,a,{initialize:function(){},route:function(e,t,n){u.isRegExp(e)||(e=this._routeToRegExp(e)),u.isFunction(t)&&(n=t,t=""),n||(n=this[t]);var r=this;return o.history.route(e,function(i){var s=r._extractParameters(e,i);n&&n.apply(r,s),r.trigger.apply(r,["route:"+t].concat(s)),r.trigger("route",t,s),o.history.trigger("route",r,t,s)}),this},navigate:function(e,t){return o.history.navigate(e,t),this},_bindRoutes:function(){if(!this.routes)return;this.routes=u.result(this,"routes");var e,t=u.keys(this.routes);while((e=t.pop())!=null)this.route(e,this.routes[e])},_routeToRegExp:function(e){return e=e.replace(A,"\\$&").replace(C,"(?:$1)?").replace(k,function(e,t){return t?e:"([^/]+)"}).replace(L,"(.*?)"),new RegExp("^"+e+"$")},_extractParameters:function(e,t){var n=e.exec(t).slice(1);return u.map(n,function(e){return e?decodeURIComponent(e):null})}});var O=o.History=function(){this.handlers=[],u.bindAll(this,"checkUrl"),typeof window!="undefined"&&(this.location=window.location,this.history=window.history)},M=/^[#\/]|\s+$/g,_=/^\/+|\/+$/g,D=/msie [\w.]+/,P=/\/$/;O.started=!1,u.extend(O.prototype,a,{interval:50,getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getFragment:function(e,t){if(e==null)if(this._hasPushState||!this._wantsHashChange||t){e=this.location.pathname;var n=this.root.replace(P,"");e.indexOf(n)||(e=e.substr(n.length))}else e=this.getHash();return e.replace(M,"")},start:function(e){if(O.started)throw new Error("Backbone.history has already been started");O.started=!0,this.options=u.extend({},{root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var t=this.getFragment(),n=document.documentMode,r=D.exec(navigator.userAgent.toLowerCase())&&(!n||n<=7);this.root=("/"+this.root+"/").replace(_,"/"),r&&this._wantsHashChange&&(this.iframe=o.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(t)),this._hasPushState?o.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!r?o.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=t;var i=this.location,s=i.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!s)return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0;this._wantsPushState&&this._hasPushState&&s&&i.hash&&(this.fragment=this.getHash().replace(M,""),this.history.replaceState({},document.title,this.root+this.fragment+i.search));if(!this.options.silent)return this.loadUrl()},stop:function(){o.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),O.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe)));if(t===this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(e){var t=this.fragment=this.getFragment(e),n=u.any(this.handlers,function(e){if(e.route.test(t))return e.callback(t),!0});return n},navigate:function(e,t){if(!O.started)return!1;if(!t||t===!0)t={trigger:t};e=this.getFragment(e||"");if(this.fragment===e)return;this.fragment=e;var n=this.root+e;if(this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}t.trigger&&this.loadUrl(e)},_updateHash:function(e,t,n){if(n){var r=e.href.replace(/(javascript:|#).*$/,"");e.replace(r+"#"+t)}else e.hash="#"+t}}),o.history=new O;var H=function(e,t){var n=this,r;e&&u.has(e,"constructor")?r=e.constructor:r=function(){return n.apply(this,arguments)},u.extend(r,n,t);var i=function(){this.constructor=r};return i.prototype=n.prototype,r.prototype=new i,e&&u.extend(r.prototype,e),r.__super__=n.prototype,r};p.extend=m.extend=N.extend=E.extend=O.extend=H;var B=function(){throw new Error('A "url" property or function must be specified')},j=function(e,t){var n=t.error;t.error=function(r){n&&n(e,r,t),e.trigger("error",e,r,t)}}}.call(this),define("backbone",["jquery","underscore"],function(e){return function(){var t,n;return t||e.Backbone}}(this)),function(e){e("toastr",["jquery"],function(e){return function(){function d(e){if(!i)return;i(e)}function v(t){function c(){if(e(":focus",u).length>0)return;return u.fadeOut(r.fadeOut,function(){y(u),r.onFadeOut&&r.onFadeOut(),l.state="hidden",l.endTime=new Date,d(l)})}function h(){if(r.timeOut>0||r.extendedTimeOut>0)o=setTimeout(c,r.extendedTimeOut)}function p(){clearTimeout(o),u.stop(!0,!0).fadeIn(r.fadeIn)}var r=g(),i=t.iconClass||r.iconClass;typeof t.optionsOverride!="undefined"&&(r=e.extend(r,t.optionsOverride),i=t.optionsOverride.iconClass||i),s++,n=m(r);var o=null,u=e("<div/>"),a=e("<div/>"),f=e("<div/>"),l={toastId:s,state:"visible",startTime:new Date,options:r,map:t};return t.iconClass&&u.addClass(r.toastClass).addClass(i),t.title&&(a.append(t.title).addClass(r.titleClass),u.append(a)),t.message&&(f.append(t.message).addClass(r.messageClass),u.append(f)),u.hide(),r.newestOnTop?n.prepend(u):n.append(u),u.fadeIn(r.fadeIn,r.onFadeIn),r.timeOut>0&&(o=setTimeout(c,r.timeOut)),u.hover(p,h),!r.onclick&&r.tapToDismiss&&u.click(c),r.onclick&&u.click(function(){r.onclick()&&c()}),d(l),r.debug&&console&&console.log(l),u}function m(t){return t||(t=g()),n=e("#"+t.containerId),n.length?n:(n=e("<div/>").attr("id",t.containerId).addClass(t.positionClass),n.appendTo(e(t.target)),n)}function g(){return e.extend({},o,p.options)}function y(e){n||(n=m());if(e.is(":visible"))return;e.remove(),e=null,n.children().length===0&&n.remove()}var t="1.3.1",n,r={error:"error",info:"info",success:"success",warning:"warning"},i,s=0,o={tapToDismiss:!0,toastClass:"toast",containerId:"toast-container",debug:!1,fadeIn:300,onFadeIn:undefined,fadeOut:1e3,onFadeOut:undefined,extendedTimeOut:1e3,iconClasses:{error:"toast-error",info:"toast-info",success:"toast-success",warning:"toast-warning"},iconClass:"toast-info",positionClass:"toast-top-right",timeOut:5e3,titleClass:"toast-title",messageClass:"toast-message",target:"body",newestOnTop:!0},u=function(e,t,n){return v({type:r.error,iconClass:g().iconClasses.error,message:e,optionsOverride:n,title:t})},a=function(e,t,n){return v({type:r.info,iconClass:g().iconClasses.info,message:e,optionsOverride:n,title:t})},f=function(e){i=e},l=function(e,t,n){return v({type:r.success,iconClass:g().iconClasses.success,message:e,optionsOverride:n,title:t})},c=function(e,t,n){return v({type:r.warning,iconClass:g().iconClasses.warning,message:e,optionsOverride:n,title:t})},h=function(t){var r=g();n||m(r);if(t&&e(":focus",t).length===0){t.fadeOut(r.fadeOut,function(){y(t)});return}n.children().length&&n.fadeOut(r.fadeOut,function(){n.remove()})},p={clear:h,error:u,getContainer:m,info:a,options:{},subscribe:f,success:l,version:t,warning:c};return p}()})}(typeof define=="function"&&define.amd?define:function(e,t){typeof module!="undefined"&&module.exports?module.exports=t(require(e[0])):window.toastr=t(window.jQuery)}),define("application/events",["require","underscore","backbone"],function(e){var t,n,r;return r=e("underscore"),t=e("backbone"),n={},r(n).extend(t.Events),n});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("application/views/navigation",["require","jquery","backbone","../events"],function(e){var t,n,r,i;return t=e("jquery"),n=e("backbone"),i=e("../events"),r=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return __extends(n,e),n.prototype.el="#navigation",n.prototype.events={"click [data-command]":"handleCommand"},n.prototype.handleCommand=function(e){var n;return n=t(e.currentTarget).attr("data-command"),n?i.trigger(n):!1},n}(n.View)});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("application/models/example",["require","backbone"],function(e){var t,n;return t=e("backbone"),n=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.defaults=function(){return{display:null,snippet:null}},t}(t.Model)});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("application/models/examples",["require","backbone","./example"],function(e){var t,n,r;return t=e("backbone"),n=e("./example"),r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.model=n,t}(t.Collection)});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("application/views/examplelist",["require","jquery","underscore","backbone","../models/example","../models/examples","../events"],function(e){var t,n,r,i,s,o,u,a;return t=e("jquery"),a=e("underscore"),n=e("backbone"),r=e("../models/example"),s=e("../models/examples"),o=e("../events"),u=function(){return new s([new r({display:"Sync call",snippet:"A -> B: Sync message"}),new r({display:"Sync return",snippet:"A <-- B: Sync message return"}),new r({display:"Async call",snippet:"A ->> B: Async message"}),new r({display:"Async return",snippet:"A <<-- B: Async message return"}),new r({display:"Loop",snippet:"loop n times\n  ' nested calls goes here...\nend"}),new r({display:"If",snippet:"opt condition\n  ' nested calls goes here...\nend"}),new r({display:"If/Else",snippet:"alt condition 1\n  ' nested calls goes here...\nelse condition 2\n  ' nested calls goes here...\nend"})])},i=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return __extends(n,e),n.prototype.el="#example-list",n.prototype.events={"click li":"select"},n.prototype.initialize=function(){return this.template=a("<li><%= display %></li>").template(),this.collection=u(),this.render()},n.prototype.render=function(){var e=this;return this.$el.empty(),this.collection.each(function(n){return e.$el.append(t(e.template(n.toJSON())).attr("data-cid",n.cid))}),this},n.prototype.select=function(e){var n,r;return n=t(e.currentTarget).attr("data-cid"),r=this.collection.get(n),o.trigger("exampleSelected",{example:r})},n}(n.View)}),window.CodeMirror=function(){function E(e,n){if(!(this instanceof E))return new E(e,n);this.options=n=n||{};for(var r in Sn)!n.hasOwnProperty(r)&&Sn.hasOwnProperty(r)&&(n[r]=Sn[r]);_(n);var i=this.display=S(e);i.wrapper.CodeMirror=this,A(this),n.autofocus&&!d&&St(this),this.view=x(new xr([new Sr([ur("",null,ht(i))])])),this.nextOpId=0,T(this),k(this),n.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap"),this.setValue(n.value||""),t&&setTimeout(ni(Et,this,!0),20),this.view.history=Mr(),Tt(this);var s;try{s=document.activeElement==i.input}catch(o){}s||n.autofocus&&!d?setTimeout(ni(Vt,this),20):$t(this),mt(this,function(){for(var e in En)En.propertyIsEnumerable(e)&&En[e](this,n[e],Tn);for(var t=0;t<Ln.length;++t)Ln[t](this)})()}function S(e){var t={},r=t.input=ui("textarea",null,null,"position: absolute; padding: 0; width: 1px; height: 1em; outline: none;");i?r.style.width="1000px":r.setAttribute("wrap","off"),r.setAttribute("autocorrect","off"),r.setAttribute("autocapitalize","off"),t.inputDiv=ui("div",[r],null,"overflow: hidden; position: relative; width: 3px; height: 0px;"),t.scrollbarH=ui("div",[ui("div",null,null,"height: 1px")],"CodeMirror-hscrollbar"),t.scrollbarV=ui("div",[ui("div",null,null,"width: 1px")],"CodeMirror-vscrollbar"),t.scrollbarFiller=ui("div",null,"CodeMirror-scrollbar-filler"),t.lineDiv=ui("div"),t.selectionDiv=ui("div",null,null,"position: relative; z-index: 1"),t.cursor=ui("div"," ","CodeMirror-cursor"),t.otherCursor=ui("div"," ","CodeMirror-cursor CodeMirror-secondarycursor"),t.measure=ui("div",null,"CodeMirror-measure"),t.lineSpace=ui("div",[t.measure,t.selectionDiv,t.lineDiv,t.cursor,t.otherCursor],null,"position: relative; outline: none"),t.mover=ui("div",[ui("div",[t.lineSpace],"CodeMirror-lines")],null,"position: relative"),t.sizer=ui("div",[t.mover],"CodeMirror-sizer"),t.heightForcer=ui("div"," ",null,"position: absolute; height: "+Vr+"px"),t.gutters=ui("div",null,"CodeMirror-gutters"),t.lineGutter=null;var s=ui("div",[t.sizer,t.heightForcer,t.gutters],null,"position: relative; min-height: 100%");return t.scroller=ui("div",[s],"CodeMirror-scroll"),t.scroller.setAttribute("tabIndex","-1"),t.wrapper=ui("div",[t.inputDiv,t.scrollbarH,t.scrollbarV,t.scrollbarFiller,t.scroller],"CodeMirror"),n&&(t.gutters.style.zIndex=-1,t.scroller.style.paddingRight=0),e.appendChild?e.appendChild(t.wrapper):e(t.wrapper),p&&(r.style.width="0px"),i||(t.scroller.draggable=!0),f?(t.inputDiv.style.height="1px",t.inputDiv.style.position="absolute"):n&&(t.scrollbarH.style.minWidth=t.scrollbarV.style.minWidth="18px"),t.viewOffset=t.showingFrom=t.showingTo=t.lastSizeC=0,t.lineNumWidth=t.lineNumInnerWidth=t.lineNumChars=null,t.prevInput="",t.alignWidgets=!1,t.pollingFast=!1,t.poll=new Jr,t.draggingText=!1,t.cachedCharWidth=t.cachedTextHeight=null,t.measureLineCache=[],t.measureLineCachePos=0,t.inaccurateSelection=!1,t.pasteIncoming=!1,t.wheelDX=t.wheelDY=t.wheelStartX=t.wheelStartY=null,t}function x(e){var t={line:0,ch:0};return{doc:e,frontier:0,highlight:new Jr,sel:{from:t,to:t,head:t,anchor:t,shift:!1,extend:!1},scrollTop:0,scrollLeft:0,overwrite:!1,focused:!1,maxLine:Tr(e,0),maxLineLength:0,maxLineChanged:!1,suppressEdits:!1,goalColumn:null,cantEdit:!1,keyMaps:[],overlays:[],modeGen:0}}function T(e){var t=e.view.doc;e.view.mode=E.getMode(e.options,e.options.mode),t.iter(0,t.size,function(e){e.stateAfter&&(e.stateAfter=null),e.styles&&(e.styles=null)}),e.view.frontier=0,Q(e,100),e.view.modeGen++,e.curOp&&gt(e,0,t.size)}function N(e){var t=e.view.doc,n=ht(e.display);if(e.options.lineWrapping){e.display.wrapper.className+=" CodeMirror-wrap";var r=e.display.scroller.clientWidth/pt(e.display)-3;t.iter(0,t.size,function(e){if(e.height==0)return;var t=Math.ceil(e.text.length/r)||1;t!=1&&Nr(e,t*n)}),e.display.sizer.style.minWidth=""}else e.display.wrapper.className=e.display.wrapper.className.replace(" CodeMirror-wrap",""),M(e.view),t.iter(0,t.size,function(e){e.height!=0&&Nr(e,n)});gt(e,0,t.size),st(e),setTimeout(function(){D(e.display,e.view.doc.height)},100)}function C(e){var t=_n[e.options.keyMap].style;e.display.wrapper.className=e.display.wrapper.className.replace(/\s*cm-keymap-\S+/g,"")+(t?" cm-keymap-"+t:"")}function k(e){e.display.wrapper.className=e.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+e.options.theme.replace(/(^|\s)\s*/g," cm-s-"),st(e)}function L(e){A(e),I(e,!0)}function A(e){var t=e.display.gutters,n=e.options.gutters;ai(t);for(var r=0;r<n.length;++r){var i=n[r],s=t.appendChild(ui("div",null,"CodeMirror-gutter "+i));i=="CodeMirror-linenumbers"&&(e.display.lineGutter=s,s.style.width=(e.display.lineNumWidth||1)+"px")}t.style.display=r?"":"none"}function O(e,t){if(t.height==0)return 0;var n=t.text.length,r,i=t;while(r=$n(i)){var s=r.find();i=Tr(e,s.from.line),n+=s.from.ch-s.to.ch}i=t;while(r=Jn(i)){var s=r.find();n-=i.text.length-s.from.ch,i=Tr(e,s.to.line),n+=i.text.length-s.to.ch}return n}function M(e){e.maxLine=Tr(e.doc,0),e.maxLineLength=O(e.doc,e.maxLine),e.maxLineChanged=!0,e.doc.iter(1,e.doc.size,function(t){var n=O(e.doc,t);n>e.maxLineLength&&(e.maxLineLength=n,e.maxLine=t)})}function _(e){var t=!1;for(var n=0;n<e.gutters.length;++n)e.gutters[n]=="CodeMirror-linenumbers"&&(e.lineNumbers?t=!0:e.gutters.splice(n--,1));!t&&e.lineNumbers&&e.gutters.push("CodeMirror-linenumbers")}function D(e,t){var n=t+2*et(e);e.sizer.style.minHeight=e.heightForcer.style.top=n+"px";var r=Math.max(n,e.scroller.scrollHeight),i=e.scroller.scrollWidth>e.scroller.clientWidth,s=r>e.scroller.clientHeight;s?(e.scrollbarV.style.display="block",e.scrollbarV.style.bottom=i?di(e.measure)+"px":"0",e.scrollbarV.firstChild.style.height=r-e.scroller.clientHeight+e.scrollbarV.clientHeight+"px"):e.scrollbarV.style.display="",i?(e.scrollbarH.style.display="block",e.scrollbarH.style.right=s?di(e.measure)+"px":"0",e.scrollbarH.firstChild.style.width=e.scroller.scrollWidth-e.scroller.clientWidth+e.scrollbarH.clientWidth+"px"):e.scrollbarH.style.display="",i&&s?(e.scrollbarFiller.style.display="block",e.scrollbarFiller.style.height=e.scrollbarFiller.style.width=di(e.measure)+"px"):e.scrollbarFiller.style.display="",l&&di(e.measure)===0&&(e.scrollbarV.style.minWidth=e.scrollbarH.style.minHeight=c?"18px":"12px")}function P(e,t,n){var r=e.scroller.scrollTop,i=e.wrapper.clientHeight;typeof n=="number"?r=n:n&&(r=n.top,i=n.bottom-n.top),r=Math.floor(r-et(e));var s=Math.ceil(r+i);return{from:Lr(t,r),to:Lr(t,s)}}function H(e){var t=e.display;if(!t.alignWidgets&&(!t.gutters.firstChild||!e.options.fixedGutter))return;var n=F(t)-t.scroller.scrollLeft+e.view.scrollLeft,r=t.gutters.offsetWidth,i=n+"px";for(var s=t.lineDiv.firstChild;s;s=s.nextSibling)if(s.alignable)for(var o=0,u=s.alignable;o<u.length;++o)u[o].style.left=i;e.options.fixedGutter&&(t.gutters.style.left=n+r+"px")}function B(e){if(!e.options.lineNumbers)return!1;var t=e.view.doc,n=j(e.options,t.size-1),r=e.display;if(n.length!=r.lineNumChars){var i=r.measure.appendChild(ui("div",[ui("div",n)],"CodeMirror-linenumber CodeMirror-gutter-elt")),s=i.firstChild.offsetWidth,o=i.offsetWidth-s;return r.lineGutter.style.width="",r.lineNumInnerWidth=Math.max(s,r.lineGutter.offsetWidth-o),r.lineNumWidth=r.lineNumInnerWidth+o,r.lineNumChars=r.lineNumInnerWidth?n.length:-1,r.lineGutter.style.width=r.lineNumWidth+"px",!0}return!1}function j(e,t){return String(e.lineNumberFormatter(t+e.firstLineNumber))}function F(e){return e.scroller.getBoundingClientRect().left-e.sizer.getBoundingClientRect().left}function I(e,t,n){var r=e.display.showingFrom,i=e.display.showingTo,s=q(e,t,n);return s&&(Wr(e,e,"update",e),(e.display.showingFrom!=r||e.display.showingTo!=i)&&Wr(e,e,"viewportChange",e,e.display.showingFrom,e.display.showingTo)),V(e),D(e.display,e.view.doc.height),s}function q(e,t,r){var i=e.display,s=e.view.doc;if(!i.wrapper.clientWidth){i.showingFrom=i.showingTo=i.viewOffset=0;return}var o=P(i,s,r);if(t!==!0&&t.length==0&&o.from>i.showingFrom&&o.to<i.showingTo)return;t&&B(e)&&(t=!0);var u=i.sizer.style.marginLeft=i.gutters.offsetWidth+"px";i.scrollbarH.style.left=e.options.fixedGutter?u:"0";if(t!==!0&&w)for(var a=0;a<t.length;++a){var f=t[a],l;while(l=$n(Tr(s,f.from))){var c=l.find().from.line;f.diff&&(f.diff-=f.from-c),f.from=c}}var h=t===!0?0:Infinity;if(e.options.lineNumbers&&t&&t!==!0)for(var a=0;a<t.length;++a)if(t[a].diff){h=t[a].from;break}var c=Math.max(o.from-e.options.viewportMargin,0),p=Math.min(s.size,o.to+e.options.viewportMargin);i.showingFrom<c&&c-i.showingFrom<20&&(c=i.showingFrom),i.showingTo>p&&i.showingTo-p<20&&(p=Math.min(s.size,i.showingTo));if(w){c=Cr(Kn(s,Tr(s,c)));while(p<s.size&&Qn(Tr(s,p)))++p}var d=t===!0?[]:R([{from:i.showingFrom,to:i.showingTo}],t),v=0;for(var a=0;a<d.length;++a){var m=d[a];m.from<c&&(m.from=c),m.to>p&&(m.to=p),m.from>=m.to?d.splice(a--,1):v+=m.to-m.from}if(v==p-c&&c==i.showingFrom&&p==i.showingTo)return;d.sort(function(e,t){return e.from-t.from});var g=document.activeElement;v<(p-c)*.7&&(i.lineDiv.style.display="none"),z(e,c,p,d,h),i.lineDiv.style.display="",document.activeElement!=g&&g.offsetHeight&&g.focus();var y=c!=i.showingFrom||p!=i.showingTo||i.lastSizeC!=i.wrapper.clientHeight;y&&(i.lastSizeC=i.wrapper.clientHeight),i.showingFrom=c,i.showingTo=p,Q(e,100);var b=i.lineDiv.offsetTop;for(var E=i.lineDiv.firstChild,S;E;E=E.nextSibling)if(E.lineObj){if(n){var x=E.offsetTop+E.offsetHeight;S=x-b,b=x}else{var T=E.getBoundingClientRect();S=T.bottom-T.top}var N=E.lineObj.height-S;S<2&&(S=ht(i));if(N>.001||N<-0.001){Nr(E.lineObj,S);var C=E.lineObj.widgets;if(C)for(var a=0;a<C.length;++a)C[a].height=C[a].node.offsetHeight}}return i.viewOffset=Ar(e,Tr(s,c)),i.mover.style.top=i.viewOffset+"px",P(i,s,r).to>=p&&q(e,[],r),!0}function R(e,t){for(var n=0,r=t.length||0;n<r;++n){var i=t[n],s=[],o=i.diff||0;for(var u=0,a=e.length;u<a;++u){var f=e[u];i.to<=f.from&&i.diff?s.push({from:f.from+o,to:f.to+o}):i.to<=f.from||i.from>=f.to?s.push(f):(i.from>f.from&&s.push({from:f.from,to:i.from}),i.to<f.to&&s.push({from:i.to+o,to:f.to+o}))}e=s}return e}function U(e){var t=e.display,n={},r={};for(var i=t.gutters.firstChild,s=0;i;i=i.nextSibling,++s)n[e.options.gutters[s]]=i.offsetLeft,r[e.options.gutters[s]]=i.offsetWidth;return{fixedPos:F(t),gutterTotalWidth:t.gutters.offsetWidth,gutterLeft:n,gutterWidth:r,wrapperWidth:t.wrapper.clientWidth}}function z(e,t,n,r,s){function c(t){var n=t.nextSibling;return i&&v&&e.display.currentWheelTarget==t?(t.style.display="none",t.lineObj=null):t.parentNode.removeChild(t),n}var o=U(e),u=e.display,a=e.options.lineNumbers;!r.length&&(!i||!e.display.currentWheelTarget)&&ai(u.lineDiv);var f=u.lineDiv,l=f.firstChild,h=r.shift(),p=t;e.view.doc.iter(t,n,function(t){h&&h.to==p&&(h=r.shift());if(Qn(t)){t.height!=0&&Nr(t,0);if(t.widgets&&l.previousSibling)for(var n=0;n<t.widgets.length;++n)if(t.widgets[n].showIfHidden){var i=l.previousSibling;if(i.nodeType=="pre"){var u=ui("div",null,null,"position: relative");i.parentNode.replaceChild(u,i),u.appendChild(i),i=u}i.appendChild(X(t.widgets[n],i,o))}}else if(h&&h.from<=p&&h.to>p){while(l.lineObj!=t)l=c(l);a&&s<=p&&l.lineNumber&&li(l.lineNumber,j(e.options,p)),l=l.nextSibling}else{var d=W(e,t,p,o);f.insertBefore(d,l),d.lineObj=t}++p});while(l)l=c(l)}function W(e,t,r,i){var s=mr(e,t),o=t.gutterMarkers,u=e.display;if(!e.options.lineNumbers&&!o&&!t.bgClass&&!t.wrapClass&&(!t.widgets||!t.widgets.length))return s;var a=ui("div",null,t.wrapClass,"position: relative");if(e.options.lineNumbers||o){var f=a.appendChild(ui("div",null,null,"position: absolute; left: "+(e.options.fixedGutter?i.fixedPos:-i.gutterTotalWidth)+"px"));e.options.fixedGutter&&(a.alignable=[f]),e.options.lineNumbers&&(!o||!o["CodeMirror-linenumbers"])&&(a.lineNumber=f.appendChild(ui("div",j(e.options,r),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+i.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+u.lineNumInnerWidth+"px")));if(o)for(var l=0;l<e.options.gutters.length;++l){var c=e.options.gutters[l],h=o.hasOwnProperty(c)&&o[c];h&&f.appendChild(ui("div",[h],"CodeMirror-gutter-elt","left: "+i.gutterLeft[c]+"px; width: "+i.gutterWidth[c]+"px"))}}t.bgClass&&a.appendChild(ui("div"," ",t.bgClass+" CodeMirror-linebackground")),a.appendChild(s);if(t.widgets)for(var p=0,d=t.widgets;p<d.length;++p){var v=d[p],m=X(v,a,i);v.above?a.insertBefore(m,e.options.lineNumbers&&t.height!=0?f:s):a.appendChild(m)}return n&&(a.style.zIndex=2),a}function X(e,t,n){var r=ui("div",[e.node],"CodeMirror-linewidget");r.widget=e;if(e.noHScroll){(t.alignable||(t.alignable=[])).push(r);var i=n.wrapperWidth;r.style.left=n.fixedPos+"px",e.coverGutter||(i-=n.gutterTotalWidth,r.style.paddingLeft=n.gutterTotalWidth+"px"),r.style.width=i+"px"}return e.coverGutter&&(r.style.zIndex=5,r.style.position="relative",e.noHScroll||(r.style.marginLeft=-n.gutterTotalWidth+"px")),r}function V(e){var t=e.display,n=tn(e.view.sel.from,e.view.sel.to);n||e.options.showCursorWhenSelecting?$(e):t.cursor.style.display=t.otherCursor.style.display="none",n?t.selectionDiv.style.display="none":J(e);var r=at(e,e.view.sel.head,"div"),i=t.wrapper.getBoundingClientRect(),s=t.lineDiv.getBoundingClientRect();t.inputDiv.style.top=Math.max(0,Math.min(t.wrapper.clientHeight-10,r.top+s.top-i.top))+"px",t.inputDiv.style.left=Math.max(0,Math.min(t.wrapper.clientWidth-10,r.left+s.left-i.left))+"px"}function $(e){var t=e.display,n=at(e,e.view.sel.head,"div");t.cursor.style.left=n.left+"px",t.cursor.style.top=n.top+"px",t.cursor.style.height=Math.max(0,n.bottom-n.top)*e.options.cursorHeight+"px",t.cursor.style.display="",n.other?(t.otherCursor.style.display="",t.otherCursor.style.left=n.other.left+"px",t.otherCursor.style.top=n.other.top+"px",t.otherCursor.style.height=(n.other.bottom-n.other.top)*.85+"px"):t.otherCursor.style.display="none"}function J(e){function u(e,t,n,r){t<0&&(t=0),i.appendChild(ui("div",null,"CodeMirror-selected","position: absolute; left: "+e+"px; top: "+t+"px; width: "+(n==null?s-e:n)+"px; height: "+(r-t)+"px"))}function a(t,r,i,a){function h(n){return ut(e,{line:t,ch:n},"div",f)}var f=Tr(n,t),l=f.text.length,c=a?Infinity:-Infinity;return Ei(Or(f),r||0,i==null?l:i,function(e,t,n){var f=h(n=="rtl"?t-1:e),p=h(n=="rtl"?e:t-1),d=f.left,v=p.right;p.top-f.top>3&&(u(d,f.top,null,f.bottom),d=o,f.bottom<p.top&&u(d,f.bottom,null,p.top)),i==null&&t==l&&(v=s),r==null&&e==0&&(d=o),c=a?Math.min(p.top,c):Math.max(p.bottom,c),d<o+1&&(d=o),u(d,p.top,v-d,p.bottom)}),c}var t=e.display,n=e.view.doc,r=e.view.sel,i=document.createDocumentFragment(),s=t.lineSpace.offsetWidth,o=tt(e.display);if(r.from.line==r.to.line)a(r.from.line,r.from.ch,r.to.ch);else{var f=Tr(n,r.from.line),l=f,c,h=[r.from.line,r.from.ch],p;while(c=Jn(l)){var d=c.find();h.push(d.from.ch,d.to.line,d.to.ch);if(d.to.line==r.to.line){h.push(r.to.ch),p=!0;break}l=Tr(n,d.to.line)}if(p)for(var v=0;v<h.length;v+=3)a(h[v],h[v+1],h[v+2]);else{var m,g,y=Tr(n,r.to.line);r.from.ch?m=a(r.from.line,r.from.ch,null,!1):m=Ar(e,f)-t.viewOffset,r.to.ch?g=a(r.to.line,$n(y)?null:0,r.to.ch,!0):g=Ar(e,y)-t.viewOffset,m<g&&u(o,m,null,g)}}fi(t.selectionDiv,i),t.selectionDiv.style.display=""}function K(e){var t=e.display;clearInterval(t.blinker);var n=!0;t.cursor.style.visibility=t.otherCursor.style.visibility="",t.blinker=setInterval(function(){if(!t.cursor.offsetHeight)return;t.cursor.style.visibility=t.otherCursor.style.visibility=(n=!n)?"":"hidden"},e.options.cursorBlinkRate)}function Q(e,t){e.view.mode.startState&&e.view.frontier<e.display.showingTo&&e.view.highlight.set(t,ni(G,e))}function G(e){var t=e.view,n=t.doc;if(t.frontier>=e.display.showingTo)return;var r=+(new Date)+e.options.workTime,i=An(t.mode,Z(e,t.frontier)),s=[],o;n.iter(t.frontier,Math.min(n.size,e.display.showingTo+500),function(n){if(t.frontier>=e.display.showingFrom){var u=n.styles;n.styles=cr(e,n,i);var a=!u||u.length!=n.styles.length;for(var f=0;!a&&f<u.length;++f)a=u[f]!=n.styles[f];a&&(o&&o.end==t.frontier?o.end++:s.push(o={start:t.frontier,end:t.frontier+1})),n.stateAfter=An(t.mode,i)}else pr(e,n,i),n.stateAfter=t.frontier%5==0?An(t.mode,i):null;++t.frontier;if(+(new Date)>r)return Q(e,e.options.workDelay),!0}),s.length&&mt(e,function(){for(var e=0;e<s.length;++e)gt(this,s[e].start,s[e].end)})()}function Y(e,t){var n,r,i=e.view.doc;for(var s=t,o=t-100;s>o;--s){if(s==0)return 0;var u=Tr(i,s-1);if(u.stateAfter)return s;var a=Kr(u.text,null,e.options.tabSize);if(r==null||n>a)r=s-1,n=a}return r}function Z(e,t){var n=e.view;if(!n.mode.startState)return!0;var r=Y(e,t),i=r&&Tr(n.doc,r-1).stateAfter;return i?i=An(n.mode,i):i=On(n.mode),n.doc.iter(r,t,function(s){pr(e,s,i);var o=r==t-1||r%5==0||r>=n.showingFrom&&r<n.showingTo;s.stateAfter=o?An(n.mode,i):null,++r}),i}function et(e){return e.lineSpace.offsetTop}function tt(e){var t=fi(e.measure,ui("pre")).appendChild(ui("span","x"));return t.offsetLeft}function nt(e,t,n,r){var i=-1;r=r||rt(e,t);for(var s=n;;s+=i){var o=r[s];if(o)break;i<0&&s==0&&(i=1)}return{left:s<n?o.right:o.left,right:s>n?o.left:o.right,top:o.top,bottom:o.bottom}}function rt(e,t){var n=e.display,r=e.display.measureLineCache;for(var i=0;i<r.length;++i){var s=r[i];if(s.text==t.text&&s.markedSpans==t.markedSpans&&n.scroller.clientWidth==s.width)return s.measure}var o=it(e,t),s={text:t.text,width:n.scroller.clientWidth,markedSpans:t.markedSpans,measure:o};return r.length==16?r[++n.measureLineCachePos%16]=s:r.push(s),o}function it(e,r){var i=e.display,s=ti(r.text.length),o=mr(e,r,s);if(t&&!n&&!e.options.lineWrapping&&o.childNodes.length>100){var u=document.createDocumentFragment(),a=10,f=o.childNodes.length;for(var l=0,c=Math.ceil(f/a);l<c;++l){var h=ui("div",null,null,"display: inline-block");for(var p=0;p<a&&f;++p)h.appendChild(o.firstChild),--f;u.appendChild(h)}o.appendChild(u)}fi(i.measure,o);var d=i.lineDiv.getBoundingClientRect(),v=[],m=ti(r.text.length),g=o.offsetHeight;for(var l=0,y;l<s.length;++l)if(y=s[l]){var b=y.getBoundingClientRect(),w=Math.max(0,b.top-d.top),E=Math.min(b.bottom-d.top,g);for(var p=0;p<v.length;p+=2){var S=v[p],x=v[p+1];if(S>E||x<w)continue;if(S<=w&&x>=E||w<=S&&E>=x||Math.min(E,x)-Math.max(w,S)>=E-w>>1){v[p]=Math.min(w,S),v[p+1]=Math.max(E,x);break}}p==v.length&&v.push(w,E),m[l]={left:b.left-d.left,right:b.right-d.left,top:p}}for(var l=0,y;l<m.length;++l)if(y=m[l]){var T=y.top;y.top=v[T],y.bottom=v[T+1]}return m}function st(e){e.display.measureLineCache.length=e.display.measureLineCachePos=0,e.display.cachedCharWidth=e.display.cachedTextHeight=null,e.view.maxLineChanged=!0}function ot(e,t,n,r){if(t.widgets)for(var i=0;i<t.widgets.length;++i)if(t.widgets[i].above){var s=sr(t.widgets[i]);n.top+=s,n.bottom+=s}if(r=="line")return n;r||(r="local");var o=Ar(e,t);r!="local"&&(o-=e.display.viewOffset);if(r=="page"){var u=e.display.lineSpace.getBoundingClientRect();o+=u.top+(window.pageYOffset||(document.documentElement||document.body).scrollTop);var a=u.left+(window.pageXOffset||(document.documentElement||document.body).scrollLeft);n.left+=a,n.right+=a}return n.top+=o,n.bottom+=o,n}function ut(e,t,n,r){return r||(r=Tr(e.view.doc,t.line)),ot(e,r,nt(e,r,t.ch),n)}function at(e,t,n,r,i){function s(t,s){var o=nt(e,r,t,i);return s?o.left=o.right:o.right=o.left,ot(e,r,o,n)}r=r||Tr(e.view.doc,t.line),i||(i=rt(e,r));var o=Or(r),u=t.ch;if(!o)return s(u);var a,f,l=o[0].level;for(var c=0;c<o.length;++c){var h=o[c],p=h.level%2,d,v;if(h.from<u&&h.to>u)return s(u,p);var m=p?h.to:h.from,g=p?h.from:h.to;if(m==u)c&&h.level<(d=o[c-1]).level?v=s(d.level%2?d.from:d.to-1,!0):v=s(p&&h.from!=h.to?u-1:u),p==l?a=v:f=v;else if(g==u){var d=c<o.length-1&&o[c+1];if(!p&&d&&d.from==d.to)continue;d&&h.level<d.level?v=s(d.level%2?d.to-1:d.from):v=s(p?u:u-1,!0),p==l?a=v:f=v}}return l&&!u&&(f=s(o[0].to-1)),a?(f&&(a.other=f),a):f}function ft(e,t,n){var r=e.view.doc;n+=e.display.viewOffset;if(n<0)return{line:0,ch:0,outside:!0};var i=Lr(r,n);if(i>=r.size)return{line:r.size-1,ch:Tr(r,r.size-1).text.length};t<0&&(t=0);for(;;){var s=Tr(r,i),o=lt(e,s,i,t,n),u=Jn(s),a=u&&u.find();if(!(u&&o.ch>=a.from.ch))return o;i=a.to.line}}function lt(e,t,n,r,i){function f(r){var i=at(e,{line:n,ch:r},"line",t,a);return o=!0,s>i.bottom?Math.max(0,i.left-u):s<i.top?i.left+u:(o=!1,i.left)}var s=i-Ar(e,t),o=!1,u=e.display.wrapper.clientWidth,a=rt(e,t),l=Or(t),c=t.text.length,h=Ti(t),p=Ni(t),d=tt(e.display),v=f(p);if(r>v)return{line:n,ch:p,outside:o};for(;;){if(l?p==h||p==Li(t,h,1):p-h<=1){var m=r-d<v-r,g=m?h:p;while(oi.test(t.text.charAt(g)))++g;return{line:n,ch:g,after:m,outside:o}}var y=Math.ceil(c/2),b=h+y;if(l){b=h;for(var w=0;w<y;++w)b=Li(t,b,1)}var E=f(b);E>r?(p=b,v=E,o&&(v+=1e3),c-=y):(h=b,d=E,c=y)}}function ht(e){if(e.cachedTextHeight!=null)return e.cachedTextHeight;if(ct==null){ct=ui("pre");for(var t=0;t<49;++t)ct.appendChild(document.createTextNode("x")),ct.appendChild(ui("br"));ct.appendChild(document.createTextNode("x"))}fi(e.measure,ct);var n=ct.offsetHeight/50;return n>3&&(e.cachedTextHeight=n),ai(e.measure),n||1}function pt(e){if(e.cachedCharWidth!=null)return e.cachedCharWidth;var t=ui("span","x"),n=ui("pre",[t]);fi(e.measure,n);var r=t.offsetWidth;return r>2&&(e.cachedCharWidth=r),r||10}function dt(e){e.curOp?++e.curOp.depth:e.curOp={depth:1,changes:[],delayedCallbacks:[],updateInput:null,userSelChange:null,textChanged:null,selectionChanged:!1,updateMaxLine:!1,id:++e.nextOpId}}function vt(e){var t=e.curOp;if(--t.depth)return;e.curOp=null;var n=e.view,r=e.display;t.updateMaxLine&&M(n);if(n.maxLineChanged&&!e.options.lineWrapping){var i=nt(e,n.maxLine,n.maxLine.text.length).right;r.sizer.style.minWidth=i+3+Vr+"px",n.maxLineChanged=!1;var s=Math.max(0,r.sizer.offsetLeft+r.sizer.offsetWidth-r.scroller.clientWidth);s<n.scrollLeft&&Pt(e,Math.min(r.scroller.scrollLeft,s),!0)}var o,u;if(t.selectionChanged){var a=at(e,n.sel.head);o=vn(e,a.left,a.top,a.left,a.bottom)}if(t.changes.length||o&&o.scrollTop!=null)u=I(e,t.changes,o&&o.scrollTop);!u&&t.selectionChanged&&V(e),o&&hn(e),t.selectionChanged&&K(e),n.focused&&t.updateInput&&Et(e,t.userSelChange),t.textChanged&&zr(e,"change",e,t.textChanged),t.selectionChanged&&zr(e,"cursorActivity",e);for(var f=0;f<t.delayedCallbacks.length;++f)t.delayedCallbacks[f](e)}function mt(e,t){return function(){var n=e||this;dt(n);try{var r=t.apply(n,arguments)}finally{vt(n)}return r}}function gt(e,t,n,r){e.curOp.changes.push({from:t,to:n,diff:r})}function yt(e){if(e.view.pollingFast)return;e.display.poll.set(e.options.pollInterval,function(){wt(e),e.view.focused&&yt(e)})}function bt(e){function n(){var r=wt(e);!r&&!t?(t=!0,e.display.poll.set(60,n)):(e.display.pollingFast=!1,yt(e))}var t=!1;e.display.pollingFast=!0,e.display.poll.set(20,n)}function wt(e){var t=e.display.input,n=e.display.prevInput,r=e.view,i=r.sel;if(!r.focused||yi(t)||xt(e))return!1;var s=t.value;if(s==n&&tn(i.from,i.to))return!1;dt(e),r.sel.shift=!1;var o=0,u=Math.min(n.length,s.length);while(o<u&&n[o]==s[o])++o;var a=i.from,f=i.to;o<n.length?a={line:a.line,ch:a.ch-(n.length-o)}:r.overwrite&&tn(a,f)&&!e.display.pasteIncoming&&(f={line:f.line,ch:Math.min(Tr(e.view.doc,f.line).text.length,f.ch+(s.length-o))});var l=e.curOp.updateInput;return Qt(e,a,f,gi(s.slice(o)),"end",e.display.pasteIncoming?"paste":"input",{from:a,to:f}),e.curOp.updateInput=l,s.length>1e3?t.value=e.display.prevInput="":e.display.prevInput=s,vt(e),e.display.pasteIncoming=!1,!0}function Et(e,t){var n=e.view,r,i;tn(n.sel.from,n.sel.to)?t&&(e.display.prevInput=e.display.input.value=""):(e.display.prevInput="",r=bi&&(n.sel.to.line-n.sel.from.line>100||(i=e.getSelection()).length>1e3),r?e.display.input.value="-":e.display.input.value=i||e.getSelection(),n.focused&&Zr(e.display.input)),e.display.inaccurateSelection=r}function St(e){e.options.readOnly!="nocursor"&&(t||document.activeElement!=e.display.input)&&e.display.input.focus()}function xt(e){return e.options.readOnly||e.view.cantEdit}function Tt(t){function r(){t.view.focused&&setTimeout(ni(St,t),0)}function i(){n.cachedCharWidth=n.cachedTextHeight=null,st(t),I(t,!0)}function s(e){if(t.options.onDragEvent&&t.options.onDragEvent(t,Pr(e)))return;jr(e)}function o(){n.inaccurateSelection&&(n.prevInput="",n.inaccurateSelection=!1,n.input.value=t.getSelection(),Zr(n.input))}var n=t.display;Rr(n.scroller,"mousedown",mt(t,At)),Rr(n.scroller,"dblclick",mt(t,Hr)),Rr(n.lineSpace,"selectstart",function(e){Nt(n,e)||Hr(e)}),e||Rr(n.scroller,"contextmenu",function(e){Kt(t,e)}),Rr(n.scroller,"scroll",function(){Dt(t,n.scroller.scrollTop),Pt(t,n.scroller.scrollLeft,!0),zr(t,"scroll",t)}),Rr(n.scrollbarV,"scroll",function(){Dt(t,n.scrollbarV.scrollTop)}),Rr(n.scrollbarH,"scroll",function(){Pt(t,n.scrollbarH.scrollLeft)}),Rr(n.scroller,"mousewheel",function(e){jt(t,e)}),Rr(n.scroller,"DOMMouseScroll",function(e){jt(t,e)}),Rr(n.scrollbarH,"mousedown",r),Rr(n.scrollbarV,"mousedown",r),Rr(n.wrapper,"scroll",function(){n.wrapper.scrollTop=n.wrapper.scrollLeft=0}),window.registered||(window.registered=0),++window.registered,Rr(window,"resize",i),setTimeout(function u(){for(var e=n.wrapper.parentNode;e&&e!=document.body;e=e.parentNode);e?setTimeout(u,5e3):(--window.registered,Ur(window,"resize",i))},5e3),Rr(n.input,"keyup",mt(t,function(e){if(t.options.onKeyEvent&&t.options.onKeyEvent(t,Pr(e)))return;qr(e,"keyCode")==16&&(t.view.sel.shift=!1)})),Rr(n.input,"input",ni(bt,t)),Rr(n.input,"keydown",mt(t,Wt)),Rr(n.input,"keypress",mt(t,Xt)),Rr(n.input,"focus",ni(Vt,t)),Rr(n.input,"blur",ni($t,t)),t.options.dragDrop&&(Rr(n.scroller,"dragstart",function(e){_t(t,e)}),Rr(n.scroller,"dragenter",s),Rr(n.scroller,"dragover",s),Rr(n.scroller,"drop",mt(t,Ot))),Rr(n.scroller,"paste",function(e){if(Nt(n,e))return;St(t),bt(t)}),Rr(n.input,"paste",function(){n.pasteIncoming=!0,bt(t)}),Rr(n.input,"cut",o),Rr(n.input,"copy",o),f&&Rr(n.sizer,"mouseup",function(){document.activeElement==n.input&&n.input.blur(),St(t)})}function Nt(e,t){for(var n=Fr(t);n!=e.wrapper;n=n.parentNode){if(!n)return!0;if(/\bCodeMirror-(?:line)?widget\b/.test(n.className)||n.parentNode==e.sizer&&n!=e.mover)return!0}}function Ct(e,t,n){var r=e.display;if(!n){var i=Fr(t);if(i==r.scrollbarH||i==r.scrollbarH.firstChild||i==r.scrollbarV||i==r.scrollbarV.firstChild||i==r.scrollbarFiller)return null}var s,o,u=r.lineSpace.getBoundingClientRect();try{s=t.clientX,o=t.clientY}catch(t){return null}return ft(e,s-u.left,o-u.top)}function At(n){function g(e){if(c=="single"){an(r,on(a,f),e);return}v=on(a,v),m=on(a,m);if(c=="double"){var t=bn(Tr(a,e.line).text,e);nn(e,v)?an(r,t.from,m):an(r,v,t.to)}else c=="triple"&&(nn(e,v)?an(r,m,on(a,{line:e.line,ch:0})):an(r,v,on(a,{line:e.line+1,ch:0})))}function w(e){var t=++b,n=Ct(r,e,!0);if(!n)return;if(!tn(n,p)){o.focused||Vt(r),p=n,g(n);var i=P(s,a);(n.line>=i.to||n.line<i.from)&&setTimeout(mt(r,function(){b==t&&w(e)}),150)}else{var u=e.clientY<y.top?-20:e.clientY>y.bottom?20:0;u&&setTimeout(mt(r,function(){if(b!=t)return;s.scroller.scrollTop+=u,w(e)}),50)}}function E(e){b=Infinity;var t=Ct(r,e);t&&g(t),Hr(e),St(r),Ur(document,"mousemove",S),Ur(document,"mouseup",x)}var r=this,s=r.display,o=r.view,u=o.sel,a=o.doc;u.shift=qr(n,"shiftKey");if(Nt(s,n)){i||(s.scroller.draggable=!1,setTimeout(function(){s.scroller.draggable=!0},100));return}if(Mt(r,n))return;var f=Ct(r,n);switch(Ir(n)){case 3:e&&Kt.call(r,r,n);return;case 2:f&&an(r,f),setTimeout(ni(St,r),20),Hr(n);return}if(!f){Fr(n)==s.scroller&&Hr(n);return}o.focused||Vt(r);var l=+(new Date),c="single";if(Lt&&Lt.time>l-400&&tn(Lt.pos,f))c="triple",Hr(n),setTimeout(ni(St,r),20),wn(r,f.line);else if(kt&&kt.time>l-400&&tn(kt.pos,f)){c="double",Lt={time:l,pos:f},Hr(n);var h=bn(Tr(a,f.line).text,f);an(r,h.from,h.to)}else kt={time:l,pos:f};var p=f;if(r.options.dragDrop&&ci&&!xt(r)&&!tn(u.from,u.to)&&!nn(f,u.from)&&!nn(u.to,f)&&c=="single"){var d=mt(r,function(e){i&&(s.scroller.draggable=!1),o.draggingText=!1,Ur(document,"mouseup",d),Ur(s.scroller,"drop",d),Math.abs(n.clientX-e.clientX)+Math.abs(n.clientY-e.clientY)<10&&(Hr(e),an(r,f),St(r))});i&&(s.scroller.draggable=!0),o.draggingText=d,s.scroller.dragDrop&&s.scroller.dragDrop(),Rr(document,"mouseup",d),Rr(s.scroller,"drop",d);return}Hr(n),c=="single"&&an(r,on(a,f));var v=u.from,m=u.to,y=s.wrapper.getBoundingClientRect(),b=0,S=mt(r,function(e){!t&&!Ir(e)?E(e):w(e)}),x=mt(r,E);Rr(document,"mousemove",S),Rr(document,"mouseup",x)}function Ot(e){var t=this;if(Nt(t.display,e)||t.options.onDragEvent&&t.options.onDragEvent(t,Pr(e)))return;Hr(e);var n=Ct(t,e,!0),r=e.dataTransfer.files;if(!n||xt(t))return;if(r&&r.length&&window.FileReader&&window.File){var i=r.length,s=Array(i),o=0,u=function(e,r){var u=new FileReader;u.onload=function(){s[r]=u.result,++o==i&&(n=on(t.view.doc,n),mt(t,function(){var e=en(t,s.join(""),n,n,"paste");fn(t,n,e)})())},u.readAsText(e)};for(var a=0;a<i;++a)u(r[a],a)}else{if(t.view.draggingText&&!nn(n,t.view.sel.from)&&!nn(t.view.sel.to,n)){t.view.draggingText(e),setTimeout(ni(St,t),20);return}try{var s=e.dataTransfer.getData("Text");if(s){var f=t.view.sel.from,l=t.view.sel.to;fn(t,n,n),t.view.draggingText&&en(t,"",f,l,"paste"),t.replaceSelection(s,null,"paste"),St(t),Vt(t)}}catch(e){}}}function Mt(e,t){var n=e.display;try{var r=t.clientX,i=t.clientY}catch(t){return!1}if(r>=Math.floor(n.gutters.getBoundingClientRect().right))return!1;Hr(t);if(!Xr(e,"gutterClick"))return!0;var s=n.lineDiv.getBoundingClientRect();if(i>s.bottom)return!0;i-=s.top-n.viewOffset;for(var o=0;o<e.options.gutters.length;++o){var u=n.gutters.childNodes[o];if(u&&u.getBoundingClientRect().right>=r){var a=Lr(e.view.doc,i),f=e.options.gutters[o];Wr(e,e,"gutterClick",e,a,f,t);break}}return!0}function _t(e,t){if(Nt(e.display,t))return;var n=e.getSelection();t.dataTransfer.setData("Text",n);if(t.dataTransfer.setDragImage&&!a){var r=ui("img",null,null,"position: fixed; left: 0; top: 0;");u&&(r.width=r.height=1,e.display.wrapper.appendChild(r),r._top=r.offsetTop),t.dataTransfer.setDragImage(r,0,0),u&&r.parentNode.removeChild(r)}}function Dt(t,n){if(Math.abs(t.view.scrollTop-n)<2)return;t.view.scrollTop=n,e||I(t,[],n),t.display.scroller.scrollTop!=n&&(t.display.scroller.scrollTop=n),t.display.scrollbarV.scrollTop!=n&&(t.display.scrollbarV.scrollTop=n),e&&I(t,[])}function Pt(e,t,n){if(n?t==e.view.scrollLeft:Math.abs(e.view.scrollLeft-t)<2)return;t=Math.min(t,e.display.scroller.scrollWidth-e.display.scroller.clientWidth),e.view.scrollLeft=t,H(e),e.display.scroller.scrollLeft!=t&&(e.display.scroller.scrollLeft=t),e.display.scrollbarH.scrollLeft!=t&&(e.display.scrollbarH.scrollLeft=t)}function jt(t,n){var r=n.wheelDeltaX,s=n.wheelDeltaY;r==null&&n.detail&&n.axis==n.HORIZONTAL_AXIS&&(r=n.detail),s==null&&n.detail&&n.axis==n.VERTICAL_AXIS?s=n.detail:s==null&&(s=n.wheelDelta);if(s&&v&&i)for(var o=n.target;o!=f;o=o.parentNode)if(o.lineObj){t.display.currentWheelTarget=o;break}var a=t.display,f=a.scroller;if(r&&!e&&!u&&Bt!=null){s&&Dt(t,Math.max(0,Math.min(f.scrollTop+s*Bt,f.scrollHeight-f.clientHeight))),Pt(t,Math.max(0,Math.min(f.scrollLeft+r*Bt,f.scrollWidth-f.clientWidth))),Hr(n),a.wheelStartX=null;return}if(s&&Bt!=null){var l=s*Bt,c=t.view.scrollTop,h=c+a.wrapper.clientHeight;l<0?c=Math.max(0,c+l-50):h=Math.min(t.view.doc.height,h+l+50),I(t,[],{top:c,bottom:h})}Ht<20&&(a.wheelStartX==null?(a.wheelStartX=f.scrollLeft,a.wheelStartY=f.scrollTop,a.wheelDX=r,a.wheelDY=s,setTimeout(function(){if(a.wheelStartX==null)return;var e=f.scrollLeft-a.wheelStartX,t=f.scrollTop-a.wheelStartY,n=t&&a.wheelDY&&t/a.wheelDY||e&&a.wheelDX&&e/a.wheelDX;a.wheelStartX=a.wheelStartY=null;if(!n)return;Bt=(Bt*Ht+n)/(Ht+1),++Ht},200)):(a.wheelDX+=r,a.wheelDY+=s))}function Ft(e,t,n){if(typeof t=="string"){t=Mn[t];if(!t)return!1}e.display.pollingFast&&wt(e)&&(e.display.pollingFast=!1);var r=e.view,i=r.sel.shift;try{xt(e)&&(r.suppressEdits=!0),n&&(r.sel.shift=!1),t(e)}catch(s){if(s!=$r)throw s;return!1}finally{r.sel.shift=i,r.suppressEdits=!1}return!0}function It(e){var t=e.view.keyMaps.slice(0);return t.push(e.options.keyMap),e.options.extraKeys&&t.unshift(e.options.extraKeys),t}function Rt(e,t){function a(){u=!0}var n=Dn(e.options.keyMap),i=n.auto;clearTimeout(qt),i&&!Hn(t)&&(qt=setTimeout(function(){Dn(e.options.keyMap)==n&&(e.options.keyMap=i.call?i.call(null,e):i)},50));var s=wi[qr(t,"keyCode")],o=!1;if(s==null||t.altGraphKey)return!1;qr(t,"altKey")&&(s="Alt-"+s),qr(t,y?"metaKey":"ctrlKey")&&(s="Ctrl-"+s),qr(t,y?"ctrlKey":"metaKey")&&(s="Cmd-"+s);var u=!1,f=It(e);return qr(t,"shiftKey")?o=Pn("Shift-"+s,f,function(t){return Ft(e,t,!0)},a)||Pn(s,f,function(t){if(typeof t=="string"&&/^go[A-Z]/.test(t))return Ft(e,t)},a):o=Pn(s,f,function(t){return Ft(e,t)},a),u&&(o=!1),o&&(Hr(t),K(e),r&&(t.oldKeyCode=t.keyCode,t.keyCode=0)),o}function Ut(e,t,n){var r=Pn("'"+n+"'",It(e),function(t){return Ft(e,t,!0)});return r&&(Hr(t),K(e)),r}function Wt(e){var n=this;n.view.focused||Vt(n),t&&e.keyCode==27&&(e.returnValue=!1);if(n.options.onKeyEvent&&n.options.onKeyEvent(n,Pr(e)))return;var r=qr(e,"keyCode");n.view.sel.shift=r==16||qr(e,"shiftKey");var i=Rt(n,e);u&&(zt=i?r:null,!i&&r==88&&!bi&&qr(e,v?"metaKey":"ctrlKey")&&n.replaceSelection(""))}function Xt(e){var t=this;if(t.options.onKeyEvent&&t.options.onKeyEvent(t,Pr(e)))return;var n=qr(e,"keyCode"),r=qr(e,"charCode");if(u&&n==zt){zt=null,Hr(e);return}if((u&&(!e.which||e.which<10)||f)&&Rt(t,e))return;var i=String.fromCharCode(r==null?n:r);this.options.electricChars&&this.view.mode.electricChars&&this.options.smartIndent&&!xt(this)&&this.view.mode.electricChars.indexOf(i)>-1&&setTimeout(mt(t,function(){mn(t,t.view.sel.to.line,"smart")}),75);if(Ut(t,e,i))return;bt(t)}function Vt(e){if(e.options.readOnly=="nocursor")return;e.view.focused||(zr(e,"focus",e),e.view.focused=!0,e.display.scroller.className.search(/\bCodeMirror-focused\b/)==-1&&(e.display.scroller.className+=" CodeMirror-focused"),Et(e,!0)),yt(e),K(e)}function $t(e){e.view.focused&&(zr(e,"blur",e),e.view.focused=!1,e.display.scroller.className=e.display.scroller.className.replace(" CodeMirror-focused","")),clearInterval(e.display.blinker),setTimeout(function(){e.view.focused||(e.view.sel.shift=!1)},150)}function Kt(t,n){function l(){i.inputDiv.style.position="relative",i.input.style.cssText=f,r&&(i.scrollbarV.scrollTop=i.scroller.scrollTop=a),yt(t);if(i.input.selectionStart!=null){clearTimeout(Jt);var e=i.input.value=" "+(tn(s.from,s.to)?"":i.input.value),n=0;i.prevInput=" ",i.input.selectionStart=1,i.input.selectionEnd=e.length,Jt=setTimeout(function o(){i.prevInput==" "&&i.input.selectionStart==0?mt(t,Mn.selectAll)(t):n++<10?Jt=setTimeout(o,500):Et(t)},200)}}var i=t.display;if(Nt(i,n))return;var s=t.view.sel,o=Ct(t,n),a=i.scroller.scrollTop;if(!o||u)return;(tn(s.from,s.to)||nn(o,s.from)||!nn(o,s.to))&&mt(t,fn)(t,o,o);var f=i.input.style.cssText;i.inputDiv.style.position="absolute",i.input.style.cssText="position: fixed; width: 30px; height: 30px; top: "+(n.clientY-5)+"px; left: "+(n.clientX-5)+"px; z-index: 1000; background: white; outline: none;"+"border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);",St(t),Et(t,!0),tn(s.from,s.to)&&(i.input.value=i.prevInput=" "),e?(jr(n),Rr(window,"mouseup",function c(){Ur(window,"mouseup",c),setTimeout(l,20)})):setTimeout(l,50)}function Qt(e,t,n,r,i,s){var o=b&&Xn(e.view.doc,t,n);if(!o)return Gt(e,t,n,r,i,s);for(var u=o.length-1;u>=1;--u)Gt(e,o[u].from,o[u].to,[""],s);if(o.length)return Gt(e,o[0].from,o[0].to,r,i,s)}function Gt(e,t,n,r,i,s){if(e.view.suppressEdits)return;var o=e.view,u=o.doc,a=[];u.iter(t.line,n.line+1,function(e){a.push(er(e.text,e.markedSpans))});var f=o.sel.from,l=o.sel.to,c=Wn(Zn(a[0]),Zn(Yr(a)),t.ch,n.ch,r),h=Zt(e,t,n,c,i,s);return o.history&&_r(e,t.line,r.length,a,s,f,l,o.sel.from,o.sel.to),h}function Yt(e,t){var n=e.view.doc,r=e.view.history,i=(t=="undo"?r.done:r.undone).pop();if(!i)return;var s={events:[],fromBefore:i.fromAfter,toBefore:i.toAfter,fromAfter:i.fromBefore,toAfter:i.toBefore};for(var o=i.events.length-1;o>=0;o-=1){r.dirtyCounter+=t=="undo"?-1:1;var u=i.events[o],a=[],f=u.start+u.added;n.iter(u.start,f,function(e){a.push(er(e.text,e.markedSpans))}),s.events.push({start:u.start,added:u.old.length,old:a});var l=o?null:{from:i.fromBefore,to:i.toBefore};Zt(e,{line:u.start,ch:0},{line:f-1,ch:Tr(n,f-1).text.length},u.old,l,t)}(t=="undo"?r.undone:r.done).push(s)}function Zt(e,t,n,r,i,s){var o=e.view,u=o.doc,a=e.display;if(o.suppressEdits)return;var f=n.line-t.line,l=Tr(u,t.line),c=Tr(u,n.line),h=!1,p=t.line;e.options.lineWrapping||(p=Cr(Kn(u,l)),u.iter(p,n.line+1,function(e){if(e==o.maxLine)return h=!0,!0}));var d=Yr(r),v=ht(a);if(t.ch==0&&n.ch==0&&Yn(d)==""){var m=[];for(var g=0,y=r.length-1;g<y;++g)m.push(ur(Yn(r[g]),Zn(r[g]),v));ar(e,c,c.text,Zn(d)),f&&u.remove(t.line,f,e),m.length&&u.insert(t.line,m)}else if(l==c)if(r.length==1)ar(e,l,l.text.slice(0,t.ch)+Yn(r[0])+l.text.slice(n.ch),Zn(r[0]));else{for(var m=[],g=1,y=r.length-1;g<y;++g)m.push(ur(Yn(r[g]),Zn(r[g]),v));m.push(ur(Yn(d)+l.text.slice(n.ch),Zn(d),v)),ar(e,l,l.text.slice(0,t.ch)+Yn(r[0]),Zn(r[0])),u.insert(t.line+1,m)}else if(r.length==1)ar(e,l,l.text.slice(0,t.ch)+Yn(r[0])+c.text.slice(n.ch),Zn(r[0])),u.remove(t.line+1,f,e);else{var m=[];ar(e,l,l.text.slice(0,t.ch)+Yn(r[0]),Zn(r[0])),ar(e,c,Yn(d)+c.text.slice(n.ch),Zn(d));for(var g=1,y=r.length-1;g<y;++g)m.push(ur(Yn(r[g]),Zn(r[g]),v));f>1&&u.remove(t.line+1,f-1,e),u.insert(t.line+1,m)}if(e.options.lineWrapping){var b=Math.max(5,a.scroller.clientWidth/pt(a)-3);u.iter(t.line,t.line+r.length,function(e){if(e.height==0)return;var t=(Math.ceil(e.text.length/b)||1)*v;t!=e.height&&Nr(e,t)})}else u.iter(p,t.line+r.length,function(e){var t=O(u,e);t>o.maxLineLength&&(o.maxLine=e,o.maxLineLength=t,o.maxLineChanged=!0,h=!1)}),h&&(e.curOp.updateMaxLine=!0);o.frontier=Math.min(o.frontier,t.line),Q(e,400);var w=r.length-f-1;gt(e,t.line,n.line+1,w);if(Xr(e,"change")){for(var g=0;g<r.length;++g)typeof r[g]!="string"&&(r[g]=r[g].text);var E={from:t,to:n,text:r,origin:s};if(e.curOp.textChanged){for(var S=e.curOp.textChanged;S.next;S=S.next);S.next=E}else e.curOp.textChanged=E}var x,T,N={line:t.line+r.length-1,ch:Yn(d).length+(r.length==1?t.ch:0)};if(i&&typeof i!="string")i.from?(x=i.from,T=i.to):x=T=i;else if(i=="end")x=T=N;else if(i=="start")x=T=t;else if(i=="around")x=t,T=N;else{var C=function(e){if(nn(e,t))return e;if(!nn(n,e))return N;var r=e.line+w,i=e.ch;return e.line==n.line&&(i+=Yn(d).length-(n.ch-(n.line==t.line?t.ch:0))),{line:r,ch:i}};x=C(o.sel.from),T=C(o.sel.to)}return fn(e,x,T,null,!0),N}function en(e,t,n,r,i){r||(r=n);if(nn(r,n)){var s=r;r=n,n=s}return Qt(e,n,r,gi(t),null,i)}function tn(e,t){return e.line==t.line&&e.ch==t.ch}function nn(e,t){return e.line<t.line||e.line==t.line&&e.ch<t.ch}function rn(e){return{line:e.line,ch:e.ch}}function sn(e,t){return Math.max(0,Math.min(t,e.size-1))}function on(e,t){if(t.line<0)return{line:0,ch:0};if(t.line>=e.size)return{line:e.size-1,ch:Tr(e,e.size-1).text.length};var n=t.ch,r=Tr(e,t.line).text.length;return n==null||n>r?{line:t.line,ch:r}:n<0?{line:t.line,ch:0}:t}function un(e,t){return t>=0&&t<e.size}function an(e,t,n,r){var i=e.view.sel;if(i.shift||i.extend){var s=i.anchor;if(n){var o=nn(t,s);o!=nn(n,s)?(s=t,t=n):o!=nn(t,n)&&(t=n)}fn(e,s,t,r)}else fn(e,t,n||t,r);e.curOp.userSelChange=!0}function fn(e,t,n,r,i){e.view.goalColumn=null;var s=e.view.sel;if(i||!tn(t,s.anchor))t=cn(e,t,r,i!="push");if(i||!tn(n,s.head))n=cn(e,n,r,i!="push");if(tn(s.anchor,t)&&tn(s.head,n))return;s.anchor=t,s.head=n;var o=nn(n,t);s.from=o?n:t,s.to=o?t:n,e.curOp.updateInput=!0,e.curOp.selectionChanged=!0}function ln(e){fn(e,e.view.sel.from,e.view.sel.to,null,"push")}function cn(e,t,n,r){var i=e.view.doc,s=!1,o=t,u=n||1;e.view.cantEdit=!1;e:for(;;){var a=Tr(i,o.line),f;if(a.markedSpans){for(var l=0;l<a.markedSpans.length;++l){var c=a.markedSpans[l],h=c.marker;if((c.from==null||(h.inclusiveLeft?c.from<=o.ch:c.from<o.ch))&&(c.to==null||(h.inclusiveRight?c.to>=o.ch:c.to>o.ch))){if(r&&h.clearOnEnter){(f||(f=[])).push(h);continue}if(!h.atomic)continue;var p=h.find()[u<0?"from":"to"];if(tn(p,o)){p.ch+=u,p.ch<0?p.line?p=on(i,{line:p.line-1}):p=null:p.ch>a.text.length&&(p.line<i.size-1?p={line:p.line+1,ch:0}:p=null);if(!p){if(s)return r?(e.view.cantEdit=!0,{line:0,ch:0}):cn(e,t,n,!0);s=!0,p=t,u=-u}}o=p;continue e}}if(f)for(var l=0;l<f.length;++l)f[l].clear()}return o}}function hn(e){var t=e.view,n=pn(e,t.sel.head);if(!t.focused)return;var r=e.display,i=r.sizer.getBoundingClientRect(),s=null;n.top+i.top<0?s=!0:n.bottom+i.top>(window.innerHeight||document.documentElement.clientHeight)&&(s=!1);if(s!=null&&!h){var o=r.cursor.style.display=="none";o&&(r.cursor.style.display="",r.cursor.style.left=n.left+"px",r.cursor.style.top=n.top-r.viewOffset+"px"),r.cursor.scrollIntoView(s),o&&(r.cursor.style.display="none")}}function pn(e,t){for(;;){var n=!1,r=at(e,t),i=vn(e,r.left,r.top,r.left,r.bottom),s=e.view.scrollTop,o=e.view.scrollLeft;i.scrollTop!=null&&(Dt(e,i.scrollTop),Math.abs(e.view.scrollTop-s)>1&&(n=!0)),i.scrollLeft!=null&&(Pt(e,i.scrollLeft),Math.abs(e.view.scrollLeft-o)>1&&(n=!0));if(!n)return r}}function dn(e,t,n,r,i){var s=vn(e,t,n,r,i);s.scrollTop!=null&&Dt(e,s.scrollTop),s.scrollLeft!=null&&Pt(e,s.scrollLeft)}function vn(e,t,n,r,i){var s=e.display,o=et(s);n+=o,i+=o;var u=s.scroller.clientHeight-Vr,a=s.scroller.scrollTop,f={},l=e.view.doc.height+2*o,c=n<o+10,h=i+o>l-10;n<a?f.scrollTop=c?0:Math.max(0,n):i>a+u&&(f.scrollTop=(h?l:i)-u);var p=s.scroller.clientWidth-Vr,d=s.scroller.scrollLeft;t+=s.gutters.offsetWidth,r+=s.gutters.offsetWidth;var v=s.gutters.offsetWidth,m=t<v+10;return t<d+v||m?(m&&(t=0),f.scrollLeft=Math.max(0,t-10-v)):r>p+d-3&&(f.scrollLeft=r+10-p),f}function mn(e,t,n,r){var i=e.view.doc;n||(n="add");if(n=="smart")if(!e.view.mode.indent)n="prev";else var s=Z(e,t);var o=e.options.tabSize,u=Tr(i,t),a=Kr(u.text,null,o),f=u.text.match(/^\s*/)[0],l;if(n=="smart"){l=e.view.mode.indent(s,u.text.slice(f.length),u.text);if(l==$r){if(!r)return;n="prev"}}n=="prev"?t?l=Kr(Tr(i,t-1).text,null,o):l=0:n=="add"?l=a+e.options.indentUnit:n=="subtract"&&(l=a-e.options.indentUnit),l=Math.max(0,l);var c="",h=0;if(e.options.indentWithTabs)for(var p=Math.floor(l/o);p;--p)h+=o,c+="	";h<l&&(c+=Gr(l-h)),c!=f&&en(e,c,{line:t,ch:0},{line:t,ch:f.length},"input"),u.stateAfter=null}function gn(e,t,n){var r=t,i=t,s=e.view.doc;return typeof t=="number"?i=Tr(s,sn(s,t)):r=Cr(t),r==null?null:n(i,r)?(gt(e,r,r+1),i):null}function yn(e,t,n,r){function f(){var e=o+t;return e<0||e==i.size?!1:(o=e,a=Tr(i,e))}function l(e){var n=(r?Li:Ai)(a,u,t,!0);if(n==null){if(!!e||!f())return!1;r?u=(t<0?Ni:Ti)(a):u=t<0?a.text.length:0}else u=n;return!0}var i=e.view.doc,s=e.view.sel.head,o=s.line,u=s.ch,a=Tr(i,o);if(n=="char")l();else if(n=="column")l(!0);else if(n=="word"){var c=!1;for(;;){if(t<0&&!l())break;if(ii(a.text.charAt(u)))c=!0;else if(c){t<0&&(t=1,l());break}if(t>0&&!l())break}}return cn(e,{line:o,ch:u},t,!0)}function bn(e,t){var n=t.ch,r=t.ch;if(e){t.after===!1||r==e.length?--n:++r;var i=e.charAt(n),s=ii(i)?ii:/\s/.test(i)?function(e){return/\s/.test(e)}:function(e){return!/\s/.test(e)&&!ii(e)};while(n>0&&s(e.charAt(n-1)))--n;while(r<e.length&&s(e.charAt(r)))++r}return{from:{line:t.line,ch:n},to:{line:t.line,ch:r}}}function wn(e,t){an(e,{line:t,ch:0},on(e.view.doc,{line:t+1,ch:0}))}function xn(e,t,n,r){E.defaults[e]=t,n&&(En[e]=r?function(e,t,r){r!=Tn&&n(e,t,r)}:n)}function An(e,t){if(t===!0)return t;if(e.copyState)return e.copyState(t);var n={};for(var r in t){var i=t[r];i instanceof Array&&(i=i.concat([])),n[r]=i}return n}function On(e,t,n){return e.startState?e.startState(t,n):!0}function Dn(e){return typeof e=="string"?_n[e]:e}function Pn(e,t,n,r){function i(t){t=Dn(t);var s=t[e];if(s===!1)return r&&r(),!0;if(s!=null&&n(s))return!0;if(t.nofallthrough)return r&&r(),!0;var o=t.fallthrough;if(o==null)return!1;if(Object.prototype.toString.call(o)!="[object Array]")return i(o);for(var u=0,a=o.length;u<a;++u)if(i(o[u]))return!0;return!1}for(var s=0;s<t.length;++s)if(i(t[s]))return!0}function Hn(e){var t=wi[qr(e,"keyCode")];return t=="Ctrl"||t=="Alt"||t=="Shift"||t=="Mod"}function Bn(e,t){this.pos=this.start=0,this.string=e,this.tabSize=t||8}function jn(e,t){this.lines=[],this.type=t,this.cm=e}function Fn(e,t,n,r,i){var s=e.view.doc,o=new jn(e,i);if(i=="range"&&!nn(t,n))return o;if(r)for(var u in r)r.hasOwnProperty(u)&&(o[u]=r[u]);o.replacedWith&&(o.collapsed=!0,o.replacedWith=ui("span",[o.replacedWith],"CodeMirror-widget")),o.collapsed&&(w=!0);var a=t.line,f=0,l,c;s.iter(a,n.line+1,function(r){o.collapsed&&!e.options.lineWrapping&&Kn(s,r)==e.view.maxLine&&(e.curOp.updateMaxLine=!0);var i={from:null,to:null,marker:o};f+=r.text.length,a==t.line&&(i.from=t.ch,f-=t.ch),a==n.line&&(i.to=n.ch,f-=r.text.length-n.ch),o.collapsed&&(a==n.line&&(c=Vn(r,n.ch)),a==t.line?l=Vn(r,t.ch):Nr(r,0)),Rn(r,i),++a}),o.collapsed&&s.iter(t.line,n.line+1,function(e){Qn(e)&&Nr(e,0)}),o.readOnly&&(b=!0,(e.view.history.done.length||e.view.history.undone.length)&&e.clearHistory());if(o.collapsed){if(l!=c)throw new Error("Inserting collapsed marker overlapping an existing one");o.size=f,o.atomic=!0}return(o.className||o.startStyle||o.endStyle||o.collapsed)&&gt(e,t.line,n.line+1),o.atomic&&ln(e),o}function In(e,t){if(e)for(var n=0;n<e.length;++n){var r=e[n];if(r.marker==t)return r}}function qn(e,t){for(var n,r=0;r<e.length;++r)e[r]!=t&&(n||(n=[])).push(e[r]);return n}function Rn(e,t){e.markedSpans=e.markedSpans?e.markedSpans.concat([t]):[t],t.marker.lines.push(e)}function Un(e,t){if(e)for(var n=0,r;n<e.length;++n){var i=e[n],s=i.marker,o=i.from==null||(s.inclusiveLeft?i.from<=t:i.from<t);if(o||s.type=="bookmark"&&i.from==t){var u=i.to==null||(s.inclusiveRight?i.to>=t:i.to>t);(r||(r=[])).push({from:i.from,to:u?null:i.to,marker:s})}}return r}function zn(e,t,n){if(e)for(var r=0,i;r<e.length;++r){var s=e[r],o=s.marker,u=s.to==null||(o.inclusiveRight?s.to>=n:s.to>n);if(u||o.type=="bookmark"&&s.from==n&&s.from!=t){var a=s.from==null||(o.inclusiveLeft?s.from<=n:s.from<n);(i||(i=[])).push({from:a?null:s.from-n,to:s.to==null?null:s.to-n,marker:o})}}return i}function Wn(e,t,n,r,i){if(!e&&!t)return i;var s=Un(e,n),o=zn(t,n,r),u=i.length==1,a=Yr(i).length+(u?n:0);if(s)for(var f=0;f<s.length;++f){var l=s[f];if(l.to==null){var c=In(o,l.marker);c?u&&(l.to=c.to==null?null:c.to+a):l.to=n}}if(o)for(var f=0;f<o.length;++f){var l=o[f];l.to!=null&&(l.to+=a);if(l.from==null){var c=In(s,l.marker);c||(l.from=a,u&&(s||(s=[])).push(l))}else l.from+=a,u&&(s||(s=[])).push(l)}var h=[er(i[0],s)];if(!u){var p=i.length-2,d;if(p>0&&s)for(var f=0;f<s.length;++f)s[f].to==null&&(d||(d=[])).push({from:null,to:null,marker:s[f].marker});for(var f=0;f<p;++f)h.push(er(i[f+1],d));h.push(er(Yr(i),o))}return h}function Xn(e,t,n){var r=null;e.iter(t.line,n.line+1,function(e){if(e.markedSpans)for(var t=0;t<e.markedSpans.length;++t){var n=e.markedSpans[t].marker;n.readOnly&&(!r||ei(r,n)==-1)&&(r||(r=[])).push(n)}});if(!r)return null;var i=[{from:t,to:n}];for(var s=0;s<r.length;++s){var o=r[s].find();for(var u=0;u<i.length;++u){var a=i[u];if(!nn(o.from,a.to)||nn(o.to,a.from))continue;var f=[u,1];nn(a.from,o.from)&&f.push({from:a.from,to:o.from}),nn(o.to,a.to)&&f.push({from:o.to,to:a.to}),i.splice.apply(i,f),u+=f.length-1}}return i}function Vn(e,t){var n=w&&e.markedSpans,r;if(n)for(var i,s=0;s<n.length;++s){i=n[s];if(!i.marker.collapsed)continue;(i.from==null||i.from<t)&&(i.to==null||i.to>t)&&(!r||r.width<i.marker.width)&&(r=i.marker)}return r}function $n(e){return Vn(e,-1)}function Jn(e){return Vn(e,e.text.length+1)}function Kn(e,t){var n;while(n=$n(t))t=Tr(e,n.find().from.line);return t}function Qn(e){var t=w&&e.markedSpans;if(t)for(var n,r=0;r<t.length;++r){n=t[r];if(!n.marker.collapsed)continue;if(n.from==null)return!0;if(n.from==0&&n.marker.inclusiveLeft&&Gn(e,n))return!0}}function Gn(e,t){if(t.to==null){var n=t.marker.find().to,r=Tr(kr(e),n.line);return Gn(r,In(r.markedSpans,t.marker))}if(t.marker.inclusiveRight&&t.to==e.text.length)return!0;for(var i,s=0;s<e.markedSpans.length;++s){i=e.markedSpans[s];if(i.marker.collapsed&&i.from==t.to&&(i.marker.inclusiveLeft||t.marker.inclusiveRight)&&Gn(e,i))return!0}}function Yn(e){return typeof e=="string"?e:e.text}function Zn(e){if(typeof e=="string")return null;var t=e.markedSpans,n=null;for(var r=0;r<t.length;++r)t[r].marker.explicitlyCleared?n||(n=t.slice(0,r)):n&&n.push(t[r]);return n?n.length?n:null:t}function er(e,t){return t?{text:e,markedSpans:t}:e}function tr(e){var t=e.markedSpans;if(!t)return;for(var n=0;n<t.length;++n){var r=t[n].marker.lines,i=ei(r,e);r.splice(i,1)}e.markedSpans=null}function nr(e,t){if(!t)return;for(var n=0;n<t.length;++n)t[n].marker.lines.push(e);e.markedSpans=t}function ir(e){return function(){dt(this.cm);try{var t=e.apply(this,arguments)}finally{vt(this.cm)}return t}}function sr(e){return e.height!=null?e.height:((!e.node.parentNode||e.node.parentNode.nodeType!=1)&&fi(e.cm.display.measure,ui("div",[e.node],null,"position: relative")),e.height=e.node.offsetHeight)}function or(e,t,n,r){var i=new rr(e,n,r);return i.noHScroll&&(e.display.alignWidgets=!0),gn(e,t,function(t){(t.widgets||(t.widgets=[])).push(i),i.line=t;if(!Qn(t)||i.showIfHidden){var n=Ar(e,t)<e.display.scroller.scrollTop;Nr(t,t.height+sr(i)),n&&setTimeout(function(){e.display.scroller.scrollTop+=i.height})}return!0}),i}function ur(e,t,n){var r={text:e,height:n};return nr(r,t),Qn(r)&&(r.height=0),r}function ar(e,t,n,r){t.text=n,t.stateAfter&&(t.stateAfter=null),t.styles&&(t.styles=null),t.order!=null&&(t.order=null),tr(t),nr(t,r),Qn(t)?t.height=0:t.height||(t.height=ht(e.display)),Wr(e,t,"change")}function fr(e){e.parent=null,tr(e)}function lr(e,t,n,r,i){var s=e.options.flattenSpans,o="",u=null,a=new Bn(t,e.options.tabSize);t==""&&n.blankLine&&n.blankLine(r);while(!a.eol()){var f=n.token(a,r);a.pos>5e3&&(s=!1,a.pos=Math.min(t.length,a.start+5e4),f=null);var l=a.current();a.start=a.pos,!s||u!=f?(o&&i(o,u),o=l,u=f):o+=l}o&&i(o,u)}function cr(e,t,n){var r=[e.view.modeGen];lr(e,t.text,e.view.mode,n,function(e,t){r.push(e,t)});for(var i=0;i<e.view.overlays.length;++i){var s=e.view.overlays[i],o=1;lr(e,t.text,s.mode,!0,function(e,t){var n=o,i=e.length;while(i){var u=r[o],a=u.length;a<=i?i-=a:(r.splice(o,1,u.slice(0,i),r[o+1],u.slice(i)),i=0),o+=2}if(!t)return;if(s.opaque)r.splice(n,o-n,e,t),o=n+2;else for(;n<o;n+=2){var u=r[n+1];r[n+1]=u?u+" "+t:t}})}return r}function hr(e,t){if(!t.styles||t.styles[0]!=e.view.modeGen)t.styles=cr(e,t,t.stateAfter=Z(e,Cr(t)));return t.styles}function pr(e,t,n){var r=e.view.mode,i=new Bn(t.text,e.options.tabSize);t.text==""&&r.blankLine&&r.blankLine(n);while(!i.eol()&&i.pos<=5e3)r.token(i,n),i.start=i.pos}function vr(e){return e?dr[e]||(dr[e]="cm-"+e.replace(/ +/g," cm-")):null}function mr(e,t,n){var r,i=t,s,o,u=!0;while(r=$n(i))u=!1,i=Tr(e.view.doc,r.find().from.line),s||(s=i);var a={pre:ui("pre"),col:0,pos:0,display:!n,measure:null,addedOne:!1,cm:e};i.textClass&&(a.pre.className=i.textClass);do{a.measure=i==t&&n,a.pos=0,a.addToken=a.measure?br:yr,n&&o&&i!=t&&!a.addedOne&&(n[0]=a.pre.appendChild(mi(e.display.measure)),a.addedOne=!0);var f=Er(i,a,hr(e,i));o=i==s,f&&(i=Tr(e.view.doc,f.to.line),u=!1)}while(f);return n&&!a.addedOne&&(n[0]=a.pre.appendChild(u?ui("span"," "):mi(e.display.measure))),!a.pre.firstChild&&!Qn(t)&&a.pre.appendChild(document.createTextNode(" ")),a.pre}function yr(e,t,n,r,i){if(!t)return;if(!gr.test(t)){e.col+=t.length;var s=document.createTextNode(t)}else{var s=document.createDocumentFragment(),o=0;for(;;){gr.lastIndex=o;var u=gr.exec(t),a=u?u.index-o:t.length-o;a&&(s.appendChild(document.createTextNode(t.slice(o,o+a))),e.col+=a);if(!u)break;o+=a+1;if(u[0]=="	"){var f=e.cm.options.tabSize,l=f-e.col%f;s.appendChild(ui("span",Gr(l),"cm-tab")),e.col+=l}else{var c=ui("span","•","cm-invalidchar");c.title="\\u"+u[0].charCodeAt(0).toString(16),s.appendChild(c),e.col+=1}}}if(n||r||i||e.measure){var h=n||"";return r&&(h+=r),i&&(h+=i),e.pre.appendChild(ui("span",[s],h))}e.pre.appendChild(s)}function br(e,t,n,r,i){for(var s=0;s<t.length;++s)s&&s<t.length&&e.cm.options.lineWrapping&&hi.test(t.slice(s-1,s+1))&&e.pre.appendChild(ui("wbr")),e.measure[e.pos++]=yr(e,t.charAt(s),n,s==0&&r,s==t.length-1&&i);t.length&&(e.addedOne=!0)}function wr(e,t,n){n&&(e.display||(n=n.cloneNode(!0)),e.pre.appendChild(n),e.measure&&t&&(e.measure[e.pos]=n,e.addedOne=!0)),e.pos+=t}function Er(e,t,n){var r=e.markedSpans;if(!r){for(var i=1;i<n.length;i+=2)t.addToken(t,n[i],vr(n[i+1]));return}var s=e.text,o=s.length,u=0,i=1,a="",f,l=0,c,h,p,d;for(;;){if(l==u){c=h=p="",d=null,l=Infinity;var v=null;for(var m=0;m<r.length;++m){var g=r[m],y=g.marker;g.from<=u&&(g.to==null||g.to>u)?(g.to!=null&&l>g.to&&(l=g.to,h=""),y.className&&(c+=" "+y.className),y.startStyle&&g.from==u&&(p+=" "+y.startStyle),y.endStyle&&g.to==l&&(h+=" "+y.endStyle),y.collapsed&&(!d||d.marker.width<y.width)&&(d=g)):g.from>u&&l>g.from&&(l=g.from),y.type=="bookmark"&&g.from==u&&y.replacedWith&&(v=y.replacedWith)}if(d&&(d.from||0)==u){wr(t,(d.to==null?o:d.to)-u,d.from!=null&&d.marker.replacedWith);if(d.to==null)return d.marker.find()}v&&!d&&wr(t,0,v)}if(u>=o)break;var b=Math.min(o,l);for(;;){if(a){var w=u+a.length;if(!d){var E=w>b?a.slice(0,b-u):a;t.addToken(t,E,f+c,p,u+E.length==l?h:"")}if(w>=b){a=a.slice(b-u),u=b;break}u=w,p=""}a=n[i++],f=vr(n[i++])}}}function Sr(e){this.lines=e,this.parent=null;for(var t=0,n=e.length,r=0;t<n;++t)e[t].parent=this,r+=e[t].height;this.height=r}function xr(e){this.children=e;var t=0,n=0;for(var r=0,i=e.length;r<i;++r){var s=e[r];t+=s.chunkSize(),n+=s.height,s.parent=this}this.size=t,this.height=n,this.parent=null}function Tr(e,t){while(!e.lines)for(var n=0;;++n){var r=e.children[n],i=r.chunkSize();if(t<i){e=r;break}t-=i}return e.lines[t]}function Nr(e,t){var n=t-e.height;for(var r=e;r;r=r.parent)r.height+=n}function Cr(e){if(e.parent==null)return null;var t=e.parent,n=ei(t.lines,e);for(var r=t.parent;r;t=r,r=r.parent)for(var i=0;;++i){if(r.children[i]==t)break;n+=r.children[i].chunkSize()}return n}function kr(e){for(var t=e.parent;t.parent;t=t.parent);return t}function Lr(e,t){var n=0;e:do{for(var r=0,i=e.children.length;r<i;++r){var s=e.children[r],o=s.height;if(t<o){e=s;continue e}t-=o,n+=s.chunkSize()}return n}while(!e.lines);for(var r=0,i=e.lines.length;r<i;++r){var u=e.lines[r],a=u.height;if(t<a)break;t-=a}return n+r}function Ar(e,t){t=Kn(e.view.doc,t);var n=0,r=t.parent;for(var i=0;i<r.lines.length;++i){var s=r.lines[i];if(s==t)break;n+=s.height}for(var o=r.parent;o;r=o,o=r.parent)for(var i=0;i<o.children.length;++i){var u=o.children[i];if(u==r)break;n+=u.height}return n}function Or(e){var t=e.order;return t==null&&(t=e.order=Oi(e.text)),t}function Mr(){return{done:[],undone:[],lastTime:0,lastOp:null,lastOrigin:null,dirtyCounter:0}}function _r(e,t,n,r,i,s,o,u,a){var f=e.view.history;f.undone.length=0;var l=+(new Date),c=Yr(f.done);if(c&&(f.lastOp==e.curOp.id||f.lastOrigin==i&&(i=="input"||i=="delete")&&f.lastTime>l-600)){var h=Yr(c.events);if(h.start>t+r.length||h.start+h.added<t)c.events.push({start:t,added:n,old:r});else{var p=Math.max(0,h.start-t),d=Math.max(0,t+r.length-(h.start+h.added));for(var v=p;v>0;--v)h.old.unshift(r[v-1]);for(var v=d;v>0;--v)h.old.push(r[r.length-v]);p&&(h.start=t),h.added+=n-(r.length-p-d)}c.fromAfter=u,c.toAfter=a}else{c={events:[{start:t,added:n,old:r}],fromBefore:s,toBefore:o,fromAfter:u,toAfter:a},f.done.push(c);while(f.done.length>e.options.undoDepth)f.done.shift();f.dirtyCounter<0?f.dirtyCounter=NaN:f.dirtyCounter++}f.lastTime=l,f.lastOp=e.curOp.id,f.lastOrigin=i}function Dr(){jr(this)}function Pr(e){return e.stop||(e.stop=Dr),e}function Hr(e){e.preventDefault?e.preventDefault():e.returnValue=!1}function Br(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}function jr(e){Hr(e),Br(e)}function Fr(e){return e.target||e.srcElement}function Ir(e){var t=e.which;return t==null&&(e.button&1?t=1:e.button&2?t=3:e.button&4&&(t=2)),v&&e.ctrlKey&&t==1&&(t=3),t}function qr(e,t){var n=e.override&&e.override.hasOwnProperty(t);return n?e.override[t]:e[t]}function Rr(e,t,n){if(e.addEventListener)e.addEventListener(t,n,!1);else if(e.attachEvent)e.attachEvent("on"+t,n);else{var r=e._handlers||(e._handlers={}),i=r[t]||(r[t]=[]);i.push(n)}}function Ur(e,t,n){if(e.removeEventListener)e.removeEventListener(t,n,!1);else if(e.detachEvent)e.detachEvent("on"+t,n);else{var r=e._handlers&&e._handlers[t];if(!r)return;for(var i=0;i<r.length;++i)if(r[i]==n){r.splice(i,1);break}}}function zr(e,t){var n=e._handlers&&e._handlers[t];if(!n)return;var r=Array.prototype.slice.call(arguments,2);for(var i=0;i<n.length;++i)n[i].apply(null,r)}function Wr(e,t,n){function o(e){return function(){e.apply(null,i)}}var r=t._handlers&&t._handlers[n];if(!r)return;var i=Array.prototype.slice.call(arguments,3),s=e.curOp&&e.curOp.delayedCallbacks;for(var u=0;u<r.length;++u)s?s.push(o(r[u])):r[u].apply(null,i)}function Xr(e,t){var n=e._handlers&&e._handlers[t];return n&&n.length>0}function Jr(){this.id=null}function Kr(e,t,n){t==null&&(t=e.search(/[^\s\u00a0]/),t==-1&&(t=e.length));for(var r=0,i=0;r<t;++r)e.charAt(r)=="	"?i+=n-i%n:++i;return i}function Gr(e){while(Qr.length<=e)Qr.push(Yr(Qr)+" ");return Qr[e]}function Yr(e){return e[e.length-1]}function Zr(e){p?(e.selectionStart=0,e.selectionEnd=e.value.length):e.select()}function ei(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0,r=e.length;n<r;++n)if(e[n]==t)return n;return-1}function ti(e){for(var t=[],n=0;n<e;++n)t.push(undefined);return t}function ni(e){var t=Array.prototype.slice.call(arguments,1);return function(){return e.apply(null,t)}}function ii(e){return/\w/.test(e)||e>""&&(e.toUpperCase()!=e.toLowerCase()||ri.test(e))}function si(e){var t=0;for(var n in e)e.hasOwnProperty(n)&&e[n]&&++t;return!t}function ui(e,t,n,r){var i=document.createElement(e);n&&(i.className=n),r&&(i.style.cssText=r);if(typeof t=="string")li(i,t);else if(t)for(var s=0;s<t.length;++s)i.appendChild(t[s]);return i}function ai(e){if(!t)e.innerHTML="";else while(e.firstChild)e.removeChild(e.firstChild);return e}function fi(e,t){return ai(e).appendChild(t)}function li(e,t){r?(e.innerHTML="",e.appendChild(document.createTextNode(t))):e.textContent=t}function di(e){if(pi!=null)return pi;var t=ui("div",null,null,"width: 50px; height: 50px; overflow-x: scroll");return fi(e,t),t.offsetWidth&&(pi=t.offsetHeight-t.clientHeight),pi||0}function mi(e){if(vi==null){var t=ui("span","​");fi(e,ui("span",[t,document.createTextNode("x")])),e.firstChild.offsetHeight!=0&&(vi=t.offsetWidth<=1&&t.offsetHeight>2&&!n)}return vi?ui("span","​"):ui("span"," ",null,"display: inline-block; width: 1px; margin-right: -1px")}function Ei(e,t,n,r){if(!e)return r(t,n,"ltr");for(var i=0;i<e.length;++i){var s=e[i];(s.from<n&&s.to>t||t==n&&s.to==t)&&r(Math.max(s.from,t),Math.min(s.to,n),s.level==1?"rtl":"ltr")}}function Si(e){return e.level%2?e.to:e.from}function xi(e){return e.level%2?e.from:e.to}function Ti(e){var t=Or(e);return t?Si(t[0]):0}function Ni(e){var t=Or(e);return t?xi(Yr(t)):e.text.length}function Ci(e,t){var n=Tr(e.view.doc,t),r=Kn(e.view.doc,n);r!=n&&(t=Cr(r));var i=Or(r),s=i?i[0].level%2?Ni(r):Ti(r):0;return{line:t,ch:s}}function ki(e,t){var n,r;while(n=Jn(r=Tr(e.view.doc,t)))t=n.find().to.line;var i=Or(r),s=i?i[0].level%2?Ti(r):Ni(r):r.text.length;return{line:t,ch:s}}function Li(e,t,n,r){var i=Or(e);if(!i)return Ai(e,t,n,r);var s=r?function(t,n){do t+=n;while(t>0&&oi.test(e.text.charAt(t)));return t}:function(e,t){return e+t},o=i[0].level;for(var u=0;u<i.length;++u){var a=i[u],f=a.level%2==o;if(a.from<t&&a.to>t||f&&(a.from==t||a.to==t))break}var l=s(t,a.level%2?-n:n);while(l!=null)if(a.level%2==o){if(!(l<a.from||l>a.to))break;a=i[u+=n],l=a&&(n>0==a.level%2?s(a.to,-1):s(a.from,1))}else if(l==Si(a))a=i[--u],l=a&&xi(a);else{if(l!=xi(a))break;a=i[++u],l=a&&Si(a)}return l<0||l>e.text.length?null:l}function Ai(e,t,n,r){var i=t+n;if(r)while(i>0&&oi.test(e.text.charAt(i)))i+=n;return i<0||i>e.text.length?null:i}var e=/gecko\/\d/i.test(navigator.userAgent),t=/MSIE \d/.test(navigator.userAgent),n=t&&(document.documentMode==null||document.documentMode<8),r=t&&(document.documentMode==null||document.documentMode<9),i=/WebKit\//.test(navigator.userAgent),s=i&&/Qt\/\d+\.\d+/.test(navigator.userAgent),o=/Chrome\//.test(navigator.userAgent),u=/Opera\//.test(navigator.userAgent),a=/Apple Computer/.test(navigator.vendor),f=/KHTML\//.test(navigator.userAgent),l=/Mac OS X 1\d\D([7-9]|\d\d)\D/.test(navigator.userAgent),c=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(navigator.userAgent),h=/PhantomJS/.test(navigator.userAgent),p=/AppleWebKit/.test(navigator.userAgent)&&/Mobile\/\w+/.test(navigator.userAgent),d=p||/Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(navigator.userAgent),v=p||/Mac/.test(navigator.platform),m=/windows/i.test(navigator.platform),g=u&&navigator.userAgent.match(/Version\/(\d*\.\d*)/);g&&(g=Number(g[1]));var y=v&&(s||u&&(g==null||g<12.11)),b=!1,w=!1,ct,kt,Lt,Ht=0,Bt=null;t?Bt=-0.53:e?Bt=15:o?Bt=-0.7:a&&(Bt=-1/3);var qt,zt=null,Jt;E.prototype={getValue:function(e){var t=[],n=this.view.doc;return n.iter(0,n.size,function(e){t.push(e.text)}),t.join(e||"\n")},setValue:mt(null,function(e){var t=this.view.doc,n={line:0,ch:0},r=Tr(t,t.size-1).text.length;Gt(this,n,{line:t.size-1,ch:r},gi(e),n,n,"setValue")}),getSelection:function(e){return this.getRange(this.view.sel.from,this.view.sel.to,e)},replaceSelection:mt(null,function(e,t,n){var r=this.view.sel;Qt(this,r.from,r.to,gi(e),t||"around",n)}),focus:function(){window.focus(),St(this),Vt(this),bt(this)},setOption:function(e,t){var n=this.options,r=n[e];if(n[e]==t&&e!="mode")return;n[e]=t,En.hasOwnProperty(e)&&mt(this,En[e])(this,t,r)},getOption:function(e){return this.options[e]},getMode:function(){return this.view.mode},addKeyMap:function(e){this.view.keyMaps.push(e)},removeKeyMap:function(e){var t=this.view.keyMaps;for(var n=0;n<t.length;++n)if((typeof e=="string"?t[n].name:t[n])==e)return t.splice(n,1),!0},addOverlay:mt(null,function(e,t){var n=e.token?e:E.getMode(this.options,e);if(n.startState)throw new Error("Overlays may not be stateful.");this.view.overlays.push({mode:n,modeSpec:e,opaque:t&&t.opaque}),this.view.modeGen++,gt(this,0,this.view.doc.size)}),removeOverlay:mt(null,function(e){var t=this.view.overlays;for(var n=0;n<t.length;++n)if(t[n].modeSpec==e){t.splice(n,1),this.view.modeGen++,gt(this,0,this.view.doc.size);return}}),undo:mt(null,function(){Yt(this,"undo")}),redo:mt(null,function(){Yt(this,"redo")}),indentLine:mt(null,function(e,t,n){typeof t!="string"&&(t==null?t=this.options.smartIndent?"smart":"prev":t=t?"add":"subtract"),un(this.view.doc,e)&&mn(this,e,t,n)}),indentSelection:mt(null,function(e){var t=this.view.sel;if(tn(t.from,t.to))return mn(this,t.from.line,e);var n=t.to.line-(t.to.ch?0:1);for(var r=t.from.line;r<=n;++r)mn(this,r,e)}),historySize:function(){var e=this.view.history;return{undo:e.done.length,redo:e.undone.length}},clearHistory:function(){this.view.history=Mr()},markClean:function(){this.view.history.dirtyCounter=0,this.view.history.lastOp=this.view.history.lastOrigin=null},isClean:function(){return this.view.history.dirtyCounter==0},getHistory:function(){function t(e){for(var t=0,n=[],r;t<e.length;++t){var i=e[t];n.push({events:r=[],fromBefore:i.fromBefore,toBefore:i.toBefore,fromAfter:i.fromAfter,toAfter:i.toAfter});for(var s=0,o=i.events;s<o.length;++s){var u=[],a=o[s];r.push({start:a.start,added:a.added,old:u});for(var f=0;f<a.old.length;++f)u.push(Yn(a.old[f]))}}return n}var e=this.view.history;return{done:t(e.done),undone:t(e.undone)}},setHistory:function(e){var t=this.view.history=Mr();t.done=e.done,t.undone=e.undone},getTokenAt:function(e){var t=this.view.doc;e=on(t,e);var n=Z(this,e.line),r=this.view.mode,i=Tr(t,e.line),s=new Bn(i.text,this.options.tabSize);while(s.pos<e.ch&&!s.eol()){s.start=s.pos;var o=r.token(s,n)}return{start:s.start,end:s.pos,string:s.current(),className:o||null,type:o||null,state:n}},getStateAfter:function(e){var t=this.view.doc;return e=sn(t,e==null?t.size-1:e),Z(this,e+1)},cursorCoords:function(e,t){var n,r=this.view.sel;return e==null?n=r.head:typeof e=="object"?n=on(this.view.doc,e):n=e?r.from:r.to,at(this,n,t||"page")},charCoords:function(e,t){return ut(this,on(this.view.doc,e),t||"page")},coordsChar:function(e){var t=this.display.lineSpace.getBoundingClientRect();return ft(this,e.left-t.left,e.top-t.top)},defaultTextHeight:function(){return ht(this.display)},markText:mt(null,function(e,t,n){return Fn(this,on(this.view.doc,e),on(this.view.doc,t),n,"range")}),setBookmark:mt(null,function(e,t){return e=on(this.view.doc,e),Fn(this,e,e,t?{replacedWith:t}:{},"bookmark")}),findMarksAt:function(e){var t=this.view.doc;e=on(t,e);var n=[],r=Tr(t,e.line).markedSpans;if(r)for(var i=0;i<r.length;++i){var s=r[i];(s.from==null||s.from<=e.ch)&&(s.to==null||s.to>=e.ch)&&n.push(s.marker)}return n},setGutterMarker:mt(null,function(e,t,n){return gn(this,e,function(e){var r=e.gutterMarkers||(e.gutterMarkers={});return r[t]=n,!n&&si(r)&&(e.gutterMarkers=null),!0})}),clearGutter:mt(null,function(e){var t=0,n=this,r=n.view.doc;r.iter(0,r.size,function(r){r.gutterMarkers&&r.gutterMarkers[e]&&(r.gutterMarkers[e]=null,gt(n,t,t+1),si(r.gutterMarkers)&&(r.gutterMarkers=null)),++t})}),addLineClass:mt(null,function(e,t,n){return gn(this,e,function(e){var r=t=="text"?"textClass":t=="background"?"bgClass":"wrapClass";if(!e[r])e[r]=n;else{if((new RegExp("\\b"+n+"\\b")).test(e[r]))return!1;e[r]+=" "+n}return!0})}),removeLineClass:mt(null,function(e,t,n){return gn(this,e,function(e){var r=t=="text"?"textClass":t=="background"?"bgClass":"wrapClass",i=e[r];if(!i)return!1;if(n==null)e[r]=null;else{var s=i.replace(new RegExp("^"+n+"\\b\\s*|\\s*\\b"+n+"\\b"),"");if(s==i)return!1;e[r]=s||null}return!0})}),addLineWidget:mt(null,function(e,t,n){return or(this,e,t,n)}),removeLineWidget:function(e){e.clear()},lineInfo:function(e){if(typeof e=="number"){if(!un(this.view.doc,e))return null;var t=e;e=Tr(this.view.doc,e);if(!e)return null}else{var t=Cr(e);if(t==null)return null}return{line:t,handle:e,text:e.text,gutterMarkers:e.gutterMarkers,textClass:e.textClass,bgClass:e.bgClass,wrapClass:e.wrapClass,widgets:e.widgets}},getViewport:function(){return{from:this.display.showingFrom,to:this.display.showingTo}},addWidget:function(e,t,n,r,i){var s=this.display;e=at(this,on(this.view.doc,e));var o=e.top,u=e.left;t.style.position="absolute",s.sizer.appendChild(t);if(r=="over")o=e.top;else if(r=="near"){var a=Math.max(s.wrapper.clientHeight,this.view.doc.height),f=Math.max(s.sizer.clientWidth,s.lineSpace.clientWidth);e.bottom+t.offsetHeight>a&&e.top>t.offsetHeight&&(o=e.top-t.offsetHeight),u+t.offsetWidth>f&&(u=f-t.offsetWidth)}t.style.top=o+et(s)+"px",t.style.left=t.style.right="",i=="right"?(u=s.sizer.clientWidth-t.offsetWidth,t.style.right="0px"):(i=="left"?u=0:i=="middle"&&(u=(s.sizer.clientWidth-t.offsetWidth)/2),t.style.left=u+"px"),n&&dn(this,u,o,u+t.offsetWidth,o+t.offsetHeight)},lineCount:function(){return this.view.doc.size},clipPos:function(e){return on(this.view.doc,e)},getCursor:function(e){var t=this.view.sel,n;return e==null||e=="head"?n=t.head:e=="anchor"?n=t.anchor:e=="end"||e===!1?n=t.to:n=t.from,rn(n)},somethingSelected:function(){return!tn(this.view.sel.from,this.view.sel.to)},setCursor:mt(null,function(e,t,n){var r=on(this.view.doc,typeof e=="number"?{line:e,ch:t||0}:e);n?an(this,r):fn(this,r,r)}),setSelection:mt(null,function(e,t){var n=this.view.doc;fn(this,on(n,e),on(n,t||e))}),extendSelection:mt(null,function(e,t){var n=this.view.doc;an(this,on(n,e),t&&on(n,t))}),setExtending:function(e){this.view.sel.extend=e},getLine:function(e){var t=this.getLineHandle(e);return t&&t.text},getLineHandle:function(e){var t=this.view.doc;if(un(t,e))return Tr(t,e)},getLineNumber:function(e){return Cr(e)},setLine:mt(null,function(e,t){un(this.view.doc,e)&&en(this,t,{line:e,ch:0},{line:e,ch:Tr(this.view.doc,e).text.length})}),removeLine:mt(null,function(e){un(this.view.doc,e)&&en(this,"",{line:e,ch:0},on(this.view.doc,{line:e+1,ch:0}))}),replaceRange:mt(null,function(e,t,n){var r=this.view.doc;return t=on(r,t),n=n?on(r,n):t,en(this,e,t,n)}),getRange:function(e,t,n){var r=this.view.doc;e=on(r,e),t=on(r,t);var i=e.line,s=t.line;if(i==s)return Tr(r,i).text.slice(e.ch,t.ch);var o=[Tr(r,i).text.slice(e.ch)];return r.iter(i+1,s,function(e){o.push(e.text)}),o.push(Tr(r,s).text.slice(0,t.ch)),o.join(n||"\n")},triggerOnKeyDown:mt(null,Wt),execCommand:function(e){return Mn[e](this)},moveH:mt(null,function(e,t){var n=this.view.sel,r=e<0?n.from:n.to;if(n.shift||n.extend||tn(n.from,n.to))r=yn(this,e,t,this.options.rtlMoveVisually);an(this,r,r,e)}),deleteH:mt(null,function(e,t){var n=this.view.sel;tn(n.from,n.to)?en(this,"",n.from,yn(this,e,t,!1),"delete"):en(this,"",n.from,n.to,"delete"),this.curOp.userSelChange=!0}),moveV:mt(null,function(e,t){var n=this.view,r=n.doc,i=this.display,s=n.sel.head,o=at(this,s,"div"),u=o.left,a;n.goalColumn!=null&&(u=n.goalColumn);if(t=="page"){var f=Math.min(i.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight);a=o.top+e*f}else t=="line"&&(a=e>0?o.bottom+3:o.top-3);do{var l=ft(this,u,a);a+=e*5}while(l.outside&&(e<0?a>0:a<r.height));t=="page"&&(i.scrollbarV.scrollTop+=ut(this,l,"div").top-o.top),an(this,l,l,e),n.goalColumn=u}),toggleOverwrite:function(){(this.view.overwrite=!this.view.overwrite)?this.display.cursor.className+=" CodeMirror-overwrite":this.display.cursor.className=this.display.cursor.className.replace(" CodeMirror-overwrite","")},posFromIndex:function(e){var t=0,n,r=this.view.doc;return r.iter(0,r.size,function(r){var i=r.text.length+1;if(i>e)return n=e,!0;e-=i,++t}),on(r,{line:t,ch:n})},indexFromPos:function(e){e=on(this.view.doc,e);var t=e.ch;return this.view.doc.iter(0,e.line,function(e){t+=e.text.length+1}),t},scrollTo:function(e,t){e!=null&&(this.display.scrollbarH.scrollLeft=this.display.scroller.scrollLeft=e),t!=null&&(this.display.scrollbarV.scrollTop=this.display.scroller.scrollTop=t),I(this,[])},getScrollInfo:function(){var e=this.display.scroller,t=Vr;return{left:e.scrollLeft,top:e.scrollTop,height:e.scrollHeight-t,width:e.scrollWidth-t,clientHeight:e.clientHeight-t,clientWidth:e.clientWidth-t}},scrollIntoView:function(e){typeof e=="number"&&(e={line:e,ch:0}),!e||e.line!=null?(e=e?on(this.view.doc,e):this.view.sel.head,pn(this,e)):dn(this,e.left,e.top,e.right,e.bottom)},setSize:function(e,t){function n(e){return typeof e=="number"||/^\d+$/.test(String(e))?e+"px":e}e!=null&&(this.display.wrapper.style.width=n(e)),t!=null&&(this.display.wrapper.style.height=n(t)),this.refresh()},on:function(e,t){Rr(this,e,t)},off:function(e,t){Ur(this,e,t)},operation:function(e){return mt(this,e)()},refresh:function(){st(this);var e=this.view.scrollTop,t=this.view.scrollLeft;this.display.scroller.scrollHeight>e&&(this.display.scrollbarV.scrollTop=this.display.scroller.scrollTop=e),this.display.scroller.scrollWidth>t&&(this.display.scrollbarH.scrollLeft=this.display.scroller.scrollLeft=t),I(this,!0)},getInputField:function(){return this.display.input},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}};var En=E.optionHandlers={},Sn=E.defaults={},Tn=E.Init={toString:function(){return"CodeMirror.Init"}};xn("value","",function(e,t){e.setValue(t)},!0),xn("mode",null,T,!0),xn("indentUnit",2,T,!0),xn("indentWithTabs",!1),xn("smartIndent",!0),xn("tabSize",4,function(e){T(e),st(e),I(e,!0)},!0),xn("electricChars",!0),xn("rtlMoveVisually",!m),xn("theme","default",function(e){k(e),L(e)},!0),xn("keyMap","default",C),xn("extraKeys",null),xn("onKeyEvent",null),xn("onDragEvent",null),xn("lineWrapping",!1,N,!0),xn("gutters",[],function(e){_(e.options),L(e)},!0),xn("fixedGutter",!0,function(e,t){e.display.gutters.style.left=t?F(e.display)+"px":"0",e.refresh()},!0),xn("lineNumbers",!1,function(e){_(e.options),L(e)},!0),xn("firstLineNumber",1,L,!0),xn("lineNumberFormatter",function(e){return e},L,!0),xn("showCursorWhenSelecting",!1,V,!0),xn("readOnly",!1,function(e,t){t=="nocursor"?($t(e),e.display.input.blur()):t||Et(e,!0)}),xn("dragDrop",!0),xn("cursorBlinkRate",530),xn("cursorHeight",1),xn("workTime",100),xn("workDelay",100),xn("flattenSpans",!0),xn("pollInterval",100),xn("undoDepth",40),xn("viewportMargin",10,function(e){e.refresh()},!0),xn("tabindex",null,function(e,t){e.display.input.tabIndex=t||""}),xn("autofocus",null);var Nn=E.modes={},Cn=E.mimeModes={};E.defineMode=function(e,t){!E.defaults.mode&&e!="null"&&(E.defaults.mode=e);if(arguments.length>2){t.dependencies=[];for(var n=2;n<arguments.length;++n)t.dependencies.push(arguments[n])}Nn[e]=t},E.defineMIME=function(e,t){Cn[e]=t},E.resolveMode=function(e){if(typeof e=="string"&&Cn.hasOwnProperty(e))e=Cn[e];else if(typeof e=="string"&&/^[\w\-]+\/[\w\-]+\+xml$/.test(e))return E.resolveMode("application/xml");return typeof e=="string"?{name:e}:e||{name:"null"}},E.getMode=function(e,t){t=E.resolveMode(t);var n=Nn[t.name];if(!n)return E.getMode(e,"text/plain");var r=n(e,t);if(kn.hasOwnProperty(t.name)){var i=kn[t.name];for(var s in i){if(!i.hasOwnProperty(s))continue;r.hasOwnProperty(s)&&(r["_"+s]=r[s]),r[s]=i[s]}}return r.name=t.name,r},E.defineMode("null",function(){return{token:function(e){e.skipToEnd()}}}),E.defineMIME("text/plain","null");var kn=E.modeExtensions={};E.extendMode=function(e,t){var n=kn.hasOwnProperty(e)?kn[e]:kn[e]={};for(var r in t)t.hasOwnProperty(r)&&(n[r]=t[r])},E.defineExtension=function(e,t){E.prototype[e]=t},E.defineOption=xn;var Ln=[];E.defineInitHook=function(e){Ln.push(e)},E.copyState=An,E.startState=On,E.innerMode=function(e,t){while(e.innerMode){var n=e.innerMode(t);t=n.state,e=n.mode}return n||{mode:e,state:t}};var Mn=E.commands={selectAll:function(e){e.setSelection({line:0,ch:0},{line:e.lineCount()-1})},killLine:function(e){var t=e.getCursor(!0),n=e.getCursor(!1),r=!tn(t,n);!r&&e.getLine(t.line).length==t.ch?e.replaceRange("",t,{line:t.line+1,ch:0},"delete"):e.replaceRange("",t,r?n:{line:t.line},"delete")},deleteLine:function(e){var t=e.getCursor().line;e.replaceRange("",{line:t,ch:0},{line:t},"delete")},undo:function(e){e.undo()},redo:function(e){e.redo()},goDocStart:function(e){e.extendSelection({line:0,ch:0})},goDocEnd:function(e){e.extendSelection({line:e.lineCount()-1})},goLineStart:function(e){e.extendSelection(Ci(e,e.getCursor().line))},goLineStartSmart:function(e){var t=e.getCursor(),n=Ci(e,t.line),r=e.getLineHandle(n.line),i=Or(r);if(!i||i[0].level==0){var s=Math.max(0,r.text.search(/\S/)),o=t.line==n.line&&t.ch<=s&&t.ch;e.extendSelection({line:n.line,ch:o?0:s})}else e.extendSelection(n)},goLineEnd:function(e){e.extendSelection(ki(e,e.getCursor().line))},goLineUp:function(e){e.moveV(-1,"line")},goLineDown:function(e){e.moveV(1,"line")},goPageUp:function(e){e.moveV(-1,"page")},goPageDown:function(e){e.moveV(1,"page")},goCharLeft:function(e){e.moveH(-1,"char")},goCharRight:function(e){e.moveH(1,"char")},goColumnLeft:function(e){e.moveH(-1,"column")},goColumnRight:function(e){e.moveH(1,"column")},goWordLeft:function(e){e.moveH(-1,"word")},goWordRight:function(e){e.moveH(1,"word")},delCharBefore:function(e){e.deleteH(-1,"char")},delCharAfter:function(e){e.deleteH(1,"char")},delWordBefore:function(e){e.deleteH(-1,"word")},delWordAfter:function(e){e.deleteH(1,"word")},indentAuto:function(e){e.indentSelection("smart")},indentMore:function(e){e.indentSelection("add")},indentLess:function(e){e.indentSelection("subtract")},insertTab:function(e){e.replaceSelection("	","end","input")},defaultTab:function(e){e.somethingSelected()?e.indentSelection("add"):e.replaceSelection("	","end","input")},transposeChars:function(e){var t=e.getCursor(),n=e.getLine(t.line);t.ch>0&&t.ch<n.length-1&&e.replaceRange(n.charAt(t.ch)+n.charAt(t.ch-1),{line:t.line,ch:t.ch-1},{line:t.line,ch:t.ch+1})},newlineAndIndent:function(e){mt(e,function(){e.replaceSelection("\n","end","input"),e.indentLine(e.getCursor().line,null,!0)})()},toggleOverwrite:function(e){e.toggleOverwrite()}},_n=E.keyMap={};_n.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite"},_n.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Alt-Up":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Down":"goDocEnd","Ctrl-Left":"goWordLeft","Ctrl-Right":"goWordRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delWordBefore","Ctrl-Delete":"delWordAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore",fallthrough:"basic"},_n.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goWordLeft","Alt-Right":"goWordRight","Cmd-Left":"goLineStart","Cmd-Right":"goLineEnd","Alt-Backspace":"delWordBefore","Ctrl-Alt-Backspace":"delWordAfter","Alt-Delete":"delWordAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore",fallthrough:["basic","emacsy"]},_n["default"]=v?_n.macDefault:_n.pcDefault,_n.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Alt-F":"goWordRight","Alt-B":"goWordLeft","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-D":"delWordAfter","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars"},E.isModifierKey=Hn,E.fromTextArea=function(e,t){function i(){e.value=u.getValue()}t||(t={}),t.value=e.value,!t.tabindex&&e.tabindex&&(t.tabindex=e.tabindex);if(t.autofocus==null){var n=document.body;try{n=document.activeElement}catch(r){}t.autofocus=n==e||e.getAttribute("autofocus")!=null&&n==document.body}if(e.form){Rr(e.form,"submit",i);var s=e.form,o=s.submit;try{s.submit=function a(){i(),s.submit=o,s.submit(),s.submit=a}}catch(r){}}e.style.display="none";var u=E(function(t){e.parentNode.insertBefore(t,e.nextSibling)},t);return u.save=i,u.getTextArea=function(){return e},u.toTextArea=function(){i(),e.parentNode.removeChild(u.getWrapperElement()),e.style.display="",e.form&&(Ur(e.form,"submit",i),typeof e.form.submit=="function"&&(e.form.submit=o))},u},Bn.prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return this.pos==0},peek:function(){return this.string.charAt(this.pos)||undefined},next:function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)},eat:function(e){var t=this.string.charAt(this.pos);if(typeof e=="string")var n=t==e;else var n=t&&(e.test?e.test(t):e(t));if(n)return++this.pos,t},eatWhile:function(e){var t=this.pos;while(this.eat(e));return this.pos>t},eatSpace:function(){var e=this.pos;while(/[\s\u00a0]/.test(this.string.charAt(this.pos)))++this.pos;return this.pos>e},skipToEnd:function(){this.pos=this.string.length},skipTo:function(e){var t=this.string.indexOf(e,this.pos);if(t>-1)return this.pos=t,!0},backUp:function(e){this.pos-=e},column:function(){return Kr(this.string,this.start,this.tabSize)},indentation:function(){return Kr(this.string,null,this.tabSize)},match:function(e,t,n){if(typeof e!="string"){var i=this.string.slice(this.pos).match(e);return i&&i.index>0?null:(i&&t!==!1&&(this.pos+=i[0].length),i)}var r=function(e){return n?e.toLowerCase():e};if(r(this.string).indexOf(r(e),this.pos)==this.pos)return t!==!1&&(this.pos+=e.length),!0},current:function(){return this.string.slice(this.start,this.pos)}},E.StringStream=Bn,E.TextMarker=jn,jn.prototype.clear=function(){if(this.explicitlyCleared)return;dt(this.cm);var e=this.cm.view,t=null,n=null;for(var r=0;r<this.lines.length;++r){var i=this.lines[r],s=In(i.markedSpans,this);s.to!=null&&(n=Cr(i)),i.markedSpans=qn(i.markedSpans,s),s.from!=null?t=Cr(i):this.collapsed&&!Qn(i)&&Nr(i,ht(this.cm.display))}if(this.collapsed&&!this.cm.options.lineWrapping)for(var r=0;r<this.lines.length;++r){var o=Kn(e.doc,this.lines[r]),u=O(e.doc,o);u>e.maxLineLength&&(e.maxLine=o,e.maxLineLength=u,e.maxLineChanged=!0)}t!=null&&gt(this.cm,t,n+1),this.lines.length=0,this.explicitlyCleared=!0,this.collapsed&&this.cm.view.cantEdit&&(this.cm.view.cantEdit=!1,ln(this.cm)),vt(this.cm),Wr(this.cm,this,"clear")},jn.prototype.find=function(){var e,t;for(var n=0;n<this.lines.length;++n){var r=this.lines[n],i=In(r.markedSpans,this);if(i.from!=null||i.to!=null){var s=Cr(r);i.from!=null&&(e={line:s,ch:i.from}),i.to!=null&&(t={line:s,ch:i.to})}}return this.type=="bookmark"?e:e&&{from:e,to:t}},jn.prototype.getOptions=function(e){var t=this.replacedWith;return{className:this.className,inclusiveLeft:this.inclusiveLeft,inclusiveRight:this.inclusiveRight,atomic:this.atomic,collapsed:this.collapsed,clearOnEnter:this.clearOnEnter,replacedWith:e?t&&t.cloneNode(!0):t,readOnly:this.readOnly,startStyle:this.startStyle,endStyle:this.endStyle}};var rr=E.LineWidget=function(e,t,n){for(var r in n)n.hasOwnProperty(r)&&(this[r]=n[r]);this.cm=e,this.node=t};rr.prototype.clear=ir(function(){var e=this.line.widgets,t=Cr(this.line);if(t==null||!e)return;for(var n=0;n<e.length;++n)e[n]==this&&e.splice(n--,1);Nr(this.line,Math.max(0,this.line.height-sr(this))),gt(this.cm,t,t+1)}),rr.prototype.changed=ir(function(){var e=this.height;this.height=null;var t=sr(this)-e;if(!t)return;Nr(this.line,this.line.height+t);var n=Cr(this.line);gt(this.cm,n,n+1)});var dr={},gr=/[\t\u0000-\u0019\u200b\u2028\u2029\uFEFF]/g;Sr.prototype={chunkSize:function(){return this.lines.length},remove:function(e,t,n){for(var r=e,i=e+t;r<i;++r){var s=this.lines[r];this.height-=s.height,fr(s),Wr(n,s,"delete")}this.lines.splice(e,t)},collapse:function(e){e.splice.apply(e,[e.length,0].concat(this.lines))},insertHeight:function(e,t,n){this.height+=n,this.lines=this.lines.slice(0,e).concat(t).concat(this.lines.slice(e));for(var r=0,i=t.length;r<i;++r)t[r].parent=this},iterN:function(e,t,n){for(var r=e+t;e<r;++e)if(n(this.lines[e]))return!0}},xr.prototype={chunkSize:function(){return this.size},remove:function(e,t,n){this.size-=t;for(var r=0;r<this.children.length;++r){var i=this.children[r],s=i.chunkSize();if(e<s){var o=Math.min(t,s-e),u=i.height;i.remove(e,o,n),this.height-=u-i.height,s==o&&(this.children.splice(r--,1),i.parent=null);if((t-=o)==0)break;e=0}else e-=s}if(this.size-t<25){var a=[];this.collapse(a),this.children=[new Sr(a)],this.children[0].parent=this}},collapse:function(e){for(var t=0,n=this.children.length;t<n;++t)this.children[t].collapse(e)},insert:function(e,t){var n=0;for(var r=0,i=t.length;r<i;++r)n+=t[r].height;this.insertHeight(e,t,n)},insertHeight:function(e,t,n){this.size+=t.length,this.height+=n;for(var r=0,i=this.children.length;r<i;++r){var s=this.children[r],o=s.chunkSize();if(e<=o){s.insertHeight(e,t,n);if(s.lines&&s.lines.length>50){while(s.lines.length>50){var u=s.lines.splice(s.lines.length-25,25),a=new Sr(u);s.height-=a.height,this.children.splice(r+1,0,a),a.parent=this}this.maybeSpill()}break}e-=o}},maybeSpill:function(){if(this.children.length<=10)return;var e=this;do{var t=e.children.splice(e.children.length-5,5),n=new xr(t);if(!e.parent){var r=new xr(e.children);r.parent=e,e.children=[r,n],e=r}else{e.size-=n.size,e.height-=n.height;var i=ei(e.parent.children,e);e.parent.children.splice(i+1,0,n)}n.parent=e.parent}while(e.children.length>10);e.parent.maybeSpill()},iter:function(e,t,n){this.iterN(e,t-e,n)},iterN:function(e,t,n){for(var r=0,i=this.children.length;r<i;++r){var s=this.children[r],o=s.chunkSize();if(e<o){var u=Math.min(t,o-e);if(s.iterN(e,u,n))return!0;if((t-=u)==0)break;e=0}else e-=o}}},E.e_stop=jr,E.e_preventDefault=Hr,E.e_stopPropagation=Br,E.on=Rr,E.off=Ur,E.signal=zr;var Vr=30,$r=E.Pass={toString:function(){return"CodeMirror.Pass"}};Jr.prototype={set:function(e,t){clearTimeout(this.id),this.id=setTimeout(t,e)}},E.countColumn=Kr;var Qr=[""],ri=/[\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc]/,oi=/[\u0300-\u036F\u0483-\u0487\u0488-\u0489\u0591-\u05BD\u05BF\u05C1-\u05C2\u05C4-\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7-\u06E8\u06EA-\u06ED\uA66F\uA670-\uA672\uA674-\uA67D\uA69F]/,ci=function(){if(r)return!1;var e=ui("div");return"draggable"in e||"dragDrop"in e}(),hi=/^$/;e?hi=/$'/:a?hi=/\-[^ \-?]|\?[^ !'\"\),.\-\/:;\?\]\}]/:o&&(hi=/\-[^ \-\.?]|\?[^ \-\.?\]\}:;!'\"\),\/]|[\.!\"#&%\)*+,:;=>\]|\}~][\(\{\[<]|\$'/);var pi,vi,gi="\n\nb".split(/\n/).length!=3?function(e){var t=0,n=[],r=e.length;while(t<=r){var i=e.indexOf("\n",t);i==-1&&(i=e.length);var s=e.slice(t,e.charAt(i-1)=="\r"?i-1:i),o=s.indexOf("\r");o!=-1?(n.push(s.slice(0,o)),t+=o+1):(n.push(s),t=i+1)}return n}:function(e){return e.split(/\r\n?|\n/)};E.splitLines=gi;var yi=window.getSelection?function(e){try{return e.selectionStart!=e.selectionEnd}catch(t){return!1}}:function(e){try{var t=e.ownerDocument.selection.createRange()}catch(n){}return!t||t.parentElement()!=e?!1:t.compareEndPoints("StartToEnd",t)!=0},bi=function(){var e=ui("div");return"oncopy"in e?!0:(e.setAttribute("oncopy","return;"),typeof e.oncopy=="function")}(),wi={3:"Enter",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",91:"Mod",92:"Mod",93:"Mod",109:"-",107:"=",127:"Delete",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63276:"PageUp",63277:"PageDown",63275:"End",63273:"Home",63234:"Left",63232:"Up",63235:"Right",63233:"Down",63302:"Insert",63272:"Delete"};E.keyNames=wi,function(){for(var e=0;e<10;e++)wi[e+48]=String(e);for(var e=65;e<=90;e++)wi[e]=String.fromCharCode(e);for(var e=1;e<=12;e++)wi[e+111]=wi[e+63235]="F"+e}();var Oi=function(){function n(n){return n<=255?e.charAt(n):1424<=n&&n<=1524?"R":1536<=n&&n<=1791?t.charAt(n-1536):1792<=n&&n<=2220?"r":"L"}var e="bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLL",t="rrrrrrrrrrrr,rNNmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmrrrrrrrnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmNmmmmrrrrrrrrrrrrrrrrrr",r=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,i=/[stwN]/,s=/[LRr]/,o=/[Lb1n]/,u=/[1n]/,a="L";return function(t){if(!r.test(t))return!1;var f=t.length,l=[];for(var c=0,h;c<f;++c)l.push(h=n(t.charCodeAt(c)));for(var c=0,p=a;c<f;++c){var h=l[c];h=="m"?l[c]=p:p=h}for(var c=0,d=a;c<f;++c){var h=l[c];h=="1"&&d=="r"?l[c]="n":s.test(h)&&(d=h,h=="r"&&(l[c]="R"))}for(var c=1,p=l[0];c<f-1;++c){var h=l[c];h=="+"&&p=="1"&&l[c+1]=="1"?l[c]="1":h==","&&p==l[c+1]&&(p=="1"||p=="n")&&(l[c]=p),p=h}for(var c=0;c<f;++c){var h=l[c];if(h==",")l[c]="N";else if(h=="%"){for(var v=c+1;v<f&&l[v]=="%";++v);var m=c&&l[c-1]=="!"||v<f-1&&l[v]=="1"?"1":"N";for(var g=c;g<v;++g)l[g]=m;c=v-1}}for(var c=0,d=a;c<f;++c){var h=l[c];d=="L"&&h=="1"?l[c]="L":s.test(h)&&(d=h)}for(var c=0;c<f;++c)if(i.test(l[c])){for(var v=c+1;v<f&&i.test(l[v]);++v);var y=(c?l[c-1]:a)=="L",b=(v<f-1?l[v]:a)=="L",m=y||b?"L":"R";for(var g=c;g<v;++g)l[g]=m;c=v-1}var w=[],E;for(var c=0;c<f;)if(o.test(l[c])){var S=c;for(++c;c<f&&o.test(l[c]);++c);w.push({from:S,to:c,level:0})}else{var x=c,T=w.length;for(++c;c<f&&l[c]!="L";++c);for(var g=x;g<c;)if(u.test(l[g])){x<g&&w.splice(T,0,{from:x,to:g,level:1});var N=g;for(++g;g<c&&u.test(l[g]);++g);w.splice(T,0,{from:N,to:g,level:2}),x=g}else++g;x<c&&w.splice(T,0,{from:x,to:c,level:1})}return w[0].level==1&&(E=t.match(/^\s+/))&&(w[0].from=E[0].length,w.unshift({from:0,to:E[0].length,level:0})),Yr(w).level==1&&(E=t.match(/\s+$/))&&(Yr(w).to-=E[0].length,w.push({from:f-E[0].length,to:f,level:0})),w[0].level!=Yr(w).level&&w.push({from:f,to:f,level:w[0].level}),w}}();return E.version="3.02",E}(),define("codemirror",function(e){return function(){var t,n;return t||e.CodeMirror}}(this)),function(){function n(n){"_activeLine"in n&&(n.removeLineClass(n._activeLine,"wrap",e),n.removeLineClass(n._activeLine,"background",t))}function r(r){var i=r.getLineHandle(r.getCursor().line);if(r._activeLine==i)return;n(r),r.addLineClass(i,"wrap",e),r.addLineClass(i,"background",t),r._activeLine=i}var e="CodeMirror-activeline",t="CodeMirror-activeline-background";CodeMirror.defineOption("styleActiveLine",!1,function(e,t,i){var s=i&&i!=CodeMirror.Init;t&&!s?(r(e),e.on("cursorActivity",r)):!t&&s&&(e.off("cursorActivity",r),n(e),delete e._activeLine)})}(),define("codemirrormarkselection",function(){}),function(){function e(e){e._selectionMark&&e._selectionMark.clear()}function t(t){e(t),t.somethingSelected()?t._selectionMark=t.markText(t.getCursor("start"),t.getCursor("end"),{className:"CodeMirror-selectedtext"}):t._selectionMark=null}CodeMirror.defineOption("styleSelectedText",!1,function(n,r,i){var s=i&&i!=CodeMirror.Init;r&&!s?(t(n),n.on("cursorActivity",t)):!r&&s&&(n.off("cursorActivity",t),e(n),delete n._selectionMark)})}(),define("codemirroractiveline",function(){});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("application/views/codeeditor",["require","backbone","codemirror","../events","codemirrormarkselection","codemirroractiveline"],function(e){var t,n,r,i;return t=e("backbone"),r=e("codemirror"),i=e("../events"),e("codemirrormarkselection"),e("codemirroractiveline"),r.defineMode("uml",function(){var e;return e=/^(?:title|participant|as|alt|opt|loop|else|end)$/im,{token:function(t){var n,r;if(t.eatSpace())return null;n=t.next();if(n==="'")return t.skipToEnd(),"comment";if(n==='"')return t.skipTo('"'),"string";if(/\w/.test(n)){t.eatWhile(/\w/),r=t.current();if(e.test(r))return"keyword"}}}}),n=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.el="#code-text-area",t.prototype.initialize=function(e){var t=this;return this.context=e.context,this.editor=r.fromTextArea(this.$el.get(0),{mode:"uml",tabSize:2,indentWithTabs:!0,lineNumbers:!0,dragDrop:!1,styleActiveLine:!0}),this.oldCode=this.editor.getValue(),this.editor.on("change",function(){return t.onCodeChanged()}),this.listenTo(i,"exampleSelected",this.onExampleSelected),this.listenTo(i,"documentChanged",this.onDocumentChanged)},t.prototype.setContent=function(e){return this.changing=!0,this.context.setCurrentDocumentContent(e),this.editor.setValue(e),i.trigger("codeChanged",{code:e}),this.changing=!1},t.prototype.onExampleSelected=function(e){var t;return this.context.isCurrentDocumentEditable()?(t=this.editor.getValue(),t&&(t+="\n"),t+=e.example.get("snippet"),this.editor.setValue(t),this.editor.focus()):!1},t.prototype.onDocumentChanged=function(){var e;return this.changing=!0,e=this.context.getCurrentDocumentContent(),this.editor.setOption("readOnly",!this.context.isCurrentDocumentEditable()),this.editor.setValue(e),this.editor.focus(),this.changing=!1},t.prototype.onCodeChanged=function(e){var t;return t=this.editor.getValue(),t===this.oldCode?!1:(this.context.setCurrentDocumentContent(t),i.trigger("codeChanged",{code:t}),this.changing||i.trigger("broadcastDocumentContentChange",{content:t}),this.oldCode=t)},t}(t.View)});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("application/views/outputgenerator",["require","backbone","../events"],function(e){var t,n,r;return t=e("backbone"),r=e("../events"),n=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.el="#output-text-area",t.prototype.initialize=function(){return this.listenTo(r,"parseStarted",this.onParseStarted),this.listenTo(r,"parseWarning parseError",this.onParseWarningOrError),this.listenTo(r,"parseCompleted",this.onParseCompleted)},t.prototype.onParseStarted=function(){return this.$el.val("")},t.prototype.onParseWarningOrError=function(e){var t;return t=this.$el.val(),t&&(t+="\n"),t+=e.message,this.$el.val(t)},t.prototype.onParseCompleted=function(e){var t;return(e!=null?e.diagram:void 0)==null?!1:(t=this.$el.val(),t&&(t+="\n"),t+="Diagram generated successfully.",this.$el.val(t))},t}(t.View)}),define("application/uml/language/sequence/comment",[],function(){var e;return e=function(){function e(){}return e.prototype.handles=function(e){return/^[\s\t]*'/i.test(e.line)},e}()}),define("application/uml/language/sequence/helpers",[],function(){return{trim:function(e){var t,n;if(!e)return e;n=e.replace(/^\s+/,""),t=n.length-1;while(t>=0){if(/\S/.test(n.charAt(t))){n=n.substring(0,t+1);break}t--}return n}}}),define("application/uml/language/sequence/title",["require","./helpers"],function(e){var t,n;return n=e("./helpers").trim,t=function(){function e(){}return e.prototype.handles=function(e){var t,r;r=e.line.match(/^title\s+(\w.*)/i);if(!r)return!1;if(e.title||e.participants.length||e.commands.length)throw t="Error on line "+e.getLineNumber()+", "+"title must be defined before any other instruction.",new Error(t);return e.setTitle(n(r[1])),!0},e}()}),define("application/uml/language/sequence/participant",["require","./helpers"],function(e){var t,n;return n=e("./helpers").trim,t=function(){function e(){}return e.prototype.handles=function(e){var t,r,i,s,o;i=e.line.match(/^participant\s+(.+)/i);if(!i)return!1;o=i[1],i=o.match(/^"(\w.*)"\s+as\s+(\w.*)/i),i?(s=n(i[1]),t=n(i[2])):s=n(o);if(e.findParticipant(s))throw r="Error on line "+e.getLineNumber()+", "+('participant with name "'+s+'" already exists.'),new Error(r);if(t!=null&&e.findParticipant(t))throw r="Error on line "+e.getLineNumber()+", "+('participant with alias "'+t+'" already exists.'),new Error(r);return e.addParticipant(s,t),!0},e}()}),define("application/uml/language/sequence/message",["require","underscore","./helpers"],function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p;return p=e("underscore"),h=e("./helpers").trim,f={asyncDash:"-->>",syncDash:"-->",asyncLine:"->>",syncLine:"->"},i={asyncDash:"<<--",syncDash:"<--",asyncLine:"<<-",syncLine:"<-"},l=p(f).values(),s=p(i).values(),o=[f.asyncLine,f.syncLine,i.asyncLine,i.syncLine],r=[f.asyncDash,f.syncDash,i.asyncDash,i.syncDash],c=[f.syncDash,f.syncLine,i.syncDash,i.syncLine],n=[f.asyncDash,f.asyncLine,i.asyncDash,i.asyncLine],t=p(l).union(s),a=new RegExp("^[\\s|\\t]*(\\w.*)\\s+("+t.join("|")+")\\s+(\\w.*)\\s*:\\s*(\\w.*)","i"),u=function(){function e(){}return e.prototype.handles=function(e){var t,i,u,f,d,v,m,g;d=e.line.match(a);if(!d)return!1;t=h(d[2]);if(p(l).contains(t))g=e.findOrCreateParticipant(h(d[1])),m=e.findOrCreateParticipant(h(d[3]));else{if(!p(s).contains(t))throw f="Error on line "+e.getLineNumber()+", "+('unrecognized arrow "'+t+'".'),new Error(f);m=e.findOrCreateParticipant(h(d[1])),g=e.findOrCreateParticipant(h(d[3]))}return i=function(){if(p(n).contains(t))return!0;if(p(c).contains(t))return!1;throw f="Error on line "+e.getLineNumber()+", "+('unrecognized arrow "'+t+'".'),new Error(f)}(),u=function(){if(p(r).contains(t))return!0;if(p(o).contains(t))return!1;throw f="Error on line "+e.getLineNumber()+", "+('unrecognized arrow "'+t+'".'),new Error(f)}(),v=h(d[4]),e.addMessage(g,m,v,i,u),!0},e}()}),define("application/uml/models/sequence/grouptype",[],function(){return{opt:"opt",loop:"loop"}}),define("application/uml/language/sequence/group",["require","underscore","../../models/sequence/grouptype","./helpers"],function(e){var t,n,r,i,s,o;return o=e("underscore"),r=e("../../models/sequence/grouptype"),s=e("./helpers").trim,n=o(r).values(),i=new RegExp("^[\\s|\\t]*("+n.join("|")+")\\s*(.*)","i"),t=function(){function e(){}return e.prototype.handles=function(e){var t;return(t=e.line.match(i))?(e.addGroup(s(t[1]),s(t[2])),!0):!1},e}()}),define("application/uml/language/sequence/condition",["require","./helpers"],function(e){var t,n;return n=e("./helpers").trim,t=function(){function e(){}return e.prototype.handles=function(e){var t;return(t=e.line.match(/^[\s\t]*alt\s*(.*)/i))?(e.addIf(n(t[1])),!0):(t=e.line.match(/^[\s\t]*else\s*(.*)/i))?(e.addElse(n(t[1])),!0):!1},e}()}),define("application/uml/language/sequence/end",[],function(){var e;return e=function(){function e(){}return e.prototype.handles=function(e){return/^[\s\t]*end/i.test(e.line)?(e.closeParent(),!0):!1},e}()}),define("application/uml/models/sequence/title",[],function(){var e;return e=function(){function e(e){this.text=e}return e}()}),define("application/uml/models/sequence/participant",[],function(){var e;return e=function(){function e(e,t){this.name=e,this.alias=t}return e}()}),define("application/uml/models/sequence/base",[],function(){var e;return e=function(){function e(e){this.setParent(e)}return e.prototype.setParent=function(e){var t;return this.parent===e?this:(this.parent&&(t=this.parent.children.indexOf(this),t>=0&&this.parent.children.splice(t,1)),this.parent=e,this.parent&&this.parent.children.push(this),this)},e}()});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("application/uml/models/sequence/message",["require","./base"],function(e){var t,n;return t=e("./base"),n=function(e){function t(e,n,r,i,s,o){this.sender=e,this.receiver=n,this.name=r,this.async=i,this.callReturn=s,t.__super__.constructor.call(this,o)}return __extends(t,e),t.prototype.selfInvoking=function(){return this.sender===this.receiver},t}(t)});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("application/uml/models/sequence/composite",["require","./base"],function(e){var t,n;return t=e("./base"),n=function(e){function t(e){this.children=[],t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t}(t)});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("application/uml/models/sequence/group",["require","./composite"],function(e){var t,n;return t=e("./composite"),n=function(e){function t(e,n,r){this.label=n,this.type=r,t.__super__.constructor.call(this,e)}return __extends(t,e),t}(t)});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("application/uml/models/sequence/condition",["require","underscore","./composite","./group"],function(e){var t,n,r,i;return i=e("underscore"),t=e("./composite"),r=e("./group"),n=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.createIfGroup=function(e){return new r(this,e)},t.prototype.addElseGroup=function(e){return new r(this,e)},t.prototype.getIfGroup=function(){return i(this.children).first()},t.prototype.getElseGroups=function(){return i(this.children).rest()},t}(t)}),define("application/uml/models/sequence/diagram",[],function(){var e;return e=function(){function e(e,t,n){this.title=e,this.participants=t!=null?t:[],this.commands=n!=null?n:[]}return e}()}),define("application/uml/language/sequence/context",["require","underscore","../../models/sequence/title","../../models/sequence/participant","../../models/sequence/message","../../models/sequence/group","../../models/sequence/condition","../../models/sequence/diagram"],function(e){var t,n,r,i,s,o,u,a;return a=e("underscore"),u=e("../../models/sequence/title"),o=e("../../models/sequence/participant"),s=e("../../models/sequence/message"),i=e("../../models/sequence/group"),t=e("../../models/sequence/condition"),r=e("../../models/sequence/diagram"),n=function(){function e(e){this.payload=e,this.participants=[],this.commands=[]}return e.prototype.getLineNumber=function(){return(this.index||0)+1},e.prototype.updateLineInfo=function(e,t){this.line=e,this.index=t},e.prototype.setTitle=function(e){return this.title=new u(e)},e.prototype.addParticipant=function(e,t){var n;return n=new o(e,t),this.participants.push(n),n},e.prototype.findParticipant=function(e){return e&&this.participants.length&&a(this.participants).find(function(t){return e===t.name||e===t.alias})},e.prototype.findOrCreateParticipant=function(e){return this.findParticipant(e)||this.addParticipant(e)},e.prototype.addMessage=function(e,t,n,r,i){var o;return o=new s(e,t,n,r,i,this.parentCommand),this.parentCommand||this.commands.push(o),o},e.prototype.addGroup=function(e,t){var n;return n=new i(this.parentCommand,t,e),this.parentCommand||this.commands.push(n),this.parentCommand=n,n},e.prototype.addIf=function(e){var n,r;return n=new t(this.parentCommand),r=n.createIfGroup(e),this.parentCommand||this.commands.push(n),this.parentCommand=r,r},e.prototype.addElse=function(e){var t,n,r,i;if(!((r=this.parentCommand)!=null?(i=r.parent)!=null?i.getIfGroup():void 0:void 0))throw t="Error on line "+this.getLineNumber()+", cannot "+'use "else" without an "alt".',new Error(t);return n=this.parentCommand.parent.addElseGroup(e),this.parentCommand=n,n},e.prototype.closeParent=function(){var e;if(!this.parentCommand)throw e="Error on line "+this.getLineNumber()+", cannot end "+"without a group start.",new Error(e);return this.parentCommand.parent instanceof t&&(this.parentCommand=this.parentCommand.parent),this.parentCommand=this.parentCommand.parent},e.prototype.done=function(){var e;if(!this.parentCommand)return;throw e='Error! One or more group(s) is not properly closed, please add the missing "end" for unclosed group(s).',new Error(e)},e.prototype.getDiagram=function(){return new r(this.title,this.participants,this.commands)},e}()}),define("application/uml/language/sequence/parser",["require","underscore","./comment","./title","./participant","./message","./group","./condition","./end","./context","./helpers"],function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p;return p=e("underscore"),t=e("./comment"),l=e("./title"),f=e("./participant"),o=e("./message"),s=e("./group"),n=e("./condition"),i=e("./end"),r=e("./context"),h=e("./helpers").trim,u=/(\r\n|\n|\r)/g,c=function(){return[new t,new l,new f,new o,new s,new n,new i]},a=function(){function e(e){e==null&&(e={}),this.callbacks=p(e.callbacks||{}).defaults({onStart:function(){},onWarning:function(){},onError:function(){},onComplete:function(){}}),this.handlers=e.handlers||c()}return e.prototype.contextType=r,e.prototype.parse=function(e){var t,n,r,i,s=this;this.callbacks.onStart();if(!e)return this.callbacks.onComplete(),!1;i=p(e.split(u)).reject(function(e){return u.test(e)||!(h(e)||"").length}),t=i.join("\n"),n=new this.contextType(t);try{return p(i).each(function(e,t){var r,i;n.updateLineInfo(e,t),r=p(s.handlers).some(function(e){return e.handles(n)});if(!r)return i="Warning on line "+n.getLineNumber()+", "+('unrecognized command "'+e+'".'),s.callbacks.onWarning(i)}),n.done(),r=n.getDiagram(),this.callbacks.onComplete({diagram:r.participants.length?r:void 0,code:t}),!0}catch(o){return this.callbacks.onError(o),!1}},e}()});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("application/views/editor",["require","backbone","./codeeditor","./outputgenerator","../uml/language/sequence/parser","../events"],function(e){var t,n,r,i,s,o;return t=e("backbone"),n=e("./codeeditor"),i=e("./outputgenerator"),s=e("../uml/language/sequence/parser"),o=e("../events"),r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.el="#editor-container",t.prototype.codeEditorViewType=n,t.prototype.outputGeneratorViewType=i,t.prototype.parserType=s,t.prototype.initialize=function(e){var t;return this.context=e.context,this.code=new this.codeEditorViewType({context:this.context}),this.output=new this.outputGeneratorViewType,t={onStart:function(){return o.trigger("parseStarted")},onWarning:function(e){return o.trigger("parseWarning",{message:e})},onError:function(e){return o.trigger("parseError",{message:e.message})},onComplete:function(e){return o.trigger("parseCompleted",e)}},this.parser=new this.parserType({callbacks:t}),this.listenTo(o,"codeChanged",this.onCodeChanged),this.listenTo(o,"documentContentChanged",this.onDocumentContentChanged),this.codeTitlebar=this.$("#code-section").find(".title-bar"),this.listenTo(o,"documentChanged",this.onDocumentChanged)},t.prototype.onCodeChanged=function(e){return this.parser.parse(e.code)},t.prototype.onDocumentContentChanged=function(e){return this.code.setContent(e.code)},t.prototype.onDocumentChanged=function(){var e;return e="Code",this.context.isCurrentDocumentEditable()||(e+=" (readonly)"),this.codeTitlebar.text(e)},t}(t.View)});var Kinetic={};(function(){Kinetic.version="4.4.3",Kinetic.Filters={},Kinetic.DD={},Kinetic.Global={stages:[],idCounter:0,ids:{},names:{},shapes:{},isDragging:function(){var e=Kinetic.DD;return e?e.isDragging:!1},isDragReady:function(){var e=Kinetic.DD;return e?!!e.node:!1},warn:function(e){window.console&&console.warn&&console.warn("Kinetic warning: "+e)},extend:function(e,t){for(var n in t.prototype)n in e.prototype||(e.prototype[n]=t.prototype[n])},_addId:function(e,t){t!==undefined&&(this.ids[t]=e)},_removeId:function(e){e!==undefined&&delete this.ids[e]},_addName:function(e,t){t!==undefined&&(this.names[t]===undefined&&(this.names[t]=[]),this.names[t].push(e))},_removeName:function(e,t){if(e!==undefined){var n=this.names[e];if(n!==undefined){for(var r=0;r<n.length;r++){var i=n[r];i._id===t&&n.splice(r,1)}n.length===0&&delete this.names[e]}}}}})(),function(e,t){typeof exports=="object"?module.exports=t():typeof define=="function"&&define.amd?define("kinetic",t):e.returnExports=t()}(this,function(){return Kinetic}),function(){var e="canvas",t="2d",n="[object Array]",r="[object Number]",i="[object String]",s=Math.PI/180,o=180/Math.PI;Kinetic.Type={_isElement:function(e){return!!e&&e.nodeType==1},_isFunction:function(e){return!!(e&&e.constructor&&e.call&&e.apply)},_isObject:function(e){return!!e&&e.constructor==Object},_isArray:function(e){return Object.prototype.toString.call(e)==n},_isNumber:function(e){return Object.prototype.toString.call(e)==r},_isString:function(e){return Object.prototype.toString.call(e)==i},_hasMethods:function(e){var t=[],n;for(n in e)this._isFunction(e[n])&&t.push(n);return t.length>0},_isInDocument:function(e){while(e=e.parentNode)if(e==document)return!0;return!1},_getXY:function(e){if(this._isNumber(e))return{x:e,y:e};if(this._isArray(e)){if(e.length===1){var t=e[0];if(this._isNumber(t))return{x:t,y:t};if(this._isArray(t))return{x:t[0],y:t[1]};if(this._isObject(t))return t}else if(e.length>=2)return{x:e[0],y:e[1]}}else if(this._isObject(e))return e;return null},_getSize:function(e){if(this._isNumber(e))return{width:e,height:e};if(this._isArray(e))if(e.length===1){var t=e[0];if(this._isNumber(t))return{width:t,height:t};if(this._isArray(t)){if(t.length>=4)return{width:t[2],height:t[3]};if(t.length>=2)return{width:t[0],height:t[1]}}else if(this._isObject(t))return t}else{if(e.length>=4)return{width:e[2],height:e[3]};if(e.length>=2)return{width:e[0],height:e[1]}}else if(this._isObject(e))return e;return null},_getPoints:function(e){if(e===undefined)return[];if(this._isArray(e[0])){var t=[];for(var n=0;n<e.length;n++)t.push({x:e[n][0],y:e[n][1]});return t}if(this._isObject(e[0]))return e;var t=[];for(var n=0;n<e.length;n+=2)t.push({x:e[n],y:e[n+1]});return t},_getImage:function(n,r){var i,s,o,u;n?this._isElement(n)?r(n):this._isString(n)?(i=new Image,i.onload=function(){r(i)},i.src=n):n.data?(s=document.createElement(e),s.width=n.width,s.height=n.height,o=s.getContext(t),o.putImageData(n,0,0),u=s.toDataURL(),i=new Image,i.onload=function(){r(i)},i.src=u):r(null):r(null)},_rgbToHex:function(e,t,n){return((1<<24)+(e<<16)+(t<<8)+n).toString(16).slice(1)},_hexToRgb:function(e){var t=parseInt(e,16);return{r:t>>16&255,g:t>>8&255,b:t&255}},_getRandomColorKey:function(){var e=(Math.random()*16777215<<0).toString(16);while(e.length<6)e="0"+e;return e},_merge:function(e,t){var n=this._clone(t);for(var r in e)this._isObject(e[r])?n[r]=this._merge(e[r],n[r]):n[r]=e[r];return n},_clone:function(e){var t={};for(var n in e)this._isObject(e[n])?t[n]=this._clone(e[n]):t[n]=e[n];return t},_degToRad:function(e){return e*s},_radToDeg:function(e){return e*o},_capitalize:function(e){return e.charAt(0).toUpperCase()+e.slice(1)}}}(),function(){var e=document.createElement("canvas"),t=e.getContext("2d"),n=window.devicePixelRatio||1,r=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1,i=n/r;Kinetic.Canvas=function(e){this.init(e)},Kinetic.Canvas.prototype={init:function(e){var e=e||{},t=e.width||0,n=e.height||0,r=e.pixelRatio||i,s=e.contextType||"2d";this.pixelRatio=r,this.width=t,this.height=n,this.element=document.createElement("canvas"),this.element.style.padding=0,this.element.style.margin=0,this.element.style.border=0,this.element.style.background="transparent",this.context=this.element.getContext(s),this.setSize(t,n)},getElement:function(){return this.element},getContext:function(){return this.context},setWidth:function(e){this.width=e,this.element.width=e*this.pixelRatio,this.element.style.width=e+"px"},setHeight:function(e){this.height=e,this.element.height=e*this.pixelRatio,this.element.style.height=e+"px"},getWidth:function(){return this.width},getHeight:function(){return this.height},setSize:function(e,t){this.setWidth(e),this.setHeight(t)}},Kinetic.Canvas2D=function(e){Kinetic.Canvas.call(this,e)},Kinetic.Canvas2D.prototype={clear:function(){var e=this.getContext(),t=this.getElement();e.clearRect(0,0,t.width,t.height)},toDataURL:function(e,t){try{return this.element.toDataURL(e,t)}catch(n){try{return this.element.toDataURL()}catch(n){return Kinetic.Global.warn("Unable to get data URL. "+n.message),""}}},fill:function(e){e.getFillEnabled()&&this._fill(e)},stroke:function(e){e.getStrokeEnabled()&&this._stroke(e)},fillStroke:function(e){var t=e.getFillEnabled();t&&this._fill(e),e.getStrokeEnabled()&&this._stroke(e,e.hasShadow()&&e.hasFill()&&t)},applyShadow:function(e,t){var n=this.context;n.save(),this._applyShadow(e),t(),n.restore(),t()},_applyLineCap:function(e){var t=e.getLineCap();t&&(this.context.lineCap=t)},_applyOpacity:function(e){var t=e.getAbsoluteOpacity();t!==1&&(this.context.globalAlpha=t)},_applyLineJoin:function(e){var t=e.getLineJoin();t&&(this.context.lineJoin=t)},_applyAncestorTransforms:function(e){var t=this.context;e._eachAncestorReverse(function(e){var n=e.getTransform(),r=n.getMatrix();t.transform(r[0],r[1],r[2],r[3],r[4],r[5])},!0)},_clip:function(e){var t=this.getContext();t.save(),this._applyAncestorTransforms(e),t.beginPath(),e.getClipFunc()(this),t.clip(),t.setTransform(1,0,0,1,0,0)}},Kinetic.Global.extend(Kinetic.Canvas2D,Kinetic.Canvas),Kinetic.SceneCanvas=function(e){Kinetic.Canvas2D.call(this,e)},Kinetic.SceneCanvas.prototype={setWidth:function(e){var t=this.pixelRatio;Kinetic.Canvas.prototype.setWidth.call(this,e),this.context.scale(t,t)},setHeight:function(e){var t=this.pixelRatio;Kinetic.Canvas.prototype.setHeight.call(this,e),this.context.scale(t,t)},_fillColor:function(e){var t=this.context,n=e.getFill();t.fillStyle=n,e._fillFunc(t)},_fillPattern:function(e){var t=this.context,n=e.getFillPatternImage(),r=e.getFillPatternX(),i=e.getFillPatternY(),s=e.getFillPatternScale(),o=e.getFillPatternRotation(),u=e.getFillPatternOffset(),a=e.getFillPatternRepeat();(r||i)&&t.translate(r||0,i||0),o&&t.rotate(o),s&&t.scale(s.x,s.y),u&&t.translate(-1*u.x,-1*u.y),t.fillStyle=t.createPattern(n,a||"repeat"),t.fill()},_fillLinearGradient:function(e){var t=this.context,n=e.getFillLinearGradientStartPoint(),r=e.getFillLinearGradientEndPoint(),i=e.getFillLinearGradientColorStops(),s=t.createLinearGradient(n.x,n.y,r.x,r.y);for(var o=0;o<i.length;o+=2)s.addColorStop(i[o],i[o+1]);t.fillStyle=s,t.fill()},_fillRadialGradient:function(e){var t=this.context,n=e.getFillRadialGradientStartPoint(),r=e.getFillRadialGradientEndPoint(),i=e.getFillRadialGradientStartRadius(),s=e.getFillRadialGradientEndRadius(),o=e.getFillRadialGradientColorStops(),u=t.createRadialGradient(n.x,n.y,i,r.x,r.y,s);for(var a=0;a<o.length;a+=2)u.addColorStop(o[a],o[a+1]);t.fillStyle=u,t.fill()},_fill:function(e,t){var n=this.context,r=e.getFill(),i=e.getFillPatternImage(),s=e.getFillLinearGradientStartPoint(),o=e.getFillRadialGradientStartPoint(),u=e.getFillPriority();n.save(),!t&&e.hasShadow()&&this._applyShadow(e),r&&u==="color"?this._fillColor(e):i&&u==="pattern"?this._fillPattern(e):s&&u==="linear-gradient"?this._fillLinearGradient(e):o&&u==="radial-gradient"?this._fillRadialGradient(e):r?this._fillColor(e):i?this._fillPattern(e):s?this._fillLinearGradient(e):o&&this._fillRadialGradient(e),n.restore(),!t&&e.hasShadow()&&this._fill(e,!0)},_stroke:function(e,t){var n=this.context,r=e.getStroke(),i=e.getStrokeWidth(),s=e.getDashArray();if(r||i)n.save(),e.getStrokeScaleEnabled()||n.setTransform(1,0,0,1,0,0),this._applyLineCap(e),s&&e.getDashArrayEnabled()&&(n.setLineDash?n.setLineDash(s):"mozDash"in n?n.mozDash=s:"webkitLineDash"in n&&(n.webkitLineDash=s)),!t&&e.hasShadow()&&this._applyShadow(e),n.lineWidth=i||2,n.strokeStyle=r||"black",e._strokeFunc(n),n.restore(),!t&&e.hasShadow()&&this._stroke(e,!0)},_applyShadow:function(e){var t=this.context;if(e.hasShadow()&&e.getShadowEnabled()){var n=e.getAbsoluteOpacity(),r=e.getShadowColor()||"black",i=e.getShadowBlur()||5,s=e.getShadowOffset()||{x:0,y:0};e.getShadowOpacity()&&(t.globalAlpha=e.getShadowOpacity()*n),t.shadowColor=r,t.shadowBlur=i,t.shadowOffsetX=s.x,t.shadowOffsetY=s.y}}},Kinetic.Global.extend(Kinetic.SceneCanvas,Kinetic.Canvas2D),Kinetic.HitCanvas=function(e){Kinetic.Canvas2D.call(this,e)},Kinetic.HitCanvas.prototype={_fill:function(e){var t=this.context;t.save(),t.fillStyle="#"+e.colorKey,e._fillFuncHit(t),t.restore()},_stroke:function(e){var t=this.context,n=e.getStroke(),r=e.getStrokeWidth();if(n||r)this._applyLineCap(e),t.save(),t.lineWidth=r||2,t.strokeStyle="#"+e.colorKey,e._strokeFuncHit(t),t.restore()}},Kinetic.Global.extend(Kinetic.HitCanvas,Kinetic.Canvas2D)}(),function(){Kinetic.Tween=function(e,t,n,r,i){this._listeners=[],this.addListener(this),this.propFunc=e,this.begin=n,this._pos=n,this.setDuration(i),this.isPlaying=!1,this._change=0,this.prevTime=0,this.prevPos=0,this.looping=!1,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.name="",this.func=t,this.setFinish(r)},Kinetic.Tween.prototype={setTime:function(e){this.prevTime=this._time,e>this.getDuration()?this.looping?(this.rewind(e-this._duration),this.update(),this.broadcastMessage("onLooped",{target:this,type:"onLooped"})):(this._time=this._duration,this.update(),this.stop(),this.broadcastMessage("onFinished",{target:this,type:"onFinished"})):e<0?(this.rewind(),this.update()):(this._time=e,this.update())},getTime:function(){return this._time},setDuration:function(e){this._duration=e===null||e<=0?1e5:e},getDuration:function(){return this._duration},setPosition:function(e){this.prevPos=this._pos,this.propFunc(e),this._pos=e,this.broadcastMessage("onChanged",{target:this,type:"onChanged"})},getPosition:function(e){return e===undefined&&(e=this._time),this.func(e,this.begin,this._change,this._duration)},setFinish:function(e){this._change=e-this.begin},getFinish:function(){return this.begin+this._change},start:function(){this.rewind(),this.startEnterFrame(),this.broadcastMessage("onStarted",{target:this,type:"onStarted"})},rewind:function(e){this.stop(),this._time=e===undefined?0:e,this.fixTime(),this.update()},fforward:function(){this._time=this._duration,this.fixTime(),this.update()},update:function(){this.setPosition(this.getPosition(this._time))},startEnterFrame:function(){this.stopEnterFrame(),this.isPlaying=!0,this.onEnterFrame()},onEnterFrame:function(){this.isPlaying&&this.nextFrame()},nextFrame:function(){this.setTime((this.getTimer()-this._startTime)/1e3)},stop:function(){this.stopEnterFrame(),this.broadcastMessage("onStopped",{target:this,type:"onStopped"})},stopEnterFrame:function(){this.isPlaying=!1},continueTo:function(e,t){this.begin=this._pos,this.setFinish(e),this._duration!==undefined&&this.setDuration(t),this.start()},resume:function(){this.fixTime(),this.startEnterFrame(),this.broadcastMessage("onResumed",{target:this,type:"onResumed"})},yoyo:function(){this.continueTo(this.begin,this._time)},addListener:function(e){return this.removeListener(e),this._listeners.push(e)},removeListener:function(e){var t=this._listeners,n=t.length;while(n--)if(t[n]==e)return t.splice(n,1),!0;return!1},broadcastMessage:function(){var e=[];for(var t=0;t<arguments.length;t++)e.push(arguments[t]);var n=e.shift(),r=this._listeners,i=r.length;for(var t=0;t<i;t++)r[t][n]&&r[t][n].apply(r[t],e)},fixTime:function(){this._startTime=this.getTimer()-this._time*1e3},getTimer:function(){return(new Date).getTime()-this._time}},Kinetic.Tweens={"back-ease-in":function(e,t,n,r,i,s){var o=1.70158;return n*(e/=r)*e*((o+1)*e-o)+t},"back-ease-out":function(e,t,n,r,i,s){var o=1.70158;return n*((e=e/r-1)*e*((o+1)*e+o)+1)+t},"back-ease-in-out":function(e,t,n,r,i,s){var o=1.70158;return(e/=r/2)<1?n/2*e*e*(((o*=1.525)+1)*e-o)+t:n/2*((e-=2)*e*(((o*=1.525)+1)*e+o)+2)+t},"elastic-ease-in":function(e,t,n,r,i,s){var o=0;return e===0?t:(e/=r)==1?t+n:(s||(s=r*.3),!i||i<Math.abs(n)?(i=n,o=s/4):o=s/(2*Math.PI)*Math.asin(n/i),-(i*Math.pow(2,10*(e-=1))*Math.sin((e*r-o)*2*Math.PI/s))+t)},"elastic-ease-out":function(e,t,n,r,i,s){var o=0;return e===0?t:(e/=r)==1?t+n:(s||(s=r*.3),!i||i<Math.abs(n)?(i=n,o=s/4):o=s/(2*Math.PI)*Math.asin(n/i),i*Math.pow(2,-10*e)*Math.sin((e*r-o)*2*Math.PI/s)+n+t)},"elastic-ease-in-out":function(e,t,n,r,i,s){var o=0;return e===0?t:(e/=r/2)==2?t+n:(s||(s=r*.3*1.5),!i||i<Math.abs(n)?(i=n,o=s/4):o=s/(2*Math.PI)*Math.asin(n/i),e<1?-0.5*i*Math.pow(2,10*(e-=1))*Math.sin((e*r-o)*2*Math.PI/s)+t:i*Math.pow(2,-10*(e-=1))*Math.sin((e*r-o)*2*Math.PI/s)*.5+n+t)},"bounce-ease-out":function(e,t,n,r){return(e/=r)<1/2.75?n*7.5625*e*e+t:e<2/2.75?n*(7.5625*(e-=1.5/2.75)*e+.75)+t:e<2.5/2.75?n*(7.5625*(e-=2.25/2.75)*e+.9375)+t:n*(7.5625*(e-=2.625/2.75)*e+.984375)+t},"bounce-ease-in":function(e,t,n,r){return n-Kinetic.Tweens["bounce-ease-out"](r-e,0,n,r)+t},"bounce-ease-in-out":function(e,t,n,r){return e<r/2?Kinetic.Tweens["bounce-ease-in"](e*2,0,n,r)*.5+t:Kinetic.Tweens["bounce-ease-out"](e*2-r,0,n,r)*.5+n*.5+t},"ease-in":function(e,t,n,r){return n*(e/=r)*e+t},"ease-out":function(e,t,n,r){return-n*(e/=r)*(e-2)+t},"ease-in-out":function(e,t,n,r){return(e/=r/2)<1?n/2*e*e+t:-n/2*(--e*(e-2)-1)+t},"strong-ease-in":function(e,t,n,r){return n*(e/=r)*e*e*e*e+t},"strong-ease-out":function(e,t,n,r){return n*((e=e/r-1)*e*e*e*e+1)+t},"strong-ease-in-out":function(e,t,n,r){return(e/=r/2)<1?n/2*e*e*e*e*e+t:n/2*((e-=2)*e*e*e*e+2)+t},linear:function(e,t,n,r){return n*e/r+t}}}(),function(){Kinetic.Transform=function(){this.m=[1,0,0,1,0,0]},Kinetic.Transform.prototype={translate:function(e,t){this.m[4]+=this.m[0]*e+this.m[2]*t,this.m[5]+=this.m[1]*e+this.m[3]*t},scale:function(e,t){this.m[0]*=e,this.m[1]*=e,this.m[2]*=t,this.m[3]*=t},rotate:function(e){var t=Math.cos(e),n=Math.sin(e),r=this.m[0]*t+this.m[2]*n,i=this.m[1]*t+this.m[3]*n,s=this.m[0]*-n+this.m[2]*t,o=this.m[1]*-n+this.m[3]*t;this.m[0]=r,this.m[1]=i,this.m[2]=s,this.m[3]=o},getTranslation:function(){return{x:this.m[4],y:this.m[5]}},multiply:function(e){var t=this.m[0]*e.m[0]+this.m[2]*e.m[1],n=this.m[1]*e.m[0]+this.m[3]*e.m[1],r=this.m[0]*e.m[2]+this.m[2]*e.m[3],i=this.m[1]*e.m[2]+this.m[3]*e.m[3],s=this.m[0]*e.m[4]+this.m[2]*e.m[5]+this.m[4],o=this.m[1]*e.m[4]+this.m[3]*e.m[5]+this.m[5];this.m[0]=t,this.m[1]=n,this.m[2]=r,this.m[3]=i,this.m[4]=s,this.m[5]=o},invert:function(){var e=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),t=this.m[3]*e,n=-this.m[1]*e,r=-this.m[2]*e,i=this.m[0]*e,s=e*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),o=e*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=t,this.m[1]=n,this.m[2]=r,this.m[3]=i,this.m[4]=s,this.m[5]=o},getMatrix:function(){return this.m}}}(),function(){Kinetic.Collection=function(){var e=[].slice.call(arguments),t=e.length,n=0;this.length=t;for(;n<t;n++)this[n]=e[n];return this},Kinetic.Collection.prototype=new Array,Kinetic.Collection.prototype.each=function(e){for(var t=0;t<this.length;t++)e(this[t],t)},Kinetic.Collection.mapMethods=function(e){var t=e.length,n;for(n=0;n<t;n++)(function(t){var n=e[t];Kinetic.Collection.prototype[n]=function(){var e=this.length,t;args=[].slice.call(arguments);for(t=0;t<e;t++)this[t][n].apply(this[t],args)}})(n)}}(),function(){Kinetic.Filters.Grayscale=function(e,t){var n=e.data;for(var r=0;r<n.length;r+=4){var i=.34*n[r]+.5*n[r+1]+.16*n[r+2];n[r]=i,n[r+1]=i,n[r+2]=i}}}(),function(){Kinetic.Filters.Brighten=function(e,t){var n=t.val||0,r=e.data;for(var i=0;i<r.length;i+=4)r[i]+=n,r[i+1]+=n,r[i+2]+=n}}(),function(){Kinetic.Filters.Invert=function(e,t){var n=e.data;for(var r=0;r<n.length;r+=4)n[r]=255-n[r],n[r+1]=255-n[r+1],n[r+2]=255-n[r+2]}}(),function(e){function t(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}function i(e,i){var s=e.data,o=e.width,u=e.height,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_=i+i+1,D=o-1,P=u-1,H=i+1,B=H*(H+1)/2,j=new t,F=j,I=null,q=null,R=n[i],U=r[i];for(l=1;l<_;l++){F=F.next=new t;if(l==H)var z=F}F.next=j,d=p=0;for(f=0;f<u;f++){x=T=N=C=v=m=g=y=0,b=H*(k=s[p]),w=H*(L=s[p+1]),E=H*(A=s[p+2]),S=H*(O=s[p+3]),v+=B*k,m+=B*L,g+=B*A,y+=B*O,F=j;for(l=0;l<H;l++)F.r=k,F.g=L,F.b=A,F.a=O,F=F.next;for(l=1;l<H;l++)c=p+((D<l?D:l)<<2),v+=(F.r=k=s[c])*(M=H-l),m+=(F.g=L=s[c+1])*M,g+=(F.b=A=s[c+2])*M,y+=(F.a=O=s[c+3])*M,x+=k,T+=L,N+=A,C+=O,F=F.next;I=j,q=z;for(a=0;a<o;a++)s[p+3]=O=y*R>>U,O!=0?(O=255/O,s[p]=(v*R>>U)*O,s[p+1]=(m*R>>U)*O,s[p+2]=(g*R>>U)*O):s[p]=s[p+1]=s[p+2]=0,v-=b,m-=w,g-=E,y-=S,b-=I.r,w-=I.g,E-=I.b,S-=I.a,c=d+((c=a+i+1)<D?c:D)<<2,x+=I.r=s[c],T+=I.g=s[c+1],N+=I.b=s[c+2],C+=I.a=s[c+3],v+=x,m+=T,g+=N,y+=C,I=I.next,b+=k=q.r,w+=L=q.g,E+=A=q.b,S+=O=q.a,x-=k,T-=L,N-=A,C-=O,q=q.next,p+=4;d+=o}for(a=0;a<o;a++){T=N=C=x=m=g=y=v=0,p=a<<2,b=H*(k=s[p]),w=H*(L=s[p+1]),E=H*(A=s[p+2]),S=H*(O=s[p+3]),v+=B*k,m+=B*L,g+=B*A,y+=B*O,F=j;for(l=0;l<H;l++)F.r=k,F.g=L,F.b=A,F.a=O,F=F.next;h=o;for(l=1;l<=i;l++)p=h+a<<2,v+=(F.r=k=s[p])*(M=H-l),m+=(F.g=L=s[p+1])*M,g+=(F.b=A=s[p+2])*M,y+=(F.a=O=s[p+3])*M,x+=k,T+=L,N+=A,C+=O,F=F.next,l<P&&(h+=o);p=a,I=j,q=z;for(f=0;f<u;f++)c=p<<2,s[c+3]=O=y*R>>U,O>0?(O=255/O,s[c]=(v*R>>U)*O,s[c+1]=(m*R>>U)*O,s[c+2]=(g*R>>U)*O):s[c]=s[c+1]=s[c+2]=0,v-=b,m-=w,g-=E,y-=S,b-=I.r,w-=I.g,E-=I.b,S-=I.a,c=a+((c=f+H)<P?c:P)*o<<2,v+=x+=I.r=s[c],m+=T+=I.g=s[c+1],g+=N+=I.b=s[c+2],y+=C+=I.a=s[c+3],I=I.next,b+=k=q.r,w+=L=q.g,E+=A=q.b,S+=O=q.a,x-=k,T-=L,N-=A,C-=O,q=q.next,p+=o}}var n=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],r=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];e=e||{},e.Filters=e.Filters||{},e.Filters.Blur=function(e,t){var n=t.radius;n|=0,i(e,n)},window.Kinetic=e}(Kinetic),function(e){function t(e,t,n){var r=(n*e.width+t)*4,i=[];return i.push(e.data[r++],e.data[r++],e.data[r++],e.data[r++]),i}function n(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)+Math.pow(e[2]-t[2],2))}function r(e){var t=[0,0,0];for(var n=0;n<e.length;n++)t[0]+=e[n][0],t[1]+=e[n][1],t[2]+=e[n][2];return t[0]/=e.length,t[1]/=e.length,t[2]/=e.length,t}function i(e,i){var s=t(e,0,0),o=t(e,e.width-1,0),u=t(e,0,e.height-1),a=t(e,e.width-1,e.height-1),f=i&&i.threshold?i.threshold:10;if(n(s,o)<f&&n(o,a)<f&&n(a,u)<f&&n(u,s)<f){var l=r([o,s,a,u]),c=[];for(var h=0;h<e.width*e.height;h++){var p=n(l,[e.data[h*4],e.data[h*4+1],e.data[h*4+2]]);c[h]=p<f?0:255}return c}}function s(e,t){for(var n=0;n<e.width*e.height;n++)e.data[4*n+3]=t[n]}function o(e,t,n){var r=[1,1,1,1,0,1,1,1,1],i=Math.round(Math.sqrt(r.length)),s=Math.floor(i/2),o=[];for(var u=0;u<n;u++)for(var a=0;a<t;a++){var f=u*t+a,l=0;for(var c=0;c<i;c++)for(var h=0;h<i;h++){var p=u+c-s,d=a+h-s;if(p>=0&&p<n&&d>=0&&d<t){var v=p*t+d,m=r[c*i+h];l+=e[v]*m}}o[f]=l===2040?255:0}return o}function u(e,t,n){var r=[1,1,1,1,1,1,1,1,1],i=Math.round(Math.sqrt(r.length)),s=Math.floor(i/2),o=[];for(var u=0;u<n;u++)for(var a=0;a<t;a++){var f=u*t+a,l=0;for(var c=0;c<i;c++)for(var h=0;h<i;h++){var p=u+c-s,d=a+h-s;if(p>=0&&p<n&&d>=0&&d<t){var v=p*t+d,m=r[c*i+h];l+=e[v]*m}}o[f]=l>=1020?255:0}return o}function a(e,t,n){var r=[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9],i=Math.round(Math.sqrt(r.length)),s=Math.floor(i/2),o=[];for(var u=0;u<n;u++)for(var a=0;a<t;a++){var f=u*t+a,l=0;for(var c=0;c<i;c++)for(var h=0;h<i;h++){var p=u+c-s,d=a+h-s;if(p>=0&&p<n&&d>=0&&d<t){var v=p*t+d,m=r[c*i+h];l+=e[v]*m}}o[f]=l}return o}e=e||{},e.Filters=e.Filters||{},e.Filters.Mask=function(e,t){var n=i(e,t);return n&&(n=o(n,e.width,e.height),n=u(n,e.width,e.height),n=a(n,e.width,e.height),s(e,n)),e},window.Kinetic=e}(Kinetic),function(){var e=" ",t="",n=".",r="get",i="set",s="Shape",o="Stage",u="x",a="y",f="kinetic",l="before",c="Change",h="id",p="name",d="mouseenter",v="mouseleave",m="Deg",g="on",y="off",b="beforeDraw",w="draw";Kinetic.Node=function(e){this._nodeInit(e)},Kinetic.Node.prototype={_nodeInit:function(e){this._id=Kinetic.Global.idCounter++,this.eventListeners={},this.setAttrs(e)},on:function(r,i){var s=r.split(e),o=s.length,u,a,f,l,c,h;for(u=0;u<o;u++)a=s[u],f=a,l=f.split(n),c=l[0],h=l.length>1?l[1]:t,this.eventListeners[c]||(this.eventListeners[c]=[]),this.eventListeners[c].push({name:h,handler:i});return this},off:function(t){var r=t.split(e),i=r.length,s,o,u,a,f;for(s=0;s<i;s++){o=r[s],u=o,a=u.split(n),f=a[0];if(a.length>1)if(f)this.eventListeners[f]&&this._off(f,a[1]);else for(var o in this.eventListeners)this._off(o,a[1]);else delete this.eventListeners[f]}return this},remove:function(){var e=this.getParent();e&&e.children&&(e.children.splice(this.index,1),e._setChildrenIndices()),delete this.parent},destroy:function(){var e=this.getParent(),t=this.getStage(),n=Kinetic.DD,r=Kinetic.Global;while(this.children&&this.children.length>0)this.children[0].destroy();r._removeId(this.getId()),r._removeName(this.getName(),this._id),this.trans&&this.trans.stop(),this.remove()},getAttr:function(e){var t=r+Kinetic.Type._capitalize(e);return this[t]()},getAttrs:function(){return this.attrs||{}},createAttrs:function(){this.attrs===undefined&&(this.attrs={})},setAttrs:function(e){var t,n;if(e)for(t in e)n=i+Kinetic.Type._capitalize(t),Kinetic.Type._isFunction(this[n])?this[n](e[t]):this.setAttr(t,e[t])},getVisible:function(){var e=this.attrs.visible,t=this.getParent();return e===undefined&&(e=!0),e&&t&&!t.getVisible()?!1:e},getListening:function(){var e=this.attrs.listening,t=this.getParent();return e===undefined&&(e=!0),e&&t&&!t.getListening()?!1:e},show:function(){this.setVisible(!0)},hide:function(){this.setVisible(!1)},getZIndex:function(){return this.index||0},getAbsoluteZIndex:function(){function l(t){i=[],u=t.length;for(a=0;a<u;a++)f=t[a],r++,f.nodeType!==s&&(i=i.concat(f.getChildren())),f._id===n._id&&(a=u);i.length>0&&i[0].getLevel()<=e&&l(i)}var e=this.getLevel(),t=this.getStage(),n=this,r=0,i,u,a,f;return n.nodeType!==o&&l(n.getStage().getChildren()),r},getLevel:function(){var e=0,t=this.parent;while(t)e++,t=t.parent;return e},setPosition:function(){var e=Kinetic.Type._getXY([].slice.call(arguments));this.setAttr(u,e.x),this.setAttr(a,e.y)},getPosition:function(){return{x:this.getX(),y:this.getY()}},getAbsolutePosition:function(){var e=this.getAbsoluteTransform(),t=this.getOffset();return e.translate(t.x,t.y),e.getTranslation()},setAbsolutePosition:function(){var e=Kinetic.Type._getXY([].slice.call(arguments)),t=this._clearTransform(),n;this.attrs.x=t.x,this.attrs.y=t.y,delete t.x,delete t.y,n=this.getAbsoluteTransform(),n.invert(),n.translate(e.x,e.y),e={x:this.attrs.x+n.getTranslation().x,y:this.attrs.y+n.getTranslation().y},this.setPosition(e.x,e.y),this._setTransform(t)},move:function(){var e=Kinetic.Type._getXY([].slice.call(arguments)),t=this.getX(),n=this.getY();e.x!==undefined&&(t+=e.x),e.y!==undefined&&(n+=e.y),this.setPosition(t,n)},_eachAncestorReverse:function(e,t){var n=[],r=this.getParent(),i,s;t&&n.unshift(this);while(r)n.unshift(r),r=r.parent;i=n.length;for(s=0;s<i;s++)e(n[s])},rotate:function(e){this.setRotation(this.getRotation()+e)},rotateDeg:function(e){this.setRotation(this.getRotation()+Kinetic.Type._degToRad(e))},moveToTop:function(){var e=this.index;return this.parent.children.splice(e,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0},moveUp:function(){var e=this.index,t=this.parent.getChildren().length;if(e<t-1)return this.parent.children.splice(e,1),this.parent.children.splice(e+1,0,this),this.parent._setChildrenIndices(),!0},moveDown:function(){var e=this.index;if(e>0)return this.parent.children.splice(e,1),this.parent.children.splice(e-1,0,this),this.parent._setChildrenIndices(),!0},moveToBottom:function(){var e=this.index;if(e>0)return this.parent.children.splice(e,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0},setZIndex:function(e){var t=this.index;this.parent.children.splice(t,1),this.parent.children.splice(e,0,this),this.parent._setChildrenIndices()},getAbsoluteOpacity:function(){var e=this.getOpacity();return this.getParent()&&(e*=this.getParent().getAbsoluteOpacity()),e},moveTo:function(e){Kinetic.Node.prototype.remove.call(this),e.add(this)},toObject:function(){var e=Kinetic.Type,t={},n=this.getAttrs(),r,i;t.attrs={};for(r in n)i=n[r],!e._isFunction(i)&&!e._isElement(i)&&(!e._isObject(i)||!e._hasMethods(i))&&(t.attrs[r]=i);return t.nodeType=this.nodeType,t.shapeType=this.shapeType,t},toJSON:function(){return JSON.stringify(this.toObject())},getParent:function(){return this.parent},getLayer:function(){return this.getParent().getLayer()},getStage:function(){return this.getParent()?this.getParent().getStage():undefined},fire:function(e,t,n){n?this._executeHandlers(e,t||{}):this._handleEvent(e,t||{})},getAbsoluteTransform:function(){var e=new Kinetic.Transform,t;return this._eachAncestorReverse(function(n){t=n.getTransform(),e.multiply(t)},!0),e},getTransform:function(){var e=new Kinetic.Transform,t=this.getX(),n=this.getY(),r=this.getRotation(),i=this.getScale(),s=i.x,o=i.y,u=this.getOffset(),a=u.x,f=u.y;return(t!==0||n!==0)&&e.translate(t,n),r!==0&&e.rotate(r),(s!==1||o!==1)&&e.scale(s,o),(a!==0||f!==0)&&e.translate(-1*a,-1*f),e},clone:function(e){var t=this.shapeType||this.nodeType,n=new Kinetic[t](this.attrs),r,i,s,o,u;for(r in this.eventListeners){i=this.eventListeners[r],s=i.length;for(o=0;o<s;o++)u=i[o],u.name.indexOf(f)<0&&(n.eventListeners[r]||(n.eventListeners[r]=[]),n.eventListeners[r].push(u))}return n.setAttrs(e),n},toDataURL:function(e){var e=e||{},t=e.mimeType||null,n=e.quality||null,r=this.getStage(),i=e.x||0,s=e.y||0,o=new Kinetic.SceneCanvas({width:e.width||r.getWidth(),height:e.height||r.getHeight(),pixelRatio:1}),u=o.getContext();return u.save(),(i||s)&&u.translate(-1*i,-1*s),this.drawScene(o),u.restore(),o.toDataURL(t,n)},toImage:function(e){Kinetic.Type._getImage(this.toDataURL(e),function(t){e.callback(t)})},setSize:function(){var e=Kinetic.Type._getSize(Array.prototype.slice.call(arguments));this.setWidth(e.width),this.setHeight(e.height)},getSize:function(){return{width:this.getWidth(),height:this.getHeight()}},getWidth:function(){return this.attrs.width||0},getHeight:function(){return this.attrs.height||0},_get:function(e){return this.nodeType===e?[this]:[]},_off:function(e,t){var n=this.eventListeners[e],r;for(r=0;r<n.length;r++)if(n[r].name===t){n.splice(r,1);if(n.length===0){delete this.eventListeners[e];break}r--}},_clearTransform:function(){var e=this.getScale(),t=this.getOffset(),n={x:this.getX(),y:this.getY(),rotation:this.getRotation(),scale:{x:e.x,y:e.y},offset:{x:t.x,y:t.y}};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scale={x:1,y:1},this.attrs.offset={x:0,y:0},n},_setTransform:function(e){var t;for(t in e)this.attrs[t]=e[t]},_fireBeforeChangeEvent:function(e,t,n){this._handleEvent(l+Kinetic.Type._capitalize(e)+c,{oldVal:t,newVal:n})},_fireChangeEvent:function(e,t,n){this._handleEvent(e+c,{oldVal:t,newVal:n})},setId:function(e){var t=this.getId(),n=this.getStage(),r=Kinetic.Global;r._removeId(t),r._addId(this,e),this.setAttr(h,e)},setName:function(e){var t=this.getName(),n=this.getStage(),r=Kinetic.Global;r._removeName(t,this._id),r._addName(this,e),this.setAttr(p,e)},getNodeType:function(){return this.nodeType},setAttr:function(e,t){var n;t!==undefined&&(n=this.attrs[e],this._fireBeforeChangeEvent(e,n,t),this.attrs[e]=t,this._fireChangeEvent(e,n,t))},_handleEvent:function(e,t,n){t&&this.nodeType===s&&(t.targetNode=this);var r=this.getStage(),i=this.eventListeners,o=!0;e===d&&n&&this._id===n._id?o=!1:e===v&&n&&this._id===n._id&&(o=!1),o&&(this._executeHandlers(e,t),t&&!t.cancelBubble&&this.parent&&(n&&n.parent?this._handleEvent.call(this.parent,e,t,n.parent):this._handleEvent.call(this.parent,e,t)))},_executeHandlers:function(e,t){var n=this.eventListeners[e],r,i;if(n){r=n.length;for(i=0;i<r;i++)n[i].handler.apply(this,[t])}},draw:function(){var e={node:this};this.fire(b,e),this.drawScene(),this.drawHit(),this.fire(w,e)},shouldDrawHit:function(){return this.isVisible()&&this.isListening()&&!Kinetic.Global.isDragging()}},Kinetic.Node.addGetterSetter=function(e,t,n){this.addGetter(e,t,n),this.addSetter(e,t)},Kinetic.Node.addPointGetterSetter=function(e,t,n){this.addGetter(e,t,n),this.addPointSetter(e,t)},Kinetic.Node.addRotationGetterSetter=function(e,t,n){this.addRotationGetter(e,t,n),this.addRotationSetter(e,t)},Kinetic.Node.addSetter=function(e,t){var n=this,r=i+Kinetic.Type._capitalize(t);e.prototype[r]=function(e){this.setAttr(t,e)}},Kinetic.Node.addPointSetter=function(e,t){var n=this,r=i+Kinetic.Type._capitalize(t);e.prototype[r]=function(){var e=Kinetic.Type._getXY([].slice.call(arguments));this.attrs[t]||(this.attrs[t]={x:1,y:1}),e&&e.x===undefined&&(e.x=this.attrs[t].x),e&&e.y===undefined&&(e.y=this.attrs[t].y),this.setAttr(t,e)}},Kinetic.Node.addRotationSetter=function(e,t){var n=this,r=i+Kinetic.Type._capitalize(t);e.prototype[r]=function(e){this.setAttr(t,e)},e.prototype[r+m]=function(e){this.setAttr(t,Kinetic.Type._degToRad(e))}},Kinetic.Node.addGetter=function(e,t,n){var i=this,s=r+Kinetic.Type._capitalize(t);e.prototype[s]=function(e){var r=this.attrs[t];return r===undefined&&(r=n),r}},Kinetic.Node.addRotationGetter=function(e,t,n){var i=this,s=r+Kinetic.Type._capitalize(t);e.prototype[s]=function(){var e=this.attrs[t];return e===undefined&&(e=n),e},e.prototype[s+m]=function(){var e=this.attrs[t];return e===undefined&&(e=n),Kinetic.Type._radToDeg(e)}},Kinetic.Node.create=function(e,t){return this._createNode(JSON.parse(e),t)},Kinetic.Node._createNode=function(e,t){var n,r,i,o;e.nodeType===s?e.shapeType===undefined?n=s:n=e.shapeType:n=e.nodeType,t&&(e.attrs.container=t),r=new Kinetic[n](e.attrs);if(e.children){i=e.children.length;for(o=0;o<i;o++)r.add(this._createNode(e.children[o]))}return r},Kinetic.Node.addGetterSetter(Kinetic.Node,"x",0),Kinetic.Node.addGetterSetter(Kinetic.Node,"y",0),Kinetic.Node.addGetterSetter(Kinetic.Node,"opacity",1),Kinetic.Node.addGetter(Kinetic.Node,"name"),Kinetic.Node.addGetter(Kinetic.Node,"id"),Kinetic.Node.addRotationGetterSetter(Kinetic.Node,"rotation",0),Kinetic.Node.addPointGetterSetter(Kinetic.Node,"scale",{x:1,y:1}),Kinetic.Node.addPointGetterSetter(Kinetic.Node,"offset",{x:0,y:0}),Kinetic.Node.addSetter(Kinetic.Node,"width"),Kinetic.Node.addSetter(Kinetic.Node,"height"),Kinetic.Node.addSetter(Kinetic.Node,"listening"),Kinetic.Node.addSetter(Kinetic.Node,"visible"),Kinetic.Node.prototype.isListening=Kinetic.Node.prototype.getListening,Kinetic.Node.prototype.isVisible=Kinetic.Node.prototype.getVisible,Kinetic.Collection.mapMethods(["on","off"])}(),function(){Kinetic.Animation=function(e,t){this.func=e,this.node=t,this.id=Kinetic.Animation.animIdCounter++,this.frame={time:0,timeDiff:0,lastTime:(new Date).getTime()}},Kinetic.Animation.prototype={isRunning:function(){var e=Kinetic.Animation,t=e.animations;for(var n=0;n<t.length;n++)if(t[n].id===this.id)return!0;return!1},start:function(){this.stop(),this.frame.timeDiff=0,this.frame.lastTime=(new Date).getTime(),Kinetic.Animation._addAnimation(this)},stop:function(){Kinetic.Animation._removeAnimation(this)},_updateFrameObject:function(e){this.frame.timeDiff=e-this.frame.lastTime,this.frame.lastTime=e,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1e3/this.frame.timeDiff}},Kinetic.Animation.animations=[],Kinetic.Animation.animIdCounter=0,Kinetic.Animation.animRunning=!1,Kinetic.Animation.fixedRequestAnimFrame=function(e){window.setTimeout(e,1e3/60)},Kinetic.Animation._addAnimation=function(e){this.animations.push(e),this._handleAnimation()},Kinetic.Animation._removeAnimation=function(e){var t=e.id,n=this.animations,r=n.length;for(var i=0;i<r;i++)if(n[i].id===t){this.animations.splice(i,1);break}},Kinetic.Animation._runFrames=function(){var e={},t=this.animations;for(var n=0;n<t.length;n++){var r=t[n],i=r.node,s=r.func;r._updateFrameObject((new Date).getTime()),i&&i._id!==undefined&&(e[i._id]=i),s&&s(r.frame)}for(var o in e)e[o].draw()},Kinetic.Animation._animationLoop=function(){var e=this;this.animations.length>0?(this._runFrames(),Kinetic.Animation.requestAnimFrame(function(){e._animationLoop()})):this.animRunning=!1},Kinetic.Animation._handleAnimation=function(){var e=this;this.animRunning||(this.animRunning=!0,e._animationLoop())},RAF=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||Kinetic.Animation.fixedRequestAnimFrame}(),Kinetic.Animation.requestAnimFrame=function(e){var t=Kinetic.DD&&Kinetic.DD.isDragging?this.fixedRequestAnimFrame:RAF;t(e)};var e=Kinetic.Node.prototype.moveTo;Kinetic.Node.prototype.moveTo=function(t){e.call(this,t)}}(),function(){Kinetic.DD={anim:new Kinetic.Animation,isDragging:!1,offset:{x:0,y:0},node:null,_drag:function(e){var t=Kinetic.DD,n=t.node;if(n){var r=n.getStage().getPointerPosition(),i=n.getDragBoundFunc(),s={x:r.x-t.offset.x,y:r.y-t.offset.y};i!==undefined&&(s=i.call(n,s,e)),n.setAbsolutePosition(s),t.isDragging||(t.isDragging=!0,n._handleEvent("dragstart",e)),n._handleEvent("dragmove",e)}},_endDragBefore:function(e){var t=Kinetic.DD,n=t.node,r,i;n&&(r=n.nodeType,i=n.getLayer(),t.anim.stop(),t.isDragging&&(t.isDragging=!1,e&&(e.dragEndNode=n)),delete t.node,(i||n).draw())},_endDragAfter:function(e){var e=e||{},t=e.dragEndNode;e&&t&&t._handleEvent("dragend",e)}},Kinetic.Node.prototype.startDrag=function(){var e=Kinetic.DD,t=this,n=this.getStage(),r=this.getLayer(),i=n.getPointerPosition(),s=this.getTransform().getTranslation(),o=this.getAbsolutePosition(),u=r||this;i&&(e.node&&e.node.stopDrag(),e.node=this,e.offset.x=i.x-o.x,e.offset.y=i.y-o.y,e.anim.node=u,e.anim.start())},Kinetic.Node.prototype.stopDrag=function(){var e=Kinetic.DD,t={};e._endDragBefore(t),e._endDragAfter(t)},Kinetic.Node.prototype.setDraggable=function(e){this.setAttr("draggable",e),this._dragChange()};var e=Kinetic.Node.prototype.destroy;Kinetic.Node.prototype.destroy=function(){var t=Kinetic.DD;t.node&&t.node._id===this._id&&this.stopDrag(),e.call(this)},Kinetic.Node.prototype.isDragging=function(){var e=Kinetic.DD;return e.node&&e.node._id===this._id&&e.isDragging},Kinetic.Node.prototype._listenDrag=function(){this._dragCleanup();var e=this;this.on("mousedown.kinetic touchstart.kinetic",function(t){Kinetic.DD.node||e.startDrag(t)})},Kinetic.Node.prototype._dragChange=function(){if(this.attrs.draggable)this._listenDrag();else{this._dragCleanup();var e=this.getStage(),t=Kinetic.DD;e&&t.node&&t.node._id===this._id&&t.node.stopDrag()}},Kinetic.Node.prototype._dragCleanup=function(){this.off("mousedown.kinetic"),this.off("touchstart.kinetic")},Kinetic.Node.addGetterSetter(Kinetic.Node,"dragBoundFunc"),Kinetic.Node.addGetterSetter(Kinetic.Node,"dragOnTop",!0),Kinetic.Node.addGetter(Kinetic.Node,"draggable",!1),Kinetic.Node.prototype.isDraggable=Kinetic.Node.prototype.getDraggable;var t=document.getElementsByTagName("html")[0];t.addEventListener("mouseup",Kinetic.DD._endDragBefore,!0),t.addEventListener("touchend",Kinetic.DD._endDragBefore,!0),t.addEventListener("mouseup",Kinetic.DD._endDragAfter,!1),t.addEventListener("touchend",Kinetic.DD._endDragAfter,!1)}(),function(){function e(e,t,n,r,i,s){var o=new Kinetic.Tween(function(n){e[t]=n},n,r,i,s);return o}Kinetic.Transition=function(t,n){var r=this,i=n.easing||"linear",s=Kinetic.Tweens[i],o=n.duration||0,u=null,a=0,f={},l=0,c=0;this.tweens=[],this.attrs={},this.node=t;for(var h in n)h!=="duration"&&h!=="easing"&&h!=="callback"&&(u=n[h],f=t.getAttr(h),Kinetic.Type._isObject(f)?(configValX=u.x,configValY=u.y,this.attrs[h]={},configValX!==undefined&&r.tweens.push(e(this.attrs[h],"x",s,f.x,configValX,o)),configValY!==undefined&&r.tweens.push(e(this.attrs[h],"y",s,f.y,configValY,o))):r.tweens.push(e(this.attrs,h,s,t.getAttr(h),u,o)));a=this.tweens.length-1,this.tweens[a].onStarted=function(){},this.tweens[a].onStopped=function(){t.transAnim.stop()},this.tweens[a].onResumed=function(){t.transAnim.start()},this.tweens[a].onLooped=function(){},this.tweens[a].onChanged=function(){},this.tweens[a].onFinished=function(){var e={};for(var r in n)r!=="duration"&&r!=="easing"&&r!=="callback"&&(e[r]=n[r]);t.transAnim.stop(),t.setAttrs(e),n.callback&&n.callback.call(t)}},Kinetic.Transition.prototype={start:function(){for(var e=0;e<this.tweens.length;e++)this.tweens[e].start()},stop:function(){for(var e=0;e<this.tweens.length;e++)this.tweens[e].stop()},resume:function(){for(var e=0;e<this.tweens.length;e++)this.tweens[e].resume()},_onEnterFrame:function(){for(var e=0;e<this.tweens.length;e++)this.tweens[e].onEnterFrame();this.node.setAttrs(this.attrs)},_add:function(e){this.tweens.push(e)}},Kinetic.Node.prototype.transitionTo=function(e){var t=this,n=new Kinetic.Transition(this,e);return this.transAnim||(this.transAnim=new Kinetic.Animation),this.transAnim.func=function(){n._onEnterFrame()},this.transAnim.node=this.nodeType==="Stage"?this:this.getLayer(),n.start(),this.transAnim.start(),this.trans=n,n}}(),function(){Kinetic.Container=function(e){this._containerInit(e)},Kinetic.Container.prototype={_containerInit:function(e){this.children=[],Kinetic.Node.call(this,e)},getChildren:function(){return this.children},removeChildren:function(){while(this.children.length>0)this.children[0].remove()},add:function(e){var t=Kinetic.Global,n=this.children;return e.index=n.length,e.parent=this,n.push(e),this},get:function(e){var t=new Kinetic.Collection;if(e.charAt(0)==="#"){var n=this._getNodeById(e.slice(1));n&&t.push(n)}else if(e.charAt(0)==="."){var r=this._getNodesByName(e.slice(1));Kinetic.Collection.apply(t,r)}else{var i=[],s=this.getChildren(),o=s.length;for(var u=0;u<o;u++)i=i.concat(s[u]._get(e));Kinetic.Collection.apply(t,i)}return t},_getNodeById:function(e){var t=this.getStage(),n=Kinetic.Global,r=n.ids[e];return r!==undefined&&this.isAncestorOf(r)?r:null},_getNodesByName:function(e){var t=Kinetic.Global,n=t.names[e]||[];return this._getDescendants(n)},_get:function(e){var t=Kinetic.Node.prototype._get.call(this,e),n=this.getChildren(),r=n.length;for(var i=0;i<r;i++)t=t.concat(n[i]._get(e));return t},toObject:function(){var e=Kinetic.Node.prototype.toObject.call(this);e.children=[];var t=this.getChildren(),n=t.length;for(var r=0;r<n;r++){var i=t[r];e.children.push(i.toObject())}return e},_getDescendants:function(e){var t=[],n=e.length;for(var r=0;r<n;r++){var i=e[r];this.isAncestorOf(i)&&t.push(i)}return t},isAncestorOf:function(e){var t=e.getParent();while(t){if(t._id===this._id)return!0;t=t.getParent()}return!1},clone:function(e){var t=Kinetic.Node.prototype.clone.call(this,e);for(var n in this.children)t.add(this.children[n].clone());return t},getIntersections:function(){var e=Kinetic.Type._getXY(Array.prototype.slice.call(arguments)),t=[],n=this.get("Shape"),r=n.length;for(var i=0;i<r;i++){var s=n[i];s.isVisible()&&s.intersects(e)&&t.push(s)}return t},_setChildrenIndices:function(){var e=this.children,t=e.length;for(var n=0;n<t;n++)e[n].index=n},drawScene:function(e){var t=this.getLayer(),n=!!this.getClipFunc(),r=this.getStage(),i,s;!e&&t&&(e=t.getCanvas());if(this.isVisible()){n&&e._clip(this),i=this.children,s=i.length;for(var o=0;o<s;o++)i[o].drawScene(e);n&&e.getContext().restore()}},drawHit:function(){var e=!!this.getClipFunc()&&this.nodeType!=="Stage",t=0,n=0,r=[],i;if(this.shouldDrawHit()){e&&(i=this.getLayer().hitCanvas,i._clip(this)),r=this.children,n=r.length;for(t=0;t<n;t++)r[t].drawHit();e&&i.getContext().restore()}}},Kinetic.Global.extend(Kinetic.Container,Kinetic.Node),Kinetic.Node.addGetterSetter(Kinetic.Container,"clipFunc")}(),function(){function e(e){e.fill()}function t(e){e.stroke()}function n(e){e.fill()}function r(e){e.stroke()}Kinetic.Shape=function(e){this._initShape(e)},Kinetic.Shape.prototype={_initShape:function(i){this.nodeType="Shape",this._fillFunc=e,this._strokeFunc=t,this._fillFuncHit=n,this._strokeFuncHit=r;var s=Kinetic.Global.shapes,o;for(;;){o=Kinetic.Type._getRandomColorKey();if(o&&!(o in s))break}this.colorKey=o,s[o]=this,this.createAttrs(),Kinetic.Node.call(this,i)},getContext:function(){return this.getLayer().getContext()},getCanvas:function(){return this.getLayer().getCanvas()},hasShadow:function(){return!!(this.getShadowColor()||this.getShadowBlur()||this.getShadowOffset())},hasFill:function(){return!!(this.getFill()||this.getFillPatternImage()||this.getFillLinearGradientStartPoint()||this.getFillRadialGradientStartPoint())},_get:function(e){return this.nodeType===e||this.shapeType===e?[this]:[]},intersects:function(){var e=Kinetic.Type._getXY(Array.prototype.slice.call(arguments)),t=this.getStage(),n=t.hitCanvas;n.clear(),this.drawScene(n);var r=n.context.getImageData(e.x|0,e.y|0,1,1).data;return r[3]>0},enableFill:function(){this.setAttr("fillEnabled",!0)},disableFill:function(){this.setAttr("fillEnabled",!1)},enableStroke:function(){this.setAttr("strokeEnabled",!0)},disableStroke:function(){this.setAttr("strokeEnabled",!1)},enableStrokeScale:function(){this.setAttr("strokeScaleEnabled",!0)},disableStrokeScale:function(){this.setAttr("strokeScaleEnabled",!1)},enableShadow:function(){this.setAttr("shadowEnabled",!0)},disableShadow:function(){this.setAttr("shadowEnabled",!1)},enableDashArray:function(){this.setAttr("dashArrayEnabled",!0)},disableDashArray:function(){this.setAttr("dashArrayEnabled",!1)},getShapeType:function(){return this.shapeType},destroy:function(){Kinetic.Node.prototype.destroy.call(this),delete Kinetic.Global.shapes[this.colorKey]},drawScene:function(e){var t=this.getAttrs(),n=t.drawFunc,e=e||this.getLayer().getCanvas(),r=e.getContext();n&&this.isVisible()&&(r.save(),e._applyOpacity(this),e._applyLineJoin(this),e._applyAncestorTransforms(this),n.call(this,e),r.restore())},drawHit:function(){var e=this.getAttrs(),t=e.drawHitFunc||e.drawFunc,n=this.getLayer().hitCanvas,r=n.getContext();t&&this.shouldDrawHit()&&(r.save(),n._applyLineJoin(this),n._applyAncestorTransforms(this),t.call(this,n),r.restore())},_setDrawFuncs:function(){!this.attrs.drawFunc&&this.drawFunc&&this.setDrawFunc(this.drawFunc),!this.attrs.drawHitFunc&&this.drawHitFunc&&this.setDrawHitFunc(this.drawHitFunc)}},Kinetic.Global.extend(Kinetic.Shape,Kinetic.Node),Kinetic.Node.addGetterSetter(Kinetic.Shape,"stroke"),Kinetic.Node.addGetterSetter(Kinetic.Shape,"lineJoin"),Kinetic.Node.addGetterSetter(Kinetic.Shape,"lineCap"),Kinetic.Node.addGetterSetter(Kinetic.Shape,"strokeWidth"),Kinetic.Node.addGetterSetter(Kinetic.Shape,"drawFunc"),Kinetic.Node.addGetterSetter(Kinetic.Shape,"drawHitFunc"),Kinetic.Node.addGetterSetter(Kinetic.Shape,"dashArray"),Kinetic.Node.addGetterSetter(Kinetic.Shape,"shadowColor"),Kinetic.Node.addGetterSetter(Kinetic.Shape,"shadowBlur"),Kinetic.Node.addGetterSetter(Kinetic.Shape,"shadowOpacity"),Kinetic.Node.addGetterSetter(Kinetic.Shape,"fillPatternImage"),Kinetic.Node.addGetterSetter(Kinetic.Shape,"fill"),Kinetic.Node.addGetterSetter(Kinetic.Shape,"fillPatternX"),Kinetic.Node.addGetterSetter(Kinetic.Shape,"fillPatternY"),Kinetic.Node.addGetterSetter(Kinetic.Shape,"fillLinearGradientColorStops"),Kinetic.Node.addGetterSetter(Kinetic.Shape,"fillRadialGradientStartRadius"),Kinetic.Node.addGetterSetter(Kinetic.Shape,"fillRadialGradientEndRadius"),Kinetic.Node.addGetterSetter(Kinetic.Shape,"fillRadialGradientColorStops"),Kinetic.Node.addGetterSetter(Kinetic.Shape,"fillPatternRepeat"),Kinetic.Node.addGetterSetter(Kinetic.Shape,"fillEnabled",!0),Kinetic.Node.addGetterSetter(Kinetic.Shape,"strokeEnabled",!0),Kinetic.Node.addGetterSetter(Kinetic.Shape,"shadowEnabled",!0),Kinetic.Node.addGetterSetter(Kinetic.Shape,"dashArrayEnabled",!0),Kinetic.Node.addGetterSetter(Kinetic.Shape,"fillPriority","color"),Kinetic.Node.addGetterSetter(Kinetic.Shape,"strokeScaleEnabled",!0),Kinetic.Node.addPointGetterSetter(Kinetic.Shape,"fillPatternOffset"),Kinetic.Node.addPointGetterSetter(Kinetic.Shape,"fillPatternScale"),Kinetic.Node.addPointGetterSetter(Kinetic.Shape,"fillLinearGradientStartPoint"),Kinetic.Node.addPointGetterSetter(Kinetic.Shape,"fillLinearGradientEndPoint"),Kinetic.Node.addPointGetterSetter(Kinetic.Shape,"fillRadialGradientStartPoint"),Kinetic.Node.addPointGetterSetter(Kinetic.Shape,"fillRadialGradientEndPoint"),Kinetic.Node.addPointGetterSetter(Kinetic.Shape,"shadowOffset"),Kinetic.Node.addRotationGetterSetter(Kinetic.Shape,"fillPatternRotation",0)}(),function(){function p(e,t){e.content.addEventListener(t,function(n){e["_"+t](n)},!1)}var e="Stage",t="string",n="px",r="mouseout",i="mouseleave",r="mouseout",s="mouseover",o="mouseenter",u="mousemove",a="mousedown",f="mouseup",l="click",c="dblclick",h="touchstart";TOUCHEND="touchend",TAP="tap",DBL_TAP="dbltap",TOUCHMOVE="touchmove",DIV="div",RELATIVE="relative",INLINE_BLOCK="inline-block",KINETICJS_CONTENT="kineticjs-content",SPACE=" ",CONTAINER="container",EVENTS=[a,u,f,r,h,TOUCHMOVE,TOUCHEND],eventsLength=EVENTS.length,Kinetic.Stage=function(e){this._initStage(e)},Kinetic.Stage.prototype={_initStage:function(t){this.createAttrs(),Kinetic.Container.call(this,t),this.nodeType=e,this.dblClickWindow=400,this._id=Kinetic.Global.idCounter++,this._buildDOM(),this._bindContentEvents(),Kinetic.Global.stages.push(this)},setContainer:function(e){typeof e===t&&(e=document.getElementById(e)),this.setAttr(CONTAINER,e)},draw:function(){var e=this.getChildren(),t=e.length,n,r;for(n=0;n<t;n++)r=e[n],r.getClearBeforeDraw()&&(r.getCanvas().clear(),r.getHitCanvas().clear());Kinetic.Node.prototype.draw.call(this)},setHeight:function(e){Kinetic.Node.prototype.setHeight.call(this,e),this._resizeDOM()},setWidth:function(e){Kinetic.Node.prototype.setWidth.call(this,e),this._resizeDOM()},clear:function(){var e=this.children,t=e.length,n;for(n=0;n<t;n++)e[n].clear()},remove:function(){var e=this.content;Kinetic.Node.prototype.remove.call(this),e&&Kinetic.Type._isInDocument(e)&&this.getContainer().removeChild(e)},getMousePosition:function(){return this.mousePos},getTouchPosition:function(){return this.touchPos},getPointerPosition:function(){return this.getTouchPosition()||this.getMousePosition()},getStage:function(){return this},getContent:function(){return this.content},toDataURL:function(e){function a(r){var i=u[r],f=i.toDataURL(),l=new Image;l.onload=function(){o.drawImage(l,0,0),r<u.length-1?a(r+1):e.callback(s.toDataURL(t,n))},l.src=f}var e=e||{},t=e.mimeType||null,n=e.quality||null,r=e.x||0,i=e.y||0,s=new Kinetic.SceneCanvas({width:e.width||this.getWidth(),height:e.height||this.getHeight(),pixelRatio:1}),o=s.getContext(),u=this.children;(r||i)&&o.translate(-1*r,-1*i),a(0)},toImage:function(e){var t=e.callback;e.callback=function(e){Kinetic.Type._getImage(e,function(e){t(e)})},this.toDataURL(e)},getIntersection:function(){var e=Kinetic.Type._getXY(Array.prototype.slice.call(arguments)),t=this.getChildren(),n=t.length,r=n-1,i,s;for(i=r;i>=0;i--){s=t[i].getIntersection(e);if(s)return s}return null},_resizeDOM:function(){if(this.content){var e=this.getWidth(),t=this.getHeight(),r=this.getChildren(),i=r.length,s;this.content.style.width=e+n,this.content.style.height=t+n,this.bufferCanvas.setSize(e,t,1),this.hitCanvas.setSize(e,t);for(s=0;s<i;s++)layer=r[s],layer.getCanvas().setSize(e,t),layer.hitCanvas.setSize(e,t),layer.draw()}},add:function(e){return Kinetic.Container.prototype.add.call(this,e),e.canvas.setSize(this.attrs.width,this.attrs.height),e.hitCanvas.setSize(this.attrs.width,this.attrs.height),e.draw(),this.content.appendChild(e.canvas.element),this},getParent:function(){return null},getLayer:function(){return null},_setPointerPosition:function(e){e||(e=window.event),this._setMousePosition(e),this._setTouchPosition(e)},_bindContentEvents:function(){var e=this,t;for(t=0;t<eventsLength;t++)p(this,EVENTS[t])},_mouseout:function(e){this._setPointerPosition(e);var t=Kinetic.Global,n=this.targetShape;n&&!t.isDragging()&&(n._handleEvent(r,e),n._handleEvent(i,e),this.targetShape=null),this.mousePos=undefined},_mousemove:function(e){this._setPointerPosition(e);var t=Kinetic.Global,n=Kinetic.DD,a=this.getIntersection(this.getPointerPosition()),f;a?(f=a.shape,f&&(!t.isDragging()&&a.pixel[3]===255&&(!this.targetShape||this.targetShape._id!==f._id)?(this.targetShape&&(this.targetShape._handleEvent(r,e,f),this.targetShape._handleEvent(i,e,f)),f._handleEvent(s,e,this.targetShape),f._handleEvent(o,e,this.targetShape),this.targetShape=f):f._handleEvent(u,e))):this.targetShape&&!t.isDragging()&&(this.targetShape._handleEvent(r,e),this.targetShape._handleEvent(i,e),this.targetShape=null),n&&n._drag(e)},_mousedown:function(e){this._setPointerPosition(e);var t=Kinetic.Global,n=this.getIntersection(this.getPointerPosition()),r;n&&n.shape&&(r=n.shape,this.clickStart=!0,this.clickStartShape=r,r._handleEvent(a,e)),this.isDraggable()&&!t.isDragReady()&&this.startDrag(e)},_mouseup:function(e){this._setPointerPosition(e);var t=this,n=Kinetic.Global,r=this.getIntersection(this.getPointerPosition()),i;r&&r.shape&&(i=r.shape,i._handleEvent(f,e),this.clickStart&&!n.isDragging()&&i._id===this.clickStartShape._id&&(i._handleEvent(l,e),this.inDoubleClickWindow&&i._handleEvent(c,e),this.inDoubleClickWindow=!0,setTimeout(function(){t.inDoubleClickWindow=!1},this.dblClickWindow))),this.clickStart=!1},_touchstart:function(e){this._setPointerPosition(e);var t=Kinetic.Global,n=this.getIntersection(this.getPointerPosition()),r;e.preventDefault(),n&&n.shape&&(r=n.shape,this.tapStart=!0,this.tapStartShape=r,r._handleEvent(h,e)),this.isDraggable()&&!t.isDragReady()&&this.startDrag(e)},_touchend:function(e){this._setPointerPosition(e);var t=this,n=Kinetic.Global,r=this.getIntersection(this.getPointerPosition()),i;r&&r.shape&&(i=r.shape,i._handleEvent(TOUCHEND,e),this.tapStart&&!n.isDragging()&&i._id===this.tapStartShape._id&&(i._handleEvent(TAP,e),this.inDoubleClickWindow&&i._handleEvent(DBL_TAP,e),this.inDoubleClickWindow=!0,setTimeout(function(){t.inDoubleClickWindow=!1},this.dblClickWindow))),this.tapStart=!1},_touchmove:function(e){this._setPointerPosition(e);var t=Kinetic.DD,n=this.getIntersection(this.getPointerPosition()),r;e.preventDefault(),n&&n.shape&&(r=n.shape,r._handleEvent(TOUCHMOVE,e)),t&&t._drag(e)},_setMousePosition:function(e){var t=e.clientX-this._getContentPosition().left,n=e.clientY-this._getContentPosition().top;this.mousePos={x:t,y:n}},_setTouchPosition:function(e){var t,n,r;e.touches!==undefined&&e.touches.length===1&&(t=e.touches[0],n=t.clientX-this._getContentPosition().left,r=t.clientY-this._getContentPosition().top,this.touchPos={x:n,y:r})},_getContentPosition:function(){var e=this.content.getBoundingClientRect();return{top:e.top,left:e.left}},_buildDOM:function(){this.content=document.createElement(DIV),this.content.style.position=RELATIVE,this.content.style.display=INLINE_BLOCK,this.content.className=KINETICJS_CONTENT,this.attrs.container.appendChild(this.content),this.bufferCanvas=new Kinetic.SceneCanvas,this.hitCanvas=new Kinetic.HitCanvas,this._resizeDOM()},_onContent:function(e,t){var n=e.split(SPACE),r=n.length,i,s;for(i=0;i<r;i++)s=n[i],this.content.addEventListener(s,t,!1)}},Kinetic.Global.extend(Kinetic.Stage,Kinetic.Container),Kinetic.Node.addGetter(Kinetic.Stage,"container")}(),function(){Kinetic.Layer=function(e){this._initLayer(e)},Kinetic.Layer.prototype={_initLayer:function(e){this.nodeType="Layer",this.createAttrs(),Kinetic.Container.call(this,e),this.canvas=new Kinetic.SceneCanvas,this.canvas.getElement().style.position="absolute",this.hitCanvas=new Kinetic.HitCanvas},getIntersection:function(){var e=Kinetic.Type._getXY(Array.prototype.slice.call(arguments)),t,n,r;if(this.isVisible()&&this.isListening()){t=this.hitCanvas.context.getImageData(e.x|0,e.y|0,1,1).data;if(t[3]===255)return n=Kinetic.Type._rgbToHex(t[0],t[1],t[2]),r=Kinetic.Global.shapes[n],{shape:r,pixel:t};if(t[0]>0||t[1]>0||t[2]>0||t[3]>0)return{pixel:t}}return null},drawScene:function(e){var e=e||this.getCanvas();this.getClearBeforeDraw()&&e.clear(),Kinetic.Container.prototype.drawScene.call(this,e)},drawHit:function(){var e=this.getLayer();e&&e.getClearBeforeDraw()&&e.getHitCanvas().clear(),Kinetic.Container.prototype.drawHit.call(this)},getCanvas:function(){return this.canvas},getHitCanvas:function(){return this.hitCanvas},getContext:function(){return this.getCanvas().getContext()},clear:function(){this.getCanvas().clear()},setVisible:function(e){Kinetic.Node.prototype.setVisible.call(this,e),e?(this.getCanvas().element.style.display="block",this.hitCanvas.element.style.display="block"):(this.getCanvas().element.style.display="none",this.hitCanvas.element.style.display="none")},setZIndex:function(e){Kinetic.Node.prototype.setZIndex.call(this,e);var t=this.getStage();t&&(t.content.removeChild(this.getCanvas().element),e<t.getChildren().length-1?t.content.insertBefore(this.getCanvas().element,t.getChildren()[e+1].getCanvas().element):t.content.appendChild(this.getCanvas().element))},moveToTop:function(){Kinetic.Node.prototype.moveToTop.call(this);var e=this.getStage();e&&(e.content.removeChild(this.getCanvas().element),e.content.appendChild(this.getCanvas().element))},moveUp:function(){if(Kinetic.Node.prototype.moveUp.call(this)){var e=this.getStage();e&&(e.content.removeChild(this.getCanvas().element),this.index<e.getChildren().length-1?e.content.insertBefore(this.getCanvas().element,e.getChildren()[this.index+1].getCanvas().element):e.content.appendChild(this.getCanvas().element))}},moveDown:function(){if(Kinetic.Node.prototype.moveDown.call(this)){var e=this.getStage();if(e){var t=e.getChildren();e.content.removeChild(this.getCanvas().element),e.content.insertBefore(this.getCanvas().element,t[this.index+1].getCanvas().element)}}},moveToBottom:function(){if(Kinetic.Node.prototype.moveToBottom.call(this)){var e=this.getStage();if(e){var t=e.getChildren();e.content.removeChild(this.getCanvas().element),e.content.insertBefore(this.getCanvas().element,t[1].getCanvas().element)}}},getLayer:function(){return this},remove:function(){var e=this.getStage(),t=this.getCanvas(),n=t.element;Kinetic.Node.prototype.remove.call(this),e&&t&&Kinetic.Type._isInDocument(n)&&e.content.removeChild(n)}},Kinetic.Global.extend(Kinetic.Layer,Kinetic.Container),Kinetic.Node.addGetterSetter(Kinetic.Layer,"clearBeforeDraw",!0)}(),function(){Kinetic.Group=function(e){this._initGroup(e)},Kinetic.Group.prototype={_initGroup:function(e){this.nodeType="Group",this.createAttrs(),Kinetic.Container.call(this,e)}},Kinetic.Global.extend(Kinetic.Group,Kinetic.Container)}(),function(){Kinetic.Rect=function(e){this._initRect(e)},Kinetic.Rect.prototype={_initRect:function(e){this.createAttrs(),Kinetic.Shape.call(this,e),this.shapeType="Rect",this._setDrawFuncs()},drawFunc:function(e){var t=e.getContext(),n=this.getCornerRadius(),r=this.getWidth(),i=this.getHeight();t.beginPath(),n?(t.moveTo(n,0),t.lineTo(r-n,0),t.arc(r-n,n,n,Math.PI*3/2,0,!1),t.lineTo(r,i-n),t.arc(r-n,i-n,n,0,Math.PI/2,!1),t.lineTo(n,i),t.arc(n,i-n,n,Math.PI/2,Math.PI,!1),t.lineTo(0,n),t.arc(n,n,n,Math.PI,Math.PI*3/2,!1)):t.rect(0,0,r,i),t.closePath(),e.fillStroke(this)}},Kinetic.Global.extend(Kinetic.Rect,Kinetic.Shape),Kinetic.Node.addGetterSetter(Kinetic.Rect,"cornerRadius",0)}(),function(){Kinetic.Circle=function(e){this._initCircle(e)},Kinetic.Circle.prototype={_initCircle:function(e){this.createAttrs(),Kinetic.Shape.call(this,e),this.shapeType="Circle",this._setDrawFuncs()},drawFunc:function(e){var t=e.getContext();t.beginPath(),t.arc(0,0,this.getRadius(),0,Math.PI*2,!0),t.closePath(),e.fillStroke(this)},getWidth:function(){return this.getRadius()*2},getHeight:function(){return this.getRadius()*2},setWidth:function(e){Kinetic.Node.prototype.setWidth.call(this,e),this.setRadius(e/2)},setHeight:function(e){Kinetic.Node.prototype.setHeight.call(this,e),this.setRadius(e/2)}},Kinetic.Global.extend(Kinetic.Circle,Kinetic.Shape),Kinetic.Node.addGetterSetter(Kinetic.Circle,"radius",0)}(),function(){Kinetic.Wedge=function(e){this._initWedge(e)},Kinetic.Wedge.prototype={_initWedge:function(e){this.createAttrs(),Kinetic.Shape.call(this,e),this.shapeType="Wedge",this._setDrawFuncs()},drawFunc:function(e){var t=e.getContext();t.beginPath(),t.arc(0,0,this.getRadius(),0,this.getAngle(),this.getClockwise()),t.lineTo(0,0),t.closePath(),e.fillStroke(this)},setAngleDeg:function(e){this.setAngle(Kinetic.Type._degToRad(e))},getAngleDeg:function(){return Kinetic.Type._radToDeg(this.getAngle())}},Kinetic.Global.extend(Kinetic.Wedge,Kinetic.Shape),Kinetic.Node.addGetterSetter(Kinetic.Wedge,"radius",0),Kinetic.Node.addGetterSetter(Kinetic.Wedge,"angle",0),Kinetic.Node.addGetterSetter(Kinetic.Wedge,"clockwise",!1)}(),function(){Kinetic.Ellipse=function(e){this._initEllipse(e)},Kinetic.Ellipse.prototype={_initEllipse:function(e){this.createAttrs(),Kinetic.Shape.call(this,e),this.shapeType="Ellipse",this._setDrawFuncs()},drawFunc:function(e){var t=e.getContext(),n=this.getRadius();t.beginPath(),t.save(),n.x!==n.y&&t.scale(1,n.y/n.x),t.arc(0,0,n.x,0,Math.PI*2,!0),t.restore(),t.closePath(),e.fillStroke(this)},getWidth:function(){return this.getRadius().x*2},getHeight:function(){return this.getRadius().y*2},setWidth:function(e){Kinetic.Node.prototype.setWidth.call(this,e),this.setRadius({x:e/2})},setHeight:function(e){Kinetic.Node.prototype.setHeight.call(this,e),this.setRadius({y:e/2})}},Kinetic.Global.extend(Kinetic.Ellipse,Kinetic.Shape),Kinetic.Node.addPointGetterSetter(Kinetic.Ellipse,"radius",{x:0,y:0})}(),function(){var e="Image",t="crop";Kinetic.Image=function(e){this._initImage(e)},Kinetic.Image.prototype={_initImage:function(t){var n=this;Kinetic.Shape.call(this,t),this.shapeType=e,this._setDrawFuncs()},drawFunc:function(e){var t=this.getWidth(),n=this.getHeight(),r,i=this,s=e.getContext(),o=this.getImage(),u=this.getCrop(),a,f,l,c;s.beginPath(),s.rect(0,0,t,n),s.closePath(),e.fillStroke(this),o&&(u?(a=u.x||0,f=u.y||0,l=u.width||0,c=u.height||0,r=[o,a,f,l,c,0,0,t,n]):r=[o,0,0,t,n],this.hasShadow()?e.applyShadow(this,function(){i._drawImage(s,r)}):this._drawImage(s,r))},drawHitFunc:function(e){var t=this.getWidth(),n=this.getHeight(),r=this.imageHitRegion,i=e.getContext();r?(i.drawImage(r,0,0,t,n),i.beginPath(),i.rect(0,0,t,n),i.closePath(),e.stroke(this)):(i.beginPath(),i.rect(0,0,t,n),i.closePath(),e.fillStroke(this))},applyFilter:function(e,t,n){var r=this.getImage(),i=new Kinetic.Canvas({width:r.width,height:r.height}),s=i.getContext(),o=this;s.drawImage(r,0,0);try{var u=s.getImageData(0,0,i.getWidth(),i.getHeight());e(u,t),Kinetic.Type._getImage(u,function(e){o.setImage(e),n&&n()})}catch(a){Kinetic.Global.warn("Unable to apply filter. "+a.message)}},setCrop:function(){var e=[].slice.call(arguments),n=Kinetic.Type._getXY(e),r=Kinetic.Type._getSize(e),i=Kinetic.Type._merge(n,r);this.setAttr(t,Kinetic.Type._merge(i,this.getCrop()))},createImageHitRegion:function(e){var t=this,n=this.getWidth(),r=this.getHeight(),i=new Kinetic.Canvas({width:n,height:r}),s=i.getContext(),o=this.getImage(),u,a,f,l,c;s.drawImage(o,0,0);try{u=s.getImageData(0,0,n,r),a=u.data,f=Kinetic.Type._hexToRgb(this.colorKey);for(l=0,c=a.length;l<c;l+=4)a[l+3]>0&&(a[l]=f.r,a[l+1]=f.g,a[l+2]=f.b);Kinetic.Type._getImage(u,function(n){t.imageHitRegion=n,e&&e()})}catch(h){Kinetic.Global.warn("Unable to create image hit region. "+h.message)}},clearImageHitRegion:function(){delete this.imageHitRegion},getWidth:function(){var e=this.getImage();return this.attrs.width||(e?e.width:0)},getHeight:function(){var e=this.getImage();return this.attrs.height||(e?e.height:0)},_drawImage:function(e,t){t.length===5?e.drawImage(t[0],t[1],t[2],t[3],t[4]):t.length===9&&e.drawImage(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}},Kinetic.Global.extend(Kinetic.Image,Kinetic.Shape),Kinetic.Node.addGetterSetter(Kinetic.Image,"image"),Kinetic.Node.addGetter(Kinetic.Image,"crop")}(),function(){Kinetic.Polygon=function(e){this._initPolygon(e)},Kinetic.Polygon.prototype={_initPolygon:function(e){this.createAttrs(),Kinetic.Shape.call(this,e),this.shapeType="Polygon",this._setDrawFuncs()},drawFunc:function(e){var t=e.getContext(),n=this.getPoints(),r=n.length;t.beginPath(),t.moveTo(n[0].x,n[0].y);for(var i=1;i<r;i++)t.lineTo(n[i].x,n[i].y);t.closePath(),e.fillStroke(this)},setPoints:function(e){this.setAttr("points",Kinetic.Type._getPoints(e))},getPoints:function(){return this.attrs.points||[]}},Kinetic.Global.extend(Kinetic.Polygon,Kinetic.Shape)}(),function(){function T(e){e.fillText(this.partialText,0,0)}function N(e){e.strokeText(this.partialText,0,0)}var e="auto",t="Calibri",n="canvas",r="center",i="Change.kinetic",s="2d",o="-",u="",a="left",f="\n",l="text",c="Text",h="top",p="middle",d="normal",v="px ",m=" ",g="right",y="word",b="char",w="none",E=["fontFamily","fontSize","fontStyle","padding","align","lineHeight","text","width","height","wrap"],S=E.length,x=document.createElement(n).getContext(s);Kinetic.Text=function(e){this._initText(e)},Kinetic.Text.prototype={_initText:function(t){var n=this;this.createAttrs(),this.attrs.width=e,this.attrs.height=e,Kinetic.Shape.call(this,t),this.shapeType=l,this._fillFunc=T,this._strokeFunc=N,this.shapeType=c,this._setDrawFuncs();for(var r=0;r<S;r++)this.on(E[r]+i,n._setTextData);this._setTextData()},drawFunc:function(e){var t=e.getContext(),n=this.getPadding(),i=this.getFontStyle(),s=this.getFontSize(),o=this.getFontFamily(),u=this.getTextHeight(),f=this.getLineHeight()*u,l=this.textArr,c=l.length,h=this.getWidth();t.font=this._getContextFont(),t.textBaseline=p,t.textAlign=a,t.save(),t.translate(n,0),t.translate(0,n+u/2);for(var d=0;d<c;d++){var v=l[d],m=v.text,y=v.width;t.save(),this.getAlign()===g?t.translate(h-y-n*2,0):this.getAlign()===r&&t.translate((h-y-n*2)/2,0),this.partialText=m,e.fillStroke(this),t.restore(),t.translate(0,f)}t.restore()},drawHitFunc:function(e){var t=e.getContext(),n=this.getWidth(),r=this.getHeight();t.beginPath(),t.rect(0,0,n,r),t.closePath(),e.fillStroke(this)},setText:function(e){var t=Kinetic.Type._isString(e)?e:e.toString();this.setAttr(l,t)},getWidth:function(){return this.attrs.width===e?this.getTextWidth()+this.getPadding()*2:this.attrs.width},getHeight:function(){return this.attrs.height===e?this.getTextHeight()*this.textArr.length*this.getLineHeight()+this.getPadding()*2:this.attrs.height},getTextWidth:function(){return this.textWidth},getTextHeight:function(){return this.textHeight},_getTextSize:function(e){var t=x,n=this.getFontSize(),r;return t.save(),t.font=this._getContextFont(),r=t.measureText(e),t.restore(),{width:r.width,height:parseInt(n,10)}},_getContextFont:function(){return this.getFontStyle()+m+this.getFontSize()+v+this.getFontFamily()},_addTextLine:function(e,t,n){return this.textArr.push({text:e,width:t})},_getTextWidth:function(e){return x.measureText(e).width},_setTextData:function(){var t=this.getText().split("\n"),n=+this.getFontSize(),r=0,i=this.getLineHeight()*n,s=this.attrs.width,u=this.attrs.height,a=s!==e,f=u!==e,l=this.getPadding(),c=s-l*2,h=u-l*2,p=0,d=this.getWrap(),g=d!==w,y=d!==b&&g;this.textArr=[],x.save(),x.font=this.getFontStyle()+m+n+v+this.getFontFamily();for(var E=0,S=t.length;E<S;++E){var T=t[E],N=this._getTextWidth(T);if(a&&N>c)while(T.length>0){var C=0,k=T.length,L="",A=0;while(C<k){var O=C+k>>>1,M=T.slice(0,O+1),_=this._getTextWidth(M);_<=c?(C=O+1,L=M,A=_):k=O}if(!L)break;if(y){var D=Math.max(L.lastIndexOf(m),L.lastIndexOf(o))+1;D>0&&(C=D,L=L.slice(0,C),A=this._getTextWidth(L))}this._addTextLine(L,A),p+=i;if(!g||f&&p+i>h)break;T=T.slice(C);if(T.length>0){N=this._getTextWidth(T);if(N<=c){this._addTextLine(T,N),p+=i;break}}}else this._addTextLine(T,N),p+=i,r=Math.max(r,N);if(f&&p+i>h)break}x.restore(),this.textHeight=n,this.textWidth=r}},Kinetic.Global.extend(Kinetic.Text,Kinetic.Shape),Kinetic.Node.addGetterSetter(Kinetic.Text,"fontFamily",t),Kinetic.Node.addGetterSetter(Kinetic.Text,"fontSize",12),Kinetic.Node.addGetterSetter(Kinetic.Text,"fontStyle",d),Kinetic.Node.addGetterSetter(Kinetic.Text,"padding",0),Kinetic.Node.addGetterSetter(Kinetic.Text,"align",a),Kinetic.Node.addGetterSetter(Kinetic.Text,"lineHeight",1),Kinetic.Node.addGetterSetter(Kinetic.Text,"wrap",y),Kinetic.Node.addGetter(Kinetic.Text,l,u),Kinetic.Node.addSetter(Kinetic.Text,"width"),Kinetic.Node.addSetter(Kinetic.Text,"height")}(),function(){Kinetic.Line=function(e){this._initLine(e)},Kinetic.Line.prototype={_initLine:function(e){this.createAttrs(),Kinetic.Shape.call(this,e),this.shapeType="Line",this._setDrawFuncs()},drawFunc:function(e){var t=this.getPoints(),n=t.length,r=e.getContext();r.beginPath(),r.moveTo(t[0].x,t[0].y);for(var i=1;i<n;i++){var s=t[i];r.lineTo(s.x,s.y)}e.stroke(this)},setPoints:function(e){this.setAttr("points",Kinetic.Type._getPoints(e))},getPoints:function(){return this.attrs.points||[]}},Kinetic.Global.extend(Kinetic.Line,Kinetic.Shape)}(),function(){Kinetic.Spline=function(e){this._initSpline(e)},Kinetic.Spline._getControlPoints=function(e,t,n,r){var i=e.x,s=e.y,o=t.x,u=t.y,a=n.x,f=n.y,l=Math.sqrt(Math.pow(o-i,2)+Math.pow(u-s,2)),c=Math.sqrt(Math.pow(a-o,2)+Math.pow(f-u,2)),h=r*l/(l+c),p=r*c/(l+c),d=o-h*(a-i),v=u-h*(f-s),m=o+p*(a-i),g=u+p*(f-s);return[{x:d,y:v},{x:m,y:g}]},Kinetic.Spline.prototype={_initSpline:function(e){this.createAttrs(),Kinetic.Line.call(this,e),this.shapeType="Spline"},drawFunc:function(e){var t=this.getPoints(),n=t.length,r=e.getContext(),i=this.getTension();r.beginPath(),r.moveTo(t[0].x,t[0].y);if(i!==0&&n>2){var s=this.allPoints,o=s.length;r.quadraticCurveTo(s[0].x,s[0].y,s[1].x,s[1].y);var u=2;while(u<o-1)r.bezierCurveTo(s[u].x,s[u++].y,s[u].x,s[u++].y,s[u].x,s[u++].y);r.quadraticCurveTo(s[o-1].x,s[o-1].y,t[n-1].x,t[n-1].y)}else for(var u=1;u<n;u++){var a=t[u];r.lineTo(a.x,a.y)}e.stroke(this)},setPoints:function(e){Kinetic.Line.prototype.setPoints.call(this,e),this._setAllPoints()},setTension:function(e){this.setAttr("tension",e),this._setAllPoints()},_setAllPoints:function(){var e=this.getPoints(),t=e.length,n=this.getTension(),r=[];for(var i=1;i<t-1;i++){var s=Kinetic.Spline._getControlPoints(e[i-1],e[i],e[i+1],n);r.push(s[0]),r.push(e[i]),r.push(s[1])}this.allPoints=r}},Kinetic.Global.extend(Kinetic.Spline,Kinetic.Line),Kinetic.Node.addGetter(Kinetic.Spline,"tension",1)}(),function(){Kinetic.Blob=function(e){this._initBlob(e)},Kinetic.Blob.prototype={_initBlob:function(e){Kinetic.Spline.call(this,e),this.shapeType="Blob"},drawFunc:function(e){var t=this.getPoints(),n=t.length,r=e.getContext(),i=this.getTension();r.beginPath(),r.moveTo(t[0].x,t[0].y);if(i!==0&&n>2){var s=this.allPoints,o=s.length,u=0;while(u<o-1)r.bezierCurveTo(s[u].x,s[u++].y,s[u].x,s[u++].y,s[u].x,s[u++].y)}else for(var u=1;u<n;u++){var a=t[u];r.lineTo(a.x,a.y)}r.closePath(),e.fillStroke(this)},_setAllPoints:function(){var e=this.getPoints(),t=e.length,n=this.getTension(),r=Kinetic.Spline._getControlPoints(e[t-1],e[0],e[1],n),i=Kinetic.Spline._getControlPoints(e[t-2],e[t-1],e[0],n);Kinetic.Spline.prototype._setAllPoints.call(this),this.allPoints.unshift(r[1]),this.allPoints.push(i[0]),this.allPoints.push(e[t-1]),this.allPoints.push(i[1]),this.allPoints.push(r[0]),this.allPoints.push(e[0])}},Kinetic.Global.extend(Kinetic.Blob,Kinetic.Spline)}(),function(){Kinetic.Sprite=function(e){this._initSprite(e)},Kinetic.Sprite.prototype={_initSprite:function(e){this.createAttrs(),Kinetic.Shape.call(this,e),this.shapeType="Sprite",this._setDrawFuncs(),this.anim=new Kinetic.Animation;var t=this;this.on("animationChange",function(){t.setIndex(0)})},drawFunc:function(e){var t=this.getAnimation(),n=this.getIndex(),r=this.getAnimations()[t][n],i=e.getContext(),s=this.getImage();s&&i.drawImage(s,r.x,r.y,r.width,r.height,0,0,r.width,r.height)},drawHitFunc:function(e){var t=this.getAnimation(),n=this.getIndex(),r=this.getAnimations()[t][n],i=e.getContext();i.beginPath(),i.rect(0,0,r.width,r.height),i.closePath(),e.fill(this)},start:function(){var e=this,t=this.getLayer();this.anim.node=t,this.interval=setInterval(function(){var t=e.getIndex();e._updateIndex(),e.afterFrameFunc&&t===e.afterFrameIndex&&(e.afterFrameFunc(),delete e.afterFrameFunc,delete e.afterFrameIndex)},1e3/this.getFrameRate()),this.anim.start()},stop:function(){this.anim.stop(),clearInterval(this.interval)},afterFrame:function(e,t){this.afterFrameIndex=e,this.afterFrameFunc=t},_updateIndex:function(){var e=this.getIndex(),t=this.getAnimation(),n=this.getAnimations(),r=n[t],i=r.length;e<i-1?this.setIndex(e+1):this.setIndex(0)}},Kinetic.Global.extend(Kinetic.Sprite,Kinetic.Shape),Kinetic.Node.addGetterSetter(Kinetic.Sprite,"animation"),Kinetic.Node.addGetterSetter(Kinetic.Sprite,"animations"),Kinetic.Node.addGetterSetter(Kinetic.Sprite,"image"),Kinetic.Node.addGetterSetter(Kinetic.Sprite,"index",0),Kinetic.Node.addGetterSetter(Kinetic.Sprite,"frameRate",17)}(),function(){Kinetic.Path=function(e){this._initPath(e)},Kinetic.Path.prototype={_initPath:function(e){this.dataArray=[];var t=this;Kinetic.Shape.call(this,e),this.shapeType="Path",this._setDrawFuncs(),this.dataArray=Kinetic.Path.parsePathData(this.getData()),this.on("dataChange",function(){t.dataArray=Kinetic.Path.parsePathData(this.getData())})},drawFunc:function(e){var t=this.dataArray,n=e.getContext();n.beginPath();for(var r=0;r<t.length;r++){var i=t[r].command,s=t[r].points;switch(i){case"L":n.lineTo(s[0],s[1]);break;case"M":n.moveTo(s[0],s[1]);break;case"C":n.bezierCurveTo(s[0],s[1],s[2],s[3],s[4],s[5]);break;case"Q":n.quadraticCurveTo(s[0],s[1],s[2],s[3]);break;case"A":var o=s[0],u=s[1],a=s[2],f=s[3],l=s[4],c=s[5],h=s[6],p=s[7],d=a>f?a:f,v=a>f?1:a/f,m=a>f?f/a:1;n.translate(o,u),n.rotate(h),n.scale(v,m),n.arc(0,0,d,l,l+c,1-p),n.scale(1/v,1/m),n.rotate(-h),n.translate(-o,-u);break;case"z":n.closePath()}}e.fillStroke(this)}},Kinetic.Global.extend(Kinetic.Path,Kinetic.Shape),Kinetic.Path.getLineLength=function(e,t,n,r){return Math.sqrt((n-e)*(n-e)+(r-t)*(r-t))},Kinetic.Path.getPointOnLine=function(e,t,n,r,i,s,o){s===undefined&&(s=t),o===undefined&&(o=n);var u=(i-n)/(r-t+1e-8),a=Math.sqrt(e*e/(1+u*u));r<t&&(a*=-1);var f=u*a,l;if((o-n)/(s-t+1e-8)===u)l={x:s+a,y:o+f};else{var c,h,p=this.getLineLength(t,n,r,i);if(p<1e-8)return undefined;var d=(s-t)*(r-t)+(o-n)*(i-n);d/=p*p,c=t+d*(r-t),h=n+d*(i-n);var v=this.getLineLength(s,o,c,h),m=Math.sqrt(e*e-v*v);a=Math.sqrt(m*m/(1+u*u)),r<t&&(a*=-1),f=u*a,l={x:c+a,y:h+f}}return l},Kinetic.Path.getPointOnCubicBezier=function(e,t,n,r,i,s,o,u,a){function f(e){return e*e*e}function l(e){return 3*e*e*(1-e)}function c(e){return 3*e*(1-e)*(1-e)}function h(e){return(1-e)*(1-e)*(1-e)}var p=u*f(e)+s*l(e)+r*c(e)+t*h(e),d=a*f(e)+o*l(e)+i*c(e)+n*h(e);return{x:p,y:d}},Kinetic.Path.getPointOnQuadraticBezier=function(e,t,n,r,i,s,o){function u(e){return e*e}function a(e){return 2*e*(1-e)}function f(e){return(1-e)*(1-e)}var l=s*u(e)+r*a(e)+t*f(e),c=o*u(e)+i*a(e)+n*f(e);return{x:l,y:c}},Kinetic.Path.getPointOnEllipticalArc=function(e,t,n,r,i,s){var o=Math.cos(s),u=Math.sin(s),a={x:n*Math.cos(i),y:r*Math.sin(i)};return{x:e+(a.x*o-a.y*u),y:t+(a.x*u+a.y*o)}},Kinetic.Path.parsePathData=function(e){if(!e)return[];var t=e,n=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];t=t.replace(new RegExp(" ","g"),",");for(var r=0;r<n.length;r++)t=t.replace(new RegExp(n[r],"g"),"|"+n[r]);var i=t.split("|"),s=[],o=0,u=0;for(var r=1;r<i.length;r++){var a=i[r],f=a.charAt(0);a=a.slice(1),a=a.replace(new RegExp(",-","g"),"-"),a=a.replace(new RegExp("-","g"),",-"),a=a.replace(new RegExp("e,-","g"),"e-");var l=a.split(",");l.length>0&&l[0]===""&&l.shift();for(var c=0;c<l.length;c++)l[c]=parseFloat(l[c]);while(l.length>0){if(isNaN(l[0]))break;var h=null,p=[],d=o,v=u;switch(f){case"l":o+=l.shift(),u+=l.shift(),h="L",p.push(o,u);break;case"L":o=l.shift(),u=l.shift(),p.push(o,u);break;case"m":o+=l.shift(),u+=l.shift(),h="M",p.push(o,u),f="l";break;case"M":o=l.shift(),u=l.shift(),h="M",p.push(o,u),f="L";break;case"h":o+=l.shift(),h="L",p.push(o,u);break;case"H":o=l.shift(),h="L",p.push(o,u);break;case"v":u+=l.shift(),h="L",p.push(o,u);break;case"V":u=l.shift(),h="L",p.push(o,u);break;case"C":p.push(l.shift(),l.shift(),l.shift(),l.shift()),o=l.shift(),u=l.shift(),p.push(o,u);break;case"c":p.push(o+l.shift(),u+l.shift(),o+l.shift(),u+l.shift()),o+=l.shift(),u+=l.shift(),h="C",p.push(o,u);break;case"S":var m=o,g=u,y=s[s.length-1];y.command==="C"&&(m=o+(o-y.points[2]),g=u+(u-y.points[3])),p.push(m,g,l.shift(),l.shift()),o=l.shift(),u=l.shift(),h="C",p.push(o,u);break;case"s":var m=o,g=u,y=s[s.length-1];y.command==="C"&&(m=o+(o-y.points[2]),g=u+(u-y.points[3])),p.push(m,g,o+l.shift(),u+l.shift()),o+=l.shift(),u+=l.shift(),h="C",p.push(o,u);break;case"Q":p.push(l.shift(),l.shift()),o=l.shift(),u=l.shift(),p.push(o,u);break;case"q":p.push(o+l.shift(),u+l.shift()),o+=l.shift(),u+=l.shift(),h="Q",p.push(o,u);break;case"T":var m=o,g=u,y=s[s.length-1];y.command==="Q"&&(m=o+(o-y.points[0]),g=u+(u-y.points[1])),o=l.shift(),u=l.shift(),h="Q",p.push(m,g,o,u);break;case"t":var m=o,g=u,y=s[s.length-1];y.command==="Q"&&(m=o+(o-y.points[0]),g=u+(u-y.points[1])),o+=l.shift(),u+=l.shift(),h="Q",p.push(m,g,o,u);break;case"A":var b=l.shift(),w=l.shift(),E=l.shift(),S=l.shift(),x=l.shift(),T=o,N=u;o=l.shift(),u=l.shift(),h="A",p=this.convertEndpointToCenterParameterization(T,N,o,u,S,x,b,w,E);break;case"a":var b=l.shift(),w=l.shift(),E=l.shift(),S=l.shift(),x=l.shift(),T=o,N=u;o+=l.shift(),u+=l.shift(),h="A",p=this.convertEndpointToCenterParameterization(T,N,o,u,S,x,b,w,E)}s.push({command:h||f,points:p,start:{x:d,y:v},pathLength:this.calcLength(d,v,h||f,p)})}(f==="z"||f==="Z")&&s.push({command:"z",points:[],start:undefined,pathLength:0})}return s},Kinetic.Path.calcLength=function(e,n,r,i){var s,o,u,a=Kinetic.Path;switch(r){case"L":return a.getLineLength(e,n,i[0],i[1]);case"C":s=0,o=a.getPointOnCubicBezier(0,e,n,i[0],i[1],i[2],i[3],i[4],i[5]);for(t=.01;t<=1;t+=.01)u=a.getPointOnCubicBezier(t,e,n,i[0],i[1],i[2],i[3],i[4],i[5]),s+=a.getLineLength(o.x,o.y,u.x,u.y),o=u;return s;case"Q":s=0,o=a.getPointOnQuadraticBezier(0,e,n,i[0],i[1],i[2],i[3]);for(t=.01;t<=1;t+=.01)u=a.getPointOnQuadraticBezier(t,e,n,i[0],i[1],i[2],i[3]),s+=a.getLineLength(o.x,o.y,u.x,u.y),o=u;return s;case"A":s=0;var f=i[4],l=i[5],c=i[4]+l,h=Math.PI/180;Math.abs(f-c)<h&&(h=Math.abs(f-c)),o=a.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],f,0);if(l<0)for(t=f-h;t>c;t-=h)u=a.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],t,0),s+=a.getLineLength(o.x,o.y,u.x,u.y),o=u;else for(t=f+h;t<c;t+=h)u=a.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],t,0),s+=a.getLineLength(o.x,o.y,u.x,u.y),o=u;return u=a.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],c,0),s+=a.getLineLength(o.x,o.y,u.x,u.y),s}return 0},Kinetic.Path.convertEndpointToCenterParameterization=function(e,t,n,r,i,s,o,u,a){var f=a*(Math.PI/180),l=Math.cos(f)*(e-n)/2+Math.sin(f)*(t-r)/2,c=-1*Math.sin(f)*(e-n)/2+Math.cos(f)*(t-r)/2,h=l*l/(o*o)+c*c/(u*u);h>1&&(o*=Math.sqrt(h),u*=Math.sqrt(h));var p=Math.sqrt((o*o*u*u-o*o*c*c-u*u*l*l)/(o*o*c*c+u*u*l*l));i==s&&(p*=-1),isNaN(p)&&(p=0);var d=p*o*c/u,v=p*-u*l/o,m=(e+n)/2+Math.cos(f)*d-Math.sin(f)*v,g=(t+r)/2+Math.sin(f)*d+Math.cos(f)*v,y=function(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])},b=function(e,t){return(e[0]*t[0]+e[1]*t[1])/(y(e)*y(t))},w=function(e,t){return(e[0]*t[1]<e[1]*t[0]?-1:1)*Math.acos(b(e,t))},E=w([1,0],[(l-d)/o,(c-v)/u]),S=[(l-d)/o,(c-v)/u],x=[(-1*l-d)/o,(-1*c-v)/u],T=w(S,x);return b(S,x)<=-1&&(T=Math.PI),b(S,x)>=1&&(T=0),s===0&&T>0&&(T-=2*Math.PI),s==1&&T<0&&(T+=2*Math.PI),[m,g,o,u,E,T,f,s]},Kinetic.Node.addGetterSetter(Kinetic.Path,"data")}(),function(){function r(e){e.fillText(this.partialText,0,0)}function i(e){e.strokeText(this.partialText,0,0)}var e="",t="Calibri",n="normal";Kinetic.TextPath=function(e){this._initTextPath(e)},Kinetic.TextPath.prototype={_initTextPath:function(e){var t=this;this.createAttrs(),this.dummyCanvas=document.createElement("canvas"),this.dataArray=[],Kinetic.Shape.call(this,e),this._fillFunc=r,this._strokeFunc=i,this.shapeType="TextPath",this._setDrawFuncs(),this.dataArray=Kinetic.Path.parsePathData(this.attrs.data),this.on("dataChange",function(){t.dataArray=Kinetic.Path.parsePathData(this.attrs.data)});var n=["text","textStroke","textStrokeWidth"];for(var s=0;s<n.length;s++){var o=n[s];this.on(o+"Change",t._setTextData)}t._setTextData()},drawFunc:function(e){var t=this.charArr,n=e.getContext();n.font=this._getContextFont(),n.textBaseline="middle",n.textAlign="left",n.save();var r=this.glyphInfo;for(var i=0;i<r.length;i++){n.save();var s=r[i].p0,o=r[i].p1,u=parseFloat(this.attrs.fontSize);n.translate(s.x,s.y),n.rotate(r[i].rotation),this.partialText=r[i].text,e.fillStroke(this),n.restore()}n.restore()},getTextWidth:function(){return this.textWidth},getTextHeight:function(){return this.textHeight},setText:function(e){Kinetic.Text.prototype.setText.call(this,e)},_getTextSize:function(e){var t=this.dummyCanvas,n=t.getContext("2d");n.save(),n.font=this._getContextFont();var r=n.measureText(e);return n.restore(),{width:r.width,height:parseInt(this.attrs.fontSize,10)}},_setTextData:function(){var e=this,t=this._getTextSize(this.attrs.text);this.textWidth=t.width,this.textHeight=t.height,this.glyphInfo=[];var n=this.attrs.text.split(""),r,i,s,o=-1,u=0,a=function(){u=0;var t=e.dataArray;for(var n=o+1;n<t.length;n++){if(t[n].pathLength>0)return o=n,t[n];t[n].command=="M"&&(r={x:t[n].points[0],y:t[n].points[1]})}return{}},f=function(t,n){var o=e._getTextSize(t).width,f=0,l=0,c=!1;i=undefined;while(Math.abs(o-f)/o>.01&&l<25){l++;var h=f;while(s===undefined)s=a(),s&&h+s.pathLength<o&&(h+=s.pathLength,s=undefined);if(s==={}||r===undefined)return undefined;var p=!1;switch(s.command){case"L":Kinetic.Path.getLineLength(r.x,r.y,s.points[0],s.points[1])>o?i=Kinetic.Path.getPointOnLine(o,r.x,r.y,s.points[0],s.points[1],r.x,r.y):s=undefined;break;case"A":var d=s.points[4],v=s.points[5],m=s.points[4]+v;u===0?u=d+1e-8:o>f?u+=Math.PI/180*v/Math.abs(v):u-=Math.PI/360*v/Math.abs(v),Math.abs(u)>Math.abs(m)&&(u=m,p=!0),i=Kinetic.Path.getPointOnEllipticalArc(s.points[0],s.points[1],s.points[2],s.points[3],u,s.points[6]);break;case"C":u===0?o>s.pathLength?u=1e-8:u=o/s.pathLength:o>f?u+=(o-f)/s.pathLength:u-=(f-o)/s.pathLength,u>1&&(u=1,p=!0),i=Kinetic.Path.getPointOnCubicBezier(u,s.start.x,s.start.y,s.points[0],s.points[1],s.points[2],s.points[3],s.points[4],s.points[5]);break;case"Q":u===0?u=o/s.pathLength:o>f?u+=(o-f)/s.pathLength:u-=(f-o)/s.pathLength,u>1&&(u=1,p=!0),i=Kinetic.Path.getPointOnQuadraticBezier(u,s.start.x,s.start.y,s.points[0],s.points[1],s.points[2],s.points[3])}i!==undefined&&(f=Kinetic.Path.getLineLength(r.x,r.y,i.x,i.y)),p&&(p=!1,s=undefined)}};for(var l=0;l<n.length;l++){f(n[l]);if(r===undefined||i===undefined)break;var c=Kinetic.Path.getLineLength(r.x,r.y,i.x,i.y),h=0,p=Kinetic.Path.getPointOnLine(h+c/2,r.x,r.y,i.x,i.y),d=Math.atan2(i.y-r.y,i.x-r.x);this.glyphInfo.push({transposeX:p.x,transposeY:p.y,text:n[l],rotation:d,p0:r,p1:i}),r=i}}},Kinetic.TextPath.prototype._getContextFont=Kinetic.Text.prototype._getContextFont,Kinetic.Global.extend(Kinetic.TextPath,Kinetic.Shape),Kinetic.Node.addGetterSetter(Kinetic.TextPath,"fontFamily",t),Kinetic.Node.addGetterSetter(Kinetic.TextPath,"fontSize",12),Kinetic.Node.addGetterSetter(Kinetic.TextPath,"fontStyle",n),Kinetic.Node.addGetter(Kinetic.TextPath,"text",e)}(),function(){Kinetic.RegularPolygon=function(e){this._initRegularPolygon(e)},Kinetic.RegularPolygon.prototype={_initRegularPolygon:function(e){this.createAttrs(),Kinetic.Shape.call(this,e),this.shapeType="RegularPolygon",this._setDrawFuncs()},drawFunc:function(e){var t=e.getContext(),n=this.attrs.sides,r=this.attrs.radius;t.beginPath(),t.moveTo(0,0-r);for(var i=1;i<n;i++){var s=r*Math.sin(i*2*Math.PI/n),o=-1*r*Math.cos(i*2*Math.PI/n);t.lineTo(s,o)}t.closePath(),e.fillStroke(this)}},Kinetic.Global.extend(Kinetic.RegularPolygon,Kinetic.Shape),Kinetic.Node.addGetterSetter(Kinetic.RegularPolygon,"radius",0),Kinetic.Node.addGetterSetter(Kinetic.RegularPolygon,"sides",0)}(),function(){Kinetic.Star=function(e){this._initStar(e)},Kinetic.Star.prototype={_initStar:function(e){this.createAttrs(),Kinetic.Shape.call(this,e),this.shapeType="Star",this._setDrawFuncs()},drawFunc:function(e){var t=e.getContext(),n=this.attrs.innerRadius,r=this.attrs.outerRadius,i=this.attrs.numPoints;t.beginPath(),t.moveTo(0,0-this.attrs.outerRadius);for(var s=1;s<i*2;s++){var o=s%2===0?r:n,u=o*Math.sin(s*Math.PI/i),a=-1*o*Math.cos(s*Math.PI/i);t.lineTo(u,a)}t.closePath(),e.fillStroke(this)}},Kinetic.Global.extend(Kinetic.Star,Kinetic.Shape),Kinetic.Node.addGetterSetter(Kinetic.Star,"numPoints",0),Kinetic.Node.addGetterSetter(Kinetic.Star,"innerRadius",0),Kinetic.Node.addGetterSetter(Kinetic.Star,"outerRadius",0)}(),function(){var e=["fontFamily","fontSize","fontStyle","padding","lineHeight","text"],t="Change.kinetic",n="none",r="up",i="right",s="down",o="left",u=e.length;Kinetic.Label=function(e){this._initLabel(e)},Kinetic.Label.prototype={_initLabel:function(n){var r=this,i=null;this.innerGroup=new Kinetic.Group,this.createAttrs(),Kinetic.Group.call(this,n),i=new Kinetic.Text(n.text),this.setText(i),this.setRect(new Kinetic.LabelRect(n.rect)),this.innerGroup.add(this.getRect()),this.innerGroup.add(i),this.add(this.innerGroup),this._setGroupOffset();for(var s=0;s<u;s++)i.on(e[s]+t,function(){r._setGroupOffset()})},getWidth:function(){return this.getText().getWidth()},getHeight:function(){return this.getText().getHeight()},_setGroupOffset:function(){var e=this.getText(),t=e.getWidth(),n=e.getHeight(),u=this.getRect(),a=u.getPointerDirection(),f=u.getPointerWidth(),l=u.getPointerHeight(),c=0,h=0;switch(a){case r:c=t/2,h=-1*l;break;case i:c=t+f,h=n/2;break;case s:c=t/2,h=n+l;break;case o:c=-1*f,h=n/2}this.setOffset({x:c,y:h})}},Kinetic.Global.extend(Kinetic.Label,Kinetic.Group),Kinetic.Node.addGetterSetter(Kinetic.Label,"text"),Kinetic.Node.addGetterSetter(Kinetic.Label,"rect"),Kinetic.LabelRect=function(e){this._initLabelRect(e)},Kinetic.LabelRect.prototype={_initLabelRect:function(e){this.createAttrs(),Kinetic.Shape.call(this,e),this.shapeType="LabelRect",this._setDrawFuncs()},drawFunc:function(e){var t=this.getParent().getParent(),n=e.getContext(),u=t.getWidth(),a=t.getHeight(),f=this.getPointerDirection(),l=this.getPointerWidth(),c=this.getPointerHeight(),h=this.getCornerRadius();n.beginPath(),n.moveTo(0,0),f===r&&(n.lineTo((u-l)/2,0),n.lineTo(u/2,-1*c),n.lineTo((u+l)/2,0)),n.lineTo(u,0),f===i&&(n.lineTo(u,(a-c)/2),n.lineTo(u+l,a/2),n.lineTo(u,(a+c)/2)),n.lineTo(u,a),f===s&&(n.lineTo((u+l)/2,a),n.lineTo(u/2,a+c),n.lineTo((u-l)/2,a)),n.lineTo(0,a),f===o&&(n.lineTo(0,(a+c)/2),n.lineTo(-1*l,a/2),n.lineTo(0,(a-c)/2)),n.closePath(),e.fillStroke(this)}},Kinetic.Global.extend(Kinetic.LabelRect,Kinetic.Shape),Kinetic.Node.addGetterSetter(Kinetic.LabelRect,"pointerDirection",n),Kinetic.Node.addGetterSetter(Kinetic.LabelRect,"pointerWidth",0),Kinetic.Node.addGetterSetter(Kinetic.LabelRect,"pointerHeight",0),Kinetic.Node.addGetterSetter(Kinetic.LabelRect,"cornerRadius",0)}(),define("application/uml/drawing/sequence/config",["require","jquery"],function(e){var t,n,r;return t=e("jquery"),n=t("body").css("fontFamily"),r=parseInt(t("body").css("fontSize"),10),{lineSize:1,arrowSize:8,borderColor:"#a80036",backColor:"#ffffcf",foreColor:"#000",fontFamily:n,fontSize:r}}),define("application/uml/drawing/sequence/composite",["require","underscore"],function(e){var t,n;return n=e("underscore"),t=function(){function e(){this.children=[]}return e.prototype.draw=function(e){throw new Error("Not implemented.")},e.prototype.remove=function(){return n(this.children).each(function(e){return e.remove()}),this},e.prototype.getX1=function(){var e;return this.children.length?(e=n(this.children).chain().map(function(e){return e.getX1()}).sortBy(function(e){return e}).first().value(),e):0},e.prototype.getY1=function(){var e;return this.children.length?(e=n(this.children).chain().map(function(e){return e.getY1()}).sortBy(function(e){return e}).first().value(),e):0},e.prototype.getX2=function(){var e;return this.children.length?(e=n(this.children).chain().map(function(e){return e.getX2()}).sortBy(function(e){return e}).last().value(),e):0},e.prototype.getY2=function(){var e;return this.children.length?(e=n(this.children).chain().map(function(e){return e.getY2()}).sortBy(function(e){return e}).last().value(),e):0},e.prototype.getWidth=function(){var e;return e=this.getX2()-this.getX1(),e},e.prototype.getHeight=function(){var e;return e=this.getY2()-this.getY1(),e},e.prototype.show=function(){return n(this.children).each(function(e){return e.show()}),this},e.prototype.hide=function(){return n(this.children).each(function(e){return e.hide()}),this},e.prototype.toBack=function(){return n(this.children).each(function(e){return e.toBack()}),this},e.prototype.toFront=function(){return n(this.children).each(function(e){return e.toFront()}),this},e}()});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("application/uml/drawing/sequence/participant",["require","./config","./composite"],function(e){var t,n,r,i,s;return n=e("./config"),t=e("./composite"),r=30,s={fontFamily:n.fontFamily,fontSize:n.fontSize,fill:n.foreColor},i=function(e){function t(e){this.model=e,t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.draw=function(e){var t,i,o,u,a;return o=e.getParticipantShapeStartPoint(this.model),u=e.shapeFactory.text(o.x+r,o.y+r,this.model.name,s).draw(e.surface),a=r*2+u.getWidth(),i=r*2+u.getHeight(),t=e.shapeFactory.rectangle(o.x,o.y,a,i,{stroke:n.borderColor,fill:n.backColor}).draw(e.surface),t.toBack(),u.toFront(),this.children.push(u,t),e.addShape(this),this},t.prototype.getLifelineStartPoint=function(){var e,t;return e=this.getX1()+this.getWidth()/2,t=this.getY1()+this.getHeight(),{x:e,y:t}},t}(t)}),define("application/uml/drawing/linestyle",[],function(){return{line:0,dash:1}});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("application/uml/drawing/sequence/lifeline",["require","./config","./composite","../linestyle"],function(e){var t,n,r,i;return n=e("./config"),t=e("./composite"),i=e("../linestyle"),r=function(e){function t(e){this.model=e,t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.draw=function(e){var t,r;return r=e.getLifelinePosition(this.model.name),t=e.shapeFactory.verticalLine(r.x,r.y,r.height,i.dash,{stroke:n.borderColor}).draw(e.surface).toBack(),this.children.push(t),e.addShape(this),this},t}(t)}),define("application/uml/drawing/sequence/context",["require","underscore","./config","./participant","./lifeline","../../models/sequence/composite","../../models/sequence/condition","../../models/sequence/group","../../models/sequence/message"],function(e){var t,n,r,i,s,o,u,a,f,l,c,h;return h=e("underscore"),r=e("./config"),l=e("./participant"),o=e("./lifeline"),t=e("../../models/sequence/composite"),n=e("../../models/sequence/condition"),s=e("../../models/sequence/group"),a=e("../../models/sequence/message"),f=80,c=40,u=10,i=function(){function e(e,t,n){this.diagram=e,this.surface=t,this.shapeFactory=n,this.shapes=[],this.streamlinedMessages=this.getStreamLinedMessages(e.commands),this.totalNesting=this.getNestingLevel()}return e.prototype.getStreamLinedMessages=function(e){var n,r=this;return n=[],h(e).each(function(e){return e instanceof a?n.push(e):e instanceof t?h(r.getStreamLinedMessages(e.children)).each(function(e){return n.push(e)}):!1}),n},e.prototype.getNestingLevel=function(e){var r,i=this;return r=0,e||(e=this.diagram.commands),h(e).chain().filter(function(e){return e instanceof t}).each(function(e){var t;return t=1,e instanceof n?(t+=i.getNestingLevel(e.getIfGroup().children),r=Math.max(t,r),h(e.getElseGroups()).each(function(e){return t+=i.getNestingLevel(e.children),r=Math.max(t,r)})):e instanceof s?(t+=i.getNestingLevel(e.children),r=Math.max(t,r)):!1}),r},e.prototype.getXMargin=function(e){var t;return t=f,e&&(t+=c*e),t},e.prototype.isLast=function(e){var t;return t=h(this.diagram.participants).last()===e,t},e.prototype.getTitleShapeStartPoint=function(e,t){var n,r,i,s,o,u;return n=h(this.shapes).chain().map(function(e){return e.getX1()}).sortBy(function(e){return e}).first().value(),i=h(this.shapes).chain().map(function(e){return e.getX2()}).sortBy(function(e){return e}).last().value(),o=i-n,s=this.textSize(e,t),u=s.width>o?f:n+(o-s.width)/2,r={x:u,y:this.getNextShapeStartY()},r},e.prototype.getResizedSize=function(){var e,t,n;return t=h(this.shapes).chain().map(function(e){return e.getX2()}).sortBy(function(e){return e}).last().value(),e=h(this.shapes).chain().map(function(e){return e.getY2()}).sortBy(function(e){return e}).last().value(),n={width:t+f,height:e+f},n},e.prototype.addShape=function(e){return this.shapes.push(e),this},e.prototype.getLastDrawnShape=function(){var e;return e=h(this.shapes).last(),e},e.prototype.getParticipantShape=function(e){var t;return t=h(this.shapes).chain().filter(function(e){return e instanceof l}).find(function(t){return t.model.name===e}).value(),t},e.prototype.getParticipantShapeStartPoint=function(e){var t,n,r;return t=this.getLastParticipantShape(),t?r=t.getX2()+this.getMessageWidth(e,t.model)+c:r=this.getXMargin(this.totalNesting),n={x:r,y:f},n},e.prototype.getNextShapeStartY=function(){var e;return e=this.getLastDrawnShape().getY2()+c,e},e.prototype.getCompositeShapeWidth=function(e){var t,n,r,i;return n=h(this.shapes).chain().filter(function(e){return e instanceof l}).map(function(e){return e.getX1()}).sortBy(function(e){return e}).first().value(),r=h(this.shapes).chain().filter(function(e){return e instanceof l}).map(function(e){return e.getX2()}).sortBy(function(e){return e}).last().value(),t=Math.abs(e-n),i=r+t-e,i},e.prototype.getCompositeShapeHeight=function(e){var t;return t=this.getNextShapeStartY()-e,t},e.prototype.getLifelinePosition=function(e){var t,n,i,s,u;return i=this.getParticipantShape(e),s=i.getLifelineStartPoint(),t=h(this.shapes).chain().filter(function(e){return!(e instanceof o)}).map(function(e){return e.getY2()}).sortBy(function(e){return e}).last().value(),n=t-s.y-r.lineSize+c,u={x:s.x,y:s.y+r.lineSize,height:n},u},e.prototype.getLastParticipantShape=function(){var e;return e=h(this.shapes).chain().filter(function(e){return e instanceof l}).sortBy(function(e){return e.getX2()}).last().value(),e},e.prototype.getMessageWidth=function(e,t){var n,r,i=this;return n=h(this.streamlinedMessages).filter(function(n){return n.sender===t&&n.receiver===e||n.sender===e&&n.receiver===t||n.sender===e&&n.receiver===e||n.sender===t&&n.receiver===t}),n.length?(r=h(n).chain().map(function(e){return i.textSize(e.name).width}).max().value(),r+=u*2,r):0},e.prototype.textSize=function(e,t){var n;return n=this.shapeFactory.textSize(this.surface,e,t),n},e}()});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("application/uml/drawing/sequence/groupheader",["require","./config","./composite","../linestyle"],function(e){var t,n,r,i,s,o;return n=e("./config"),t=e("./composite"),s=e("../linestyle"),i=8,o={fontFamily:n.fontFamily,fontSize:n.fontSize,fill:n.foreColor},r=function(e){function t(e,n,r,i){this.x=e,this.y=n,this.showType=r,this.model=i,t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.draw=function(e){var t,r,u,a,f,l,c,h;return c=this.x,h=this.y,f=this.model.type,t=this.model.label,l=e.shapeFactory.text(c+i,h+i,f,o).draw(e.surface),this.children.push(l),u=e.shapeFactory.verticalLine(l.getX2()+i,h,l.getY2()-h+i,s.line,{stroke:n.borderColor}).draw(e.surface),this.children.push(u),a=e.shapeFactory.horizontalLine(c,l.getY2()+i,l.getX2()-c+i,s.line,{stroke:n.borderColor}).draw(e.surface),this.children.push(a),t&&(r=e.shapeFactory.text(u.getX2()+i,h+i,"["+t+"]",o).draw(e.surface),this.children.push(r)),this.showType||(l.hide(),u.hide(),a.hide()),e.addShape(this),this},t}(t)}),define("application/uml/drawing/arrowdirection",[],function(){return{left:0,right:1}}),define("application/uml/drawing/arrowstyle",[],function(){return{open:0,close:1}});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("application/uml/drawing/sequence/message",["require","./config","./composite","../arrowdirection","../arrowstyle","../linestyle"],function(e){var t,n,r,i,s,o,u,a,f,l;return i=e("./config"),r=e("./composite"),t=e("../arrowdirection"),n=e("../arrowstyle"),s=e("../linestyle"),a=10,u=40,f=function(){return i.lineSize*3},l={fontFamily:i.fontFamily,fontSize:i.fontSize,fill:i.foreColor},o=function(e){function r(e){this.model=e,r.__super__.constructor.apply(this,arguments)}return __extends(r,e),r.prototype.draw=function(e){var r,i,o,u,a,l,c,h,p,d;return i=this.model.async?n.open:n.close,u=this.model.callReturn?s.dash:s.line,d=e.getNextShapeStartY(),l=e.getParticipantShape(this.model.sender.name),a=e.getParticipantShape(this.model.receiver.name),o=f(),this.model.selfInvoking()?(c=l.getLifelineStartPoint().x,e.isLast(l.model)?(r=t.right,c-=o):(r=t.left,c+=o),this.drawSelfInvoking(e,r,i,u,c,d)):(l.getX1()<a.getX1()?(r=t.right,h=l.getLifelineStartPoint().x+o,p=a.getLifelineStartPoint().x-o):(r=t.left,h=a.getLifelineStartPoint().x+o,p=l.getLifelineStartPoint().x-o),this.drawRegular(e,r,i,u,h,p,d)),e.addShape(this),this},r.prototype.drawRegular=function(e,r,s,o,u,a,c){var h,p,d,v,m,g,y,b;return m=e.shapeFactory.textSize(e.surface,this.model.name,l),y=a-u,g=u+(y-m.width)/2,v=e.shapeFactory.text(g,c,this.model.name,l).draw(e.surface),c+=m.height+f(),d=e.shapeFactory.horizontalLine(u,c,y,o,{stroke:i.borderColor}).draw(e.surface),b=r===t.left?u:a,p={stroke:i.borderColor},s===n.close&&(p.fill=i.borderColor),h=e.shapeFactory.arrow(b,c,r,s,i.arrowSize,p).draw(e.surface),this.children.push(v,d,h)},r.prototype.drawSelfInvoking=function(e,r,s,o,c,h){var p,d,v,m,g,y,b,w,E;return w=e.shapeFactory.textSize(e.surface,this.model.name,l),E=c+a/2,y=w.width+a,r===t.right&&(E=c-w.width-a/2,y=-y),b=e.shapeFactory.text(E,h,this.model.name,l).draw(e.surface),h+=w.height+f(),v=e.shapeFactory.horizontalLine(c,h,y,o,{stroke:i.borderColor}).draw(e.surface),m=e.shapeFactory.verticalLine(c+y,h,u,o,{stroke:i.borderColor}).draw(e.surface),g=e.shapeFactory.horizontalLine(c,h+u,y,o,{stroke:i.borderColor}).draw(e.surface),d={stroke:i.borderColor},s===n.close&&(d.fill=i.borderColor),p=e.shapeFactory.arrow(c,h+u,r,s,i.arrowSize,d).draw(e.surface),this.children.push(b,v,m,g,p)},r}(r)});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("application/uml/drawing/sequence/group",["require","underscore","./config","./composite","./groupheader","./message","../../models/sequence/composite","../../models/sequence/condition","../../models/sequence/group","../../models/sequence/message","./condition"],function(e){var t,n,r,i,s,o,u,a,f,l,c,h;return h=e("underscore"),s=e("./config"),t=e("./composite"),u=e("./groupheader"),f=e("./message"),n=e("../../models/sequence/composite"),i=e("../../models/sequence/condition"),a=e("../../models/sequence/group"),l=e("../../models/sequence/message"),r=null,c=function(){return r||(r=e("./condition"))},o=function(e){function t(e,n){this.model=e,this.nestingLevel=n,t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.draw=function(e){var r,o,p,d,v,m,g,y=this;return d=this.nestingLevel,m=e.getXMargin(d),g=e.getNextShapeStartY(),o=(new u(m,g,!0,{type:this.model.type,label:this.model.label})).draw(e),this.children.push(o),h(this.model.children).each(function(r){var s,o;return o=null,r instanceof n?(d+=1,r instanceof i?(s=c(),o=new s(r,d)):r instanceof a&&(o=new t(r,d)),d-=1):r instanceof l&&(o=new f(r)),o?y.children.push(o.draw(e)):!1}),v=e.getCompositeShapeWidth(m),p=e.getNextShapeStartY()-g,r=e.shapeFactory.rectangle(m,g,v,p,{stroke:s.borderColor}).draw(e.surface),this.children.push(r),e.addShape(this),this},t}(t)});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("application/uml/drawing/sequence/condition",["require","underscore","./config","./composite","./group","./groupheader","./message","../linestyle","../../models/sequence/composite","../../models/sequence/condition","../../models/sequence/group","../../models/sequence/message"],function(e){var t,n,r,i,s,o,u,a,f,l,c,h;return h=e("underscore"),s=e("./config"),t=e("./composite"),o=e("./group"),u=e("./groupheader"),l=e("./message"),f=e("../linestyle"),n=e("../../models/sequence/composite"),i=e("../../models/sequence/condition"),a=e("../../models/sequence/group"),c=e("../../models/sequence/message"),r=function(e){function t(e,n){this.model=e,this.nestingLevel=n,t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.draw=function(e){var t,n,r,i,o,a,l,c,p,d=this;return i=this.model.getIfGroup(),n=this.model.getElseGroups(),a=this.nestingLevel,c=e.getXMargin(a),p=e.getNextShapeStartY(),l=e.getCompositeShapeWidth(c),o=(new u(c,p,!0,{type:"alt",label:i.label})).draw(e),this.children.push(o),this.iterate(a,i,e),h(n).each(function(t){var n,r;return n=e.shapeFactory.horizontalLine(c,e.getNextShapeStartY(),l,f.dash,{stroke:s.borderColor}).draw(e.surface),d.children.push(n),r=(new u(c,e.getNextShapeStartY(),!1,{type:"alt",label:t.label})).draw(e),d.children.push(r),d.iterate(a,t,e)}),r=e.getNextShapeStartY()-p,t=e.shapeFactory.rectangle(c,p,l,r,{stroke:s.borderColor}).draw(e.surface),this.children.push(t),e.addShape(this),this},t.prototype.iterate=function(e,r,s){var u=this;return h(r.children).each(function(r){var f;return f=null,r instanceof n?(e+=1,r instanceof i?f=new t(r,e):r instanceof a&&(f=new o(r,e)),e-=1):r instanceof c&&(f=new l(r)),f?u.children.push(f.draw(s)):!1})},t}(t)});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("application/uml/drawing/sequence/title",["require","./config","./composite"],function(e){var t,n,r,i;return n=e("./config"),t=e("./composite"),i={fontFamily:n.fontFamily,fontSize:n.fontSize*1.5,fill:n.foreColor},r=function(e){function t(e){this.model=e,t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.draw=function(e){var t,n;return t=e.getTitleShapeStartPoint(this.model.text,i),n=e.shapeFactory.text(t.x,t.y,this.model.text,i).draw(e.surface),this.children.push(n),e.addShape(this),this},t}(t)}),define("application/uml/drawing/canvas/base",[],function(){var e;return e=function(){function e(e){this.attributes=e!=null?e:{}}return e.prototype.draw=function(e){throw new Error("Not implemented.")},e.prototype.remove=function(){return this.element.destroy(),this},e.prototype.getX1=function(){return this.element.getX()},e.prototype.getY1=function(){return this.element.getY()},e.prototype.getX2=function(){var e;return e=this.getX1()+this.getWidth(),e},e.prototype.getY2=function(){var e;return e=this.getY1()+this.getHeight(),e},e.prototype.getWidth=function(){return this.element.getWidth()},e.prototype.getHeight=function(){return this.element.getHeight()},e.prototype.show=function(){return this.element.show(),this},e.prototype.hide=function(){return this.element.hide(),this},e.prototype.toBack=function(){return this.element.moveToBottom(),this},e.prototype.toFront=function(){return this.element.moveToTop(),this},e}()});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("application/uml/drawing/canvas/rectangle",["require","underscore","kinetic","./base"],function(e){var t,n,r,i;return i=e("underscore"),n=e("kinetic"),t=e("./base"),r=function(e){function t(e,n,r,i,s){this.x=e,this.y=n,this.width=r,this.height=i,t.__super__.constructor.call(this,s)}return __extends(t,e),t.prototype.draw=function(e){return this.element=new n.Rect({x:this.x,y:this.y,width:this.width,height:this.height}),i(this.attributes).isEmpty()||this.element.setAttrs(this.attributes),this.element.setListening(!1),e.add(this.element),this},t}(t)});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("application/uml/drawing/canvas/text",["require","underscore","kinetic","./base"],function(e){var t,n,r,i;return i=e("underscore"),n=e("kinetic"),t=e("./base"),r=function(e){function t(e,n,r,i){this.x=e,this.y=n,this.value=r,t.__super__.constructor.call(this,i)}return __extends(t,e),t.size=function(e,n,r){var i,s;return s=(new t(0,0,n,r)).draw(e),i={width:s.getWidth(),height:s.getHeight()},s.remove(),i},t.prototype.draw=function(e){return this.element=new n.Text({x:this.x,y:this.y,text:this.value}),this.element.setAttrs(this.attributes),this.element.setListening(!1),e.add(this.element),this},t}(t)});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("application/uml/drawing/canvas/line",["require","underscore","kinetic","./base","../linestyle"],function(e){var t,n,r,i,s;return s=e("underscore"),n=e("kinetic"),t=e("./base"),i=e("../linestyle"),r=function(e){function t(e,n,r,s){this.x=e,this.y=n,this.style=r!=null?r:i.line,t.__super__.constructor.call(this,s)}return __extends(t,e),t.prototype.draw=function(e){var t;return t=s(this.attributes).defaults({points:this.getPoints()}),this.style===i.dash&&(t=s(t).defaults({dashArray:[8,3]})),this.element=new n.Line(t),this.element.setListening(!1),e.add(this.element),this},t.prototype.getPoints=function(){throw new Error("Not implemented.")},t.prototype.getX1=function(){return this.x},t.prototype.getY1=function(){return this.y},t}(t)});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("application/uml/drawing/canvas/verticalline",["require","./line"],function(e){var t,n;return t=e("./line"),n=function(e){function t(e,n,r,i,s){this.height=r,t.__super__.constructor.call(this,e,n,i,s)}return __extends(t,e),t.prototype.getPoints=function(){return[this.x,this.y,this.x,this.y+this.height]},t.prototype.getHeight=function(){return this.height},t}(t)});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("application/uml/drawing/canvas/horizontalline",["require","./line"],function(e){var t,n;return n=e("./line"),t=function(e){function t(e,n,r,i,s){this.width=r,t.__super__.constructor.call(this,e,n,i,s)}return __extends(t,e),t.prototype.getPoints=function(){return[this.x,this.y,this.x+this.width,this.y]},t.prototype.getWidth=function(){return this.width},t}(n)});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("application/uml/drawing/canvas/arrow",["require","kinetic","./base","../arrowdirection","../arrowstyle"],function(e){var t,n,r,i,s;return s=e("kinetic"),i=e("./base"),n=e("../arrowdirection"),r=e("../arrowstyle"),t=function(e){function t(e,i,s,o,u,a){this.x=e,this.y=i,this.direction=s!=null?s:n.left,this.style=o!=null?o:r.open,this.size=u,t.__super__.constructor.call(this,a)}return __extends(t,e),t.prototype.draw=function(e){var t;return t=this.generatePath(),this.element=new s.Path({data:t}),this.element.setAttrs(this.attributes),this.element.setListening(!1),e.add(this.element),this},t.prototype.generatePath=function(){var e;return e=null,this.direction===n.right?(e="M"+this.x+" "+this.y+" L"+(this.x-this.size)+" "+(this.y-this.size)+" ",this.style===r.close?e+=""+(this.x-this.size)+" "+(this.y+this.size)+" Z":this.style===r.open&&(e+="M"+this.x+" "+this.y+" L"+(this.x-this.size)+" "+(this.y+this.size))):this.direction===n.left&&(e="M"+this.x+" "+this.y+" L"+(this.x+this.size)+" "+(this.y-this.size)+" ",this.style===r.close?e+=""+(this.x+this.size)+" "+(this.y+this.size)+" Z":this.style===r.open&&(e+="M"+this.x+" "+this.y+" L"+(this.x+this.size)+" "+(this.y+this.size))),e},t}(i)}),define("application/uml/drawing/canvas/factory",["require","./rectangle","./text","./verticalline","./horizontalline","./arrow"],function(e){var t,n,r,i,s,o;return i=e("./rectangle"),s=e("./text"),o=e("./verticalline"),r=e("./horizontalline"),t=e("./arrow"),n=function(){function e(){}return e.prototype.rectangle=function(e,t,n,r,s){return new i(e,t,n,r,s)},e.prototype.text=function(e,t,n,r){return new s(e,t,n,r)},e.prototype.verticalLine=function(e,t,n,r,i){return new o(e,t,n,r,i)},e.prototype.horizontalLine=function(e,t,n,i,s){return new r(e,t,n,i,s)},e.prototype.arrow=function(e,n,r,i,s,o){return new t(e,n,r,i,s,o)},e.prototype.textSize=function(e,t,n){return s.size(e,t,n)},e}()}),define("application/uml/drawing/sequence/renderer",["require","jquery","underscore","kinetic","./context","./participant","./condition","./group","./message","./lifeline","./title","../canvas/factory","../../models/sequence/composite","../../models/sequence/condition","../../models/sequence/group","../../models/sequence/message"],function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m;return t=e("jquery"),m=e("underscore"),f=e("kinetic"),s=e("./context"),p=e("./participant"),r=e("./condition"),u=e("./group"),c=e("./message"),l=e("./lifeline"),v=e("./title"),o=e("../canvas/factory"),n=e("../../models/sequence/composite"),i=e("../../models/sequence/condition"),a=e("../../models/sequence/group"),h=e("../../models/sequence/message"),d=function(){function e(e){var n;this.id=e!=null?e:"canvas",n=t("#"+this.id),this.container=n.parent(),this.originalSize=this.currentSize={width:n.width(),height:n.height()},this.shapeFactory=new o}return e.prototype.reset=function(){return this.currentSize={width:this.originalSize.width,height:this.originalSize.height},this.surface&&this.surface.destroy(),this.surface=new f.Stage({container:this.id,width:this.currentSize.width,height:this.currentSize.height}),this.resetSize()},e.prototype.render=function(e){var t,o,d;return this.reset(),!e||!e.participants.length?!1:(d=new f.Layer,t=new s(e,d,this.shapeFactory),m(e.participants).each(function(e){return(new p(e)).draw(t)}),o=0,m(e.commands).each(function(e){var s;s=null,e instanceof n?(o+=1,e instanceof i?s=new r(e,o):e instanceof a&&(s=new u(e,o)),o-=1):e instanceof h&&(s=new c(e));if(s)return s.draw(t)}),m(e.participants).each(function(e){return(new l(e)).draw(t).toBack()}),e.title&&(new v(e.title)).draw(t),this.currentSize=t.getResizedSize(),this.surface.add(d),this.resetSize(),this.surface.draw(),!0)},e.prototype.resetSize=function(){return this.surface.setWidth(this.currentSize.width),this.surface.setHeight(this.currentSize.height),this.container.width(this.currentSize.width),this.container.height(this.currentSize.height)},e.prototype.serialize=function(){var e,t;if((t=this.surface)!=null?!t.getChildren().length:!void 0)throw new Error("You cannot export a blank document, add some shapes prior exporting.");return e=this.surface.getChildren()[0].toDataURL(),e},e}()}),!function(e){e(function(){e.support.transition=function(){var e=function(){var e=document.createElement("bootstrap"),t={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"},n;for(n in t)if(e.style[n]!==undefined)return t[n]}();return e&&{end:e}}()})}(window.jQuery),!function(e){var t='[data-dismiss="alert"]',n=function(n){e(n).on("click",t,this.close)};n.prototype.close=function(t){function s(){i.trigger("closed").remove()}var n=e(this),r=n.attr("data-target"),i;r||(r=n.attr("href"),r=r&&r.replace(/.*(?=#[^\s]*$)/,"")),i=e(r),t&&t.preventDefault(),i.length||(i=n.hasClass("alert")?n:n.parent()),i.trigger(t=e.Event("close"));if(t.isDefaultPrevented())return;i.removeClass("in"),e.support.transition&&i.hasClass("fade")?i.on(e.support.transition.end,s):s()};var r=e.fn.alert;e.fn.alert=function(t){return this.each(function(){var r=e(this),i=r.data("alert");i||r.data("alert",i=new n(this)),typeof t=="string"&&i[t].call(r)})},e.fn.alert.Constructor=n,e.fn.alert.noConflict=function(){return e.fn.alert=r,this},e(document).on("click.alert.data-api",t,n.prototype.close)}(window.jQuery),!function(e){var t=function(t,n){this.$element=e(t),this.options=e.extend({},e.fn.button.defaults,n)};t.prototype.setState=function(e){var t="disabled",n=this.$element,r=n.data(),i=n.is("input")?"val":"html";e+="Text",r.resetText||n.data("resetText",n[i]()),n[i](r[e]||this.options[e]),setTimeout(function(){e=="loadingText"?n.addClass(t).attr(t,t):n.removeClass(t).removeAttr(t)},0)},t.prototype.toggle=function(){var e=this.$element.closest('[data-toggle="buttons-radio"]');e&&e.find(".active").removeClass("active"),this.$element.toggleClass("active")};var n=e.fn.button;e.fn.button=function(n){return this.each(function(){var r=e(this),i=r.data("button"),s=typeof n=="object"&&n;i||r.data("button",i=new t(this,s)),n=="toggle"?i.toggle():n&&i.setState(n)})},e.fn.button.defaults={loadingText:"loading..."},e.fn.button.Constructor=t,e.fn.button.noConflict=function(){return e.fn.button=n,this},e(document).on("click.button.data-api","[data-toggle^=button]",function(t){var n=e(t.target);n.hasClass("btn")||(n=n.closest(".btn")),n.button("toggle")})}(window.jQuery),!function(e){var t=function(t,n){this.$element=e(t),this.$indicators=this.$element.find(".carousel-indicators"),this.options=n,this.options.pause=="hover"&&this.$element.on("mouseenter",e.proxy(this.pause,this)).on("mouseleave",e.proxy(this.cycle,this))};t.prototype={cycle:function(t){return t||(this.paused=!1),this.interval&&clearInterval(this.interval),this.options.interval&&!this.paused&&(this.interval=setInterval(e.proxy(this.next,this),this.options.interval)),this},getActiveIndex:function(){return this.$active=this.$element.find(".item.active"),this.$items=this.$active.parent().children(),this.$items.index(this.$active)},to:function(t){var n=this.getActiveIndex(),r=this;if(t>this.$items.length-1||t<0)return;return this.sliding?this.$element.one("slid",function(){r.to(t)}):n==t?this.pause().cycle():this.slide(t>n?"next":"prev",e(this.$items[t]))},pause:function(t){return t||(this.paused=!0),this.$element.find(".next, .prev").length&&e.support.transition.end&&(this.$element.trigger(e.support.transition.end),this.cycle(!0)),clearInterval(this.interval),this.interval=null,this},next:function(){if(this.sliding)return;return this.slide("next")},prev:function(){if(this.sliding)return;return this.slide("prev")},slide:function(t,n){var r=this.$element.find(".item.active"),i=n||r[t](),s=this.interval,o=t=="next"?"left":"right",u=t=="next"?"first":"last",a=this,f;this.sliding=!0,s&&this.pause(),i=i.length?i:this.$element.find(".item")[u](),f=e.Event("slide",{relatedTarget:i[0],direction:o});if(i.hasClass("active"))return;this.$indicators.length&&(this.$indicators.find(".active").removeClass("active"),this.$element.one("slid",function(){var t=e(a.$indicators.children()[a.getActiveIndex()]);t&&t.addClass("active")}));if(e.support.transition&&this.$element.hasClass("slide")){this.$element.trigger(f);if(f.isDefaultPrevented())return;i.addClass(t),i[0].offsetWidth,r.addClass(o),i.addClass(o),this.$element.one(e.support.transition.end,function(){i.removeClass([t,o].join(" ")).addClass("active"),r.removeClass(["active",o].join(" ")),a.sliding=!1,setTimeout(function(){a.$element.trigger("slid")},0)})}else{this.$element.trigger(f);if(f.isDefaultPrevented())return;r.removeClass("active"),i.addClass("active"),this.sliding=!1,this.$element.trigger("slid")}return s&&this.cycle(),this}};var n=e.fn.carousel;e.fn.carousel=function(n){return this.each(function(){var r=e(this),i=r.data("carousel"),s=e.extend({},e.fn.carousel.defaults,typeof n=="object"&&n),o=typeof n=="string"?n:s.slide;i||r.data("carousel",i=new t(this,s)),typeof n=="number"?i.to(n):o?i[o]():s.interval&&i.pause().cycle()})},e.fn.carousel.defaults={interval:5e3,pause:"hover"},e.fn.carousel.Constructor=t,e.fn.carousel.noConflict=function(){return e.fn.carousel=n,this},e(document).on("click.carousel.data-api","[data-slide], [data-slide-to]",function(t){var n=e(this),r,i=e(n.attr("data-target")||(r=n.attr("href"))&&r.replace(/.*(?=#[^\s]+$)/,"")),s=e.extend({},i.data(),n.data()),o;i.carousel(s),(o=n.attr("data-slide-to"))&&i.data("carousel").pause().to(o).cycle(),t.preventDefault()})}(window.jQuery),!function(e){var t=function(t,n){this.$element=e(t),this.options=e.extend({},e.fn.collapse.defaults,n),this.options.parent&&(this.$parent=e(this.options.parent)),this.options.toggle&&this.toggle()};t.prototype={constructor:t,dimension:function(){var e=this.$element.hasClass("width");return e?"width":"height"},show:function(){var t,n,r,i;if(this.transitioning||this.$element.hasClass("in"))return;t=this.dimension(),n=e.camelCase(["scroll",t].join("-")),r=this.$parent&&this.$parent.find("> .accordion-group > .in");if(r&&r.length){i=r.data("collapse");if(i&&i.transitioning)return;r.collapse("hide"),i||r.data("collapse",null)}this.$element[t](0),this.transition("addClass",e.Event("show"),"shown"),e.support.transition&&this.$element[t](this.$element[0][n])},hide:function(){var t;if(this.transitioning||!this.$element.hasClass("in"))return;t=this.dimension(),this.reset(this.$element[t]()),this.transition("removeClass",e.Event("hide"),"hidden"),this.$element[t](0)},reset:function(e){var t=this.dimension();return this.$element.removeClass("collapse")[t](e||"auto")[0].offsetWidth,this.$element[e!==null?"addClass":"removeClass"]("collapse"),this},transition:function(t,n,r){var i=this,s=function(){n.type=="show"&&i.reset(),i.transitioning=0,i.$element.trigger(r)};this.$element.trigger(n);if(n.isDefaultPrevented())return;this.transitioning=1,this.$element[t]("in"),e.support.transition&&this.$element.hasClass("collapse")?this.$element.one(e.support.transition.end,s):s()},toggle:function(){this[this.$element.hasClass("in")?"hide":"show"]()}};var n=e.fn.collapse;e.fn.collapse=function(n){return this.each(function(){var r=e(this),i=r.data("collapse"),s=e.extend({},e.fn.collapse.defaults,r.data(),typeof n=="object"&&n);i||r.data("collapse",i=new t(this,s)),typeof n=="string"&&i[n]()})},e.fn.collapse.defaults={toggle:!0},e.fn.collapse.Constructor=t,e.fn.collapse.noConflict=function(){return e.fn.collapse=n,this},e(document).on("click.collapse.data-api","[data-toggle=collapse]",function(t){var n=e(this),r,i=n.attr("data-target")||t.preventDefault()||(r=n.attr("href"))&&r.replace(/.*(?=#[^\s]+$)/,""),s=e(i).data("collapse")?"toggle":n.data();n[e(i).hasClass("in")?"addClass":"removeClass"]("collapsed"),e(i).collapse(s)})}(window.jQuery),!function(e){function r(){e(".dropdown-backdrop").remove(),e(t).each(function(){i(e(this)).removeClass("open")})}function i(t){var n=t.attr("data-target"),r;n||(n=t.attr("href"),n=n&&/#/.test(n)&&n.replace(/.*(?=#[^\s]*$)/,"")),r=n&&e(n);if(!r||!r.length)r=t.parent();return r}var t="[data-toggle=dropdown]",n=function(t){var n=e(t).on("click.dropdown.data-api",this.toggle);e("html").on("click.dropdown.data-api",function(){n.parent().removeClass("open")})};n.prototype={constructor:n,toggle:function(t){var n=e(this),s,o;if(n.is(".disabled, :disabled"))return;return s=i(n),o=s.hasClass("open"),r(),o||("ontouchstart"in document.documentElement&&e('<div class="dropdown-backdrop"/>').insertBefore(e(this)).on("click",r),s.toggleClass("open")),n.focus(),!1},keydown:function(n){var r,s,o,u,a,f;if(!/(38|40|27)/.test(n.keyCode))return;r=e(this),n.preventDefault(),n.stopPropagation();if(r.is(".disabled, :disabled"))return;u=i(r),a=u.hasClass("open");if(!a||a&&n.keyCode==27)return n.which==27&&u.find(t).focus(),r.click();s=e("[role=menu] li:not(.divider):visible a",u);if(!s.length)return;f=s.index(s.filter(":focus")),n.keyCode==38&&f>0&&f--,n.keyCode==40&&f<s.length-1&&f++,~f||(f=0),s.eq(f).focus()}};var s=e.fn.dropdown;e.fn.dropdown=function(t){return this.each(function(){var r=e(this),i=r.data("dropdown");i||r.data("dropdown",i=new n(this)),typeof t=="string"&&i[t].call(r)})},e.fn.dropdown.Constructor=n,e.fn.dropdown.noConflict=function(){return e.fn.dropdown=s,this},e(document).on("click.dropdown.data-api",r).on("click.dropdown.data-api",".dropdown form",function(e){e.stopPropagation()}).on("click.dropdown.data-api",t,n.prototype.toggle).on("keydown.dropdown.data-api",t+", [role=menu]",n.prototype.keydown)}(window.jQuery),!function(e){var t=function(t,n){this.options=n,this.$element=e(t).delegate('[data-dismiss="modal"]',"click.dismiss.modal",e.proxy(this.hide,this)),this.options.remote&&this.$element.find(".modal-body").load(this.options.remote)};t.prototype={constructor:t,toggle:function(){return this[this.isShown?"hide":"show"]()},show:function(){var t=this,n=e.Event("show");this.$element.trigger(n);if(this.isShown||n.isDefaultPrevented())return;this.isShown=!0,this.escape(),this.backdrop(function(){var n=e.support.transition&&t.$element.hasClass("fade");t.$element.parent().length||t.$element.appendTo(document.body),t.$element.show(),n&&t.$element[0].offsetWidth,t.$element.addClass("in").attr("aria-hidden",!1),t.enforceFocus(),n?t.$element.one(e.support.transition.end,function(){t.$element.focus().trigger("shown")}):t.$element.focus().trigger("shown")})},hide:function(t){t&&t.preventDefault();var n=this;t=e.Event("hide"),this.$element.trigger(t);if(!this.isShown||t.isDefaultPrevented())return;this.isShown=!1,this.escape(),e(document).off("focusin.modal"),this.$element.removeClass("in").attr("aria-hidden",!0),e.support.transition&&this.$element.hasClass("fade")?this.hideWithTransition():this.hideModal()},enforceFocus:function(){var t=this;e(document).on("focusin.modal",function(e){t.$element[0]!==e.target&&!t.$element.has(e.target).length&&t.$element.focus()})},escape:function(){var e=this;this.isShown&&this.options.keyboard?this.$element.on("keyup.dismiss.modal",function(t){t.which==27&&e.hide()}):this.isShown||this.$element.off("keyup.dismiss.modal")},hideWithTransition:function(){var t=this,n=setTimeout(function(){t.$element.off(e.support.transition.end),t.hideModal()},500);this.$element.one(e.support.transition.end,function(){clearTimeout(n),t.hideModal()})},hideModal:function(){var e=this;this.$element.hide(),this.backdrop(function(){e.removeBackdrop(),e.$element.trigger("hidden")})},removeBackdrop:function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},backdrop:function(t){var n=this,r=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var i=e.support.transition&&r;this.$backdrop=e('<div class="modal-backdrop '+r+'" />').appendTo(document.body),this.$backdrop.click(this.options.backdrop=="static"?e.proxy(this.$element[0].focus,this.$element[0]):e.proxy(this.hide,this)),i&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in");if(!t)return;i?this.$backdrop.one(e.support.transition.end,t):t()}else!this.isShown&&this.$backdrop?(this.$backdrop.removeClass("in"),e.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one(e.support.transition.end,t):t()):t&&t()}};var n=e.fn.modal;e.fn.modal=function(n){return this.each(function(){var r=e(this),i=r.data("modal"),s=e.extend({},e.fn.modal.defaults,r.data(),typeof n=="object"&&n);i||r.data("modal",i=new t(this,s)),typeof n=="string"?i[n]():s.show&&i.show()})},e.fn.modal.defaults={backdrop:!0,keyboard:!0,show:!0},e.fn.modal.Constructor=t,e.fn.modal.noConflict=function(){return e.fn.modal=n,this},e(document).on("click.modal.data-api",'[data-toggle="modal"]',function(t){var n=e(this),r=n.attr("href"),i=e(n.attr("data-target")||r&&r.replace(/.*(?=#[^\s]+$)/,"")),s=i.data("modal")?"toggle":e.extend({remote:!/#/.test(r)&&r},i.data(),n.data());t.preventDefault(),i.modal(s).one("hide",function(){n.focus()})})}(window.jQuery),!function(e){var t=function(e,t){this.init("tooltip",e,t)};t.prototype={constructor:t,init:function(t,n,r){var i,s,o,u,a;this.type=t,this.$element=e(n),this.options=this.getOptions(r),this.enabled=!0,o=this.options.trigger.split(" ");for(a=o.length;a--;)u=o[a],u=="click"?this.$element.on("click."+this.type,this.options.selector,e.proxy(this.toggle,this)):u!="manual"&&(i=u=="hover"?"mouseenter":"focus",s=u=="hover"?"mouseleave":"blur",this.$element.on(i+"."+this.type,this.options.selector,e.proxy(this.enter,this)),this.$element.on(s+"."+this.type,this.options.selector,e.proxy(this.leave,this)));this.options.selector?this._options=e.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},getOptions:function(t){return t=e.extend({},e.fn[this.type].defaults,this.$element.data(),t),t.delay&&typeof t.delay=="number"&&(t.delay={show:t.delay,hide:t.delay}),t},enter:function(t){var n=e.fn[this.type].defaults,r={},i;this._options&&e.each(this._options,function(e,t){n[e]!=t&&(r[e]=t)},this),i=e(t.currentTarget)[this.type](r).data(this.type);if(!i.options.delay||!i.options.delay.show)return i.show();clearTimeout(this.timeout),i.hoverState="in",this.timeout=setTimeout(function(){i.hoverState=="in"&&i.show()},i.options.delay.show)},leave:function(t){var n=e(t.currentTarget)[this.type](this._options).data(this.type);this.timeout&&clearTimeout(this.timeout);if(!n.options.delay||!n.options.delay.hide)return n.hide();n.hoverState="out",this.timeout=setTimeout(function(){n.hoverState=="out"&&n.hide()},n.options.delay.hide)},show:function(){var t,n,r,i,s,o,u=e.Event("show");if(this.hasContent()&&this.enabled){this.$element.trigger(u);if(u.isDefaultPrevented())return;t=this.tip(),this.setContent(),this.options.animation&&t.addClass("fade"),s=typeof this.options.placement=="function"?this.options.placement.call(this,t[0],this.$element[0]):this.options.placement,t.detach().css({top:0,left:0,display:"block"}),this.options.container?t.appendTo(this.options.container):t.insertAfter(this.$element),n=this.getPosition(),r=t[0].offsetWidth,i=t[0].offsetHeight;switch(s){case"bottom":o={top:n.top+n.height,left:n.left+n.width/2-r/2};break;case"top":o={top:n.top-i,left:n.left+n.width/2-r/2};break;case"left":o={top:n.top+n.height/2-i/2,left:n.left-r};break;case"right":o={top:n.top+n.height/2-i/2,left:n.left+n.width}}this.applyPlacement(o,s),this.$element.trigger("shown")}},applyPlacement:function(e,t){var n=this.tip(),r=n[0].offsetWidth,i=n[0].offsetHeight,s,o,u,a;n.offset(e).addClass(t).addClass("in"),s=n[0].offsetWidth,o=n[0].offsetHeight,t=="top"&&o!=i&&(e.top=e.top+i-o,a=!0),t=="bottom"||t=="top"?(u=0,e.left<0&&(u=e.left*-2,e.left=0,n.offset(e),s=n[0].offsetWidth,o=n[0].offsetHeight),this.replaceArrow(u-r+s,s,"left")):this.replaceArrow(o-i,o,"top"),a&&n.offset(e)},replaceArrow:function(e,t,n){this.arrow().css(n,e?50*(1-e/t)+"%":"")},setContent:function(){var e=this.tip(),t=this.getTitle();e.find(".tooltip-inner")[this.options.html?"html":"text"](t),e.removeClass("fade in top bottom left right")},hide:function(){function i(){var t=setTimeout(function(){n.off(e.support.transition.end).detach()},500);n.one(e.support.transition.end,function(){clearTimeout(t),n.detach()})}var t=this,n=this.tip(),r=e.Event("hide");this.$element.trigger(r);if(r.isDefaultPrevented())return;return n.removeClass("in"),e.support.transition&&this.$tip.hasClass("fade")?i():n.detach(),this.$element.trigger("hidden"),this},fixTitle:function(){var e=this.$element;(e.attr("title")||typeof e.attr("data-original-title")!="string")&&e.attr("data-original-title",e.attr("title")||"").attr("title","")},hasContent:function(){return this.getTitle()},getPosition:function(){var t=this.$element[0];return e.extend({},typeof t.getBoundingClientRect=="function"?t.getBoundingClientRect():{width:t.offsetWidth,height:t.offsetHeight},this.$element.offset())},getTitle:function(){var e,t=this.$element,n=this.options;return e=t.attr("data-original-title")||(typeof n.title=="function"?n.title.call(t[0]):n.title),e},tip:function(){return this.$tip=this.$tip||e(this.options.template)},arrow:function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},validate:function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},toggleEnabled:function(){this.enabled=!this.enabled},toggle:function(t){var n=t?e(t.currentTarget)[this.type](this._options).data(this.type):this;n.tip().hasClass("in")?n.hide():n.show()},destroy:function(){this.hide().$element.off("."+this.type).removeData(this.type)}};var n=e.fn.tooltip;e.fn.tooltip=function(n){return this.each(function(){var r=e(this),i=r.data("tooltip"),s=typeof n=="object"&&n;i||r.data("tooltip",i=new t(this,s)),typeof n=="string"&&i[n]()})},e.fn.tooltip.Constructor=t,e.fn.tooltip.defaults={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1},e.fn.tooltip.noConflict=function(){return e.fn.tooltip=n,this}}(window.jQuery),!function(e){var t=function(e,t){this.init("popover",e,t)};t.prototype=e.extend({},e.fn.tooltip.Constructor.prototype,{constructor:t,setContent:function(){var e=this.tip(),t=this.getTitle(),n=this.getContent();e.find(".popover-title")[this.options.html?"html":"text"](t),e.find(".popover-content")[this.options.html?"html":"text"](n),e.removeClass("fade top bottom left right in")},hasContent:function(){return this.getTitle()||this.getContent()},getContent:function(){var e,t=this.$element,n=this.options;return e=(typeof n.content=="function"?n.content.call(t[0]):n.content)||t.attr("data-content"),e},tip:function(){return this.$tip||(this.$tip=e(this.options.template)),this.$tip},destroy:function(){this.hide().$element.off("."+this.type).removeData(this.type)}});var n=e.fn.popover;e.fn.popover=function(n){return this.each(function(){var r=e(this),i=r.data("popover"),s=typeof n=="object"&&n;i||r.data("popover",i=new t(this,s)),typeof n=="string"&&i[n]()})},e.fn.popover.Constructor=t,e.fn.popover.defaults=e.extend({},e.fn.tooltip.defaults,{placement:"right",trigger:"click",content:"",template:'<div class="popover"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),e.fn.popover.noConflict=function(){return e.fn.popover=n,this}}(window.jQuery),!function(e){function t(t,n){var r=e.proxy(this.process,this),i=e(t).is("body")?e(window):e(t),s;this.options=e.extend({},e.fn.scrollspy.defaults,n),this.$scrollElement=i.on("scroll.scroll-spy.data-api",r),this.selector=(this.options.target||(s=e(t).attr("href"))&&s.replace(/.*(?=#[^\s]+$)/,"")||"")+" .nav li > a",this.$body=e("body"),this.refresh(),this.process()}t.prototype={constructor:t,refresh:function(){var t=this,n;this.offsets=e([]),this.targets=e([]),n=this.$body.find(this.selector).map(function(){var n=e(this),r=n.data("target")||n.attr("href"),i=/^#\w/.test(r)&&e(r);return i&&i.length&&[[i.position().top+(!e.isWindow(t.$scrollElement.get(0))&&t.$scrollElement.scrollTop()),r]]||null}).sort(function(e,t){return e[0]-t[0]}).each(function(){t.offsets.push(this[0]),t.targets.push(this[1])})},process:function(){var e=this.$scrollElement.scrollTop()+this.options.offset,t=this.$scrollElement[0].scrollHeight||this.$body[0].scrollHeight,n=t-this.$scrollElement.height(),r=this.offsets,i=this.targets,s=this.activeTarget,o;if(e>=n)return s!=(o=i.last()[0])&&this.activate(o);for(o=r.length;o--;)s!=i[o]&&e>=r[o]&&(!r[o+1]||e<=r[o+1])&&this.activate(i[o])},activate:function(t){var n,r;this.activeTarget=t,e(this.selector).parent(".active").removeClass("active"),r=this.selector+'[data-target="'+t+'"],'+this.selector+'[href="'+t+'"]',n=e(r).parent("li").addClass("active"),n.parent(".dropdown-menu").length&&(n=n.closest("li.dropdown").addClass("active")),n.trigger("activate")}};var n=e.fn.scrollspy;e.fn.scrollspy=function(n){return this.each(function(){var r=e(this),i=r.data("scrollspy"),s=typeof n=="object"&&n;i||r.data("scrollspy",i=new t(this,s)),typeof n=="string"&&i[n]()})},e.fn.scrollspy.Constructor=t,e.fn.scrollspy.defaults={offset:10},e.fn.scrollspy.noConflict=function(){return e.fn.scrollspy=n,this},e(window).on("load",function(){e('[data-spy="scroll"]').each(function(){var t=e(this);t.scrollspy(t.data())})})}(window.jQuery),!function(e){var t=function(t){this.element=e(t)};t.prototype={constructor:t,show:function(){var t=this.element,n=t.closest("ul:not(.dropdown-menu)"),r=t.attr("data-target"),i,s,o;r||(r=t.attr("href"),r=r&&r.replace(/.*(?=#[^\s]*$)/,""));if(t.parent("li").hasClass("active"))return;i=n.find(".active:last a")[0],o=e.Event("show",{relatedTarget:i}),t.trigger(o);if(o.isDefaultPrevented())return;s=e(r),this.activate(t.parent("li"),n),this.activate(s,s.parent(),function(){t.trigger({type:"shown",relatedTarget:i})})},activate:function(t,n,r){function o(){i.removeClass("active").find("> .dropdown-menu > .active").removeClass("active"),t.addClass("active"),s?(t[0].offsetWidth,t.addClass("in")):t.removeClass("fade"),t.parent(".dropdown-menu")&&t.closest("li.dropdown").addClass("active"),r&&r()}var i=n.find("> .active"),s=r&&e.support.transition&&i.hasClass("fade");s?i.one(e.support.transition.end,o):o(),i.removeClass("in")}};var n=e.fn.tab;e.fn.tab=function(n){return this.each(function(){var r=e(this),i=r.data("tab");i||r.data("tab",i=new t(this)),typeof n=="string"&&i[n]()})},e.fn.tab.Constructor=t,e.fn.tab.noConflict=function(){return e.fn.tab=n,this},e(document).on("click.tab.data-api",'[data-toggle="tab"], [data-toggle="pill"]',function(t){t.preventDefault(),e(this).tab("show")})}(window.jQuery),!function(e){var t=function(t,n){this.$element=e(t),this.options=e.extend({},e.fn.typeahead.defaults,n),this.matcher=this.options.matcher||this.matcher,this.sorter=this.options.sorter||this.sorter,this.highlighter=this.options.highlighter||this.highlighter,this.updater=this.options.updater||this.updater,this.source=this.options.source,this.$menu=e(this.options.menu),this.shown=!1,this.listen()};t.prototype={constructor:t,select:function(){var e=this.$menu.find(".active").attr("data-value");return this.$element.val(this.updater(e)).change(),this.hide()},updater:function(e){return e},show:function(){var t=e.extend({},this.$element.position(),{height:this.$element[0].offsetHeight});return this.$menu.insertAfter(this.$element).css({top:t.top+t.height,left:t.left}).show(),this.shown=!0,this},hide:function(){return this.$menu.hide(),this.shown=!1,this},lookup:function(t){var n;return this.query=this.$element.val(),!this.query||this.query.length<this.options.minLength?this.shown?this.hide():this:(n=e.isFunction(this.source)?this.source(this.query,e.proxy(this.process,this)):this.source,n?this.process(n):this)},process:function(t){var n=this;return t=e.grep(t,function(e){return n.matcher(e)}),t=this.sorter(t),t.length?this.render(t.slice(0,this.options.items)).show():this.shown?this.hide():this},matcher:function(e){return~e.toLowerCase().indexOf(this.query.toLowerCase())},sorter:function(e){var t=[],n=[],r=[],i;while(i=e.shift())i.toLowerCase().indexOf(this.query.toLowerCase())?~i.indexOf(this.query)?n.push(i):r.push(i):t.push(i);return t.concat(n,r)},highlighter:function(e){var t=this.query.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&");return e.replace(new RegExp("("+t+")","ig"),function(e,t){return"<strong>"+t+"</strong>"})},render:function(t){var n=this;return t=e(t).map(function(t,r){return t=e(n.options.item).attr("data-value",r),t.find("a").html(n.highlighter(r)),t[0]}),t.first().addClass("active"),this.$menu.html(t),this},next:function(t){var n=this.$menu.find(".active").removeClass("active"),r=n.next();r.length||(r=e(this.$menu.find("li")[0])),r.addClass("active")},prev:function(e){var t=this.$menu.find(".active").removeClass("active"),n=t.prev();n.length||(n=this.$menu.find("li").last()),n.addClass("active")},listen:function(){this.$element.on("focus",e.proxy(this.focus,this)).on("blur",e.proxy(this.blur,this)).on("keypress",e.proxy(this.keypress,this)).on("keyup",e.proxy(this.keyup,this)),this.eventSupported("keydown")&&this.$element.on("keydown",e.proxy(this.keydown,this)),this.$menu.on("click",e.proxy(this.click,this)).on("mouseenter","li",e.proxy(this.mouseenter,this)).on("mouseleave","li",e.proxy(this.mouseleave,this))},eventSupported:function(e){var t=e in this.$element;return t||(this.$element.setAttribute(e,"return;"),t=typeof this.$element[e]=="function"),t},move:function(e){if(!this.shown)return;switch(e.keyCode){case 9:case 13:case 27:e.preventDefault();break;case 38:e.preventDefault(),this.prev();break;case 40:e.preventDefault(),this.next()}e.stopPropagation()},keydown:function(t){this.suppressKeyPressRepeat=~e.inArray(t.keyCode,[40,38,9,13,27]),this.move(t)},keypress:function(e){if(this.suppressKeyPressRepeat)return;this.move(e)},keyup:function(e){switch(e.keyCode){case 40:case 38:case 16:case 17:case 18:break;case 9:case 13:if(!this.shown)return;this.select();break;case 27:if(!this.shown)return;this.hide();break;default:this.lookup()}e.stopPropagation(),e.preventDefault()},focus:function(e){this.focused=!0},blur:function(e){this.focused=!1,!this.mousedover&&this.shown&&this.hide()},click:function(e){e.stopPropagation(),e.preventDefault(),this.select(),this.$element.focus()},mouseenter:function(t){this.mousedover=!0,this.$menu.find(".active").removeClass("active"),e(t.currentTarget).addClass("active")},mouseleave:function(e){this.mousedover=!1,!this.focused&&this.shown&&this.hide()}};var n=e.fn.typeahead;e.fn.typeahead=function(n){return this.each(function(){var r=e(this),i=r.data("typeahead"),s=typeof n=="object"&&n;i||r.data("typeahead",i=new t(this,s)),typeof n=="string"&&i[n]()})},e.fn.typeahead.defaults={source:[],items:8,menu:'<ul class="typeahead dropdown-menu"></ul>',item:'<li><a href="#"></a></li>',minLength:1},e.fn.typeahead.Constructor=t,e.fn.typeahead.noConflict=function(){return e.fn.typeahead=n,this},e(document).on("focus.typeahead.data-api",'[data-provide="typeahead"]',function(t){var n=e(this);if(n.data("typeahead"))return;n.typeahead(n.data())})}(window.jQuery),!function(e){var t=function(t,n){this.options=e.extend({},e.fn.affix.defaults,n),this.$window=e(window).on("scroll.affix.data-api",e.proxy(this.checkPosition,this)).on("click.affix.data-api",e.proxy(function(){setTimeout(e.proxy(this.checkPosition,this),1)},this)),this.$element=e(t),this.checkPosition()};t.prototype.checkPosition=function(){if(!this.$element.is(":visible"))return;var t=e(document).height(),n=this.$window.scrollTop(),r=this.$element.offset(),i=this.options.offset,s=i.bottom,o=i.top,u="affix affix-top affix-bottom",a;typeof i!="object"&&(s=o=i),typeof o=="function"&&(o=i.top()),typeof s=="function"&&(s=i.bottom()),a=this.unpin!=null&&n+this.unpin<=r.top?!1:s!=null&&r.top+this.$element.height()>=t-s?"bottom":o!=null&&n<=o?"top":!1;if(this.affixed===a)return;this.affixed=a,this.unpin=a=="bottom"?r.top-n:null,this.$element.removeClass(u).addClass("affix"+(a?"-"+a:""))};var n=e.fn.affix;e.fn.affix=function(n){return this.each(function(){var r=e(this),i=r.data("affix"),s=typeof n=="object"&&n;i||r.data("affix",i=new t(this,s)),typeof n=="string"&&i[n]()})},e.fn.affix.Constructor=t,e.fn.affix.defaults={offset:0},e.fn.affix.noConflict=function(){return e.fn.affix=n,this},e(window).on("load",function(){e('[data-spy="affix"]').each(function(){var t=e(this),n=t.data();n.offset=n.offset||{},n.offsetBottom&&(n.offset.bottom=n.offsetBottom),n.offsetTop&&(n.offset.top=n.offsetTop),t.affix(n)})})}(window.jQuery),define("bootstrap",function(){}),define("flashbar",["require","underscore","jquery","bootstrap"],function(e){var t,n,r,i,s,o;return o=e("underscore"),t=e("jquery"),e("bootstrap"),s=7e3,n=400,i=o('<div class="alert alert-<%= type %> fade.in flash-bar hide">\n  <button type="button" class="close" data-dismiss="alert" title="close">&times;</button>\n  <i class="<%= icon %>"></i>\n  <span><%= message %></span>\n</div>').template(),r=function(e,r){var u,a;return a=function(){switch(e){case"success":return"icon-ok-sign";case"error":return"icon-warning-sign";case"info":return"icon-info-sign";default:throw new Error("Unknown Type.")}}(),u=t(i({icon:a,type:e,message:r})).prependTo("body").alert().slideDown(n),o(function(){return u.slideUp(n,function(){return u.remove()})}).delay(s)},t.showSuccessbar=function(e){return r("success",e)},t.showErrorbar=function(e){return r("error",e)},t.showInfobar=function(e){return r("info",e)},t});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("application/views/canvas",["require","jquery","backbone","../uml/drawing/sequence/renderer","../events","flashbar"],function(e){var t,n,r,i,s;return t=e("jquery"),n=e("backbone"),i=e("../uml/drawing/sequence/renderer"),s=e("../events"),e("flashbar"),r=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return __extends(n,e),n.prototype.el="#canvas-container",n.prototype.rendererType=i,n.prototype.initialize=function(e){return this.context=e.context,this.renderer=new this.rendererType,this.listenTo(s,"parseStarted",this.onParseStarted),this.listenTo(s,"parseCompleted",this.onParseCompleted),this.listenTo(s,"exportDocument",this.onExportDocument)},n.prototype.onParseStarted=function(){return this.renderer.reset()},n.prototype.onParseCompleted=function(e){var t,n;t=null;if(e!=null?e.diagram:void 0)t=(n=e.diagram.title)!=null?n.text:void 0,this.renderer.render(e.diagram);return this.context.setCurrentDocumentTitle(t)},n.prototype.onExportDocument=function(){var e;try{return e=this.renderer.serialize(),s.trigger("documentExported",{data:e})}catch(n){return t.showErrorbar(n.message)}},n}(n.View)}),function(e){function M(e,t){return function(n){return F(e.call(this,n),t)}}function _(e,t){return function(n){return this.lang().ordinal(e.call(this,n),t)}}function D(){}function P(e){B(this,e)}function H(e){var t=e.years||e.year||e.y||0,n=e.months||e.month||e.M||0,r=e.weeks||e.week||e.w||0,i=e.days||e.day||e.d||0,s=e.hours||e.hour||e.h||0,o=e.minutes||e.minute||e.m||0,u=e.seconds||e.second||e.s||0,a=e.milliseconds||e.millisecond||e.ms||0;this._input=e,this._milliseconds=a+u*1e3+o*6e4+s*36e5,this._days=i+r*7,this._months=n+t*12,this._data={},this._bubble()}function B(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function j(e){return e<0?Math.ceil(e):Math.floor(e)}function F(e,t){var n=e+"";while(n.length<t)n="0"+n;return n}function I(e,n,r,i){var s=n._milliseconds,o=n._days,u=n._months,a,f,l;s&&e._d.setTime(+e._d+s*r);if(o||u)a=e.minute(),f=e.hour();o&&e.date(e.date()+o*r),u&&e.month(e.month()+u*r),s&&!i&&t.updateOffset(e);if(o||u)e.minute(a),e.hour(f)}function q(e){return Object.prototype.toString.call(e)==="[object Array]"}function R(e,t){var n=Math.min(e.length,t.length),r=Math.abs(e.length-t.length),i=0,s;for(s=0;s<n;s++)~~e[s]!==~~t[s]&&i++;return i+r}function U(e){return e?C[e]||e.toLowerCase().replace(/(.)s$/,"$1"):e}function z(e,t){return t.abbr=e,s[e]||(s[e]=new D),s[e].set(t),s[e]}function W(e){if(!e)return t.fn._lang;if(!s[e]&&o)try{require("./lang/"+e)}catch(n){return t.fn._lang}return s[e]}function X(e){return e.match(/\[.*\]/)?e.replace(/^\[|\]$/g,""):e.replace(/\\/g,"")}function V(e){var t=e.match(f),n,r;for(n=0,r=t.length;n<r;n++)O[t[n]]?t[n]=O[t[n]]:t[n]=X(t[n]);return function(i){var s="";for(n=0;n<r;n++)s+=t[n]instanceof Function?t[n].call(i,e):t[n];return s}}function $(e,t){function r(t){return e.lang().longDateFormat(t)||t}var n=5;while(n--&&l.test(t))t=t.replace(l,r);return k[t]||(k[t]=V(t)),k[t](e)}function J(e,t){switch(e){case"DDDD":return p;case"YYYY":return d;case"YYYYY":return v;case"S":case"SS":case"SSS":case"DDD":return h;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":return m;case"a":case"A":return W(t._l)._meridiemParse;case"X":return b;case"Z":case"ZZ":return g;case"T":return y;case"MM":case"DD":case"YY":case"HH":case"hh":case"mm":case"ss":case"M":case"D":case"d":case"H":case"h":case"m":case"s":return c;default:return new RegExp(e.replace("\\",""))}}function K(e){var t=(g.exec(e)||[])[0],n=(t+"").match(x)||["-",0,0],r=+(n[1]*60)+~~n[2];return n[0]==="+"?-r:r}function Q(e,t,n){var r,i=n._a;switch(e){case"M":case"MM":i[1]=t==null?0:~~t-1;break;case"MMM":case"MMMM":r=W(n._l).monthsParse(t),r!=null?i[1]=r:n._isValid=!1;break;case"D":case"DD":case"DDD":case"DDDD":t!=null&&(i[2]=~~t);break;case"YY":i[0]=~~t+(~~t>68?1900:2e3);break;case"YYYY":case"YYYYY":i[0]=~~t;break;case"a":case"A":n._isPm=W(n._l).isPM(t);break;case"H":case"HH":case"h":case"hh":i[3]=~~t;break;case"m":case"mm":i[4]=~~t;break;case"s":case"ss":i[5]=~~t;break;case"S":case"SS":case"SSS":i[6]=~~(("0."+t)*1e3);break;case"X":n._d=new Date(parseFloat(t)*1e3);break;case"Z":case"ZZ":n._useUTC=!0,n._tzm=K(t)}t==null&&(n._isValid=!1)}function G(e){var t,n,r=[];if(e._d)return;for(t=0;t<7;t++)e._a[t]=r[t]=e._a[t]==null?t===2?1:0:e._a[t];r[3]+=~~((e._tzm||0)/60),r[4]+=~~((e._tzm||0)%60),n=new Date(0),e._useUTC?(n.setUTCFullYear(r[0],r[1],r[2]),n.setUTCHours(r[3],r[4],r[5],r[6])):(n.setFullYear(r[0],r[1],r[2]),n.setHours(r[3],r[4],r[5],r[6])),e._d=n}function Y(e){var t=e._f.match(f),n=e._i,r,i;e._a=[];for(r=0;r<t.length;r++)i=(J(t[r],e).exec(n)||[])[0],i&&(n=n.slice(n.indexOf(i)+i.length)),O[t[r]]&&Q(t[r],i,e);n&&(e._il=n),e._isPm&&e._a[3]<12&&(e._a[3]+=12),e._isPm===!1&&e._a[3]===12&&(e._a[3]=0),G(e)}function Z(e){var t,n,r,i=99,s,o;for(s=0;s<e._f.length;s++)t=B({},e),t._f=e._f[s],Y(t),n=new P(t),o=R(t._a,n.toArray()),n._il&&(o+=n._il.length),o<i&&(i=o,r=n);B(e,r)}function et(e){var t,n=e._i,r=w.exec(n);if(r){e._f="YYYY-MM-DD"+(r[2]||" ");for(t=0;t<4;t++)if(S[t][1].exec(n)){e._f+=S[t][0];break}g.exec(n)&&(e._f+=" Z"),Y(e)}else e._d=new Date(n)}function tt(t){var n=t._i,r=u.exec(n);n===e?t._d=new Date:r?t._d=new Date(+r[1]):typeof n=="string"?et(t):q(n)?(t._a=n.slice(0),G(t)):t._d=n instanceof Date?new Date(+n):new Date(n)}function nt(e,t,n,r,i){return i.relativeTime(t||1,!!n,e,r)}function rt(e,t,n){var i=r(Math.abs(e)/1e3),s=r(i/60),o=r(s/60),u=r(o/24),a=r(u/365),f=i<45&&["s",i]||s===1&&["m"]||s<45&&["mm",s]||o===1&&["h"]||o<22&&["hh",o]||u===1&&["d"]||u<=25&&["dd",u]||u<=45&&["M"]||u<345&&["MM",r(u/30)]||a===1&&["y"]||["yy",a];return f[2]=t,f[3]=e>0,f[4]=n,nt.apply({},f)}function it(e,n,r){var i=r-n,s=r-e.day(),o;return s>i&&(s-=7),s<i-7&&(s+=7),o=t(e).add("d",s),{week:Math.ceil(o.dayOfYear()/7),year:o.year()}}function st(e){var n=e._i,r=e._f;return n===null||n===""?null:(typeof n=="string"&&(e._i=n=W().preparse(n)),t.isMoment(n)?(e=B({},n),e._d=new Date(+n._d)):r?q(r)?Z(e):Y(e):tt(e),new P(e))}function ot(e,n){t.fn[e]=t.fn[e+"s"]=function(e){var r=this._isUTC?"UTC":"";return e!=null?(this._d["set"+r+n](e),t.updateOffset(this),this):this._d["get"+r+n]()}}function ut(e){t.duration.fn[e]=function(){return this._data[e]}}function at(e,n){t.duration.fn["as"+e]=function(){return+this/n}}var t,n="2.1.0",r=Math.round,i,s={},o=typeof module!="undefined"&&module.exports,u=/^\/?Date\((\-?\d+)/i,a=/(\-)?(\d*)?\.?(\d+)\:(\d+)\:(\d+)\.?(\d{3})?/,f=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|SS?S?|X|zz?|ZZ?|.)/g,l=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?|l{1,4})/g,c=/\d\d?/,h=/\d{1,3}/,p=/\d{3}/,d=/\d{1,4}/,v=/[+\-]?\d{1,6}/,m=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,g=/Z|[\+\-]\d\d:?\d\d/i,y=/T/i,b=/[\+\-]?\d+(\.\d{1,3})?/,w=/^\s*\d{4}-\d\d-\d\d((T| )(\d\d(:\d\d(:\d\d(\.\d\d?\d?)?)?)?)?([\+\-]\d\d:?\d\d)?)?/,E="YYYY-MM-DDTHH:mm:ssZ",S=[["HH:mm:ss.S",/(T| )\d\d:\d\d:\d\d\.\d{1,3}/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],x=/([\+\-]|\d\d)/gi,T="Date|Hours|Minutes|Seconds|Milliseconds".split("|"),N={Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6},C={ms:"millisecond",s:"second",m:"minute",h:"hour",d:"day",w:"week",M:"month",y:"year"},k={},L="DDD w W M D d".split(" "),A="M D H h m s w W".split(" "),O={M:function(){return this.month()+1},MMM:function(e){return this.lang().monthsShort(this,e)},MMMM:function(e){return this.lang().months(this,e)},D:function(){return this.date()},DDD:function(){return this.dayOfYear()},d:function(){return this.day()},dd:function(e){return this.lang().weekdaysMin(this,e)},ddd:function(e){return this.lang().weekdaysShort(this,e)},dddd:function(e){return this.lang().weekdays(this,e)},w:function(){return this.week()},W:function(){return this.isoWeek()},YY:function(){return F(this.year()%100,2)},YYYY:function(){return F(this.year(),4)},YYYYY:function(){return F(this.year(),5)},gg:function(){return F(this.weekYear()%100,2)},gggg:function(){return this.weekYear()},ggggg:function(){return F(this.weekYear(),5)},GG:function(){return F(this.isoWeekYear()%100,2)},GGGG:function(){return this.isoWeekYear()},GGGGG:function(){return F(this.isoWeekYear(),5)},e:function(){return this.weekday()},E:function(){return this.isoWeekday()},a:function(){return this.lang().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.lang().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return~~(this.milliseconds()/100)},SS:function(){return F(~~(this.milliseconds()/10),2)},SSS:function(){return F(this.milliseconds(),3)},Z:function(){var e=-this.zone(),t="+";return e<0&&(e=-e,t="-"),t+F(~~(e/60),2)+":"+F(~~e%60,2)},ZZ:function(){var e=-this.zone(),t="+";return e<0&&(e=-e,t="-"),t+F(~~(10*e/6),4)},z:function(){return this.zoneAbbr()},zz:function(){return this.zoneName()},X:function(){return this.unix()}};while(L.length)i=L.pop(),O[i+"o"]=_(O[i],i);while(A.length)i=A.pop(),O[i+i]=M(O[i],2);O.DDDD=M(O.DDD,3),D.prototype={set:function(e){var t,n;for(n in e)t=e[n],typeof t=="function"?this[n]=t:this["_"+n]=t},_months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),months:function(e){return this._months[e.month()]},_monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),monthsShort:function(e){return this._monthsShort[e.month()]},monthsParse:function(e){var n,r,i;this._monthsParse||(this._monthsParse=[]);for(n=0;n<12;n++){this._monthsParse[n]||(r=t([2e3,n]),i="^"+this.months(r,"")+"|^"+this.monthsShort(r,""),this._monthsParse[n]=new RegExp(i.replace(".",""),"i"));if(this._monthsParse[n].test(e))return n}},_weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdays:function(e){return this._weekdays[e.day()]},_weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysShort:function(e){return this._weekdaysShort[e.day()]},_weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),weekdaysMin:function(e){return this._weekdaysMin[e.day()]},weekdaysParse:function(e){var n,r,i;this._weekdaysParse||(this._weekdaysParse=[]);for(n=0;n<7;n++){this._weekdaysParse[n]||(r=t([2e3,1]).day(n),i="^"+this.weekdays(r,"")+"|^"+this.weekdaysShort(r,"")+"|^"+this.weekdaysMin(r,""),this._weekdaysParse[n]=new RegExp(i.replace(".",""),"i"));if(this._weekdaysParse[n].test(e))return n}},_longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},longDateFormat:function(e){var t=this._longDateFormat[e];return!t&&this._longDateFormat[e.toUpperCase()]&&(t=this._longDateFormat[e.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(e){return e.slice(1)}),this._longDateFormat[e]=t),t},isPM:function(e){return(e+"").toLowerCase()[0]==="p"},_meridiemParse:/[ap]\.?m?\.?/i,meridiem:function(e,t,n){return e>11?n?"pm":"PM":n?"am":"AM"},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},calendar:function(e,t){var n=this._calendar[e];return typeof n=="function"?n.apply(t):n},_relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(e,t,n,r){var i=this._relativeTime[n];return typeof i=="function"?i(e,t,n,r):i.replace(/%d/i,e)},pastFuture:function(e,t){var n=this._relativeTime[e>0?"future":"past"];return typeof n=="function"?n(t):n.replace(/%s/i,t)},ordinal:function(e){return this._ordinal.replace("%d",e)},_ordinal:"%d",preparse:function(e){return e},postformat:function(e){return e},week:function(e){return it(e,this._week.dow,this._week.doy).week},_week:{dow:0,doy:6}},t=function(e,t,n){return st({_i:e,_f:t,_l:n,_isUTC:!1})},t.utc=function(e,t,n){return st({_useUTC:!0,_isUTC:!0,_l:n,_i:e,_f:t})},t.unix=function(e){return t(e*1e3)},t.duration=function(e,n){var r=t.isDuration(e),i=typeof e=="number",s=r?e._input:i?{}:e,o=a.exec(e),u,f;return i?n?s[n]=e:s.milliseconds=e:o&&(u=o[1]==="-"?-1:1,s={y:0,d:~~o[2]*u,h:~~o[3]*u,m:~~o[4]*u,s:~~o[5]*u,ms:~~o[6]*u}),f=new H(s),r&&e.hasOwnProperty("_lang")&&(f._lang=e._lang),f},t.version=n,t.defaultFormat=E,t.updateOffset=function(){},t.lang=function(e,n){if(!e)return t.fn._lang._abbr;n?z(e,n):s[e]||W(e),t.duration.fn._lang=t.fn._lang=W(e)},t.langData=function(e){return e&&e._lang&&e._lang._abbr&&(e=e._lang._abbr),W(e)},t.isMoment=function(e){return e instanceof P},t.isDuration=function(e){return e instanceof H},t.fn=P.prototype={clone:function(){return t(this)},valueOf:function(){return+this._d+(this._offset||0)*6e4},unix:function(){return Math.floor(+this/1e3)},toString:function(){return this.format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},toDate:function(){return this._offset?new Date(+this):this._d},toISOString:function(){return $(t(this).utc(),"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},toArray:function(){var e=this;return[e.year(),e.month(),e.date(),e.hours(),e.minutes(),e.seconds(),e.milliseconds()]},isValid:function(){return this._isValid==null&&(this._a?this._isValid=!R(this._a,(this._isUTC?t.utc(this._a):t(this._a)).toArray()):this._isValid=!isNaN(this._d.getTime())),!!this._isValid},utc:function(){return this.zone(0)},local:function(){return this.zone(0),this._isUTC=!1,this},format:function(e){var n=$(this,e||t.defaultFormat);return this.lang().postformat(n)},add:function(e,n){var r;return typeof e=="string"?r=t.duration(+n,e):r=t.duration(e,n),I(this,r,1),this},subtract:function(e,n){var r;return typeof e=="string"?r=t.duration(+n,e):r=t.duration(e,n),I(this,r,-1),this},diff:function(e,n,r){var i=this._isUTC?t(e).zone(this._offset||0):t(e).local(),s=(this.zone()-i.zone())*6e4,o,u;return n=U(n),n==="year"||n==="month"?(o=(this.daysInMonth()+i.daysInMonth())*432e5,u=(this.year()-i.year())*12+(this.month()-i.month()),u+=(this-t(this).startOf("month")-(i-t(i).startOf("month")))/o,u-=(this.zone()-t(this).startOf("month").zone()-(i.zone()-t(i).startOf("month").zone()))*6e4/o,n==="year"&&(u/=12)):(o=this-i,u=n==="second"?o/1e3:n==="minute"?o/6e4:n==="hour"?o/36e5:n==="day"?(o-s)/864e5:n==="week"?(o-s)/6048e5:o),r?u:j(u)},from:function(e,n){return t.duration(this.diff(e)).lang(this.lang()._abbr).humanize(!n)},fromNow:function(e){return this.from(t(),e)},calendar:function(){var e=this.diff(t().startOf("day"),"days",!0),n=e<-6?"sameElse":e<-1?"lastWeek":e<0?"lastDay":e<1?"sameDay":e<2?"nextDay":e<7?"nextWeek":"sameElse";return this.format(this.lang().calendar(n,this))},isLeapYear:function(){var e=this.year();return e%4===0&&e%100!==0||e%400===0},isDST:function(){return this.zone()<this.clone().month(0).zone()||this.zone()<this.clone().month(5).zone()},day:function(e){var t=this._isUTC?this._d.getUTCDay():this._d.getDay();if(e!=null){if(typeof e=="string"){e=this.lang().weekdaysParse(e);if(typeof e!="number")return this}return this.add({d:e-t})}return t},month:function(e){var n=this._isUTC?"UTC":"",r,i;if(e!=null){if(typeof e=="string"){e=this.lang().monthsParse(e);if(typeof e!="number")return this}return r=this.date(),this.date(1),this._d["set"+n+"Month"](e),this.date(Math.min(r,this.daysInMonth())),t.updateOffset(this),this}return this._d["get"+n+"Month"]()},startOf:function(e){e=U(e);switch(e){case"year":this.month(0);case"month":this.date(1);case"week":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return e==="week"&&this.weekday(0),this},endOf:function(e){return this.startOf(e).add(e,1).subtract("ms",1)},isAfter:function(e,n){return n=typeof n!="undefined"?n:"millisecond",+this.clone().startOf(n)>+t(e).startOf(n)},isBefore:function(e,n){return n=typeof n!="undefined"?n:"millisecond",+this.clone().startOf(n)<+t(e).startOf(n)},isSame:function(e,n){return n=typeof n!="undefined"?n:"millisecond",+this.clone().startOf(n)===+t(e).startOf(n)},min:function(e){return e=t.apply(null,arguments),e<this?this:e},max:function(e){return e=t.apply(null,arguments),e>this?this:e},zone:function(e){var n=this._offset||0;return e==null?this._isUTC?n:this._d.getTimezoneOffset():(typeof e=="string"&&(e=K(e)),Math.abs(e)<16&&(e*=60),this._offset=e,this._isUTC=!0,n!==e&&I(this,t.duration(n-e,"m"),1,!0),this)},zoneAbbr:function(){return this._isUTC?"UTC":""},zoneName:function(){return this._isUTC?"Coordinated Universal Time":""},daysInMonth:function(){return t.utc([this.year(),this.month()+1,0]).date()},dayOfYear:function(e){var n=r((t(this).startOf("day")-t(this).startOf("year"))/864e5)+1;return e==null?n:this.add("d",e-n)},weekYear:function(e){var t=it(this,this.lang()._week.dow,this.lang()._week.doy).year;return e==null?t:this.add("y",e-t)},isoWeekYear:function(e){var t=it(this,1,4).year;return e==null?t:this.add("y",e-t)},week:function(e){var t=this.lang().week(this);return e==null?t:this.add("d",(e-t)*7)},isoWeek:function(e){var t=it(this,1,4).week;return e==null?t:this.add("d",(e-t)*7)},weekday:function(e){var t=(this._d.getDay()+7-this.lang()._week.dow)%7;return e==null?t:this.add("d",e-t)},isoWeekday:function(e){return e==null?this.day()||7:this.day(this.day()%7?e:e-7)},lang:function(t){return t===e?this._lang:(this._lang=W(t),this)}};for(i=0;i<T.length;i++)ot(T[i].toLowerCase().replace(/s$/,""),T[i]);ot("year","FullYear"),t.fn.days=t.fn.day,t.fn.months=t.fn.month,t.fn.weeks=t.fn.week,t.fn.isoWeeks=t.fn.isoWeek,t.fn.toJSON=t.fn.toISOString,t.duration.fn=H.prototype={_bubble:function(){var e=this._milliseconds,t=this._days,n=this._months,r=this._data,i,s,o,u;r.milliseconds=e%1e3,i=j(e/1e3),r.seconds=i%60,s=j(i/60),r.minutes=s%60,o=j(s/60),r.hours=o%24,t+=j(o/24),r.days=t%30,n+=j(t/30),r.months=n%12,u=j(n/12),r.years=u},weeks:function(){return j(this.days()/7)},valueOf:function(){return this._milliseconds+this._days*864e5+this._months%12*2592e6+~~(this._months/12)*31536e6},humanize:function(e){var t=+this,n=rt(t,!e,this.lang());return e&&(n=this.lang().pastFuture(t,n)),this.lang().postformat(n)},add:function(e,n){var r=t.duration(e,n);return this._milliseconds+=r._milliseconds,this._days+=r._days,this._months+=r._months,this._bubble(),this},subtract:function(e,n){var r=t.duration(e,n);return this._milliseconds-=r._milliseconds,this._days-=r._days,this._months-=r._months,this._bubble(),this},get:function(e){return e=U(e),this[e.toLowerCase()+"s"]()},as:function(e){return e=U(e),this["as"+e.charAt(0).toUpperCase()+e.slice(1)+"s"]()},lang:t.fn.lang};for(i in N)N.hasOwnProperty(i)&&(at(i,N[i]),ut(i.toLowerCase()));at("Weeks",6048e5),t.duration.fn.asMonths=function(){return(+this-this.years()*31536e6)/2592e6+this.years()*12},t.lang("en",{ordinal:function(e){var t=e%10,n=~~(e%100/10)===1?"th":t===1?"st":t===2?"nd":t===3?"rd":"th";return e+n}}),o&&(module.exports=t),typeof ender=="undefined"&&(this.moment=t),typeof define=="function"&&define.amd&&define("moment",[],function(){return t})}.call(this),define("form",["require","underscore","jquery"],function(e){var t,n,r,i;return i=e("underscore"),t=e("jquery"),t.fn.serializeFields=function(){var e;return e={},this.each(function(){return t.each(t(this).serializeArray(),function(){return e[this.name]=this.value})}),e},t.fn.deserializeFields=function(e){return this.each(function(){var n=this;return i(e).chain().keys().each(function(r){return t(n).find(":input[name='"+r+"']").val(e[r])})})},t.fn.resetFields=function(){return this.each(function(){var e;return e=t(this),e.is("form")?e.get(0).reset():e.find("form").each(function(){return this.reset()})})},n=400,r=5e3,t.fn.hideFieldErrors=function(){return this.each(function(){return t(this).find(".control-group").filter(".error").removeClass("error").find(".help-block,.help-inline").slideUp(n,function(){return t(this).remove()})})},t.fn.showFieldErrors=function(e){var s,o,u,a,f=this;return e=t.extend({inline:!1,errors:{}},e),a=e.inline,s=a?"help-inline":"help-block",o=e.errors||{},u=null,this.each(function(){return t(this).find(":input").each(function(){var e,r,f;return e=t(this),r=e.attr("name"),r?(f=r.toLowerCase(),i(o).chain().keys().filter(function(e){return o[e].length}).filter(function(e){return e.toLowerCase()===f}).each(function(r){var f;return u||(u=e),e.closest(".control-group").addClass("error"),f=a?e.parent():e.closest(".controls"),i(o[r]).each(function(e){return t("<span>",{text:e,"class":s}).appendTo(f).hide().slideDown(n)})})):!1})}),u&&u.first().focus(),i(function(){return f.hideFieldErrors()}).delay(r),this},t.fn.hideSummaryError=function(){return this.each(function(){var e;return e=t(this),e.is("form")||(e=e.find("form")),e.find(".alert").slideUp(n,function(){return t(this).remove()})})},function(){var e;return e=i('<div class="alert alert-error fade in">\n  <button type="button" class="close" data-dismiss="alert" title="close">&times;</button>\n  <i class="icon-warning-sign"></i> \n  <span><%= message %></span>\n</div>').template(),t.fn.showSummaryError=function(s){var o=this;return s=t.extend({message:"An unexpected error has occurred while performing your last operation."},s),this.each(function(){var r;return r=t(this),r.is("form")||(r=r.find("form")),t(e({message:s.message})).prependTo(r).hide().slideDown(n)}),i(function(){return o.hideSummaryError()}).delay(r)}}(),t.fn.putFocus=function(){var e=this;return i(function(){return e.find(":input").not(":button").not(":checkbox").not(":radio").not(":disabled").first().select().focus()}).delay(80),this},t}),define("application/views/helpers",["require","jquery","underscore","moment","form"],function(e){var t,n,r,i,s;return t=e("jquery"),s=e("underscore"),i=e("moment"),e("form"),n=function(){var e;return e=(new Date).getTimezoneOffset(),e>0?-e:Math.abs(e)},r=function(e){return i(e).add("m",n())},{formatAsRelativeTime:function(e){return r(e).fromNow()},formatAsHumanizeTime:function(e){return r(e).format("dddd, MMMM Do YYYY, h:mm a")},hasModelErrors:function(e){return e.status===400},getModelErrors:function(e){var n,r;try{r=t.parseJSON(e.responseText)}catch(i){r=null}if(r){n=s(r).chain().keys().filter(function(e){return e.toLowerCase()==="modelstate"}).first().value();if(n)return r[n]}return void 0},subscribeModelInvalidEvent:function(e,t){return e.once("invalid",function(){return t.showFieldErrors({errors:e.validationError})})}}});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("application/views/membershipform",["require","backbone","./helpers","../events","form"],function(e){var t,n,r,i;return t=e("backbone"),n=e("./helpers"),i=e("../events"),e("form"),r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.modelType=null,t.prototype.successEvent=null,t.prototype.events={submit:"onSubmit"},t.prototype.handleError=function(e){throw new Error("Not implemented")},t.prototype.onSubmit=function(e){var t,r=this;return e.preventDefault(),this.$el.hideSummaryError().hideFieldErrors(),t=new this.modelType,n.subscribeModelInvalidEvent(t,this.$el),t.save(this.$el.serializeFields(),{success:function(){return i.trigger(r.successEvent)},error:function(e,t){return r.handleError(t)}})},t}(t.View)}),define("application/models/validation",[],function(){return{isValidEmailFormat:function(e){return e&&/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(e)},isValidPasswordLength:function(e){var t;return e&&64>=(t=e.length)&&t>=6},addError:function(e,t,n){return(e[t]||(e[t]=[])).push(n)}}});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("application/models/session",["require","underscore","backbone","./validation"],function(e){var t,n,r,i;return i=e("underscore"),t=e("backbone"),r=e("./validation"),n=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.url="/api/sessions",t.prototype.defaults=function(){return{email:null,password:null,rememberMe:!1}},t.prototype.validate=function(e){var t;return t={},e.email||r.addError(t,"email","Email is required."),e.password||r.addError(t,"password","Password is required."),i(t).isEmpty()?void 0:t},t}(t.Model)});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("application/views/signin",["require","./membershipform","../models/session","./helpers"],function(e){var t,n,r,i;return n=e("./membershipform"),r=e("../models/session"),t=e("./helpers"),i=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return __extends(n,e),n.prototype.el="#sign-in-form",n.prototype.handleError=function(e){var n;return n=t.hasModelErrors(e)?"Invalid credentials.":"An unexpected error has occurred while signing in.",this.$el.showSummaryError({message:n})},n}(n),i.prototype.modelType=r,i.prototype.successEvent="signedIn",i});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("application/models/forgotpassword",["require","underscore","backbone","./validation"],function(e){var t,n,r,i;return i=e("underscore"),t=e("backbone"),r=e("./validation"),n=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.url="/api/passwords/forgot",t.prototype.defaults=function(){return{email:null}},t.prototype.validate=function(e){var t;return t={},e.email?r.isValidEmailFormat(e.email)||r.addError(t,"email","Invalid email format."):r.addError(t,"email","Email is required."),i(t).isEmpty()?void 0:t},t}(t.Model)});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("application/views/forgotpassword",["require","./membershipform","../models/forgotpassword"],function(e){var t,n,r;return r=e("./membershipform"),t=e("../models/forgotpassword"),n=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.el="#forgot-password-form",t.prototype.handleError=function(){var e;return e="An unexpected error has occurred while sending forgot password request.",this.$el.showSummaryError({message:e})},t}(r),n.prototype.modelType=t,n.prototype.successEvent="passwordResetTokenRequested",n});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("application/models/user",["require","underscore","backbone","./validation"],function(e){var t,n,r,i;return i=e("underscore"),t=e("backbone"),r=e("./validation"),n=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.url="/api/users",t.prototype.defaults=function(){return{email:null,password:null,confirmPassword:null}},t.prototype.validate=function(e){var t;return t={},e.email?r.isValidEmailFormat(e.email)||r.addError(t,"email","Invalid email format."):r.addError(t,"email","Email is required."),e.password?r.isValidPasswordLength(e.password)||r.addError(t,"password","Password length must be between 6 to 64 characters."):r.addError(t,"password","Password is required."),e.confirmPassword?e.password&&e.confirmPassword!==e.password&&r.addError(t,"confirmPassword","Password and confirmation password do not match."):r.addError(t,"confirmPassword","Confirm password is required."),i(t).isEmpty()?void 0:t},t}(t.Model)});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("application/views/signup",["require","./membershipform","../models/user","./helpers"],function(e){var t,n,r,i;return n=e("./membershipform"),i=e("../models/user"),t=e("./helpers"),r=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return __extends(n,e),n.prototype.el="#sign-up-form",n.prototype.handleError=function(e){var n;if(t.hasModelErrors(e)){n=t.getModelErrors(e);if(n)return this.$el.showFieldErrors({errors:n})}return this.$el.showSummaryError({message:"An unexpected error has occurred while signing up."})},n}(n),r.prototype.modelType=i,r.prototype.successEvent="signedUp",r});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("application/views/membership",["require","underscore","backbone","./signin","./forgotpassword","./signup","../events","bootstrap","form"],function(e){var t,n,r,i,s,o,u;return u=e("underscore"),t=e("backbone"),i=e("./signin"),n=e("./forgotpassword"),s=e("./signup"),o=e("../events"),e("bootstrap"),e("form"),r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.el="#membership-dialog",t.prototype.signInViewType=i,t.prototype.forgotPasswordViewType=n,t.prototype.signUpViewType=s,t.prototype.events={'shown a[data-toggle="tab"]':"onTabHeaderShown",show:"onDialogShow",shown:"onDialogShown",hidden:"onDialogHidden"},t.prototype.initialize=function(){return this.signIn=new this.signInViewType,this.forgotPassword=new this.forgotPasswordViewType,this.signUp=new this.signUpViewType,this.firstTabHead=this.$('a[data-toggle="tab"]').first(),this.$el.modal({show:!1}),this.listenTo(o,"showMembership",this.onShowMembership),this.listenTo(o,"signedIn passwordResetTokenRequested signedUp",this.onSignedInOrPasswordResetTokenRequestedOrSignedUp)},t.prototype.onShowMembership=function(e){return this.ok=e&&u(e.ok).isFunction()?e.ok:void 0,this.cancel=e&&u(e.cancel).isFunction()?e.cancel:void 0,this.firstTabHead.trigger("click"),this.$el.modal("show")},t.prototype.onSignedInOrPasswordResetTokenRequestedOrSignedUp=function(){return this.canceled=!1,this.$el.modal("hide")},t.prototype.onTabHeaderShown=function(e){var t;return((t=e.target)!=null?t.hash:void 0)==null?!1:this.$(e.target.hash).putFocus()},t.prototype.onDialogShow=function(){return this.canceled=!0,this.$el.resetFields().hideSummaryError().hideFieldErrors()},t.prototype.onDialogShown=function(){return this.$el.putFocus()},t.prototype.onDialogHidden=function(){return this.canceled&&this.cancel!=null?this.cancel():this.ok!=null?this.ok():!1},t}(t.View)});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("application/models/changepassword",["require","underscore","backbone","./validation"],function(e){var t,n,r,i;return i=e("underscore"),t=e("backbone"),r=e("./validation"),n=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.url=function(){return"/api/passwords/change"},t.prototype.defaults=function(){return{oldPassword:null,newPassword:null,confirmPassword:null}},t.prototype.validate=function(e){var t;return t={},e.oldPassword||r.addError(t,"oldPassword","Old password is required."),e.newPassword?r.isValidPasswordLength(e.newPassword)||r.addError(t,"newPassword","New password length must be between 6 to 64 characters."):r.addError(t,"newPassword","New password is required."),e.confirmPassword?e.newPassword&&e.confirmPassword!==e.newPassword&&r.addError(t,"confirmPassword","New password and confirmation password do not match."):r.addError(t,"confirmPassword","Confirm password is required."),i(t).isEmpty()?void 0:t},t}(t.Model)}),define("confirm",["require","underscore","jquery","bootstrap"],function(e){var t,n,r,i;return i=e("underscore"),t=e("jquery"),e("bootstrap"),r=i('<div class="modal fade hide">\n  <div class="modal-header">\n    <button type="button" class="close" title="close" data-dismiss="modal">&times;</button>\n    <h3><%= title %></h3>\n  </div>\n  <div class="modal-body"><%= prompt %></div>\n  <div class="modal-footer">\n    <button type="button" class="btn">Ok</button>\n    <button type="button" class="btn btn-primary" data-dismiss="modal">Cancel</button>\n  </div>\n</div>').template(),n={title:"Confirm",prompt:"Are you sure you want to perform this action?",ok:function(){},cancel:function(){}},t.confirm=function(e){var i,s;return e=t.extend(n,e),i={title:e.title,prompt:e.prompt},s=t(r(i)).appendTo("body").modal({show:!1}),s.on("click",".modal-footer .btn",function(n){return t(n.currentTarget).is(".btn-primary")?typeof e.cancel=="function"?e.cancel():void 0:(s.modal("hide"),typeof e.ok=="function"?e.ok():void 0)}),s.on("hidden",function(){return s.remove()}).modal("show")},t});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("application/views/profile",["require","jquery","backbone","../models/changepassword","../models/session","./helpers","../events","bootstrap","form","confirm"],function(e){var t,n,r,i,s,o,u;return t=e("jquery"),n=e("backbone"),r=e("../models/changepassword"),o=e("../models/session"),i=e("./helpers"),u=e("../events"),e("bootstrap"),e("form"),e("confirm"),s=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return __extends(n,e),n.prototype.el="#profile-dialog",n.prototype.changePasswordType=r,n.prototype.sessionType=o,n.prototype.events={shown:"onDialogShown","submit form":"onChangePassword","click #sign-out-button":"onSignOut"},n.prototype.initialize=function(){return this.changePasswordForm=this.$("form"),this.$el.modal({show:!1}),this.listenTo(u,"showProfile",this.onShowProfile)},n.prototype.onShowProfile=function(){return this.changePasswordForm.resetFields().hideSummaryError().hideFieldErrors(),this.$el.modal("show")},n.prototype.onDialogShown=function(){return this.changePasswordForm.putFocus()},n.prototype.onChangePassword=function(e){var t,n=this;return e.preventDefault(),this.changePasswordForm.hideSummaryError().hideFieldErrors(),t=new this.changePasswordType,i.subscribeModelInvalidEvent(t,this.changePasswordForm),t.save(this.changePasswordForm.serializeFields(),{success:function(){return n.$el.modal("hide"),u.trigger("passwordChanged")},error:function(e,t){var r;if(i.hasModelErrors(t)){r=i.getModelErrors(t);if(r)return n.changePasswordForm.showFieldErrors({errors:r})}return n.changePasswordForm.showSummaryError({message:"An unexpected error has occurred while changing your password."})}})},n.prototype.onSignOut=function(e){var n=this;return e.preventDefault(),this.$el.modal("hide"),t.confirm({prompt:"Are you sure you want to sign out?",ok:function(){return(new n.sessionType({id:Date.now()})).destroy({success:function(){return u.trigger("signedOut")}})}})},n}(n.View)});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("application/views/documenttitle",["require","backbone","../events","form","bootstrap"],function(e){var t,n,r;return t=e("backbone"),r=e("../events"),e("form"),e("bootstrap"),n=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.el="#document-title-dialog",t.prototype.events={show:"onDialogShow",shown:"onDiaglogShown","click button":"onSubmit"},t.prototype.initialize=function(e){return this.context=e.context,this.input=this.$('input[type="text"]'),this.$el.modal({show:!1}),this.listenTo(r,"showNewDocumentTitle",this.onShowNewDocumentTitle)},t.prototype.onShowNewDocumentTitle=function(){return this.input.val(this.context.getNewDocumentTitle()),this.$el.modal("show")},t.prototype.onDialogShow=function(){return this.$el.hideFieldErrors()},t.prototype.onDiaglogShown=function(){return this.$el.putFocus()},t.prototype.onSubmit=function(e){var t,n;return e.preventDefault(),n=this.input.val(),n?(this.context.setCurrentDocumentTitle(n),this.$el.modal("hide"),r.trigger("newDocumentTitleAssigned")):(t={title:["Title is required."]},this.$el.showFieldErrors({errors:t}))},t}(t.View)});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("application/views/documentlistitem",["require","underscore","backbone","./helpers"],function(e){var t,n,r,i;return i=e("underscore"),t=e("backbone"),r=e("./helpers"),n=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.tagName="li",t.prototype.initialize=function(e){return this.template=e.template,this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"remove destroy",this.remove)},t.prototype.render=function(){var e;return e=i(this.model.toJSON()).extend({lastUpdatedInRelativeTime:function(){return r.formatAsRelativeTime(this.updatedAt)},lastUpdatedInHumanizeTime:function(){return r.formatAsHumanizeTime(this.updatedAt)}}),this.$el.html(this.template(e)),this},t.prototype.remove=function(e){var n=this;return e==null&&(e=!0),e?(this.trigger("removing"),this.$el.fadeOut(function(){return t.__super__.remove.apply(n,arguments)}),this):t.__super__.remove.apply(this,arguments)},t}(t.View)});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("application/views/documentlistedititem",["require","jquery","underscore","./documentlistitem"],function(e){var t,n,r,i;return t=e("jquery"),i=e("underscore"),r=e("./documentlistitem"),n=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return __extends(n,e),n.prototype.events={"dblclick .display span":"onEdit",'click [data-command="delete"]':"onDestroy",'keydown input[type="text"]':"onUpdateOrCancel",'blur input[type="text"]':"onCancel"},n.prototype.showDisplay=function(){return this.$(".edit").hide(),this.$(".display").show()},n.prototype.showEdit=function(){return this.$(".display").hide(),this.$(".edit").show().find('input[type="text"]').val(this.model.get("title")).select().focus()},n.prototype.onEdit=function(e){return e.preventDefault(),e.stopPropagation(),this.showEdit()},n.prototype.onCancel=function(e){return e.preventDefault(),e.stopPropagation(),this.showDisplay()},n.prototype.onUpdateOrCancel=function(e){var n;return e.stopPropagation(),e.which===13?(e.preventDefault(),n=t(e.currentTarget).val(),n&&n!==this.model.get("title")&&this.model.save({title:n}),this.showDisplay()):e.which===27?(e.preventDefault(),this.showDisplay()):!0},n.prototype.onDestroy=function(e){var n=this;return e.preventDefault(),e.stopPropagation(),t.confirm({prompt:"Are you sure you want to delete "+("<strong>"+this.model.get("title")+"</strong>?"),ok:function(){return n.model.destroy()}})},n}(r)});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("application/views/documentlist",["require","jquery","underscore","backbone","./documentlistitem","./documentlistedititem"],function(e){var t,n,r,i,s,o;return t=e("jquery"),o=e("underscore"),n=e("backbone"),i=e("./documentlistitem"),r=e("./documentlistedititem"),s=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return __extends(n,e),n.prototype.el="#document-list",n.prototype.itemViewType=i,n.prototype.editItemViewType=r,n.prototype.events={"click .btn-toolbar .btn":"onSort","keydown .list-container":"onNavigate","scroll .list-container":"onScroll","click .list-container li":"onSelect","dblclick .list-container li":"onOpen"},n.prototype.initialize=function(){return this.listContainer=this.$(".list-container"),this.list=this.listContainer.find("> ul"),this.children=[],this.selectedId=void 0,this.itemTemplate=o(this.$("#document-item-template").html()).template(),this.editItemTemplate=o(this.$("#document-edit-item-template").html()).template(),this.listenTo(this.collection,"reset sort",this.render),this.listenTo(this.collection,"add",this.renderItem),this.render()},n.prototype.getSelectedId=function(){return this.selectedId},n.prototype.resetSelection=function(){return this.list.children().removeClass("active"),this.selectedId=void 0},n.prototype.scrollToTop=function(){return this.listContainer.scrollTop(0)},n.prototype.render=function(){var e=this;return this.removeChildren(),this.collection.each(function(t){return e.renderItem(t)}),this},n.prototype.renderItem=function(e){var t,n=this;return t=e.get("editable")?new this.editItemViewType({model:e,template:this.editItemTemplate}):new this.itemViewType({model:e,template:this.itemTemplate}),this.listenTo(t,"removing",function(){var e;return e=o(n.children).indexOf(t),n.stopListening(t,"removing"),n.children.splice(e,1)}),t.render().$el.attr("data-id",e.id).appendTo(this.list),this.children.push(t),t},n.prototype.remove=function(){return this.removeChildren(),n.__super__.remove.apply(this,arguments)},n.prototype.removeChildren=function(){var e,t;t=[];while(e=this.children.pop())this.stopListening(e,"removing"),t.push(e.remove(!1));return t},n.prototype.onSort=function(e){var n,r,i,s=this;n=t(e.currentTarget),r=n.attr("data-sort-attribute"),i=n.attr("data-sort-order");if(r){if(r===this.collection.sortAttribute)return!1;this.collection.sortAttribute=r}else if(i){if(parseInt(i,10)===this.collection.sortOrder)return!1;this.collection.sortOrder=parseInt(i,10)}return this.collection.pageIndex=0,this.collection.fetch({reset:!0,success:function(){return s.scrollToTop()}})},n.prototype.onScroll=function(){return this.collection.pageIndex>=this.collection.pageCount?!1:this.isEndOfScrolling()?(this.collection.pageIndex+=1,this.collection.fetch({update:!0,add:!0,remove:!1})):!1},n.prototype.onNavigate=function(e){var n,r,i;i=e.which;if(i===38||i===40){r=this.list.children("li"),n=r.index(this.list.find("li.active"));if(i===38){if(!n)return!1;n-=1}else if(i===40){if(n>=r.length-1)return!1;n+=1}return t(r.get(n)).trigger("click")}return i===32?(e.preventDefault(),this.list.find("li.active").trigger("dblclick")):!0},n.prototype.onSelect=function(e){return this.triggerEvent(e,"selected")},n.prototype.onOpen=function(e){return this.triggerEvent(e,"opened")},n.prototype.isEndOfScrolling=function(){var e;return e=this.listContainer.get(0),e.scrollTop+e.clientHeight+125>e.scrollHeight},n.prototype.triggerEvent=function(e,n){var r,i;return e.preventDefault(),r=t(e.currentTarget),i=r.attr("data-id"),this.resetSelection(),r.addClass("active"),this.selectedId=i,this.trigger(n)},n}(n.View)});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("application/views/documentbrowser",["require","backbone","./documentlist","../events","bootstrap"],function(e){var t,n,r,i;return t=e("backbone"),r=e("./documentlist"),i=e("../events"),e("bootstrap"),n=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.el="#document-browser-dialog",t.prototype.listViewType=r,t.prototype.events={show:"onDiaglogShow",hidden:"onDialogHidden","click .btn-primary":"onSubmit"},t.prototype.initialize=function(e){return this.list=new this.listViewType({collection:e.context.documents}),this.submitButton=this.$(".btn-primary"),this.$el.modal({show:!1}),this.listenTo(i,"showDocuments",this.onShowDocuments),this.listenTo(this.list,"selected",this.onDocumentSelected),this.listenTo(this.list,"opened",this.onDocumentOpened)},t.prototype.onShowDocuments=function(e){return this.cancel=e.cancel,this.$el.modal("show")},t.prototype.onDiaglogShow=function(){return this.canceled=!0,this.list.scrollToTop(),this.list.resetSelection(),this.submitButton.prop("disabled",!0)},t.prototype.onDialogHidden=function(){return this.canceled?typeof this.cancel=="function"?this.cancel():void 0:!1},t.prototype.onDocumentSelected=function(){return this.submitButton.prop("disabled",!1)},t.prototype.onDocumentOpened=function(){return this.submitButton.trigger("click")},t.prototype.onSubmit=function(e){return e.preventDefault(),this.canceled=!1,this.$el.modal("hide"),i.trigger("documentSelected",{id:this.list.getSelectedId()})},t}(t.View)});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("application/views/exporteddocument",["require","backbone","../events","bootstrap"],function(e){var t,n,r;return t=e("backbone"),r=e("../events"),e("bootstrap"),n=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.el="#exported-document-dialog",t.prototype.events={shown:"onDialogShown",hide:"onDialogHide"},t.prototype.initialize=function(){return this.messageBox=this.$(".alert"),this.image=this.$("img"),this.$el.modal({show:!1}),this.listenTo(r,"documentExported",this.onDocumentExported)},t.prototype.onDocumentExported=function(e){return this.image.prop("src",e.data),this.$el.modal("show")},t.prototype.onDialogShown=function(){return this.messageBox.fadeIn(400)},t.prototype.onDialogHide=function(){return this.messageBox.hide()},t}(t.View)});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("application/models/share",["require","underscore","backbone","./validation"],function(e){var t,n,r,i;return i=e("underscore"),t=e("backbone"),r=e("./validation"),n=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.defaults=function(){return{email:null,canEdit:!1}},t.prototype.validate=function(e){var t;return t={},e.email?r.isValidEmailFormat(e.email)||r.addError(t,"email","Invalid email format."):r.addError(t,"email","Email is required."),i(t).isEmpty()?void 0:t},t}(t.Model)});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("application/models/shares",["require","underscore","backbone","./share"],function(e){var t,n,r,i;return i=e("underscore"),t=e("backbone"),n=e("./share"),r=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return __extends(r,e),r.prototype.model=n,r.prototype.url=function(){return"/api/documents/"+this.documentId+"/shares"},r.prototype.update=function(e){return t.sync("update",this,e)},r.collections={},r.get=function(e,t){var n;return n=r.collections[e],(n!=null?n.length:void 0)?i(function(){return t(n)}).defer():(n=new r,r.set(e,n),n.fetch({success:function(){return t(n)}}))},r.set=function(e,t){return t.documentId=e,r.collections[e]=t},r.remove=function(e){return delete r.collections[e]},r.reset=function(){return r.collections={}},r}(t.Collection)});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("application/views/sharedocument",["require","jquery","underscore","backbone","./helpers","../models/share","../models/shares","../events"],function(e){var t,n,r,i,s,o,u,a;return t=e("jquery"),a=e("underscore"),n=e("backbone"),r=e("./helpers"),i=e("../models/share"),o=e("../models/shares"),u=e("../events"),s=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return __extends(n,e),n.prototype.el="#document-share-dialog",n.prototype.events={shown:"onDialogShown","submit .new-share":"onAdd","submit .share-list .edit-share":"onRemove","click .modal-footer .btn-primary":"onSave"},n.prototype.initialize=function(e){return this.context=e.context,this.container=this.$(".modal-body > .share-list"),this.template=a(this.$("#share-item-template").html()).template(),this.$el.modal({show:!1}),this.listenTo(u,"shareDocument",this.onShare)},n.prototype.render=function(){var e=this;return this.container.empty(),this.collection.each(function(n){return t(e.template(n.toJSON())).appendTo(e.container)}),this},n.prototype.onDialogShown=function(){return this.$el.putFocus()},n.prototype.onAdd=function(e){var n,s;return e.preventDefault(),n=t(e.currentTarget),s=new i,r.subscribeModelInvalidEvent(s,n),s.set(n.serializeFields(),{validate:!0})?(t(this.template(s.toJSON())).hide().prependTo(this.container).fadeIn(),n.resetFields().putFocus()):!1},n.prototype.onRemove=function(e){return e.preventDefault(),t(e.currentTarget).fadeOut(function(){return t(this).remove()})},n.prototype.onSave=function(e){var n,s,o=this;return e.preventDefault(),n=[],this.container.find(".edit-share").each(function(){return n.push({model:new i,form:t(this)})}),s=a(n).chain().map(function(e){return r.subscribeModelInvalidEvent(e.model,e.form),e.model.set(e.form.serializeFields(),{validate:!0})}).all().value(),s?(this.collection.reset({silent:!0}),this.collection.set(a(n).map(function(e){return e.model})),this.collection.update({success:function(){return o.$el.modal("hide")}})):!1},n.prototype.onShare=function(){var e=this;return this.context.isUserSignedIn()?this.context.isCurrentDocumentNew()?u.trigger("showNewDocumentTitle"):this.context.isCurrentDocumentOwned()?o.get(this.context.getCurrentDocumentId(),function(t){return e.collection=t,e.render(),e.$el.modal("show")}):t.showErrorbar("Only document owner can share a document."):u.trigger("showMembership")},n}(n.View)}),define("application/models/sortorder",[],function(){return{ascending:0,descending:1}});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("application/models/document",["require","underscore","backbone","./validation"],function(e){var t,n,r,i;return i=e("underscore"),t=e("backbone"),r=e("./validation"),n=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.urlRoot=function(){return"/api/documents"},t.prototype.defaults=function(){return{title:null,content:null,owned:null,shared:null,editable:null,createdAt:null,updatedAt:null}},t.prototype.validate=function(e){var t;return t={},e.title||r.addError(t,"title","Title is required."),i(t).isEmpty()?void 0:t},t}(t.Model)});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("application/models/documents",["require","jquery","underscore","./sortorder","./document"],function(e){var t,n,r,i,s;return t=e("jquery"),s=e("underscore"),i=e("./sortorder"),n=e("./document"),r=function(e){function r(){r.__super__.constructor.apply(this,arguments),this.resetSorting(),this.resetPaging()}return __extends(r,e),r.prototype.defaultSortAttribute="updatedAt",r.prototype.defaultSortOrder=i.descending,r.prototype.countAttribute="count",r.prototype.resultAttribute="data",r.prototype.defaultPageSize=25,r.prototype.filter=null,r.prototype.model=n,r.prototype.parse=function(e){return this.setCounts(e[this.countAttribute]),e[this.resultAttribute]},r.prototype.url=function(){var e,n;return n={top:this.pageSize},this.pageIndex&&(n.skip=this.pageSize*this.pageIndex),this.sortAttribute&&(e=this.sortAttribute,this.sortOrder===i.ascending?e+=" asc":this.sortOrder===i.descending&&(e+=" desc"),n.orderBy=e),this.filter&&(n.filter=this.filter),"/api/documents?"+t.param(n)},r.prototype.fetchOne=function(e,t){var r,i,o=this;return t=s(t).defaults({success:function(){},error:function(){}}),r=this.get(e),r?s(function(){return t.success(r)}).defer():(r=new n,r.id=e,i=t.success,t.success=function(){return o.add(r),i(r)},r.fetch(t))},r.prototype.setCounts=function(e){return this.totalCount=e,this.pageCount=Math.ceil(e/this.pageSize),this},r.prototype.resetSorting=function(){return this.sortAttribute=this.defaultSortAttribute,this.sortOrder=this.defaultSortOrder},r.prototype.resetPaging=function(){return this.pageSize=this.defaultPageSize,this.pageIndex=0,this.pageCount=0,this.totalCount=0},r}(Backbone.Collection)}),define("application/context",["require","./models/documents"],function(e){var t,n;return n=e("./models/documents"),t=function(){function e(e){this.resetCurrentDocument(),this.documents=new this.documentsType,e.userSignedIn&&(e.documents&&(this.documents.reset(e.documents.data),this.documents.setCounts(e.documents.count)),this.userSignedIn(!1))}return e.prototype.documentsType=n,e.prototype.isUserSignedIn=function(){return this.signedIn},e.prototype.userSignedIn=function(e){e==null&&(e=!0),this.signedIn=!0;if(e)return this.documents.fetch({reset:!0})},e.prototype.userSignedOut=function(){return this.signedIn=!1,this.documents.reset(),this.resetCurrentDocument()},e.prototype.resetCurrentDocument=function(){return this.id=null,this.title=null,this.content=null,this.owned=!0,this.shared=!1,this.editable=!0},e.prototype.setCurrentDocument=function(e,t){var n=this;return this.documents.fetchOne(e,{success:function(e){var r;return r=e.toJSON(),n.id=r.id,n.title=r.title,n.content=r.content,n.owned=r.owned,n.shared=r.shared,n.editable=r.editable,typeof t=="function"?t(e):void 0},error:function(){return n.resetCurrentDocument(),typeof t=="function"?t():void 0}})},e.prototype.getCurrentDocumentId=function(){return this.id},e.prototype.getCurrentDocumentTitle=function(){return this.title||""},e.prototype.setCurrentDocumentTitle=function(e){return this.isCurrentDocumentEditable()?(e||(e=null),this.title=e):!1},e.prototype.getCurrentDocumentContent=function(){return this.content||""},e.prototype.setCurrentDocumentContent=function(e){return this.isCurrentDocumentEditable()?(e||(e=null),this.content=e):!1},e.prototype.isCurrentDocumentNew=function(){return!this.id},e.prototype.isCurrentDocumentEditable=function(){return this.editable},e.prototype.isCurrentDocumentOwned=function(){return this.owned},e.prototype.isCurrentDocumentShared=function(){return this.shared},e.prototype.canShareCurrentDocumentUpdate=function(){return this.isCurrentDocumentShared()&&this.isCurrentDocumentEditable()},e.prototype.saveCurrentDocument=function(e){var t,n,r=this;return this.isCurrentDocumentEditable()?(t={content:this.content},this.isCurrentDocumentNew()?(t.title=this.title,this.documents.create(t,{wait:!0,success:function(t){return r.id=t.id,typeof e=="function"?e():void 0}})):(n=this.documents.get(this.id),n.save(t,{success:function(){return typeof e=="function"?e():void 0}}))):!1},e.prototype.getNewDocumentTitle=function(){var e,t;return t=this.title,t||(e=this.documents.length+1,t="New document "+e),t},e}()});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("application/router",["require","jquery","backbone","./events","flashbar","confirm"],function(e){var t,n,r,i;return t=e("jquery"),n=e("backbone"),i=e("./events"),e("flashbar"),e("confirm"),r=function(e){function r(){var e=this;r.__super__.constructor.apply(this,arguments),this.localHistory=[],this.on("all",function(){var t;return t=n.history.fragment,e.localHistory.length&&e.localHistory[e.localHistory.length-1]===t?!1:e.localHistory.push(t)})}return __extends(r,e),r.prototype.routes={"!/documents/new":"newDocument","!/documents/:id":"openDocument","!/documents":"openDocuments"},r.prototype.initialize=function(e){return this.context=e.context,this.clientUrl=e.clientUrl},r.prototype.newDocument=function(){return this.context.resetCurrentDocument(),i.trigger("documentChanged")},r.prototype.openDocument=function(e){var n=this;return this.ensureSignedIn(function(){return n.context.setCurrentDocument(e,function(r){return r||(t.showErrorbar("Document with id <strong>"+e+"</strong> "+"does not exist."),n.redirecToPrevious()),i.trigger("documentChanged")})})},r.prototype.openDocuments=function(){var e=this;return this.ensureSignedIn(function(){return e.context.resetCurrentDocument(),i.trigger("documentChanged"),i.trigger("showDocuments",{cancel:function(){return e.redirectToPrevious()}})})},r.prototype.ensureSignedIn=function(e){var t=this;return this.context.isUserSignedIn()?e():i.trigger("showMembership",{ok:function(){return t.context.isUserSignedIn()?e():t.redirectToPrevious()},cancel:function(){return t.redirectToPrevious()}})},r.prototype.redirectToPrevious=function(){var e;return this.localHistory.length>1?e=this.localHistory[this.localHistory.length-2]:e=this.clientUrl("documents","new"),this.navigate(e,!0)},r}(n.Router)}),function(e,t){function c(t,r){if(e.isArray(t)){for(var i=t.length-1;i>=0;i--){var s=t[i];e.type(t)!=="object"&&(e.type(s)!=="string"||!n.transports[s])&&(r.log("Invalid transport: "+s+", removing it from the transports list."),t.splice(i,1))}t.length===0&&(r.log("No transports remain within the specified transport array."),t=null)}else if(e.type(t)!=="object"&&!n.transports[t]&&t!=="auto")r.log("Invalid transport: "+t.toString()),t=null;else if(t==="auto"&&n._.ieVersion<=8)return["longPolling"];return t}function h(e){if(e==="http:")return 80;if(e==="https:")return 443}function p(e,t){return t.match(/:\d+$/)?t:t+":"+h(e)}if(typeof e!="function")throw new Error("SignalR: jQuery not found. Please ensure jQuery is referenced before the SignalR.js file.");if(!t.JSON)throw new Error("SignalR: No JSON parser found. Please ensure json2.js is referenced before the SignalR.js file if you need to support clients without native JSON parsing support, e.g. IE<8.");var n,r,i=t.document.readyState==="complete",s=e(t),o={onStart:"onStart",onStarting:"onStarting",onReceived:"onReceived",onError:"onError",onConnectionSlow:"onConnectionSlow",onReconnecting:"onReconnecting",onReconnect:"onReconnect",onStateChanged:"onStateChanged",onDisconnect:"onDisconnect"},u=function(e,n){if(n===!1)return;var r;if(typeof t.console=="undefined")return;r="["+(new Date).toTimeString()+"] SignalR: "+e,t.console.debug?t.console.debug(r):t.console.log&&t.console.log(r)},a=function(t,n,r){return n===t.state?(t.state=r,e(t).triggerHandler(o.onStateChanged,[{oldState:n,newState:r}]),!0):!1},f=function(e){return e.state===n.connectionState.disconnected},l=function(e){var r,i;e._.configuredStopReconnectingTimeout||(i=function(e){e.log("Couldn't reconnect within the configured timeout ("+e.disconnectTimeout+"ms), disconnecting."),e.stop(!1,!1)},e.reconnecting(function(){var e=this;e.state===n.connectionState.reconnecting&&(r=t.setTimeout(function(){i(e)},e.disconnectTimeout))}),e.stateChanged(function(e){e.oldState===n.connectionState.reconnecting&&t.clearTimeout(r)}),e._.configuredStopReconnectingTimeout=!0)};n=function(e,t,r){return new n.fn.init(e,t,r)},n._={defaultContentType:"application/x-www-form-urlencoded; charset=UTF-8",ieVersion:function(){var e,n;return t.navigator.appName==="Microsoft Internet Explorer"&&(n=/MSIE ([0-9]+\.[0-9]+)/.exec(t.navigator.userAgent),n&&(e=t.parseFloat(n[1]))),e}()},n.events=o,n.changeState=a,n.isDisconnecting=f,n.connectionState={connecting:0,connected:1,reconnecting:2,disconnected:4},n.hub={start:function(){throw new Error("SignalR: Error loading hubs. Ensure your hubs reference is correct, e.g. <script src='/signalr/hubs'></script>.")}},s.load(function(){i=!0}),n.fn=n.prototype={init:function(e,t,n){this.url=e,this.qs=t,this._={},typeof n=="boolean"&&(this.logging=n)},isCrossDomain:function(n,r){var i;return n=e.trim(n),n.indexOf("http")!==0?!1:(r=r||t.location,i=t.document.createElement("a"),i.href=n,i.protocol+p(i.protocol,i.host)!==r.protocol+p(r.protocol,r.host))},ajaxDataType:"json",contentType:"application/json; charset=UTF-8",logging:!1,state:n.connectionState.disconnected,keepAliveData:{},reconnectDelay:2e3,disconnectTimeout:3e4,keepAliveWarnAt:2/3,start:function(r,u){var f=this,h={waitForPageLoad:!0,transport:"auto",jsonp:!1},p,d=f._deferral||e.Deferred(),v=t.document.createElement("a");e.type(r)==="function"?u=r:e.type(r)==="object"&&(e.extend(h,r),e.type(h.callback)==="function"&&(u=h.callback)),h.transport=c(h.transport,f);if(!h.transport)throw new Error("SignalR: Invalid transport(s) specified, aborting start.");if(!i&&h.waitForPageLoad===!0)return s.load(function(){f._deferral=d,f.start(r,u)}),d.promise();l(f);if(a(f,n.connectionState.disconnected,n.connectionState.connecting)===!1)return d.resolve(f),d.promise();v.href=f.url,!v.protocol||v.protocol===":"?(f.protocol=t.document.location.protocol,f.host=t.document.location.host,f.baseUrl=f.protocol+"//"+f.host):(f.protocol=v.protocol,f.host=v.host,f.baseUrl=v.protocol+"//"+v.host),f.wsProtocol=f.protocol==="https:"?"wss://":"ws://",h.transport==="auto"&&h.jsonp===!0&&(h.transport="longPolling"),this.isCrossDomain(f.url)&&(f.log("Auto detected cross domain url."),h.transport==="auto"&&(h.transport=["webSockets","longPolling"]),h.jsonp||(h.jsonp=!e.support.cors,h.jsonp&&f.log("Using jsonp because this browser doesn't support CORS")),f.contentType=n._.defaultContentType),f.ajaxDataType=h.jsonp?"jsonp":"json",e(f).bind(o.onStart,function(t,n){e.type(u)==="function"&&u.call(f),d.resolve(f)}),p=function(t,r){r=r||0;if(r>=t.length){f.transport||(e(f).triggerHandler(o.onError,["SignalR: No transport could be initialized successfully. Try specifying a different transport or none at all for auto initialization."]),d.reject("SignalR: No transport could be initialized successfully. Try specifying a different transport or none at all for auto initialization."),f.stop());return}var i=t[r],u=e.type(i)==="object"?i:n.transports[i];if(i.indexOf("_")===0){p(t,r+1);return}u.start(f,function(){u.supportsKeepAlive&&f.keepAliveData.activated&&n.transports._logic.monitorKeepAlive(f),f.transport=u,a(f,n.connectionState.connecting,n.connectionState.connected),e(f).triggerHandler(o.onStart),s.unload(function(){f.stop(!1)})},function(){p(t,r+1)})};var m=f.url+"/negotiate";return m=n.transports._logic.addQs(m,f),f.log("Negotiating with '"+m+"'."),e.ajax({url:m,global:!1,cache:!1,type:"GET",contentType:f.contentType,data:{},dataType:f.ajaxDataType,error:function(t){e(f).triggerHandler(o.onError,[t.responseText]),d.reject("SignalR: Error during negotiation request: "+t.responseText),f.stop()},success:function(t){var r=f.keepAliveData;f.appRelativeUrl=t.Url,f.id=t.ConnectionId,f.token=t.ConnectionToken,f.webSocketServerUrl=t.WebSocketServerUrl,f.disconnectTimeout=t.DisconnectTimeout*1e3,t.KeepAliveTimeout?(r.activated=!0,r.timeout=t.KeepAliveTimeout*1e3,r.timeoutWarning=r.timeout*f.keepAliveWarnAt,r.checkInterval=(r.timeout-r.timeoutWarning)/3):r.activated=!1;if(!t.ProtocolVersion||t.ProtocolVersion!=="1.2"){e(f).triggerHandler(o.onError,["You are using a version of the client that isn't compatible with the server. Client version 1.2, server version "+t.ProtocolVersion+"."]),d.reject("You are using a version of the client that isn't compatible with the server. Client version 1.2, server version "+t.ProtocolVersion+".");return}e(f).triggerHandler(o.onStarting);var i=[],s=[];e.each(n.transports,function(e){if(e==="webSockets"&&!t.TryWebSockets)return!0;s.push(e)}),e.isArray(h.transport)?e.each(h.transport,function(){var t=this;(e.type(t)==="object"||e.type(t)==="string"&&e.inArray(""+t,s)>=0)&&i.push(e.type(t)==="string"?""+t:t)}):e.type(h.transport)==="object"||e.inArray(h.transport,s)>=0?i.push(h.transport):i=s,p(i)}}),d.promise()},starting:function(t){var n=this;return e(n).bind(o.onStarting,function(e,r){t.call(n)}),n},send:function(e){var t=this;if(t.state===n.connectionState.disconnected)throw new Error("SignalR: Connection must be started before data can be sent. Call .start() before .send()");if(t.state===n.connectionState.connecting)throw new Error("SignalR: Connection has not been fully initialized. Use .start().done() or .start().fail() to run logic after the connection has started.");return t.transport.send(t,e),t},received:function(t){var n=this;return e(n).bind(o.onReceived,function(e,r){t.call(n,r)}),n},stateChanged:function(t){var n=this;return e(n).bind(o.onStateChanged,function(e,r){t.call(n,r)}),n},error:function(t){var n=this;return e(n).bind(o.onError,function(e,r){t.call(n,r)}),n},disconnected:function(t){var n=this;return e(n).bind(o.onDisconnect,function(e,r){t.call(n)}),n},connectionSlow:function(t){var n=this;return e(n).bind(o.onConnectionSlow,function(e,r){t.call(n)}),n},reconnecting:function(t){var n=this;return e(n).bind(o.onReconnecting,function(e,r){t.call(n)}),n},reconnected:function(t){var n=this;return e(n).bind(o.onReconnect,function(e,r){t.call(n)}),n},stop:function(t,r){var i=this;if(i.state===n.connectionState.disconnected)return;try{i.transport&&(r!==!1&&i.transport.abort(i,t),i.transport.supportsKeepAlive&&i.keepAliveData.activated&&n.transports._logic.stopMonitoringKeepAlive(i),i.transport.stop(i),i.transport=null),e(i).triggerHandler(o.onDisconnect),delete i.messageId,delete i.groupsToken,delete i.id,delete i._deferral}finally{a(i,i.state,n.connectionState.disconnected)}return i},log:function(e){u(e,this.logging)}},n.fn.init.prototype=n.fn,n.noConflict=function(){return e.connection===n&&(e.connection=r),n},e.connection&&(r=e.connection),e.connection=e.signalR=n}(window.jQuery,window),function(e,t){function s(i){var o=i.keepAliveData,u,a;i.state===n.connectionState.connected&&(u=new Date,u.setTime(u-o.lastKeepAlive),a=u.getTime(),a>=o.timeout?(i.log("Keep alive timed out.  Notifying transport that connection has been lost."),i.transport.lostConnection(i)):a>=o.timeoutWarning?o.userNotified||(i.log("Keep alive has been missed, connection may be dead/slow."),e(i).triggerHandler(r.onConnectionSlow),o.userNotified=!0):o.userNotified=!1),o.monitoring&&t.setTimeout(function(){s(i)},o.checkInterval)}function o(e){return e.state===n.connectionState.connected||e.state===n.connectionState.reconnecting}var n=e.signalR,r=e.signalR.events,i=e.signalR.changeState;n.transports={},n.transports._logic={pingServer:function(t,n){var r=n==="webSockets"?"":t.baseUrl,i=r+t.appRelativeUrl+"/ping",s=e.Deferred();return i=this.addQs(i,t),e.ajax({url:i,global:!1,cache:!1,type:"GET",contentType:t.contentType,data:{},dataType:t.ajaxDataType,success:function(e){e.Response==="pong"?s.resolve():s.reject("SignalR: Invalid ping response when pinging server: "+(e.responseText||e.statusText))},error:function(e){s.reject("SignalR: Error pinging server: "+(e.responseText||e.statusText))}}),s.promise()},addQs:function(t,n){var r=t.indexOf("?")!==-1?"&":"?",i;if(!n.qs)return t;if(typeof n.qs=="object")return t+r+e.param(n.qs);if(typeof n.qs=="string"){i=n.qs.charAt(0);if(i==="?"||i==="&")r="";return t+r+n.qs}throw new Error("Connections query string property must be either a string or object.")},getUrl:function(e,n,r,i){var s=n==="webSockets"?"":e.baseUrl,o=s+e.appRelativeUrl,u="transport="+n+"&connectionToken="+t.encodeURIComponent(e.token);return e.data&&(u+="&connectionData="+t.encodeURIComponent(e.data)),e.groupsToken&&(u+="&groupsToken="+t.encodeURIComponent(e.groupsToken)),r?(i?o+="/poll":o+="/reconnect",e.messageId&&(u+="&messageId="+t.encodeURIComponent(e.messageId))):o+="/connect",o+="?"+u,o=this.addQs(o,e),o+="&tid="+Math.floor(Math.random()*11),o},maximizePersistentResponse:function(e){return{MessageId:e.C,Messages:e.M,Disconnect:typeof e.D!="undefined"?!0:!1,TimedOut:typeof e.T!="undefined"?!0:!1,LongPollDelay:e.L,GroupsToken:e.G}},updateGroups:function(e,t){t&&(e.groupsToken=t)},ajaxSend:function(i,s){var o=i.url+"/send"+"?transport="+i.transport.name+"&connectionToken="+t.encodeURIComponent(i.token);return o=this.addQs(o,i),e.ajax({url:o,global:!1,type:i.ajaxDataType==="jsonp"?"GET":"POST",contentType:n._.defaultContentType,dataType:i.ajaxDataType,data:{data:s},success:function(t){t&&e(i).triggerHandler(r.onReceived,[t])},error:function(t,n){if(n==="abort"||n==="parsererror")return;e(i).triggerHandler(r.onError,[t])}})},ajaxAbort:function(n,r){if(typeof n.transport=="undefined")return;r=typeof r=="undefined"?!0:r;var i=n.url+"/abort"+"?transport="+n.transport.name+"&connectionToken="+t.encodeURIComponent(n.token);i=this.addQs(i,n),e.ajax({url:i,async:r,timeout:1e3,global:!1,type:"POST",contentType:n.contentType,dataType:n.ajaxDataType,data:{}}),n.log("Fired ajax abort async = "+r)},processMessages:function(t,n){var i;if(t.transport){var s=e(t);t.transport.supportsKeepAlive&&t.keepAliveData.activated&&this.updateKeepAlive(t);if(!n)return;i=this.maximizePersistentResponse(n);if(i.Disconnect){t.log("Disconnect command received from server"),t.stop(!1,!1);return}this.updateGroups(t,i.GroupsToken),i.Messages&&e.each(i.Messages,function(e,t){s.triggerHandler(r.onReceived,[t])}),i.MessageId&&(t.messageId=i.MessageId)}},monitorKeepAlive:function(t){var n=t.keepAliveData,i=this;n.monitoring?t.log("Tried to monitor keep alive but it's already being monitored"):(n.monitoring=!0,i.updateKeepAlive(t),t.keepAliveData.reconnectKeepAliveUpdate=function(){i.updateKeepAlive(t)},e(t).bind(r.onReconnect,t.keepAliveData.reconnectKeepAliveUpdate),t.log("Now monitoring keep alive with a warning timeout of "+n.timeoutWarning+" and a connection lost timeout of "+n.timeout),s(t))},stopMonitoringKeepAlive:function(t){var n=t.keepAliveData;n.monitoring&&(n.monitoring=!1,e(t).unbind(r.onReconnect,t.keepAliveData.reconnectKeepAliveUpdate),t.keepAliveData={},t.log("Stopping the monitoring of the keep alive"))},updateKeepAlive:function(e){e.keepAliveData.lastKeepAlive=new Date},ensureReconnectingState:function(t){return i(t,n.connectionState.connected,n.connectionState.reconnecting)===!0&&e(t).triggerHandler(r.onReconnecting),t.state===n.connectionState.reconnecting},clearReconnectTimeout:function(e){e&&e._.reconnectTimeout&&(t.clearTimeout(e._.reconnectTimeout),delete e._.reconnectTimeout)},reconnect:function(e,r){var i=n.transports[r],s=this;o(e)&&!e._.reconnectTimeout&&(e._.reconnectTimeout=t.setTimeout(function(){i.stop(e),s.ensureReconnectingState(e)&&(e.log(r+" reconnecting"),i.start(e))},e.reconnectDelay))},foreverFrame:{count:0,connections:{}}}}(window.jQuery,window),function(e,t){var n=e.signalR,r=e.signalR.events,i=e.signalR.changeState,s=n.transports._logic;n.transports.webSockets={name:"webSockets",supportsKeepAlive:!0,send:function(e,t){e.socket.send(t)},start:function(o,u,a){var f,l=!1,c=this,h=!u,p=e(o);if(!t.WebSocket){a();return}o.socket||(o.webSocketServerUrl?f=o.webSocketServerUrl:f=o.wsProtocol+o.host,f+=s.getUrl(o,this.name,h),o.log("Connecting to websocket endpoint '"+f+"'"),o.socket=new t.WebSocket(f),o.socket.onopen=function(){l=!0,o.log("Websocket opened"),s.clearReconnectTimeout(o),u?u():i(o,n.connectionState.reconnecting,n.connectionState.connected)===!0&&p.triggerHandler(r.onReconnect)},o.socket.onclose=function(t){if(this===o.socket){if(!l){a?a():h&&c.reconnect(o);return}typeof t.wasClean!="undefined"&&t.wasClean===!1?(e(o).triggerHandler(r.onError,[t.reason]),o.log("Unclean disconnect from websocket."+t.reason)):o.log("Websocket closed"),c.reconnect(o)}},o.socket.onmessage=function(n){var i=t.JSON.parse(n.data),u=e(o);i&&(e.isEmptyObject(i)||i.M?s.processMessages(o,i):u.triggerHandler(r.onReceived,[i]))})},reconnect:function(e){s.reconnect(e,this.name)},lostConnection:function(e){this.reconnect(e)},stop:function(e){s.clearReconnectTimeout(e),e.socket!==null&&(e.log("Closing the Websocket"),e.socket.close(),e.socket=null)},abort:function(e){}}}(window.jQuery,window),function(e,t){var n=e.signalR,r=e.signalR.events,i=e.signalR.changeState,s=n.transports._logic;n.transports.serverSentEvents={name:"serverSentEvents",supportsKeepAlive:!0,timeOut:3e3,start:function(o,u,a){var f=this,l=!1,c=e(o),h=!u,p,d;o.eventSource&&(o.log("The connection already has an event source. Stopping it."),o.stop());if(!t.EventSource){a&&(o.log("This browser doesn't support SSE."),a());return}p=s.getUrl(o,this.name,h);try{o.log("Attempting to connect to SSE endpoint '"+p+"'"),o.eventSource=new t.EventSource(p)}catch(v){o.log("EventSource failed trying to connect with error "+v.Message),a?a():(c.triggerHandler(r.onError,[v]),h&&f.reconnect(o));return}d=t.setTimeout(function(){l===!1&&(o.log("EventSource timed out trying to connect"),o.log("EventSource readyState: "+o.eventSource.readyState),h||f.stop(o),h?o.eventSource.readyState!==t.EventSource.CONNECTING&&o.eventSource.readyState!==t.EventSource.OPEN&&f.reconnect(o):a&&a())},f.timeOut),o.eventSource.addEventListener("open",function(e){o.log("EventSource connected"),d&&t.clearTimeout(d),s.clearReconnectTimeout(o),l===!1&&(l=!0,u?u():i(o,n.connectionState.reconnecting,n.connectionState.connected)===!0&&c.triggerHandler(r.onReconnect))},!1),o.eventSource.addEventListener("message",function(e){if(e.data==="initialized")return;s.processMessages(o,t.JSON.parse(e.data))},!1),o.eventSource.addEventListener("error",function(e){if(this===o.eventSource){if(!l){a&&a();return}o.log("EventSource readyState: "+o.eventSource.readyState),e.eventPhase===t.EventSource.CLOSED?(o.log("EventSource reconnecting due to the server connection ending"),f.reconnect(o)):(o.log("EventSource error"),c.triggerHandler(r.onError))}},!1)},reconnect:function(e){s.reconnect(e,this.name)},lostConnection:function(e){this.reconnect(e)},send:function(e,t){s.ajaxSend(e,t)},stop:function(e){s.clearReconnectTimeout(e),e&&e.eventSource&&(e.log("EventSource calling close()"),e.eventSource.close(),e.eventSource=null,delete e.eventSource)},abort:function(e,t){s.ajaxAbort(e,t)}}}(window.jQuery,window),function(e,t){var n=e.signalR,r=e.signalR.events,i=e.signalR.changeState,s=n.transports._logic,o=function(){var r=null,i=1e3,s=0;return{prevent:function(){n._.ieVersion<=8&&(s===0&&(r=t.setInterval(function(){var t=e("<iframe style='position:absolute;top:0;left:0;width:0;height:0;visibility:hidden;' src=''></iframe>");e("body").append(t),t.remove(),t=null},i)),s++)},cancel:function(){s===1&&t.clearInterval(r),s>0&&s--}}}();n.transports.foreverFrame={name:"foreverFrame",supportsKeepAlive:!0,timeOut:3e3,start:function(n,r,i){var u=this,a=s.foreverFrame.count+=1,f,l=e("<iframe data-signalr-connection-id='"+n.id+"' style='position:absolute;top:0;left:0;width:0;height:0;visibility:hidden;' src=''></iframe>");if(t.EventSource){i&&(n.log("This browser supports SSE, skipping Forever Frame."),i());return}o.prevent(),f=s.getUrl(n,this.name),f+="&frameId="+a,e("body").append(l),l.prop("src",f),s.foreverFrame.connections[a]=n,n.log("Binding to iframe's readystatechange event."),l.bind("readystatechange",function(){e.inArray(this.readyState,["loaded","complete"])>=0&&(n.log("Forever frame iframe readyState changed to "+this.readyState+", reconnecting"),u.reconnect(n))}),n.frame=l[0],n.frameId=a,r&&(n.onSuccess=r),t.setTimeout(function(){n.onSuccess&&(n.log("Failed to connect using forever frame source, it timed out after "+u.timeOut+"ms."),u.stop(n),i&&i())},u.timeOut)},reconnect:function(e){var n=this;t.setTimeout(function(){if(e.frame&&s.ensureReconnectingState(e)){var t=e.frame,r=s.getUrl(e,n.name,!0)+"&frameId="+e.frameId;e.log("Updating iframe src to '"+r+"'."),t.src=r}},e.reconnectDelay)},lostConnection:function(e){this.reconnect(e)},send:function(e,t){s.ajaxSend(e,t)},receive:function(t,n){var r;s.processMessages(t,n),t.frameMessageCount=(t.frameMessageCount||0)+1,t.frameMessageCount>50&&(t.frameMessageCount=0,r=t.frame.contentWindow||t.frame.contentDocument,r&&r.document&&e("body",r.document).empty())},stop:function(t){var n=null;o.cancel();if(t.frame){if(t.frame.stop)t.frame.stop();else try{n=t.frame.contentWindow||t.frame.contentDocument,n.document&&n.document.execCommand&&n.document.execCommand("Stop")}catch(r){t.log("SignalR: Error occured when stopping foreverFrame transport. Message = "+r.message)}e(t.frame).remove(),delete s.foreverFrame.connections[t.frameId],t.frame=null,t.frameId=null,delete t.frame,delete t.frameId,t.log("Stopping forever frame")}},abort:function(e,t){s.ajaxAbort(e,t)},getConnection:function(e){return s.foreverFrame.connections[e]},started:function(t){t.onSuccess?(t.onSuccess(),t.onSuccess=null,delete t.onSuccess):i(t,n.connectionState.reconnecting,n.connectionState.connected)===!0&&e(t).triggerHandler(r.onReconnect)}}}(window.jQuery,window),function(e,t){var n=e.signalR,r=e.signalR.events,i=e.signalR.changeState,s=e.signalR.isDisconnecting,o=n.transports._logic;n.transports.longPolling={name:"longPolling",supportsKeepAlive:!1,reconnectDelay:3e3,init:function(e,n){var r=this,i,u=function(n){s(e)===!1&&(e.log("SignalR: Server ping failed because '"+n+"', re-trying ping."),t.setTimeout(i,r.reconnectDelay))};e.log("SignalR: Initializing long polling connection with server."),i=function(){o.pingServer(e,r.name).done(n).fail(u)},i()},start:function(u,a,f){var l=this,c=!1,h=function(){if(c)return;c=!0,a(),u.log("Longpolling connected")},p=0,d=null,v=function(s){t.clearTimeout(d),d=null,i(u,n.connectionState.reconnecting,n.connectionState.connected)===!0&&(u.log("Raising the reconnect event"),e(s).triggerHandler(r.onReconnect))},m=36e5;u.pollXhr&&(u.log("Polling xhr requests already exists, aborting."),u.stop()),l.init(u,function(){u.messageId=null,t.setTimeout(function(){(function i(a,f){var c=a.messageId,g=c===null,y=!g,b=!f,w=o.getUrl(a,l.name,y,b);if(s(a)===!0)return;u.log("Attempting to connect to '"+w+"' using longPolling."),a.pollXhr=e.ajax({url:w,global:!1,cache:!1,type:"GET",dataType:u.ajaxDataType,contentType:u.contentType,success:function(n){var r=0,u;p=0,d!==null&&v(),h(),n&&(u=o.maximizePersistentResponse(n)),o.processMessages(a,n),u&&e.type(u.LongPollDelay)==="number"&&(r=u.LongPollDelay);if(u&&u.Disconnect)return;if(s(a)===!0)return;r>0?t.setTimeout(function(){i(a,!1)},r):i(a,!1)},error:function(s,f){t.clearTimeout(d),d=null;if(f==="abort"){u.log("Aborted xhr requst.");return}p++,u.state!==n.connectionState.reconnecting&&(u.log("An error occurred using longPolling. Status = "+f+". "+s.responseText),e(a).triggerHandler(r.onError,[s.responseText])),o.ensureReconnectingState(a),l.init(a,function(){i(a,!0)})}}),y&&f===!0&&(d=t.setTimeout(function(){v(a)},Math.min(1e3*(Math.pow(2,p)-1),m)))})(u),t.setTimeout(function(){h()},250)},250)})},lostConnection:function(e){throw new Error("Lost Connection not handled for LongPolling")},send:function(e,t){o.ajaxSend(e,t)},stop:function(e){e.pollXhr&&(e.pollXhr.abort(),e.pollXhr=null,delete e.pollXhr)},abort:function(e,t){o.ajaxAbort(e,t)}}}(window.jQuery,window),function(e,t){function s(e){return e+i}function o(e,t,n){var r,i=e.length,s=[];for(r=0;r<i;r+=1)e.hasOwnProperty(r)&&(s[r]=t.call(n,e[r],r,e));return s}function u(t){return e.isFunction(t)?null:e.type(t)==="undefined"?null:t}function a(e){for(var t in e)if(e.hasOwnProperty(t))return!0;return!1}function f(e,t){return new f.fn.init(e,t)}function l(t,n){var r={qs:null,logging:!1,useDefaultPath:!0};e.extend(r,n);if(!t||r.useDefaultPath)t=(t||"")+"/signalr";return new l.fn.init(t,r)}var n=0,r={},i=".hubProxy";f.fn=f.prototype={init:function(e,t){this.state={},this.connection=e,this.hubName=t,this._={callbackMap:{}}},hasSubscriptions:function(){return a(this._.callbackMap)},on:function(t,n){var r=this,i=r._.callbackMap;return t=t.toLowerCase(),i[t]||(i[t]={}),i[t][n]=function(e,t){n.apply(r,t)},e(r).bind(s(t),i[t][n]),r},off:function(t,n){var r=this,i=r._.callbackMap,o;return t=t.toLowerCase(),o=i[t],o&&(o[n]?(e(r).unbind(s(t),o[n]),delete o[n],a(o)||delete i[t]):n||(e(r).unbind(s(t)),delete i[t])),r},invoke:function(i){var s=this,a=e.makeArray(arguments).slice(1),f=o(a,u),l={H:s.hubName,M:i,A:f,I:n},c=e.Deferred(),h=function(t){var n=s._maximizeHubResponse(t);e.extend(s.state,n.State),n.Error?(n.StackTrace&&s.connection.log(n.Error+"\n"+n.StackTrace),c.rejectWith(s,[n.Error])):c.resolveWith(s,[n.Result])};return r[n.toString()]={scope:s,method:h},n+=1,e.isEmptyObject(s.state)||(l.S=s.state),s.connection.send(t.JSON.stringify(l)),c.promise()},_maximizeHubResponse:function(e){return{State:e.S,Result:e.R,Id:e.I,Error:e.E,StackTrace:e.T}}},f.fn.init.prototype=f.fn,l.fn=l.prototype=e.connection(),l.fn.init=function(t,n){var i={qs:null,logging:!1,useDefaultPath:!0},o=this;e.extend(i,n),e.signalR.fn.init.call(o,t,i.qs,i.logging),o.proxies={},o.received(function(t){var n,i,u,a,f,l;if(!t)return;typeof t.I!="undefined"?(u=t.I.toString(),a=r[u],a&&(r[u]=null,delete r[u],a.method.call(a.scope,t))):(n=this._maximizeClientHubInvocation(t),o.log("Triggering client hub event '"+n.Method+"' on hub '"+n.Hub+"'."),f=n.Hub.toLowerCase(),l=n.Method.toLowerCase(),i=this.proxies[f],e.extend(i.state,n.State),e(i).triggerHandler(s(l),[n.Args]))})},l.fn._maximizeClientHubInvocation=function(e){return{Hub:e.H,Method:e.M,Args:e.A,State:e.S}},l.fn._registerSubscribedHubs=function(){this._subscribedToHubs||(this._subscribedToHubs=!0,this.starting(function(){var n=[];e.each(this.proxies,function(e){this.hasSubscriptions()&&n.push({name:e})}),this.data=t.JSON.stringify(n)}))},l.fn.createHubProxy=function(e){e=e.toLowerCase();var t=this.proxies[e];return t||(t=f(this,e),this.proxies[e]=t),this._registerSubscribedHubs(),t},l.fn.init.prototype=l.fn,e.hubConnection=l}(window.jQuery,window),function(e){e.signalR.version="1.1.2"}(window.jQuery),define("signalr",function(){}),function(e,t){function r(t,n){return function(){n.apply(t,e.makeArray(arguments))}}function i(t,n){var i,s,o,u,a;for(i in t)if(t.hasOwnProperty(i)){s=t[i];if(!s.hubName)continue;n?a=s.on:a=s.off;for(o in s.client)if(s.client.hasOwnProperty(o)){u=s.client[o];if(!e.isFunction(u))continue;a.call(s,o,r(s,u))}}}if(typeof e.signalR!="function")throw new Error("SignalR: SignalR is not loaded. Please ensure jquery.signalR-x.js is referenced before ~/signalr/hubs.");var n=e.signalR;e.hubConnection.prototype.createHubProxies=function(){var t={};return this.starting(function(){i(t,!0),this._registerSubscribedHubs()}).disconnected(function(){i(t,!1)}),t.sharingHub=this.createHubProxy("sharingHub"),t.sharingHub.client={},t.sharingHub.server={subscribe:function(n){return t.sharingHub.invoke.apply(t.sharingHub,e.merge(["Subscribe"],e.makeArray(arguments)))},unsubscribe:function(n){return t.sharingHub.invoke.apply(t.sharingHub,e.merge(["Unsubscribe"],e.makeArray(arguments)))},update:function(n,r){return t.sharingHub.invoke.apply(t.sharingHub,e.merge(["Update"],e.makeArray(arguments)))}},t},n.hub=e.hubConnection("/signalr",{useDefaultPath:!1}),e.extend(n,n.hub.createHubProxies())}(window.jQuery,window),define("sharinghubproxy",function(){});var __bind=function(e,t){return function(){return e.apply(t,arguments)}};define("application/sharing",["require","jquery","underscore","backbone","./events","signalr","sharinghubproxy"],function(e){var t,n,r,i,s,o,u;return t=e("jquery"),u=e("underscore"),r=e("backbone"),s=e("./events"),e("signalr"),e("sharinghubproxy"),o=t.connection.sharingHub,n=3e3,i=function(){function e(e){this.onBroadcast=__bind(this.onBroadcast,this),this.onDocumentChanged=__bind(this.onDocumentChanged,this),this.onUnsubscribed=__bind(this.onUnsubscribed,this),this.onUpdated=__bind(this.onUpdated,this),this.onSubscribed=__bind(this.onSubscribed,this),u(this).extend(r.Events),this.context=e.context,o.client.subscribed=this.onSubscribed,o.client.updated=this.onUpdated,o.client.unsubscribed=this.onUnsubscribed}return e.prototype.start=function(){var e=this;return t.connection.hub.start().done(function(){return s.on("documentChanged",e.onDocumentChanged),s.on("broadcastDocumentContentChange",u(e.onBroadcast).debounce(n))})},e.prototype.stop=function(){return s.off("documentChanged"),s.off("broadcastDocumentContentChange")},e.prototype.onSubscribed=function(e,t){return this.trigger("userJoined",{documentId:parseInt(e,10),user:t})},e.prototype.onUpdated=function(e,t,n){return this.trigger("documentUpdated",{documentId:parseInt(e,10),content:t,user:n})},e.prototype.onUnsubscribed=function(e,t){return this.trigger("userLeft",{documentId:parseInt(e,10),user:t})},e.prototype.onDocumentChanged=function(){var e,t=this;e=this.documentId,e&&o.server.unsubscribe(e).done(function(){return t.documentId=void 0});if(this.context.isCurrentDocumentShared())return e=this.context.getCurrentDocumentId(),o.server.subscribe(e).done(function(){return t.documentId=e})},e.prototype.onBroadcast=function(e){return this.context.canShareCurrentDocumentUpdate()?o.server.update(this.context.getCurrentDocumentId(),e.content):!1},e}()}),function(e,t,n){function i(n){r[n]||(r[n]=!0,e.migrateWarnings.push(n),t.console&&console.warn&&!e.migrateMute&&(console.warn("JQMIGRATE: "+n),e.migrateTrace&&console.trace&&console.trace()))}function s(t,n,r,s){if(Object.defineProperty)try{Object.defineProperty(t,n,{configurable:!0,enumerable:!0,get:function(){return i(s),r},set:function(e){i(s),r=e}});return}catch(o){}e._definePropertyBroken=!0,t[n]=r}var r={};e.migrateWarnings=[],!e.migrateMute&&t.console&&console.log&&console.log("JQMIGRATE: Logging is active"),e.migrateTrace===n&&(e.migrateTrace=!0),e.migrateReset=function(){r={},e.migrateWarnings.length=0},document.compatMode==="BackCompat"&&i("jQuery is not compatible with Quirks Mode");var o=e("<input/>",{size:1}).attr("size")&&e.attrFn,u=e.attr,a=e.attrHooks.value&&e.attrHooks.value.get||function(){return null},f=e.attrHooks.value&&e.attrHooks.value.set||function(){return n},l=/^(?:input|button)$/i,c=/^[238]$/,h=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,p=/^(?:checked|selected)$/i;s(e,"attrFn",o||{},"jQuery.attrFn is deprecated"),e.attr=function(t,r,s,a){var f=r.toLowerCase(),d=t&&t.nodeType;if(a){u.length<4&&i("jQuery.fn.attr( props, pass ) is deprecated");if(t&&!c.test(d)&&(o?r in o:e.isFunction(e.fn[r])))return e(t)[r](s)}return r==="type"&&s!==n&&l.test(t.nodeName)&&t.parentNode&&i("Can't change the 'type' of an input or button in IE 6/7/8"),!e.attrHooks[f]&&h.test(f)&&(e.attrHooks[f]={get:function(t,r){var i,s=e.prop(t,r);return s===!0||typeof s!="boolean"&&(i=t.getAttributeNode(r))&&i.nodeValue!==!1?r.toLowerCase():n},set:function(t,n,r){var i;return n===!1?e.removeAttr(t,r):(i=e.propFix[r]||r,i in t&&(t[i]=!0),t.setAttribute(r,r.toLowerCase())),r}},p.test(f)&&i("jQuery.fn.attr('"+f+"') may use property instead of attribute")),u.call(e,t,r,s)},e.attrHooks.value={get:function(e,t){var n=(e.nodeName||"").toLowerCase();return n==="button"?a.apply(this,arguments):(n!=="input"&&n!=="option"&&i("jQuery.fn.attr('value') no longer gets properties"),t in e?e.value:null)},set:function(e,t){var n=(e.nodeName||"").toLowerCase();if(n==="button")return f.apply(this,arguments);n!=="input"&&n!=="option"&&i("jQuery.fn.attr('value', val) no longer sets properties"),e.value=t}};var d,v,m=e.fn.init,g=e.parseJSON,y=/^(?:[^<]*(<[\w\W]+>)[^>]*|#([\w\-]*))$/;e.fn.init=function(t,n,r){var s;if(t&&typeof t=="string"&&!e.isPlainObject(n)&&(s=y.exec(t))&&s[1]){t.charAt(0)!=="<"&&i("$(html) HTML strings must start with '<' character"),n&&n.context&&(n=n.context);if(e.parseHTML)return m.call(this,e.parseHTML(e.trim(t),n,!0),n,r)}return m.apply(this,arguments)},e.fn.init.prototype=e.fn,e.parseJSON=function(e){return!e&&e!==null?(i("jQuery.parseJSON requires a valid JSON string"),null):g.apply(this,arguments)},e.uaMatch=function(e){e=e.toLowerCase();var t=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];return{browser:t[1]||"",version:t[2]||"0"}},e.browser||(d=e.uaMatch(navigator.userAgent),v={},d.browser&&(v[d.browser]=!0,v.version=d.version),v.chrome?v.webkit=!0:v.webkit&&(v.safari=!0),e.browser=v),s(e,"browser",e.browser,"jQuery.browser is deprecated"),e.sub=function(){function t(e,n){return new t.fn.init(e,n)}e.extend(!0,t,this),t.superclass=this,t.fn=t.prototype=this(),t.fn.constructor=t,t.sub=this.sub,t.fn.init=function(i,s){return s&&s instanceof e&&!(s instanceof t)&&(s=t(s)),e.fn.init.call(this,i,s,n)},t.fn.init.prototype=t.fn;var n=t(document);return i("jQuery.sub() is deprecated"),t},e.ajaxSetup({converters:{"text json":e.parseJSON}});var b=e.fn.data;e.fn.data=function(t){var r,s,o=this[0];if(o&&t==="events"&&arguments.length===1){r=e.data(o,t),s=e._data(o,t);if((r===n||r===s)&&s!==n)return i("Use of jQuery.fn.data('events') is deprecated"),s}return b.apply(this,arguments)};var w=/\/(java|ecma)script/i,E=e.fn.andSelf||e.fn.addBack;e.fn.andSelf=function(){return i("jQuery.fn.andSelf() replaced by jQuery.fn.addBack()"),E.apply(this,arguments)},e.clean||(e.clean=function(t,n,r,s){n=n||document,n=!n.nodeType&&n[0]||n,n=n.ownerDocument||n,i("jQuery.clean() is deprecated");var o,u,a,f,l=[];e.merge(l,e.buildFragment(t,n).childNodes);if(r){a=function(e){if(!e.type||w.test(e.type))return s?s.push(e.parentNode?e.parentNode.removeChild(e):e):r.appendChild(e)};for(o=0;(u=l[o])!=null;o++)if(!e.nodeName(u,"script")||!a(u))r.appendChild(u),typeof u.getElementsByTagName!="undefined"&&(f=e.grep(e.merge([],u.getElementsByTagName("script")),a),l.splice.apply(l,[o+1,0].concat(f)),o+=f.length)}return l});var S=e.event.add,x=e.event.remove,T=e.event.trigger,N=e.fn.toggle,C=e.fn.live,k=e.fn.die,L="ajaxStart|ajaxStop|ajaxSend|ajaxComplete|ajaxError|ajaxSuccess",A=new RegExp("\\b(?:"+L+")\\b"),O=/(?:^|\s)hover(\.\S+|)\b/,M=function(t){return typeof t!="string"||e.event.special.hover?t:(O.test(t)&&i("'hover' pseudo-event is deprecated, use 'mouseenter mouseleave'"),t&&t.replace(O,"mouseenter$1 mouseleave$1"))};e.event.props&&e.event.props[0]!=="attrChange"&&e.event.props.unshift("attrChange","attrName","relatedNode","srcElement"),e.event.dispatch&&s(e.event,"handle",e.event.dispatch,"jQuery.event.handle is undocumented and deprecated"),e.event.add=function(e,t,n,r,s){e!==document&&A.test(t)&&i("AJAX events should be attached to document: "+t),S.call(this,e,M(t||""),n,r,s)},e.event.remove=function(e,t,n,r,i){x.call(this,e,M(t)||"",n,r,i)},e.fn.error=function(){var e=Array.prototype.slice.call(arguments,0);return i("jQuery.fn.error() is deprecated"),e.splice(0,0,"error"),arguments.length?this.bind.apply(this,e):(this.triggerHandler.apply(this,e),this)},e.fn.toggle=function(t,n){if(!e.isFunction(t)||!e.isFunction(n))return N.apply(this,arguments);i("jQuery.fn.toggle(handler, handler...) is deprecated");var r=arguments,s=t.guid||e.guid++,o=0,u=function(n){var i=(e._data(this,"lastToggle"+t.guid)||0)%o;return e._data(this,"lastToggle"+t.guid,i+1),n.preventDefault(),r[i].apply(this,arguments)||!1};u.guid=s;while(o<r.length)r[o++].guid=s;return this.click(u)},e.fn.live=function(t,n,r){return i("jQuery.fn.live() is deprecated"),C?C.apply(this,arguments):(e(this.context).on(t,this.selector,n,r),this)},e.fn.die=function(t,n){return i("jQuery.fn.die() is deprecated"),k?k.apply(this,arguments):(e(this.context).off(t,this.selector||"**",n),this)},e.event.trigger=function(e,t,n,r){return!n&&!A.test(e)&&i("Global events are undocumented and deprecated"),T.call(this,e,t,n||document,r)},e.each(L.split("|"),function(t,n){e.event.special[n]={setup:function(){var t=this;return t!==document&&(e.event.add(document,n+"."+e.guid,function(){e.event.trigger(n,null,t,!0)}),e._data(this,n,e.guid++)),!1},teardown:function(){return this!==document&&e.event.remove(document,n+"."+e._data(this,n)),!1}}})}(jQuery,window),define("jquery.migrate",function(){}),function(e,t,n){function i(e){return e}function s(e){return o(decodeURIComponent(e.replace(r," ")))}function o(e){return e.indexOf('"')===0&&(e=e.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\")),e}function u(e){return a.json?JSON.parse(e):e}var r=/\+/g,a=e.cookie=function(r,o,f){if(o!==n){f=e.extend({},a.defaults,f),o===null&&(f.expires=-1);if(typeof f.expires=="number"){var l=f.expires,c=f.expires=new Date;c.setDate(c.getDate()+l)}return o=a.json?JSON.stringify(o):String(o),t.cookie=[encodeURIComponent(r),"=",a.raw?o:encodeURIComponent(o),f.expires?"; expires="+f.expires.toUTCString():"",f.path?"; path="+f.path:"",f.domain?"; domain="+f.domain:"",f.secure?"; secure":""].join("")}var h=a.raw?i:s,p=t.cookie.split("; "),d=r?null:{};for(var v=0,m=p.length;v<m;v++){var g=p[v].split("="),y=h(g.shift()),b=h(g.join("="));if(r&&r===y){d=u(b);break}r||(d[y]=u(b))}return d};a.defaults={},e.removeCookie=function(t,n){return e.cookie(t)!==null?(e.cookie(t,null,n),!0):!1}}(jQuery,document),define("jquery.cookie",function(){}),function(e){var t=0;e.fn.splitter=function(n){return n=n||{},this.each(function(){function i(){return e.browser.msie&&parseInt(e.browser.version)<9}function s(e){b.removeClass(p.barStateClasses).addClass(e)}function o(t){if(t.which!=1)return;b.removeClass(p.barHoverClass),p.outline&&(r=r||b.clone(!1).insertAfter(m),b.removeClass(p.barDockedClass)),s(p.barActiveClass),v.css("-webkit-user-select","none").find("iframe").addClass(p.iframeClass),m._posSplit=m[0][p.pxSplit]-t[p.eventPos],e(document).bind("mousemove"+p.eventNamespace,u).bind("mouseup"+p.eventNamespace,a)}function u(e){var t=m._posSplit+e[p.eventPos],n=Math.max(0,Math.min(t,d._DA-b._DA)),r=Math.max(m._min,d._DA-g._max,Math.min(t,m._max,d._DA-b._DA-g._min));p.outline?(p.dockPane==m&&t<Math.max(m._min,b._DA)||p.dockPane==g&&t>Math.min(t,m._max,d._DA-b._DA-g._min)?b.addClass(p.barDockedClass).css(p.origin,n):b.removeClass(p.barDockedClass).css(p.origin,r),b._DA=b[0][p.pxSplit]):f(t),s(t==r?p.barActiveClass:p.barLimitClass)}function a(t){s(p.barNormalClass),b.addClass(p.barHoverClass);var n=m._posSplit+t[p.eventPos];p.outline&&(r&&r.remove(),r=null,f(n)),v.css("-webkit-user-select","text").find("iframe").removeClass(p.iframeClass),e(document).unbind("mousemove"+p.eventNamespace+" mouseup"+p.eventNamespace)}function f(e){b._DA=b[0][p.pxSplit],p.dockPane==m&&e<Math.max(m._min,b._DA)||p.dockPane==g&&e>Math.min(e,m._max,d._DA-b._DA-g._min)?(b.addClass(p.barDockedClass),b._DA=b[0][p.pxSplit],e=p.dockPane==m?0:d._DA-b._DA,b._pos==null&&(b._pos=m[0][p.pxSplit])):(b.removeClass(p.barDockedClass),b._DA=b[0][p.pxSplit],b._pos=null,e=Math.max(m._min,d._DA-g._max,Math.min(e,m._max,d._DA-b._DA-g._min))),b.css(p.origin,e).css(p.fixed,d._DF),m.css(p.origin,0).css(p.split,e).css(p.fixed,d._DF),g.css(p.origin,e+b._DA).css(p.split,d._DA-b._DA-e).css(p.fixed,d._DF),i()||v.triggerHandler("resize")}function l(e,t){var n=0;for(var r=1;r<arguments.length;r++)n+=Math.max(parseInt(e.css(arguments[r]),10)||0,0);return n}function c(e){d._DF=d[0][p.pxFixed]-d._PBF,d._DA=d[0][p.pxSplit]-d._PBA;if(d._DF<=0||d._DA<=0)return;if(d._oldW==d.width()&&d._oldH==d.height())return;d._oldW=d.width(),d._oldH=d.height(),f(isNaN(e)?!p.sizeRight&&!p.sizeBottom?m[0][p.pxSplit]:d._DA-g[0][p.pxSplit]-b._DA:e),s(p.barNormalClass)}if(e(this).attr("data-splitter-initialized"))return;var r,h=(n.splitHorizontal?"h":n.splitVertical?"v":n.type)||"v",p=e.extend({splitterClass:"splitter ui-widget ui-widget-content",paneClass:"splitter-pane",barClass:"splitter-bar",barNormalClass:"ui-state-default",barHoverClass:"ui-state-hover",barActiveClass:"ui-state-highlight",barLimitClass:"ui-state-error",iframeClass:"splitter-iframe-hide",eventNamespace:".splitter"+ ++t,pxPerKey:8,tabIndex:0,accessKey:""},{v:{keyLeft:39,keyRight:37,cursor:"e-resize",barStateClass:"splitter-bar-vertical",barDockedClass:"splitter-bar-vertical-docked"},h:{keyTop:40,keyBottom:38,cursor:"n-resize",barStateClass:"splitter-bar-horizontal",barDockedClass:"splitter-bar-horizontal-docked"}}[h],n,{v:{type:"v",eventPos:"pageX",origin:"left",split:"width",pxSplit:"offsetWidth",side1:"Left",side2:"Right",fixed:"height",pxFixed:"offsetHeight",side3:"Top",side4:"Bottom"},h:{type:"h",eventPos:"pageY",origin:"top",split:"height",pxSplit:"offsetHeight",side1:"Top",side2:"Bottom",fixed:"width",pxFixed:"offsetWidth",side3:"Left",side4:"Right"}}[h]);p.barStateClasses=[p.barNormalClass,p.barHoverClass,p.barActiveClass,p.barLimitClass].join(" ");var d=e(this).css({position:"relative"}).addClass(p.splitterClass).attr("data-splitter-initialized",!0),v=e(">*",d[0]).addClass(p.paneClass).css({position:"absolute","z-index":"1","-moz-outline-style":"none"}),m=e(v[0]),g=e(v[1]);p.dockPane=p.dock&&(/right|bottom/.test(p.dock)?g:m);var y=e('<a href="javascript:void(0)"></a>').attr({accessKey:p.accessKey,tabIndex:p.tabIndex,title:p.splitbarClass}).bind((e.browser.opera?"click":"focus")+p.eventNamespace,function(){this.focus(),b.addClass(p.barActiveClass)}).bind("keydown"+p.eventNamespace,function(e){var t=e.which||e.keyCode,n=t==p["key"+p.side1]?1:t==p["key"+p.side2]?-1:0;n&&f(m[0][p.pxSplit]+n*p.pxPerKey,!1)}).bind("blur"+p.eventNamespace,function(){b.removeClass(p.barActiveClass)}),b=e("<div></div>").insertAfter(m).addClass(p.barClass).addClass(p.barStateClass).append(y).attr({unselectable:"on"}).css({position:"absolute","user-select":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","z-index":"100"}).bind("mousedown"+p.eventNamespace,o).bind("mouseover"+p.eventNamespace,function(){e(this).addClass(p.barHoverClass)}).bind("mouseout"+p.eventNamespace,function(){e(this).removeClass(p.barHoverClass)});/^(auto|default|)$/.test(b.css("cursor"))&&b.css("cursor",p.cursor),b._DA=b[0][p.pxSplit],d._PBF=l(d,"border"+p.side3+"Width","border"+p.side4+"Width"),d._PBA=l(d,"border"+p.side1+"Width","border"+p.side2+"Width"),m._pane=p.side1,g._pane=p.side2,e.each([m,g],function(){this._splitter_style=this.style,this._min=p["min"+this._pane]||l(this,"min-"+p.split),this._max=p["max"+this._pane]||l(this,"max-"+p.split)||9999,this._init=p["size"+this._pane]===!0?parseInt(e.css(this[0],p.split),10):p["size"+this._pane]});var w=m._init;isNaN(g._init)||(w=d[0][p.pxSplit]-d._PBA-g._init-b._DA),p.cookie&&(e.cookie||alert("jQuery.splitter(): jQuery cookie plugin required"),w=parseInt(e.cookie(p.cookie),10),e(window).bind("unload"+p.eventNamespace,function(){var t=String(b.css(p.origin));e.cookie(p.cookie,t,{expires:p.cookieExpires||365,path:p.cookiePath||document.location.pathname})})),isNaN(w)&&(w=Math.round((d[0][p.pxSplit]-d._PBA-b._DA)/2)),p.anchorToWindow&&(p.resizeTo=window),p.resizeTo?(d._hadjust=l(d,"borderTopWidth","borderBottomWidth","marginBottom"),d._hmin=Math.max(l(d,"minHeight"),20),e(window).bind("resize"+p.eventNamespace,function(){var t=d.offset().top,n=e(p.resizeTo).height();d.css("height",Math.max(n-t-d._hadjust,d._hmin)+"px"),i()||d.triggerHandler("resize")}).triggerHandler("resize"+p.eventNamespace)):p.resizeToWidth&&!i()&&e(window).bind("resize"+p.eventNamespace,function(){c()}),p.dock&&(d.bind("toggleDock"+p.eventNamespace,function(){var e=p.dockPane[0][p.pxSplit];d.triggerHandler(e?"dock":"undock")}).bind("dock"+p.eventNamespace,function(){var e=m[0][p.pxSplit];if(!e)return;b._pos=e;var t={};t[p.origin]=p.dockPane==m?0:d[0][p.pxSplit]-d._PBA-b[0][p.pxSplit],b.animate(t,p.dockSpeed||1,p.dockEasing,function(){b.addClass(p.barDockedClass),f(t[p.origin])})}).bind("undock"+p.eventNamespace,function(){var e=p.dockPane[0][p.pxSplit];if(e)return;var t={};t[p.origin]=b._pos+"px",b.removeClass(p.barDockedClass).animate(t,p.undockSpeed||p.dockSpeed||1,p.undockEasing||p.dockEasing,function(){f(b._pos),b._pos=null})}),p.dockKey&&e('<a title="'+p.splitbarClass+' toggle dock" href="javascript:void(0)"></a>').attr({accessKey:p.dockKey,tabIndex:-1}).appendTo(b).bind(e.browser.opera?"click":"focus",function(){d.triggerHandler("toggleDock"),this.blur()}),b.bind("dblclick",function(){d.triggerHandler("toggleDock")})),d.bind("destroy"+p.eventNamespace,function(){e([window,document]).unbind(p.eventNamespace),b.unbind().remove(),v.removeClass(p.paneClass),d.removeClass(p.splitterClass).add(v).unbind(p.eventNamespace).attr("style",function(e){return this._splitter_style||""}),d=b=y=v=m=g=p=n=null}).bind("resize"+p.eventNamespace,function(e,t){c(t)}).trigger("resize",[w])})}}(jQuery),define("jquery.splitter",function(){}),define("application/layout",["require","jquery","underscore","jquery.splitter"],function(e){var t,n;return t=e("jquery"),n=e("underscore"),e("jquery.splitter"),{init:function(){return t("#content").splitter({type:"v",outline:!0,anchorToWindow:!0,dock:"left",accessKey:"L",cookie:"side-bar"}).on("toggleDock resize",function(){return n(function(){return t(window).trigger("resize")}).defer()}),t("#main").splitter({type:"v",outline:!0,anchorToWindow:!0,accessKey:"M",cookie:"main-content"})}}});var __slice=[].slice;define("application/application",["require","jquery","backbone","toastr","./views/navigation","./views/examplelist","./views/editor","./views/canvas","./views/membership","./views/profile","./views/documenttitle","./views/documentbrowser","./views/exporteddocument","./views/sharedocument","./context","./router","./sharing","./events","./layout","flashbar"],function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k;return t=e("jquery"),n=e("backbone"),k=e("toastr"),c=e("./views/navigation"),a=e("./views/examplelist"),u=e("./views/editor"),r=e("./views/canvas"),l=e("./views/membership"),h=e("./views/profile"),o=e("./views/documenttitle"),s=e("./views/documentbrowser"),f=e("./views/exporteddocument"),d=e("./views/sharedocument"),i=e("./context"),p=e("./router"),v=e("./sharing"),S=e("./events"),T=e("./layout"),e("flashbar"),b="#!/",y=function(){var e,t;return t=1<=arguments.length?__slice.call(arguments,0):[],e=t.join("/"),e.length&&e.indexOf("/")===0&&(e=e.substring(1)),b+e},x=function(){var e;return e=window.location.hash,e.length>b.length?!0:b.indexOf(e)===0?!1:!0},C=null,w=null,N=null,g=function(){return S.on("saveDocument",function(){return w.isUserSignedIn()?w.isCurrentDocumentNew()?S.trigger("showNewDocumentTitle"):w.saveCurrentDocument(function(){return t.showInfobar("Your document is successfully saved.")}):S.trigger("showMembership")}),S.on("newDocumentTitleAssigned",function(){return w.saveCurrentDocument(function(){var e;return t.showInfobar("Your document is successfully saved."),e=y("documents",w.getCurrentDocumentId()),N.navigate(e)})}),S.on("documentSelected",function(e){return N.navigate(y("documents",e.id),!0)}),S.on("myAccount",function(){var e;return e=w.isUserSignedIn()?"showProfile":"showMembership",S.trigger(e)}),S.on("signedIn",function(){return C.start(),w.userSignedIn(),t.showInfobar("You are now signed in.")}),S.on("passwordResetTokenRequested",function(){return t.showInfobar("An email with a password reset link has been sent to your email address. Please open the link to reset your password.")}),S.on("passwordChanged",function(){return t.showInfobar("You have changed your password successfully.")}),S.on("signedUp",function(){return t.showInfobar("Thank you for signing up, an email with a confirmation link has been sent to your email address. Please open the link to activate your account.")}),S.on("signedOut",function(){return C.stop(),w.userSignedOut(),N.navigate(y("documents","new"),!0),t.showInfobar("You are now signed out.")})},E=function(){return m.views={navigation:new c,exampleList:new a,editor:new u({context:w}),canvas:new r({context:w}),membership:new l,profile:new h,documentTitle:new o({context:w}),documentBrowser:new s({context:w}),exportedDocument:new f,shareDocumentView:new d({context:w})}},m={clientUrl:y,start:function(e){return k.options={positionClass:"toast-bottom-right"},T.init(),w=new i(e),C=new v({context:w}),N=new p({context:w,clientUrl:y}),m.context=w,m.sharing=C,m.router=N,C.on("userJoined",function(e){return e.documentId!==w.getCurrentDocumentId()?!1:k.info(""+e.user+" has joined.")}),C.on("documentUpdated",function(e){return e.documentId!==w.getCurrentDocumentId()?!1:(k.info(""+e.user+" has updated the code."),S.trigger("documentContentChanged",{code:e.content}))}),C.on("userLeft",function(e){return e.documentId!==w.getCurrentDocumentId()?!1:k.info(""+e.user+" has left.")}),e.userSignedIn&&C.start(),g(),E(),n.history.start(),x()?!0:N.navigate(y("documents","new"),!0)}},window.app=m,m}),define("main.js",["require","jquery","application/application","preloaded-data"],function(e){var t,n,r;return t=e("jquery"),n=e("application/application"),r=e("preloaded-data"),t(function(){return n.start(r)})});