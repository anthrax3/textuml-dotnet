!function(){var t=this,e=t._,n={},i=Array.prototype,r=Object.prototype,o=Function.prototype,s=i.push,a=i.slice,c=i.concat,l=r.toString,u=r.hasOwnProperty,h=i.forEach,d=i.map,p=i.reduce,f=i.reduceRight,g=i.filter,m=i.every,v=i.some,y=i.indexOf,w=i.lastIndexOf,_=Array.isArray,b=Object.keys,x=o.bind,S=function(t){return t instanceof S?t:this instanceof S?(this._wrapped=t,void 0):new S(t)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=S),exports._=S):t._=S,S.VERSION="1.5.1";var C=S.each=S.forEach=function(t,e,i){if(null!=t)if(h&&t.forEach===h)t.forEach(e,i);else if(t.length===+t.length){for(var r=0,o=t.length;o>r;r++)if(e.call(i,t[r],r,t)===n)return}else for(var s in t)if(S.has(t,s)&&e.call(i,t[s],s,t)===n)return};S.map=S.collect=function(t,e,n){var i=[];return null==t?i:d&&t.map===d?t.map(e,n):(C(t,function(t,r,o){i.push(e.call(n,t,r,o))}),i)};var T="Reduce of empty array with no initial value";S.reduce=S.foldl=S.inject=function(t,e,n,i){var r=arguments.length>2;if(null==t&&(t=[]),p&&t.reduce===p)return i&&(e=S.bind(e,i)),r?t.reduce(e,n):t.reduce(e);if(C(t,function(t,o,s){r?n=e.call(i,n,t,o,s):(n=t,r=!0)}),!r)throw new TypeError(T);return n},S.reduceRight=S.foldr=function(t,e,n,i){var r=arguments.length>2;if(null==t&&(t=[]),f&&t.reduceRight===f)return i&&(e=S.bind(e,i)),r?t.reduceRight(e,n):t.reduceRight(e);var o=t.length;if(o!==+o){var s=S.keys(t);o=s.length}if(C(t,function(a,c,l){c=s?s[--o]:--o,r?n=e.call(i,n,t[c],c,l):(n=t[c],r=!0)}),!r)throw new TypeError(T);return n},S.find=S.detect=function(t,e,n){var i;return k(t,function(t,r,o){return e.call(n,t,r,o)?(i=t,!0):void 0}),i},S.filter=S.select=function(t,e,n){var i=[];return null==t?i:g&&t.filter===g?t.filter(e,n):(C(t,function(t,r,o){e.call(n,t,r,o)&&i.push(t)}),i)},S.reject=function(t,e,n){return S.filter(t,function(t,i,r){return!e.call(n,t,i,r)},n)},S.every=S.all=function(t,e,i){e||(e=S.identity);var r=!0;return null==t?r:m&&t.every===m?t.every(e,i):(C(t,function(t,o,s){return(r=r&&e.call(i,t,o,s))?void 0:n}),!!r)};var k=S.some=S.any=function(t,e,i){e||(e=S.identity);var r=!1;return null==t?r:v&&t.some===v?t.some(e,i):(C(t,function(t,o,s){return r||(r=e.call(i,t,o,s))?n:void 0}),!!r)};S.contains=S.include=function(t,e){return null==t?!1:y&&t.indexOf===y?-1!=t.indexOf(e):k(t,function(t){return t===e})},S.invoke=function(t,e){var n=a.call(arguments,2),i=S.isFunction(e);return S.map(t,function(t){return(i?e:t[e]).apply(t,n)})},S.pluck=function(t,e){return S.map(t,function(t){return t[e]})},S.where=function(t,e,n){return S.isEmpty(e)?n?void 0:[]:S[n?"find":"filter"](t,function(t){for(var n in e)if(e[n]!==t[n])return!1;return!0})},S.findWhere=function(t,e){return S.where(t,e,!0)},S.max=function(t,e,n){if(!e&&S.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.max.apply(Math,t);if(!e&&S.isEmpty(t))return-1/0;var i={computed:-1/0,value:-1/0};return C(t,function(t,r,o){var s=e?e.call(n,t,r,o):t;s>i.computed&&(i={value:t,computed:s})}),i.value},S.min=function(t,e,n){if(!e&&S.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.min.apply(Math,t);if(!e&&S.isEmpty(t))return 1/0;var i={computed:1/0,value:1/0};return C(t,function(t,r,o){var s=e?e.call(n,t,r,o):t;s<i.computed&&(i={value:t,computed:s})}),i.value},S.shuffle=function(t){var e,n=0,i=[];return C(t,function(t){e=S.random(n++),i[n-1]=i[e],i[e]=t}),i};var P=function(t){return S.isFunction(t)?t:function(e){return e[t]}};S.sortBy=function(t,e,n){var i=P(e);return S.pluck(S.map(t,function(t,e,r){return{value:t,index:e,criteria:i.call(n,t,e,r)}}).sort(function(t,e){var n=t.criteria,i=e.criteria;if(n!==i){if(n>i||void 0===n)return 1;if(i>n||void 0===i)return-1}return t.index<e.index?-1:1}),"value")};var D=function(t,e,n,i){var r={},o=P(null==e?S.identity:e);return C(t,function(e,s){var a=o.call(n,e,s,t);i(r,a,e)}),r};S.groupBy=function(t,e,n){return D(t,e,n,function(t,e,n){(S.has(t,e)?t[e]:t[e]=[]).push(n)})},S.countBy=function(t,e,n){return D(t,e,n,function(t,e){S.has(t,e)||(t[e]=0),t[e]++})},S.sortedIndex=function(t,e,n,i){n=null==n?S.identity:P(n);for(var r=n.call(i,e),o=0,s=t.length;s>o;){var a=o+s>>>1;n.call(i,t[a])<r?o=a+1:s=a}return o},S.toArray=function(t){return t?S.isArray(t)?a.call(t):t.length===+t.length?S.map(t,S.identity):S.values(t):[]},S.size=function(t){return null==t?0:t.length===+t.length?t.length:S.keys(t).length},S.first=S.head=S.take=function(t,e,n){return null==t?void 0:null==e||n?t[0]:a.call(t,0,e)},S.initial=function(t,e,n){return a.call(t,0,t.length-(null==e||n?1:e))},S.last=function(t,e,n){return null==t?void 0:null==e||n?t[t.length-1]:a.call(t,Math.max(t.length-e,0))},S.rest=S.tail=S.drop=function(t,e,n){return a.call(t,null==e||n?1:e)},S.compact=function(t){return S.filter(t,S.identity)};var L=function(t,e,n){return e&&S.every(t,S.isArray)?c.apply(n,t):(C(t,function(t){S.isArray(t)||S.isArguments(t)?e?s.apply(n,t):L(t,e,n):n.push(t)}),n)};S.flatten=function(t,e){return L(t,e,[])},S.without=function(t){return S.difference(t,a.call(arguments,1))},S.uniq=S.unique=function(t,e,n,i){S.isFunction(e)&&(i=n,n=e,e=!1);var r=n?S.map(t,n,i):t,o=[],s=[];return C(r,function(n,i){(e?i&&s[s.length-1]===n:S.contains(s,n))||(s.push(n),o.push(t[i]))}),o},S.union=function(){return S.uniq(S.flatten(arguments,!0))},S.intersection=function(t){var e=a.call(arguments,1);return S.filter(S.uniq(t),function(t){return S.every(e,function(e){return S.indexOf(e,t)>=0})})},S.difference=function(t){var e=c.apply(i,a.call(arguments,1));return S.filter(t,function(t){return!S.contains(e,t)})},S.zip=function(){for(var t=S.max(S.pluck(arguments,"length").concat(0)),e=new Array(t),n=0;t>n;n++)e[n]=S.pluck(arguments,""+n);return e},S.object=function(t,e){if(null==t)return{};for(var n={},i=0,r=t.length;r>i;i++)e?n[t[i]]=e[i]:n[t[i][0]]=t[i][1];return n},S.indexOf=function(t,e,n){if(null==t)return-1;var i=0,r=t.length;if(n){if("number"!=typeof n)return i=S.sortedIndex(t,e),t[i]===e?i:-1;i=0>n?Math.max(0,r+n):n}if(y&&t.indexOf===y)return t.indexOf(e,n);for(;r>i;i++)if(t[i]===e)return i;return-1},S.lastIndexOf=function(t,e,n){if(null==t)return-1;var i=null!=n;if(w&&t.lastIndexOf===w)return i?t.lastIndexOf(e,n):t.lastIndexOf(e);for(var r=i?n:t.length;r--;)if(t[r]===e)return r;return-1},S.range=function(t,e,n){arguments.length<=1&&(e=t||0,t=0),n=arguments[2]||1;for(var i=Math.max(Math.ceil((e-t)/n),0),r=0,o=new Array(i);i>r;)o[r++]=t,t+=n;return o};var K=function(){};S.bind=function(t,e){var n,i;if(x&&t.bind===x)return x.apply(t,a.call(arguments,1));if(!S.isFunction(t))throw new TypeError;return n=a.call(arguments,2),i=function(){if(!(this instanceof i))return t.apply(e,n.concat(a.call(arguments)));K.prototype=t.prototype;var r=new K;K.prototype=null;var o=t.apply(r,n.concat(a.call(arguments)));return Object(o)===o?o:r}},S.partial=function(t){var e=a.call(arguments,1);return function(){return t.apply(this,e.concat(a.call(arguments)))}},S.bindAll=function(t){var e=a.call(arguments,1);if(0===e.length)throw new Error("bindAll must be passed function names");return C(e,function(e){t[e]=S.bind(t[e],t)}),t},S.memoize=function(t,e){var n={};return e||(e=S.identity),function(){var i=e.apply(this,arguments);return S.has(n,i)?n[i]:n[i]=t.apply(this,arguments)}},S.delay=function(t,e){var n=a.call(arguments,2);return setTimeout(function(){return t.apply(null,n)},e)},S.defer=function(t){return S.delay.apply(S,[t,1].concat(a.call(arguments,1)))},S.throttle=function(t,e,n){var i,r,o,s=null,a=0;n||(n={});var c=function(){a=n.leading===!1?0:new Date,s=null,o=t.apply(i,r)};return function(){var l=new Date;a||n.leading!==!1||(a=l);var u=e-(l-a);return i=this,r=arguments,0>=u?(clearTimeout(s),s=null,a=l,o=t.apply(i,r)):s||n.trailing===!1||(s=setTimeout(c,u)),o}},S.debounce=function(t,e,n){var i,r=null;return function(){var o=this,s=arguments,a=function(){r=null,n||(i=t.apply(o,s))},c=n&&!r;return clearTimeout(r),r=setTimeout(a,e),c&&(i=t.apply(o,s)),i}},S.once=function(t){var e,n=!1;return function(){return n?e:(n=!0,e=t.apply(this,arguments),t=null,e)}},S.wrap=function(t,e){return function(){var n=[t];return s.apply(n,arguments),e.apply(this,n)}},S.compose=function(){var t=arguments;return function(){for(var e=arguments,n=t.length-1;n>=0;n--)e=[t[n].apply(this,e)];return e[0]}},S.after=function(t,e){return function(){return--t<1?e.apply(this,arguments):void 0}},S.keys=b||function(t){if(t!==Object(t))throw new TypeError("Invalid object");var e=[];for(var n in t)S.has(t,n)&&e.push(n);return e},S.values=function(t){var e=[];for(var n in t)S.has(t,n)&&e.push(t[n]);return e},S.pairs=function(t){var e=[];for(var n in t)S.has(t,n)&&e.push([n,t[n]]);return e},S.invert=function(t){var e={};for(var n in t)S.has(t,n)&&(e[t[n]]=n);return e},S.functions=S.methods=function(t){var e=[];for(var n in t)S.isFunction(t[n])&&e.push(n);return e.sort()},S.extend=function(t){return C(a.call(arguments,1),function(e){if(e)for(var n in e)t[n]=e[n]}),t},S.pick=function(t){var e={},n=c.apply(i,a.call(arguments,1));return C(n,function(n){n in t&&(e[n]=t[n])}),e},S.omit=function(t){var e={},n=c.apply(i,a.call(arguments,1));for(var r in t)S.contains(n,r)||(e[r]=t[r]);return e},S.defaults=function(t){return C(a.call(arguments,1),function(e){if(e)for(var n in e)void 0===t[n]&&(t[n]=e[n])}),t},S.clone=function(t){return S.isObject(t)?S.isArray(t)?t.slice():S.extend({},t):t},S.tap=function(t,e){return e(t),t};var A=function(t,e,n,i){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return t===e;t instanceof S&&(t=t._wrapped),e instanceof S&&(e=e._wrapped);var r=l.call(t);if(r!=l.call(e))return!1;switch(r){case"[object String]":return t==String(e);case"[object Number]":return t!=+t?e!=+e:0==t?1/t==1/e:t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object RegExp]":return t.source==e.source&&t.global==e.global&&t.multiline==e.multiline&&t.ignoreCase==e.ignoreCase}if("object"!=typeof t||"object"!=typeof e)return!1;for(var o=n.length;o--;)if(n[o]==t)return i[o]==e;var s=t.constructor,a=e.constructor;if(s!==a&&!(S.isFunction(s)&&s instanceof s&&S.isFunction(a)&&a instanceof a))return!1;n.push(t),i.push(e);var c=0,u=!0;if("[object Array]"==r){if(c=t.length,u=c==e.length)for(;c--&&(u=A(t[c],e[c],n,i)););}else{for(var h in t)if(S.has(t,h)&&(c++,!(u=S.has(e,h)&&A(t[h],e[h],n,i))))break;if(u){for(h in e)if(S.has(e,h)&&!c--)break;u=!c}}return n.pop(),i.pop(),u};S.isEqual=function(t,e){return A(t,e,[],[])},S.isEmpty=function(t){if(null==t)return!0;if(S.isArray(t)||S.isString(t))return 0===t.length;for(var e in t)if(S.has(t,e))return!1;return!0},S.isElement=function(t){return!(!t||1!==t.nodeType)},S.isArray=_||function(t){return"[object Array]"==l.call(t)},S.isObject=function(t){return t===Object(t)},C(["Arguments","Function","String","Number","Date","RegExp"],function(t){S["is"+t]=function(e){return l.call(e)=="[object "+t+"]"}}),S.isArguments(arguments)||(S.isArguments=function(t){return!(!t||!S.has(t,"callee"))}),"function"!=typeof/./&&(S.isFunction=function(t){return"function"==typeof t}),S.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},S.isNaN=function(t){return S.isNumber(t)&&t!=+t},S.isBoolean=function(t){return t===!0||t===!1||"[object Boolean]"==l.call(t)},S.isNull=function(t){return null===t},S.isUndefined=function(t){return void 0===t},S.has=function(t,e){return u.call(t,e)},S.noConflict=function(){return t._=e,this},S.identity=function(t){return t},S.times=function(t,e,n){for(var i=Array(Math.max(0,t)),r=0;t>r;r++)i[r]=e.call(n,r);return i},S.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))};var M={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};M.unescape=S.invert(M.escape);var E={escape:new RegExp("["+S.keys(M.escape).join("")+"]","g"),unescape:new RegExp("("+S.keys(M.unescape).join("|")+")","g")};S.each(["escape","unescape"],function(t){S[t]=function(e){return null==e?"":(""+e).replace(E[t],function(e){return M[t][e]})}}),S.result=function(t,e){if(null==t)return void 0;var n=t[e];return S.isFunction(n)?n.call(t):n},S.mixin=function(t){C(S.functions(t),function(e){var n=S[e]=t[e];S.prototype[e]=function(){var t=[this._wrapped];return s.apply(t,arguments),R.call(this,n.apply(S,t))}})};var N=0;S.uniqueId=function(t){var e=++N+"";return t?t+e:e},S.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var O=/(.)^/,I={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},F=/\\|'|\r|\n|\t|\u2028|\u2029/g;S.template=function(t,e,n){var i;n=S.defaults({},n,S.templateSettings);var r=new RegExp([(n.escape||O).source,(n.interpolate||O).source,(n.evaluate||O).source].join("|")+"|$","g"),o=0,s="__p+='";t.replace(r,function(e,n,i,r,a){return s+=t.slice(o,a).replace(F,function(t){return"\\"+I[t]}),n&&(s+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),i&&(s+="'+\n((__t=("+i+"))==null?'':__t)+\n'"),r&&(s+="';\n"+r+"\n__p+='"),o=a+e.length,e}),s+="';\n",n.variable||(s="with(obj||{}){\n"+s+"}\n"),s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{i=new Function(n.variable||"obj","_",s)}catch(a){throw a.source=s,a}if(e)return i(e,S);var c=function(t){return i.call(this,t,S)};return c.source="function("+(n.variable||"obj")+"){\n"+s+"}",c},S.chain=function(t){return S(t).chain()};var R=function(t){return this._chain?S(t).chain():t};S.mixin(S),C(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=i[t];S.prototype[t]=function(){var n=this._wrapped;return e.apply(n,arguments),"shift"!=t&&"splice"!=t||0!==n.length||delete n[0],R.call(this,n)}}),C(["concat","join","slice"],function(t){var e=i[t];S.prototype[t]=function(){return R.call(this,e.apply(this._wrapped,arguments))}}),S.extend(S.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}.call(this),define("underscore",function(t){return function(){var e;return e||t._}}(this)),function(){var t,e=this,n=e.Backbone,i=[],r=i.push,o=i.slice,s=i.splice;t="undefined"!=typeof exports?exports:e.Backbone={},t.VERSION="1.0.0";var a=e._;a||"undefined"==typeof require||(a=require("underscore")),t.$=e.jQuery||e.Zepto||e.ender||e.$,t.noConflict=function(){return e.Backbone=n,this},t.emulateHTTP=!1,t.emulateJSON=!1;var c=t.Events={on:function(t,e,n){if(!u(this,"on",t,[e,n])||!e)return this;this._events||(this._events={});var i=this._events[t]||(this._events[t]=[]);return i.push({callback:e,context:n,ctx:n||this}),this},once:function(t,e,n){if(!u(this,"once",t,[e,n])||!e)return this;var i=this,r=a.once(function(){i.off(t,r),e.apply(this,arguments)});return r._callback=e,this.on(t,r,n)},off:function(t,e,n){var i,r,o,s,c,l,h,d;if(!this._events||!u(this,"off",t,[e,n]))return this;if(!t&&!e&&!n)return this._events={},this;for(s=t?[t]:a.keys(this._events),c=0,l=s.length;l>c;c++)if(t=s[c],o=this._events[t]){if(this._events[t]=i=[],e||n)for(h=0,d=o.length;d>h;h++)r=o[h],(e&&e!==r.callback&&e!==r.callback._callback||n&&n!==r.context)&&i.push(r);i.length||delete this._events[t]}return this},trigger:function(t){if(!this._events)return this;var e=o.call(arguments,1);if(!u(this,"trigger",t,e))return this;var n=this._events[t],i=this._events.all;return n&&h(n,e),i&&h(i,arguments),this},stopListening:function(t,e,n){var i=this._listeners;if(!i)return this;var r=!e&&!n;"object"==typeof e&&(n=this),t&&((i={})[t._listenerId]=t);for(var o in i)i[o].off(e,n,this),r&&delete this._listeners[o];return this}},l=/\s+/,u=function(t,e,n,i){if(!n)return!0;if("object"==typeof n){for(var r in n)t[e].apply(t,[r,n[r]].concat(i));return!1}if(l.test(n)){for(var o=n.split(l),s=0,a=o.length;a>s;s++)t[e].apply(t,[o[s]].concat(i));return!1}return!0},h=function(t,e){var n,i=-1,r=t.length,o=e[0],s=e[1],a=e[2];switch(e.length){case 0:for(;++i<r;)(n=t[i]).callback.call(n.ctx);return;case 1:for(;++i<r;)(n=t[i]).callback.call(n.ctx,o);return;case 2:for(;++i<r;)(n=t[i]).callback.call(n.ctx,o,s);return;case 3:for(;++i<r;)(n=t[i]).callback.call(n.ctx,o,s,a);return;default:for(;++i<r;)(n=t[i]).callback.apply(n.ctx,e)}},d={listenTo:"on",listenToOnce:"once"};a.each(d,function(t,e){c[e]=function(e,n,i){var r=this._listeners||(this._listeners={}),o=e._listenerId||(e._listenerId=a.uniqueId("l"));return r[o]=e,"object"==typeof n&&(i=this),e[t](n,i,this),this}}),c.bind=c.on,c.unbind=c.off,a.extend(t,c);var p=t.Model=function(t,e){var n,i=t||{};e||(e={}),this.cid=a.uniqueId("c"),this.attributes={},a.extend(this,a.pick(e,f)),e.parse&&(i=this.parse(i,e)||{}),(n=a.result(this,"defaults"))&&(i=a.defaults({},i,n)),this.set(i,e),this.changed={},this.initialize.apply(this,arguments)},f=["url","urlRoot","collection"];a.extend(p.prototype,c,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(){return a.clone(this.attributes)},sync:function(){return t.sync.apply(this,arguments)},get:function(t){return this.attributes[t]},escape:function(t){return a.escape(this.get(t))},has:function(t){return null!=this.get(t)},set:function(t,e,n){var i,r,o,s,c,l,u,h;if(null==t)return this;if("object"==typeof t?(r=t,n=e):(r={})[t]=e,n||(n={}),!this._validate(r,n))return!1;o=n.unset,c=n.silent,s=[],l=this._changing,this._changing=!0,l||(this._previousAttributes=a.clone(this.attributes),this.changed={}),h=this.attributes,u=this._previousAttributes,this.idAttribute in r&&(this.id=r[this.idAttribute]);for(i in r)e=r[i],a.isEqual(h[i],e)||s.push(i),a.isEqual(u[i],e)?delete this.changed[i]:this.changed[i]=e,o?delete h[i]:h[i]=e;if(!c){s.length&&(this._pending=!0);for(var d=0,p=s.length;p>d;d++)this.trigger("change:"+s[d],this,h[s[d]],n)}if(l)return this;if(!c)for(;this._pending;)this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(t,e){return this.set(t,void 0,a.extend({},e,{unset:!0}))},clear:function(t){var e={};for(var n in this.attributes)e[n]=void 0;return this.set(e,a.extend({},t,{unset:!0}))},hasChanged:function(t){return null==t?!a.isEmpty(this.changed):a.has(this.changed,t)},changedAttributes:function(t){if(!t)return this.hasChanged()?a.clone(this.changed):!1;var e,n=!1,i=this._changing?this._previousAttributes:this.attributes;for(var r in t)a.isEqual(i[r],e=t[r])||((n||(n={}))[r]=e);return n},previous:function(t){return null!=t&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return a.clone(this._previousAttributes)},fetch:function(t){t=t?a.clone(t):{},void 0===t.parse&&(t.parse=!0);var e=this,n=t.success;return t.success=function(i){return e.set(e.parse(i,t),t)?(n&&n(e,i,t),e.trigger("sync",e,i,t),void 0):!1},F(this,t),this.sync("read",this,t)},save:function(t,e,n){var i,r,o,s=this.attributes;if(null==t||"object"==typeof t?(i=t,n=e):(i={})[t]=e,!(!i||n&&n.wait||this.set(i,n)))return!1;if(n=a.extend({validate:!0},n),!this._validate(i,n))return!1;i&&n.wait&&(this.attributes=a.extend({},s,i)),void 0===n.parse&&(n.parse=!0);var c=this,l=n.success;return n.success=function(t){c.attributes=s;var e=c.parse(t,n);return n.wait&&(e=a.extend(i||{},e)),a.isObject(e)&&!c.set(e,n)?!1:(l&&l(c,t,n),c.trigger("sync",c,t,n),void 0)},F(this,n),r=this.isNew()?"create":n.patch?"patch":"update","patch"===r&&(n.attrs=i),o=this.sync(r,this,n),i&&n.wait&&(this.attributes=s),o},destroy:function(t){t=t?a.clone(t):{};var e=this,n=t.success,i=function(){e.trigger("destroy",e,e.collection,t)};if(t.success=function(r){(t.wait||e.isNew())&&i(),n&&n(e,r,t),e.isNew()||e.trigger("sync",e,r,t)},this.isNew())return t.success(),!1;F(this,t);var r=this.sync("delete",this,t);return t.wait||i(),r},url:function(){var t=a.result(this,"urlRoot")||a.result(this.collection,"url")||I();return this.isNew()?t:t+("/"===t.charAt(t.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(t){return t},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},isValid:function(t){return this._validate({},a.extend(t||{},{validate:!0}))},_validate:function(t,e){if(!e.validate||!this.validate)return!0;t=a.extend({},this.attributes,t);var n=this.validationError=this.validate(t,e)||null;return n?(this.trigger("invalid",this,n,a.extend(e||{},{validationError:n})),!1):!0}});var g=["keys","values","pairs","invert","pick","omit"];a.each(g,function(t){p.prototype[t]=function(){var e=o.call(arguments);return e.unshift(this.attributes),a[t].apply(a,e)}});var m=t.Collection=function(t,e){e||(e={}),e.url&&(this.url=e.url),e.model&&(this.model=e.model),void 0!==e.comparator&&(this.comparator=e.comparator),this._reset(),this.initialize.apply(this,arguments),t&&this.reset(t,a.extend({silent:!0},e))},v={add:!0,remove:!0,merge:!0},y={add:!0,merge:!1,remove:!1};a.extend(m.prototype,c,{model:p,initialize:function(){},toJSON:function(t){return this.map(function(e){return e.toJSON(t)})},sync:function(){return t.sync.apply(this,arguments)},add:function(t,e){return this.set(t,a.defaults(e||{},y))},remove:function(t,e){t=a.isArray(t)?t.slice():[t],e||(e={});var n,i,r,o;for(n=0,i=t.length;i>n;n++)o=this.get(t[n]),o&&(delete this._byId[o.id],delete this._byId[o.cid],r=this.indexOf(o),this.models.splice(r,1),this.length--,e.silent||(e.index=r,o.trigger("remove",o,this,e)),this._removeReference(o));return this},set:function(t,e){e=a.defaults(e||{},v),e.parse&&(t=this.parse(t,e)),a.isArray(t)||(t=t?[t]:[]);var n,i,o,c,l,u=e.at,h=this.comparator&&null==u&&e.sort!==!1,d=a.isString(this.comparator)?this.comparator:null,p=[],f=[],g={};for(n=0,i=t.length;i>n;n++)(o=this._prepareModel(t[n],e))&&((c=this.get(o))?(e.remove&&(g[c.cid]=!0),e.merge&&(c.set(o.attributes,e),h&&!l&&c.hasChanged(d)&&(l=!0))):e.add&&(p.push(o),o.on("all",this._onModelEvent,this),this._byId[o.cid]=o,null!=o.id&&(this._byId[o.id]=o)));if(e.remove){for(n=0,i=this.length;i>n;++n)g[(o=this.models[n]).cid]||f.push(o);f.length&&this.remove(f,e)}if(p.length&&(h&&(l=!0),this.length+=p.length,null!=u?s.apply(this.models,[u,0].concat(p)):r.apply(this.models,p)),l&&this.sort({silent:!0}),e.silent)return this;for(n=0,i=p.length;i>n;n++)(o=p[n]).trigger("add",o,this,e);return l&&this.trigger("sort",this,e),this},reset:function(t,e){e||(e={});for(var n=0,i=this.models.length;i>n;n++)this._removeReference(this.models[n]);return e.previousModels=this.models,this._reset(),this.add(t,a.extend({silent:!0},e)),e.silent||this.trigger("reset",this,e),this},push:function(t,e){return t=this._prepareModel(t,e),this.add(t,a.extend({at:this.length},e)),t},pop:function(t){var e=this.at(this.length-1);return this.remove(e,t),e},unshift:function(t,e){return t=this._prepareModel(t,e),this.add(t,a.extend({at:0},e)),t},shift:function(t){var e=this.at(0);return this.remove(e,t),e},slice:function(t,e){return this.models.slice(t,e)},get:function(t){return null==t?void 0:this._byId[null!=t.id?t.id:t.cid||t]},at:function(t){return this.models[t]},where:function(t,e){return a.isEmpty(t)?e?void 0:[]:this[e?"find":"filter"](function(e){for(var n in t)if(t[n]!==e.get(n))return!1;return!0})},findWhere:function(t){return this.where(t,!0)},sort:function(t){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return t||(t={}),a.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(a.bind(this.comparator,this)),t.silent||this.trigger("sort",this,t),this},sortedIndex:function(t,e,n){e||(e=this.comparator);var i=a.isFunction(e)?e:function(t){return t.get(e)};return a.sortedIndex(this.models,t,i,n)},pluck:function(t){return a.invoke(this.models,"get",t)},fetch:function(t){t=t?a.clone(t):{},void 0===t.parse&&(t.parse=!0);var e=t.success,n=this;return t.success=function(i){var r=t.reset?"reset":"set";n[r](i,t),e&&e(n,i,t),n.trigger("sync",n,i,t)},F(this,t),this.sync("read",this,t)},create:function(t,e){if(e=e?a.clone(e):{},!(t=this._prepareModel(t,e)))return!1;e.wait||this.add(t,e);var n=this,i=e.success;return e.success=function(r){e.wait&&n.add(t,e),i&&i(t,r,e)},t.save(null,e),t},parse:function(t){return t},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(t,e){if(t instanceof p)return t.collection||(t.collection=this),t;e||(e={}),e.collection=this;var n=new this.model(t,e);return n._validate(t,e)?n:(this.trigger("invalid",this,t,e),!1)},_removeReference:function(t){this===t.collection&&delete t.collection,t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,n,i){("add"!==t&&"remove"!==t||n===this)&&("destroy"===t&&this.remove(e,i),e&&t==="change:"+e.idAttribute&&(delete this._byId[e.previous(e.idAttribute)],null!=e.id&&(this._byId[e.id]=e)),this.trigger.apply(this,arguments))}});var w=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","indexOf","shuffle","lastIndexOf","isEmpty","chain"];a.each(w,function(t){m.prototype[t]=function(){var e=o.call(arguments);return e.unshift(this.models),a[t].apply(a,e)}});var _=["groupBy","countBy","sortBy"];a.each(_,function(t){m.prototype[t]=function(e,n){var i=a.isFunction(e)?e:function(t){return t.get(e)};return a[t](this.models,i,n)}});var b=t.View=function(t){this.cid=a.uniqueId("view"),this._configure(t||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},x=/^(\S+)\s*(.*)$/,S=["model","collection","el","id","attributes","className","tagName","events"];a.extend(b.prototype,c,{tagName:"div",$:function(t){return this.$el.find(t)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(e,n){return this.$el&&this.undelegateEvents(),this.$el=e instanceof t.$?e:t.$(e),this.el=this.$el[0],n!==!1&&this.delegateEvents(),this},delegateEvents:function(t){if(!t&&!(t=a.result(this,"events")))return this;this.undelegateEvents();for(var e in t){var n=t[e];if(a.isFunction(n)||(n=this[t[e]]),n){var i=e.match(x),r=i[1],o=i[2];n=a.bind(n,this),r+=".delegateEvents"+this.cid,""===o?this.$el.on(r,n):this.$el.on(r,o,n)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_configure:function(t){this.options&&(t=a.extend({},a.result(this,"options"),t)),a.extend(this,a.pick(t,S)),this.options=t},_ensureElement:function(){if(this.el)this.setElement(a.result(this,"el"),!1);else{var e=a.extend({},a.result(this,"attributes"));this.id&&(e.id=a.result(this,"id")),this.className&&(e["class"]=a.result(this,"className"));var n=t.$("<"+a.result(this,"tagName")+">").attr(e);this.setElement(n,!1)}}}),t.sync=function(e,n,i){var r=C[e];a.defaults(i||(i={}),{emulateHTTP:t.emulateHTTP,emulateJSON:t.emulateJSON});var o={type:r,dataType:"json"};if(i.url||(o.url=a.result(n,"url")||I()),null!=i.data||!n||"create"!==e&&"update"!==e&&"patch"!==e||(o.contentType="application/json",o.data=JSON.stringify(i.attrs||n.toJSON(i))),i.emulateJSON&&(o.contentType="application/x-www-form-urlencoded",o.data=o.data?{model:o.data}:{}),i.emulateHTTP&&("PUT"===r||"DELETE"===r||"PATCH"===r)){o.type="POST",i.emulateJSON&&(o.data._method=r);var s=i.beforeSend;i.beforeSend=function(t){return t.setRequestHeader("X-HTTP-Method-Override",r),s?s.apply(this,arguments):void 0}}"GET"===o.type||i.emulateJSON||(o.processData=!1),"PATCH"!==o.type||!window.ActiveXObject||window.external&&window.external.msActiveXFilteringEnabled||(o.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var c=i.xhr=t.ajax(a.extend(o,i));return n.trigger("request",n,c,i),c};var C={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};t.ajax=function(){return t.$.ajax.apply(t.$,arguments)};var T=t.Router=function(t){t||(t={}),t.routes&&(this.routes=t.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},k=/\((.*?)\)/g,P=/(\(\?)?:\w+/g,D=/\*\w+/g,L=/[\-{}\[\]+?.,\\\^$|#\s]/g;a.extend(T.prototype,c,{initialize:function(){},route:function(e,n,i){a.isRegExp(e)||(e=this._routeToRegExp(e)),a.isFunction(n)&&(i=n,n=""),i||(i=this[n]);var r=this;return t.history.route(e,function(o){var s=r._extractParameters(e,o);i&&i.apply(r,s),r.trigger.apply(r,["route:"+n].concat(s)),r.trigger("route",n,s),t.history.trigger("route",r,n,s)}),this},navigate:function(e,n){return t.history.navigate(e,n),this},_bindRoutes:function(){if(this.routes){this.routes=a.result(this,"routes");for(var t,e=a.keys(this.routes);null!=(t=e.pop());)this.route(t,this.routes[t])}},_routeToRegExp:function(t){return t=t.replace(L,"\\$&").replace(k,"(?:$1)?").replace(P,function(t,e){return e?t:"([^/]+)"}).replace(D,"(.*?)"),new RegExp("^"+t+"$")},_extractParameters:function(t,e){var n=t.exec(e).slice(1);return a.map(n,function(t){return t?decodeURIComponent(t):null})}});var K=t.History=function(){this.handlers=[],a.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},A=/^[#\/]|\s+$/g,M=/^\/+|\/+$/g,E=/msie [\w.]+/,N=/\/$/;K.started=!1,a.extend(K.prototype,c,{interval:50,getHash:function(t){var e=(t||this).location.href.match(/#(.*)$/);return e?e[1]:""},getFragment:function(t,e){if(null==t)if(this._hasPushState||!this._wantsHashChange||e){t=this.location.pathname;var n=this.root.replace(N,"");t.indexOf(n)||(t=t.substr(n.length))}else t=this.getHash();return t.replace(A,"")},start:function(e){if(K.started)throw new Error("Backbone.history has already been started");K.started=!0,this.options=a.extend({},{root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var n=this.getFragment(),i=document.documentMode,r=E.exec(navigator.userAgent.toLowerCase())&&(!i||7>=i);this.root=("/"+this.root+"/").replace(M,"/"),r&&this._wantsHashChange&&(this.iframe=t.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(n)),this._hasPushState?t.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!r?t.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=n;var o=this.location,s=o.pathname.replace(/[^\/]$/,"$&/")===this.root;return this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!s?(this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0):(this._wantsPushState&&this._hasPushState&&s&&o.hash&&(this.fragment=this.getHash().replace(A,""),this.history.replaceState({},document.title,this.root+this.fragment+o.search)),this.options.silent?void 0:this.loadUrl())},stop:function(){t.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),K.started=!1},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(){var t=this.getFragment();return t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe))),t===this.fragment?!1:(this.iframe&&this.navigate(t),this.loadUrl()||this.loadUrl(this.getHash()),void 0)},loadUrl:function(t){var e=this.fragment=this.getFragment(t),n=a.any(this.handlers,function(t){return t.route.test(e)?(t.callback(e),!0):void 0});return n},navigate:function(t,e){if(!K.started)return!1;if(e&&e!==!0||(e={trigger:e}),t=this.getFragment(t||""),this.fragment!==t){this.fragment=t;var n=this.root+t;if(this._hasPushState)this.history[e.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,t,e.replace),this.iframe&&t!==this.getFragment(this.getHash(this.iframe))&&(e.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,t,e.replace))}e.trigger&&this.loadUrl(t)
}},_updateHash:function(t,e,n){if(n){var i=t.href.replace(/(javascript:|#).*$/,"");t.replace(i+"#"+e)}else t.hash="#"+e}}),t.history=new K;var O=function(t,e){var n,i=this;n=t&&a.has(t,"constructor")?t.constructor:function(){return i.apply(this,arguments)},a.extend(n,i,e);var r=function(){this.constructor=n};return r.prototype=i.prototype,n.prototype=new r,t&&a.extend(n.prototype,t),n.__super__=i.prototype,n};p.extend=m.extend=T.extend=b.extend=K.extend=O;var I=function(){throw new Error('A "url" property or function must be specified')},F=function(t,e){var n=e.error;e.error=function(i){n&&n(t,i,e),t.trigger("error",t,i,e)}}}.call(this),define("backbone",["jquery","underscore"],function(t){return function(){var e;return e||t.Backbone}}(this)),function(t){t("toastr",["jquery"],function(t){return function(){function e(t){a&&a(t)}function n(n){function a(){return t(":focus",f).length>0?void 0:f.fadeOut(h.fadeOut,function(){o(f),h.onFadeOut&&h.onFadeOut(),v.state="hidden",v.endTime=new Date,e(v)})}function c(){(h.timeOut>0||h.extendedTimeOut>0)&&(p=setTimeout(a,h.extendedTimeOut))}function l(){clearTimeout(p),f.stop(!0,!0).fadeIn(h.fadeIn)}var h=r(),d=n.iconClass||h.iconClass;"undefined"!=typeof n.optionsOverride&&(h=t.extend(h,n.optionsOverride),d=n.optionsOverride.iconClass||d),u++,s=i(h);var p=null,f=t("<div/>"),g=t("<div/>"),m=t("<div/>"),v={toastId:u,state:"visible",startTime:new Date,options:h,map:n};return n.iconClass&&f.addClass(h.toastClass).addClass(d),n.title&&(g.append(n.title).addClass(h.titleClass),f.append(g)),n.message&&(m.append(n.message).addClass(h.messageClass),f.append(m)),f.hide(),h.newestOnTop?s.prepend(f):s.append(f),f.fadeIn(h.fadeIn,h.onFadeIn),h.timeOut>0&&(p=setTimeout(a,h.timeOut)),f.hover(l,c),!h.onclick&&h.tapToDismiss&&f.click(a),h.onclick&&f.click(function(){h.onclick()&&a()}),e(v),h.debug&&console&&console.log(v),f}function i(e){return e||(e=r()),s=t("#"+e.containerId),s.length?s:(s=t("<div/>").attr("id",e.containerId).addClass(e.positionClass),s.appendTo(t(e.target)),s)}function r(){return t.extend({},h,y.options)}function o(t){s||(s=i()),t.is(":visible")||(t.remove(),t=null,0===s.children().length&&s.remove())}var s,a,c="1.3.1",l={error:"error",info:"info",success:"success",warning:"warning"},u=0,h={tapToDismiss:!0,toastClass:"toast",containerId:"toast-container",debug:!1,fadeIn:300,onFadeIn:void 0,fadeOut:1e3,onFadeOut:void 0,extendedTimeOut:1e3,iconClasses:{error:"toast-error",info:"toast-info",success:"toast-success",warning:"toast-warning"},iconClass:"toast-info",positionClass:"toast-top-right",timeOut:5e3,titleClass:"toast-title",messageClass:"toast-message",target:"body",newestOnTop:!0},d=function(t,e,i){return n({type:l.error,iconClass:r().iconClasses.error,message:t,optionsOverride:i,title:e})},p=function(t,e,i){return n({type:l.info,iconClass:r().iconClasses.info,message:t,optionsOverride:i,title:e})},f=function(t){a=t},g=function(t,e,i){return n({type:l.success,iconClass:r().iconClasses.success,message:t,optionsOverride:i,title:e})},m=function(t,e,i){return n({type:l.warning,iconClass:r().iconClasses.warning,message:t,optionsOverride:i,title:e})},v=function(e){var n=r();return s||i(n),e&&0===t(":focus",e).length?(e.fadeOut(n.fadeOut,function(){o(e)}),void 0):(s.children().length&&s.fadeOut(n.fadeOut,function(){s.remove()}),void 0)},y={clear:v,error:d,getContainer:i,info:p,options:{},subscribe:f,success:g,version:c,warning:m};return y}()})}("function"==typeof define&&define.amd?define:function(t,e){"undefined"!=typeof module&&module.exports?module.exports=e(require(t[0])):window.toastr=e(window.jQuery)}),define("application/events",["require","underscore","backbone"],function(t){var e,n,i;return i=t("underscore"),e=t("backbone"),n={},i(n).extend(e.Events),n});var __hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var i in e)__hasProp.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};define("application/views/navigation",["require","jquery","backbone","../events"],function(t){var e,n,i,r;return e=t("jquery"),n=t("backbone"),r=t("../events"),i=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return __extends(n,t),n.prototype.el="#navigation",n.prototype.events={"click [data-command]":"handleCommand"},n.prototype.handleCommand=function(t){var n;return n=e(t.currentTarget).attr("data-command"),n?r.trigger(n):!1},n}(n.View)});var __hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var i in e)__hasProp.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};define("application/models/example",["require","backbone"],function(t){var e,n;return e=t("backbone"),n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.defaults=function(){return{display:null,snippet:null}},e}(e.Model)});var __hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var i in e)__hasProp.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};define("application/models/examples",["require","backbone","./example"],function(t){var e,n,i;return e=t("backbone"),n=t("./example"),i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.model=n,e}(e.Collection)});var __hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var i in e)__hasProp.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};define("application/views/examplelist",["require","jquery","underscore","backbone","../models/example","../models/examples","../events"],function(t){var e,n,i,r,o,s,a,c;return e=t("jquery"),c=t("underscore"),n=t("backbone"),i=t("../models/example"),o=t("../models/examples"),s=t("../events"),a=function(){return new o([new i({display:"Sync call",snippet:"A -> B: Sync message"}),new i({display:"Sync return",snippet:"A <-- B: Sync message return"}),new i({display:"Async call",snippet:"A ->> B: Async message"}),new i({display:"Async return",snippet:"A <<-- B: Async message return"}),new i({display:"Loop",snippet:"loop n times\n  ' nested calls goes here...\nend"}),new i({display:"If",snippet:"opt condition\n  ' nested calls goes here...\nend"}),new i({display:"If/Else",snippet:"alt condition 1\n  ' nested calls goes here...\nelse condition 2\n  ' nested calls goes here...\nend"})])},r=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return __extends(n,t),n.prototype.el="#example-list",n.prototype.events={"click li":"select"},n.prototype.initialize=function(){return this.template=c("<li><%= display %></li>").template(),this.collection=a(),this.render()},n.prototype.render=function(){var t=this;return this.$el.empty(),this.collection.each(function(n){return t.$el.append(e(t.template(n.toJSON())).attr("data-cid",n.cid))}),this},n.prototype.select=function(t){var n,i;return n=e(t.currentTarget).attr("data-cid"),i=this.collection.get(n),s.trigger("exampleSelected",{example:i})},n}(n.View)}),window.CodeMirror=function(){function t(r,o){if(!(this instanceof t))return new t(r,o);this.options=o=o||{};for(var a in sr)!o.hasOwnProperty(a)&&sr.hasOwnProperty(a)&&(o[a]=sr[a]);h(o);var l=this.display=e(r);l.wrapper.CodeMirror=this,c(this),o.autofocus&&!$i&&te(this),this.view=n(new In([new On([xn("",null,$(l))])])),this.nextOpId=0,i(this),s(this),o.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap"),this.setValue(o.value||""),Ai&&setTimeout(di(Z,this,!0),20),this.view.history=$n(),ne(this);var u;try{u=document.activeElement==l.input}catch(d){}u||o.autofocus&&!$i?setTimeout(di(ye,this),20):we(this),U(this,function(){for(var t in or)or.propertyIsEnumerable(t)&&or[t](this,o[t],ar);for(var e=0;e<hr.length;++e)hr[e](this)})()}function e(t){var e={},n=e.input=gi("textarea",null,null,"position: absolute; padding: 0; width: 1px; height: 1em; outline: none;");Ni?n.style.width="1000px":n.setAttribute("wrap","off"),n.setAttribute("autocorrect","off"),n.setAttribute("autocapitalize","off"),e.inputDiv=gi("div",[n],null,"overflow: hidden; position: relative; width: 3px; height: 0px;"),e.scrollbarH=gi("div",[gi("div",null,null,"height: 1px")],"CodeMirror-hscrollbar"),e.scrollbarV=gi("div",[gi("div",null,null,"width: 1px")],"CodeMirror-vscrollbar"),e.scrollbarFiller=gi("div",null,"CodeMirror-scrollbar-filler"),e.lineDiv=gi("div"),e.selectionDiv=gi("div",null,null,"position: relative; z-index: 1"),e.cursor=gi("div"," ","CodeMirror-cursor"),e.otherCursor=gi("div"," ","CodeMirror-cursor CodeMirror-secondarycursor"),e.measure=gi("div",null,"CodeMirror-measure"),e.lineSpace=gi("div",[e.measure,e.selectionDiv,e.lineDiv,e.cursor,e.otherCursor],null,"position: relative; outline: none"),e.mover=gi("div",[gi("div",[e.lineSpace],"CodeMirror-lines")],null,"position: relative"),e.sizer=gi("div",[e.mover],"CodeMirror-sizer"),e.heightForcer=gi("div"," ",null,"position: absolute; height: "+vr+"px"),e.gutters=gi("div",null,"CodeMirror-gutters"),e.lineGutter=null;var i=gi("div",[e.sizer,e.heightForcer,e.gutters],null,"position: relative; min-height: 100%");return e.scroller=gi("div",[i],"CodeMirror-scroll"),e.scroller.setAttribute("tabIndex","-1"),e.wrapper=gi("div",[e.inputDiv,e.scrollbarH,e.scrollbarV,e.scrollbarFiller,e.scroller],"CodeMirror"),Mi&&(e.gutters.style.zIndex=-1,e.scroller.style.paddingRight=0),t.appendChild?t.appendChild(e.wrapper):t(e.wrapper),ji&&(n.style.width="0px"),Ni||(e.scroller.draggable=!0),Hi?(e.inputDiv.style.height="1px",e.inputDiv.style.position="absolute"):Mi&&(e.scrollbarH.style.minWidth=e.scrollbarV.style.minWidth="18px"),e.viewOffset=e.showingFrom=e.showingTo=e.lastSizeC=0,e.lineNumWidth=e.lineNumInnerWidth=e.lineNumChars=null,e.prevInput="",e.alignWidgets=!1,e.pollingFast=!1,e.poll=new oi,e.draggingText=!1,e.cachedCharWidth=e.cachedTextHeight=null,e.measureLineCache=[],e.measureLineCachePos=0,e.inaccurateSelection=!1,e.pasteIncoming=!1,e.wheelDX=e.wheelDY=e.wheelStartX=e.wheelStartY=null,e}function n(t){var e={line:0,ch:0};return{doc:t,frontier:0,highlight:new oi,sel:{from:e,to:e,head:e,anchor:e,shift:!1,extend:!1},scrollTop:0,scrollLeft:0,overwrite:!1,focused:!1,maxLine:Fn(t,0),maxLineLength:0,maxLineChanged:!1,suppressEdits:!1,goalColumn:null,cantEdit:!1,keyMaps:[],overlays:[],modeGen:0}}function i(e){var n=e.view.doc;e.view.mode=t.getMode(e.options,e.options.mode),n.iter(0,n.size,function(t){t.stateAfter&&(t.stateAfter=null),t.styles&&(t.styles=null)}),e.view.frontier=0,L(e,100),e.view.modeGen++,e.curOp&&V(e,0,n.size)}function r(t){var e=t.view.doc,n=$(t.display);if(t.options.lineWrapping){t.display.wrapper.className+=" CodeMirror-wrap";var i=t.display.scroller.clientWidth/G(t.display)-3;e.iter(0,e.size,function(t){if(0!=t.height){var e=Math.ceil(t.text.length/i)||1;1!=e&&Rn(t,e*n)}}),t.display.sizer.style.minWidth=""}else t.display.wrapper.className=t.display.wrapper.className.replace(" CodeMirror-wrap",""),u(t.view),e.iter(0,e.size,function(t){0!=t.height&&Rn(t,n)});V(t,0,e.size),R(t),setTimeout(function(){d(t.display,t.view.doc.height)},100)}function o(t){var e=pr[t.options.keyMap].style;t.display.wrapper.className=t.display.wrapper.className.replace(/\s*cm-keymap-\S+/g,"")+(e?" cm-keymap-"+e:"")}function s(t){t.display.wrapper.className=t.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+t.options.theme.replace(/(^|\s)\s*/g," cm-s-"),R(t)}function a(t){c(t),y(t,!0)}function c(t){var e=t.display.gutters,n=t.options.gutters;mi(e);for(var i=0;i<n.length;++i){var r=n[i],o=e.appendChild(gi("div",null,"CodeMirror-gutter "+r));"CodeMirror-linenumbers"==r&&(t.display.lineGutter=o,o.style.width=(t.display.lineNumWidth||1)+"px")}e.style.display=i?"":"none"}function l(t,e){if(0==e.height)return 0;for(var n,i=e.text.length,r=e;n=ln(r);){var o=n.find();r=Fn(t,o.from.line),i+=o.from.ch-o.to.ch}for(r=e;n=un(r);){var o=n.find();i-=r.text.length-o.from.ch,r=Fn(t,o.to.line),i+=r.text.length-o.to.ch}return i}function u(t){t.maxLine=Fn(t.doc,0),t.maxLineLength=l(t.doc,t.maxLine),t.maxLineChanged=!0,t.doc.iter(1,t.doc.size,function(e){var n=l(t.doc,e);n>t.maxLineLength&&(t.maxLineLength=n,t.maxLine=e)})}function h(t){for(var e=!1,n=0;n<t.gutters.length;++n)"CodeMirror-linenumbers"==t.gutters[n]&&(t.lineNumbers?e=!0:t.gutters.splice(n--,1));!e&&t.lineNumbers&&t.gutters.push("CodeMirror-linenumbers")}function d(t,e){var n=e+2*E(t);t.sizer.style.minHeight=t.heightForcer.style.top=n+"px";var i=Math.max(n,t.scroller.scrollHeight),r=t.scroller.scrollWidth>t.scroller.clientWidth,o=i>t.scroller.clientHeight;o?(t.scrollbarV.style.display="block",t.scrollbarV.style.bottom=r?wi(t.measure)+"px":"0",t.scrollbarV.firstChild.style.height=i-t.scroller.clientHeight+t.scrollbarV.clientHeight+"px"):t.scrollbarV.style.display="",r?(t.scrollbarH.style.display="block",t.scrollbarH.style.right=o?wi(t.measure)+"px":"0",t.scrollbarH.firstChild.style.width=t.scroller.scrollWidth-t.scroller.clientWidth+t.scrollbarH.clientWidth+"px"):t.scrollbarH.style.display="",r&&o?(t.scrollbarFiller.style.display="block",t.scrollbarFiller.style.height=t.scrollbarFiller.style.width=wi(t.measure)+"px"):t.scrollbarFiller.style.display="",zi&&0===wi(t.measure)&&(t.scrollbarV.style.minWidth=t.scrollbarH.style.minHeight=Wi?"18px":"12px")}function p(t,e,n){var i=t.scroller.scrollTop,r=t.wrapper.clientHeight;"number"==typeof n?i=n:n&&(i=n.top,r=n.bottom-n.top),i=Math.floor(i-E(t));var o=Math.ceil(i+r);return{from:Wn(e,i),to:Wn(e,o)}}function f(t){var e=t.display;if(e.alignWidgets||e.gutters.firstChild&&t.options.fixedGutter){for(var n=v(e)-e.scroller.scrollLeft+t.view.scrollLeft,i=e.gutters.offsetWidth,r=n+"px",o=e.lineDiv.firstChild;o;o=o.nextSibling)if(o.alignable)for(var s=0,a=o.alignable;s<a.length;++s)a[s].style.left=r;t.options.fixedGutter&&(e.gutters.style.left=n+i+"px")}}function g(t){if(!t.options.lineNumbers)return!1;var e=t.view.doc,n=m(t.options,e.size-1),i=t.display;if(n.length!=i.lineNumChars){var r=i.measure.appendChild(gi("div",[gi("div",n)],"CodeMirror-linenumber CodeMirror-gutter-elt")),o=r.firstChild.offsetWidth,s=r.offsetWidth-o;return i.lineGutter.style.width="",i.lineNumInnerWidth=Math.max(o,i.lineGutter.offsetWidth-s),i.lineNumWidth=i.lineNumInnerWidth+s,i.lineNumChars=i.lineNumInnerWidth?n.length:-1,i.lineGutter.style.width=i.lineNumWidth+"px",!0}return!1}function m(t,e){return String(t.lineNumberFormatter(e+t.firstLineNumber))}function v(t){return t.scroller.getBoundingClientRect().left-t.sizer.getBoundingClientRect().left}function y(t,e,n){var i=t.display.showingFrom,r=t.display.showingTo,o=w(t,e,n);return o&&(ii(t,t,"update",t),(t.display.showingFrom!=i||t.display.showingTo!=r)&&ii(t,t,"viewportChange",t,t.display.showingFrom,t.display.showingTo)),T(t),d(t.display,t.view.doc.height),o}function w(t,e,n){var i=t.display,r=t.view.doc;if(!i.wrapper.clientWidth)return i.showingFrom=i.showingTo=i.viewOffset=0,void 0;var o=p(i,r,n);if(!(e!==!0&&0==e.length&&o.from>i.showingFrom&&o.to<i.showingTo)){e&&g(t)&&(e=!0);var s=i.sizer.style.marginLeft=i.gutters.offsetWidth+"px";if(i.scrollbarH.style.left=t.options.fixedGutter?s:"0",e!==!0&&Zi)for(var a=0;a<e.length;++a)for(var c,l=e[a];c=ln(Fn(r,l.from));){var u=c.find().from.line;l.diff&&(l.diff-=l.from-u),l.from=u}var h=e===!0?0:1/0;if(t.options.lineNumbers&&e&&e!==!0)for(var a=0;a<e.length;++a)if(e[a].diff){h=e[a].from;break}var u=Math.max(o.from-t.options.viewportMargin,0),d=Math.min(r.size,o.to+t.options.viewportMargin);if(i.showingFrom<u&&u-i.showingFrom<20&&(u=i.showingFrom),i.showingTo>d&&i.showingTo-d<20&&(d=Math.min(r.size,i.showingTo)),Zi)for(u=Hn(hn(r,Fn(r,u)));d<r.size&&dn(Fn(r,d));)++d;for(var f=e===!0?[]:_([{from:i.showingFrom,to:i.showingTo}],e),m=0,a=0;a<f.length;++a){var v=f[a];v.from<u&&(v.from=u),v.to>d&&(v.to=d),v.from>=v.to?f.splice(a--,1):m+=v.to-v.from}if(m!=d-u||u!=i.showingFrom||d!=i.showingTo){f.sort(function(t,e){return t.from-e.from});var y=document.activeElement;.7*(d-u)>m&&(i.lineDiv.style.display="none"),x(t,u,d,f,h),i.lineDiv.style.display="",document.activeElement!=y&&y.offsetHeight&&y.focus();var b=u!=i.showingFrom||d!=i.showingTo||i.lastSizeC!=i.wrapper.clientHeight;b&&(i.lastSizeC=i.wrapper.clientHeight),i.showingFrom=u,i.showingTo=d,L(t,100);for(var S,C=i.lineDiv.offsetTop,T=i.lineDiv.firstChild;T;T=T.nextSibling)if(T.lineObj){if(Mi){var k=T.offsetTop+T.offsetHeight;S=k-C,C=k}else{var P=T.getBoundingClientRect();S=P.bottom-P.top}var D=T.lineObj.height-S;if(2>S&&(S=$(i)),D>.001||-.001>D){Rn(T.lineObj,S);var K=T.lineObj.widgets;if(K)for(var a=0;a<K.length;++a)K[a].height=K[a].node.offsetHeight}}return i.viewOffset=qn(t,Fn(r,u)),i.mover.style.top=i.viewOffset+"px",p(i,r,n).to>=d&&w(t,[],n),!0}}}function _(t,e){for(var n=0,i=e.length||0;i>n;++n){for(var r=e[n],o=[],s=r.diff||0,a=0,c=t.length;c>a;++a){var l=t[a];r.to<=l.from&&r.diff?o.push({from:l.from+s,to:l.to+s}):r.to<=l.from||r.from>=l.to?o.push(l):(r.from>l.from&&o.push({from:l.from,to:r.from}),r.to<l.to&&o.push({from:r.to+s,to:l.to+s}))}t=o}return t}function b(t){for(var e=t.display,n={},i={},r=e.gutters.firstChild,o=0;r;r=r.nextSibling,++o)n[t.options.gutters[o]]=r.offsetLeft,i[t.options.gutters[o]]=r.offsetWidth;return{fixedPos:v(e),gutterTotalWidth:e.gutters.offsetWidth,gutterLeft:n,gutterWidth:i,wrapperWidth:e.wrapper.clientWidth}}function x(t,e,n,i,r){function o(e){var n=e.nextSibling;return Ni&&Gi&&t.display.currentWheelTarget==e?(e.style.display="none",e.lineObj=null):e.parentNode.removeChild(e),n}var s=b(t),a=t.display,c=t.options.lineNumbers;i.length||Ni&&t.display.currentWheelTarget||mi(a.lineDiv);var l=a.lineDiv,u=l.firstChild,h=i.shift(),d=e;for(t.view.doc.iter(e,n,function(e){if(h&&h.to==d&&(h=i.shift()),dn(e)){if(0!=e.height&&Rn(e,0),e.widgets&&u.previousSibling)for(var n=0;n<e.widgets.length;++n)if(e.widgets[n].showIfHidden){var a=u.previousSibling;if("pre"==a.nodeType){var p=gi("div",null,null,"position: relative");a.parentNode.replaceChild(p,a),p.appendChild(a),a=p}a.appendChild(C(e.widgets[n],a,s))}}else if(h&&h.from<=d&&h.to>d){for(;u.lineObj!=e;)u=o(u);c&&d>=r&&u.lineNumber&&yi(u.lineNumber,m(t.options,d)),u=u.nextSibling}else{var f=S(t,e,d,s);l.insertBefore(f,u),f.lineObj=e}++d});u;)u=o(u)}function S(t,e,n,i){var r=Kn(t,e),o=e.gutterMarkers,s=t.display;if(!(t.options.lineNumbers||o||e.bgClass||e.wrapClass||e.widgets&&e.widgets.length))return r;var a=gi("div",null,e.wrapClass,"position: relative");if(t.options.lineNumbers||o){var c=a.appendChild(gi("div",null,null,"position: absolute; left: "+(t.options.fixedGutter?i.fixedPos:-i.gutterTotalWidth)+"px"));if(t.options.fixedGutter&&(a.alignable=[c]),!t.options.lineNumbers||o&&o["CodeMirror-linenumbers"]||(a.lineNumber=c.appendChild(gi("div",m(t.options,n),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+i.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+s.lineNumInnerWidth+"px"))),o)for(var l=0;l<t.options.gutters.length;++l){var u=t.options.gutters[l],h=o.hasOwnProperty(u)&&o[u];h&&c.appendChild(gi("div",[h],"CodeMirror-gutter-elt","left: "+i.gutterLeft[u]+"px; width: "+i.gutterWidth[u]+"px"))}}if(e.bgClass&&a.appendChild(gi("div"," ",e.bgClass+" CodeMirror-linebackground")),a.appendChild(r),e.widgets)for(var d=0,p=e.widgets;d<p.length;++d){var f=p[d],g=C(f,a,i);f.above?a.insertBefore(g,t.options.lineNumbers&&0!=e.height?c:r):a.appendChild(g)}return Mi&&(a.style.zIndex=2),a}function C(t,e,n){var i=gi("div",[t.node],"CodeMirror-linewidget");if(i.widget=t,t.noHScroll){(e.alignable||(e.alignable=[])).push(i);var r=n.wrapperWidth;i.style.left=n.fixedPos+"px",t.coverGutter||(r-=n.gutterTotalWidth,i.style.paddingLeft=n.gutterTotalWidth+"px"),i.style.width=r+"px"}return t.coverGutter&&(i.style.zIndex=5,i.style.position="relative",t.noHScroll||(i.style.marginLeft=-n.gutterTotalWidth+"px")),i}function T(t){var e=t.display,n=ke(t.view.sel.from,t.view.sel.to);n||t.options.showCursorWhenSelecting?k(t):e.cursor.style.display=e.otherCursor.style.display="none",n?e.selectionDiv.style.display="none":P(t);var i=W(t,t.view.sel.head,"div"),r=e.wrapper.getBoundingClientRect(),o=e.lineDiv.getBoundingClientRect();e.inputDiv.style.top=Math.max(0,Math.min(e.wrapper.clientHeight-10,i.top+o.top-r.top))+"px",e.inputDiv.style.left=Math.max(0,Math.min(e.wrapper.clientWidth-10,i.left+o.left-r.left))+"px"}function k(t){var e=t.display,n=W(t,t.view.sel.head,"div");e.cursor.style.left=n.left+"px",e.cursor.style.top=n.top+"px",e.cursor.style.height=Math.max(0,n.bottom-n.top)*t.options.cursorHeight+"px",e.cursor.style.display="",n.other?(e.otherCursor.style.display="",e.otherCursor.style.left=n.other.left+"px",e.otherCursor.style.top=n.other.top+"px",e.otherCursor.style.height=.85*(n.other.bottom-n.other.top)+"px"):e.otherCursor.style.display="none"}function P(t){function e(t,e,n,i){0>e&&(e=0),s.appendChild(gi("div",null,"CodeMirror-selected","position: absolute; left: "+t+"px; top: "+e+"px; width: "+(null==n?a-t:n)+"px; height: "+(i-e)+"px"))}function n(n,i,o,s){function l(e){return z(t,{line:n,ch:e},"div",u)}var u=Fn(r,n),h=u.text.length,d=s?1/0:-1/0;return bi(jn(u),i||0,null==o?h:o,function(t,n,r){var u=l("rtl"==r?n-1:t),p=l("rtl"==r?t:n-1),f=u.left,g=p.right;p.top-u.top>3&&(e(f,u.top,null,u.bottom),f=c,u.bottom<p.top&&e(f,u.bottom,null,p.top)),null==o&&n==h&&(g=a),null==i&&0==t&&(f=c),d=s?Math.min(p.top,d):Math.max(p.bottom,d),c+1>f&&(f=c),e(f,p.top,g-f,p.bottom)}),d}var i=t.display,r=t.view.doc,o=t.view.sel,s=document.createDocumentFragment(),a=i.lineSpace.offsetWidth,c=N(t.display);if(o.from.line==o.to.line)n(o.from.line,o.from.ch,o.to.ch);else{for(var l,u,h=Fn(r,o.from.line),d=h,p=[o.from.line,o.from.ch];l=un(d);){var f=l.find();if(p.push(f.from.ch,f.to.line,f.to.ch),f.to.line==o.to.line){p.push(o.to.ch),u=!0;break}d=Fn(r,f.to.line)}if(u)for(var g=0;g<p.length;g+=3)n(p[g],p[g+1],p[g+2]);else{var m,v,y=Fn(r,o.to.line);m=o.from.ch?n(o.from.line,o.from.ch,null,!1):qn(t,h)-i.viewOffset,v=o.to.ch?n(o.to.line,ln(y)?null:0,o.to.ch,!0):qn(t,y)-i.viewOffset,v>m&&e(c,m,null,v)}}vi(i.selectionDiv,s),i.selectionDiv.style.display=""}function D(t){var e=t.display;clearInterval(e.blinker);var n=!0;e.cursor.style.visibility=e.otherCursor.style.visibility="",e.blinker=setInterval(function(){e.cursor.offsetHeight&&(e.cursor.style.visibility=e.otherCursor.style.visibility=(n=!n)?"":"hidden")},t.options.cursorBlinkRate)}function L(t,e){t.view.mode.startState&&t.view.frontier<t.display.showingTo&&t.view.highlight.set(e,di(K,t))}function K(t){var e=t.view,n=e.doc;if(!(e.frontier>=t.display.showingTo)){var i,r=+new Date+t.options.workTime,o=Be(e.mode,M(t,e.frontier)),s=[];n.iter(e.frontier,Math.min(n.size,t.display.showingTo+500),function(n){if(e.frontier>=t.display.showingFrom){var a=n.styles;n.styles=kn(t,n,o);for(var c=!a||a.length!=n.styles.length,l=0;!c&&l<a.length;++l)c=a[l]!=n.styles[l];c&&(i&&i.end==e.frontier?i.end++:s.push(i={start:e.frontier,end:e.frontier+1})),n.stateAfter=Be(e.mode,o)}else Dn(t,n,o),n.stateAfter=0==e.frontier%5?Be(e.mode,o):null;return++e.frontier,+new Date>r?(L(t,t.options.workDelay),!0):void 0}),s.length&&U(t,function(){for(var t=0;t<s.length;++t)V(this,s[t].start,s[t].end)})()}}function A(t,e){for(var n,i,r=t.view.doc,o=e,s=e-100;o>s;--o){if(0==o)return 0;var a=Fn(r,o-1);if(a.stateAfter)return o;var c=si(a.text,null,t.options.tabSize);(null==i||n>c)&&(i=o-1,n=c)}return i}function M(t,e){var n=t.view;if(!n.mode.startState)return!0;var i=A(t,e),r=i&&Fn(n.doc,i-1).stateAfter;return r=r?Be(n.mode,r):Ye(n.mode),n.doc.iter(i,e,function(o){Dn(t,o,r);var s=i==e-1||0==i%5||i>=n.showingFrom&&i<n.showingTo;o.stateAfter=s?Be(n.mode,r):null,++i}),r}function E(t){return t.lineSpace.offsetTop}function N(t){var e=vi(t.measure,gi("pre")).appendChild(gi("span","x"));return e.offsetLeft}function O(t,e,n,i){var r=-1;i=i||I(t,e);for(var o=n;;o+=r){var s=i[o];if(s)break;0>r&&0==o&&(r=1)}return{left:n>o?s.right:s.left,right:o>n?s.left:s.right,top:s.top,bottom:s.bottom}}function I(t,e){for(var n=t.display,i=t.display.measureLineCache,r=0;r<i.length;++r){var o=i[r];if(o.text==e.text&&o.markedSpans==e.markedSpans&&n.scroller.clientWidth==o.width)return o.measure}var s=F(t,e),o={text:e.text,width:n.scroller.clientWidth,markedSpans:e.markedSpans,measure:s};return 16==i.length?i[++n.measureLineCachePos%16]=o:i.push(o),s}function F(t,e){var n=t.display,i=hi(e.text.length),r=Kn(t,e,i);if(Ai&&!Mi&&!t.options.lineWrapping&&r.childNodes.length>100){for(var o=document.createDocumentFragment(),s=10,a=r.childNodes.length,c=0,l=Math.ceil(a/s);l>c;++c){for(var u=gi("div",null,null,"display: inline-block"),h=0;s>h&&a;++h)u.appendChild(r.firstChild),--a;o.appendChild(u)}r.appendChild(o)}vi(n.measure,r);for(var d,p=n.lineDiv.getBoundingClientRect(),f=[],g=hi(e.text.length),m=r.offsetHeight,c=0;c<i.length;++c)if(d=i[c]){for(var v=d.getBoundingClientRect(),y=Math.max(0,v.top-p.top),w=Math.min(v.bottom-p.top,m),h=0;h<f.length;h+=2){var _=f[h],b=f[h+1];if(!(_>w||y>b)&&(y>=_&&b>=w||_>=y&&w>=b||Math.min(w,b)-Math.max(y,_)>=w-y>>1)){f[h]=Math.min(y,_),f[h+1]=Math.max(w,b);break}}h==f.length&&f.push(y,w),g[c]={left:v.left-p.left,right:v.right-p.left,top:h}}for(var d,c=0;c<g.length;++c)if(d=g[c]){var x=d.top;d.top=f[x],d.bottom=f[x+1]}return g}function R(t){t.display.measureLineCache.length=t.display.measureLineCachePos=0,t.display.cachedCharWidth=t.display.cachedTextHeight=null,t.view.maxLineChanged=!0}function H(t,e,n,i){if(e.widgets)for(var r=0;r<e.widgets.length;++r)if(e.widgets[r].above){var o=_n(e.widgets[r]);n.top+=o,n.bottom+=o}if("line"==i)return n;i||(i="local");var s=qn(t,e);if("local"!=i&&(s-=t.display.viewOffset),"page"==i){var a=t.display.lineSpace.getBoundingClientRect();s+=a.top+(window.pageYOffset||(document.documentElement||document.body).scrollTop);var c=a.left+(window.pageXOffset||(document.documentElement||document.body).scrollLeft);n.left+=c,n.right+=c}return n.top+=s,n.bottom+=s,n}function z(t,e,n,i){return i||(i=Fn(t.view.doc,e.line)),H(t,i,O(t,i,e.ch),n)}function W(t,e,n,i,r){function o(e,o){var s=O(t,i,e,r);return o?s.left=s.right:s.right=s.left,H(t,i,s,n)}i=i||Fn(t.view.doc,e.line),r||(r=I(t,i));var s=jn(i),a=e.ch;if(!s)return o(a);for(var c,l,u=s[0].level,h=0;h<s.length;++h){var d,p,f=s[h],g=f.level%2;if(f.from<a&&f.to>a)return o(a,g);var m=g?f.to:f.from,v=g?f.from:f.to;if(m==a)p=h&&f.level<(d=s[h-1]).level?o(d.level%2?d.from:d.to-1,!0):o(g&&f.from!=f.to?a-1:a),g==u?c=p:l=p;else if(v==a){var d=h<s.length-1&&s[h+1];if(!g&&d&&d.from==d.to)continue;p=d&&f.level<d.level?o(d.level%2?d.to-1:d.from):o(g?a:a-1,!0),g==u?c=p:l=p}}return u&&!a&&(l=o(s[0].to-1)),c?(l&&(c.other=l),c):l}function q(t,e,n){var i=t.view.doc;if(n+=t.display.viewOffset,0>n)return{line:0,ch:0,outside:!0};var r=Wn(i,n);if(r>=i.size)return{line:i.size-1,ch:Fn(i,i.size-1).text.length};for(0>e&&(e=0);;){var o=Fn(i,r),s=j(t,o,r,e,n),a=un(o),c=a&&a.find();if(!(a&&s.ch>=c.from.ch))return s;r=c.to.line}}function j(t,e,n,i,r){function o(i){var r=W(t,{line:n,ch:i},"line",e,l);return a=!0,s>r.bottom?Math.max(0,r.left-c):s<r.top?r.left+c:(a=!1,r.left)}var s=r-qn(t,e),a=!1,c=t.display.wrapper.clientWidth,l=I(t,e),u=jn(e),h=e.text.length,d=Ci(e),p=Ti(e),f=N(t.display),g=o(p);if(i>g)return{line:n,ch:p,outside:a};for(;;){if(u?p==d||p==Di(e,d,1):1>=p-d){for(var m=g-i>i-f,v=m?d:p;br.test(e.text.charAt(v));)++v;return{line:n,ch:v,after:m,outside:a}}var y=Math.ceil(h/2),w=d+y;if(u){w=d;for(var _=0;y>_;++_)w=Di(e,w,1)}var b=o(w);b>i?(p=w,g=b,a&&(g+=1e3),h-=y):(d=w,f=b,h=y)}}function $(t){if(null!=t.cachedTextHeight)return t.cachedTextHeight;if(null==Ui){Ui=gi("pre");for(var e=0;49>e;++e)Ui.appendChild(document.createTextNode("x")),Ui.appendChild(gi("br"));Ui.appendChild(document.createTextNode("x"))}vi(t.measure,Ui);var n=Ui.offsetHeight/50;return n>3&&(t.cachedTextHeight=n),mi(t.measure),n||1}function G(t){if(null!=t.cachedCharWidth)return t.cachedCharWidth;var e=gi("span","x"),n=gi("pre",[e]);vi(t.measure,n);var i=e.offsetWidth;return i>2&&(t.cachedCharWidth=i),i||10}function B(t){t.curOp?++t.curOp.depth:t.curOp={depth:1,changes:[],delayedCallbacks:[],updateInput:null,userSelChange:null,textChanged:null,selectionChanged:!1,updateMaxLine:!1,id:++t.nextOpId}}function Y(t){var e=t.curOp;if(!--e.depth){t.curOp=null;var n=t.view,i=t.display;if(e.updateMaxLine&&u(n),n.maxLineChanged&&!t.options.lineWrapping){var r=O(t,n.maxLine,n.maxLine.text.length).right;i.sizer.style.minWidth=r+3+vr+"px",n.maxLineChanged=!1;var o=Math.max(0,i.sizer.offsetLeft+i.sizer.offsetWidth-i.scroller.clientWidth);o<n.scrollLeft&&ue(t,Math.min(i.scroller.scrollLeft,o),!0)}var s,a;if(e.selectionChanged){var c=W(t,n.sel.head);s=He(t,c.left,c.top,c.left,c.bottom)}(e.changes.length||s&&null!=s.scrollTop)&&(a=y(t,e.changes,s&&s.scrollTop)),!a&&e.selectionChanged&&T(t),s&&Ie(t),e.selectionChanged&&D(t),n.focused&&e.updateInput&&Z(t,e.userSelChange),e.textChanged&&ni(t,"change",t,e.textChanged),e.selectionChanged&&ni(t,"cursorActivity",t);for(var l=0;l<e.delayedCallbacks.length;++l)e.delayedCallbacks[l](t)}}function U(t,e){return function(){var n=t||this;B(n);try{var i=e.apply(n,arguments)}finally{Y(n)}return i}}function V(t,e,n,i){t.curOp.changes.push({from:e,to:n,diff:i})}function X(t){t.view.pollingFast||t.display.poll.set(t.options.pollInterval,function(){J(t),t.view.focused&&X(t)})}function Q(t){function e(){var i=J(t);i||n?(t.display.pollingFast=!1,X(t)):(n=!0,t.display.poll.set(60,e))}var n=!1;t.display.pollingFast=!0,t.display.poll.set(20,e)}function J(t){var e=t.display.input,n=t.display.prevInput,i=t.view,r=i.sel;if(!i.focused||Pr(e)||ee(t))return!1;var o=e.value;if(o==n&&ke(r.from,r.to))return!1;B(t),i.sel.shift=!1;for(var s=0,a=Math.min(n.length,o.length);a>s&&n[s]==o[s];)++s;var c=r.from,l=r.to;s<n.length?c={line:c.line,ch:c.ch-(n.length-s)}:i.overwrite&&ke(c,l)&&!t.display.pasteIncoming&&(l={line:l.line,ch:Math.min(Fn(t.view.doc,l.line).text.length,l.ch+(o.length-s))});var u=t.curOp.updateInput;return be(t,c,l,kr(o.slice(s)),"end",t.display.pasteIncoming?"paste":"input",{from:c,to:l}),t.curOp.updateInput=u,o.length>1e3?e.value=t.display.prevInput="":t.display.prevInput=o,Y(t),t.display.pasteIncoming=!1,!0}function Z(t,e){var n,i,r=t.view;ke(r.sel.from,r.sel.to)?e&&(t.display.prevInput=t.display.input.value=""):(t.display.prevInput="",n=Dr&&(r.sel.to.line-r.sel.from.line>100||(i=t.getSelection()).length>1e3),t.display.input.value=n?"-":i||t.getSelection(),r.focused&&li(t.display.input)),t.display.inaccurateSelection=n}function te(t){"nocursor"==t.options.readOnly||!Ai&&document.activeElement==t.display.input||t.display.input.focus()}function ee(t){return t.options.readOnly||t.view.cantEdit}function ne(t){function e(){t.view.focused&&setTimeout(di(te,t),0)}function n(){o.cachedCharWidth=o.cachedTextHeight=null,R(t),y(t,!0)}function i(e){t.options.onDragEvent&&t.options.onDragEvent(t,Yn(e))||Xn(e)}function r(){o.inaccurateSelection&&(o.prevInput="",o.inaccurateSelection=!1,o.input.value=t.getSelection(),li(o.input))}var o=t.display;ti(o.scroller,"mousedown",U(t,oe)),ti(o.scroller,"dblclick",U(t,Un)),ti(o.lineSpace,"selectstart",function(t){ie(o,t)||Un(t)}),Ki||ti(o.scroller,"contextmenu",function(e){_e(t,e)}),ti(o.scroller,"scroll",function(){le(t,o.scroller.scrollTop),ue(t,o.scroller.scrollLeft,!0),ni(t,"scroll",t)}),ti(o.scrollbarV,"scroll",function(){le(t,o.scrollbarV.scrollTop)}),ti(o.scrollbarH,"scroll",function(){ue(t,o.scrollbarH.scrollLeft)}),ti(o.scroller,"mousewheel",function(e){he(t,e)}),ti(o.scroller,"DOMMouseScroll",function(e){he(t,e)}),ti(o.scrollbarH,"mousedown",e),ti(o.scrollbarV,"mousedown",e),ti(o.wrapper,"scroll",function(){o.wrapper.scrollTop=o.wrapper.scrollLeft=0}),window.registered||(window.registered=0),++window.registered,ti(window,"resize",n),setTimeout(function s(){for(var t=o.wrapper.parentNode;t&&t!=document.body;t=t.parentNode);t?setTimeout(s,5e3):(--window.registered,ei(window,"resize",n))},5e3),ti(o.input,"keyup",U(t,function(e){t.options.onKeyEvent&&t.options.onKeyEvent(t,Yn(e))||16==Zn(e,"keyCode")&&(t.view.sel.shift=!1)
})),ti(o.input,"input",di(Q,t)),ti(o.input,"keydown",U(t,me)),ti(o.input,"keypress",U(t,ve)),ti(o.input,"focus",di(ye,t)),ti(o.input,"blur",di(we,t)),t.options.dragDrop&&(ti(o.scroller,"dragstart",function(e){ce(t,e)}),ti(o.scroller,"dragenter",i),ti(o.scroller,"dragover",i),ti(o.scroller,"drop",U(t,se))),ti(o.scroller,"paste",function(e){ie(o,e)||(te(t),Q(t))}),ti(o.input,"paste",function(){o.pasteIncoming=!0,Q(t)}),ti(o.input,"cut",r),ti(o.input,"copy",r),Hi&&ti(o.sizer,"mouseup",function(){document.activeElement==o.input&&o.input.blur(),te(t)})}function ie(t,e){for(var n=Qn(e);n!=t.wrapper;n=n.parentNode){if(!n)return!0;if(/\bCodeMirror-(?:line)?widget\b/.test(n.className)||n.parentNode==t.sizer&&n!=t.mover)return!0}}function re(t,e,n){var i=t.display;if(!n){var r=Qn(e);if(r==i.scrollbarH||r==i.scrollbarH.firstChild||r==i.scrollbarV||r==i.scrollbarV.firstChild||r==i.scrollbarFiller)return null}var o,s,a=i.lineSpace.getBoundingClientRect();try{o=e.clientX,s=e.clientY}catch(e){return null}return q(t,o-a.left,s-a.top)}function oe(t){function e(t){if("single"==h)return Me(r,Ke(c,l),t),void 0;if(m=Ke(c,m),v=Ke(c,v),"double"==h){var e=je(Fn(c,t.line).text,t);Pe(t,m)?Me(r,e.from,v):Me(r,m,e.to)}else"triple"==h&&(Pe(t,m)?Me(r,v,Ke(c,{line:t.line,ch:0})):Me(r,m,Ke(c,{line:t.line+1,ch:0})))}function n(t){var i=++w,a=re(r,t,!0);if(a)if(ke(a,f)){var l=t.clientY<y.top?-20:t.clientY>y.bottom?20:0;l&&setTimeout(U(r,function(){w==i&&(o.scroller.scrollTop+=l,n(t))}),50)}else{s.focused||ye(r),f=a,e(a);var u=p(o,c);(a.line>=u.to||a.line<u.from)&&setTimeout(U(r,function(){w==i&&n(t)}),150)}}function i(t){w=1/0;var n=re(r,t);n&&e(n),Un(t),te(r),ei(document,"mousemove",_),ei(document,"mouseup",b)}var r=this,o=r.display,s=r.view,a=s.sel,c=s.doc;if(a.shift=Zn(t,"shiftKey"),ie(o,t))return Ni||(o.scroller.draggable=!1,setTimeout(function(){o.scroller.draggable=!0},100)),void 0;if(!ae(r,t)){var l=re(r,t);switch(Jn(t)){case 3:return Ki&&_e.call(r,r,t),void 0;case 2:return l&&Me(r,l),setTimeout(di(te,r),20),Un(t),void 0}if(!l)return Qn(t)==o.scroller&&Un(t),void 0;s.focused||ye(r);var u=+new Date,h="single";if(Xi&&Xi.time>u-400&&ke(Xi.pos,l))h="triple",Un(t),setTimeout(di(te,r),20),$e(r,l.line);else if(Vi&&Vi.time>u-400&&ke(Vi.pos,l)){h="double",Xi={time:u,pos:l},Un(t);var d=je(Fn(c,l.line).text,l);Me(r,d.from,d.to)}else Vi={time:u,pos:l};var f=l;if(r.options.dragDrop&&xr&&!ee(r)&&!ke(a.from,a.to)&&!Pe(l,a.from)&&!Pe(a.to,l)&&"single"==h){var g=U(r,function(e){Ni&&(o.scroller.draggable=!1),s.draggingText=!1,ei(document,"mouseup",g),ei(o.scroller,"drop",g),Math.abs(t.clientX-e.clientX)+Math.abs(t.clientY-e.clientY)<10&&(Un(e),Me(r,l),te(r))});return Ni&&(o.scroller.draggable=!0),s.draggingText=g,o.scroller.dragDrop&&o.scroller.dragDrop(),ti(document,"mouseup",g),ti(o.scroller,"drop",g),void 0}Un(t),"single"==h&&Me(r,Ke(c,l));var m=a.from,v=a.to,y=o.wrapper.getBoundingClientRect(),w=0,_=U(r,function(t){Ai||Jn(t)?n(t):i(t)}),b=U(r,i);ti(document,"mousemove",_),ti(document,"mouseup",b)}}function se(t){var e=this;if(!(ie(e.display,t)||e.options.onDragEvent&&e.options.onDragEvent(e,Yn(t)))){Un(t);var n=re(e,t,!0),i=t.dataTransfer.files;if(n&&!ee(e))if(i&&i.length&&window.FileReader&&window.File)for(var r=i.length,o=Array(r),s=0,a=function(t,i){var a=new FileReader;a.onload=function(){o[i]=a.result,++s==r&&(n=Ke(e.view.doc,n),U(e,function(){var t=Te(e,o.join(""),n,n,"paste");Ee(e,n,t)})())},a.readAsText(t)},c=0;r>c;++c)a(i[c],c);else{if(e.view.draggingText&&!Pe(n,e.view.sel.from)&&!Pe(e.view.sel.to,n))return e.view.draggingText(t),setTimeout(di(te,e),20),void 0;try{var o=t.dataTransfer.getData("Text");if(o){var l=e.view.sel.from,u=e.view.sel.to;Ee(e,n,n),e.view.draggingText&&Te(e,"",l,u,"paste"),e.replaceSelection(o,null,"paste"),te(e),ye(e)}}catch(t){}}}}function ae(t,e){var n=t.display;try{var i=e.clientX,r=e.clientY}catch(e){return!1}if(i>=Math.floor(n.gutters.getBoundingClientRect().right))return!1;if(Un(e),!ri(t,"gutterClick"))return!0;var o=n.lineDiv.getBoundingClientRect();if(r>o.bottom)return!0;r-=o.top-n.viewOffset;for(var s=0;s<t.options.gutters.length;++s){var a=n.gutters.childNodes[s];if(a&&a.getBoundingClientRect().right>=i){var c=Wn(t.view.doc,r),l=t.options.gutters[s];ii(t,t,"gutterClick",t,c,l,e);break}}return!0}function ce(t,e){if(!ie(t.display,e)){var n=t.getSelection();if(e.dataTransfer.setData("Text",n),e.dataTransfer.setDragImage&&!Ri){var i=gi("img",null,null,"position: fixed; left: 0; top: 0;");Fi&&(i.width=i.height=1,t.display.wrapper.appendChild(i),i._top=i.offsetTop),e.dataTransfer.setDragImage(i,0,0),Fi&&i.parentNode.removeChild(i)}}}function le(t,e){Math.abs(t.view.scrollTop-e)<2||(t.view.scrollTop=e,Ki||y(t,[],e),t.display.scroller.scrollTop!=e&&(t.display.scroller.scrollTop=e),t.display.scrollbarV.scrollTop!=e&&(t.display.scrollbarV.scrollTop=e),Ki&&y(t,[]))}function ue(t,e,n){(n?e==t.view.scrollLeft:Math.abs(t.view.scrollLeft-e)<2)||(e=Math.min(e,t.display.scroller.scrollWidth-t.display.scroller.clientWidth),t.view.scrollLeft=e,f(t),t.display.scroller.scrollLeft!=e&&(t.display.scroller.scrollLeft=e),t.display.scrollbarH.scrollLeft!=e&&(t.display.scrollbarH.scrollLeft=e))}function he(t,e){var n=e.wheelDeltaX,i=e.wheelDeltaY;if(null==n&&e.detail&&e.axis==e.HORIZONTAL_AXIS&&(n=e.detail),null==i&&e.detail&&e.axis==e.VERTICAL_AXIS?i=e.detail:null==i&&(i=e.wheelDelta),i&&Gi&&Ni)for(var r=e.target;r!=s;r=r.parentNode)if(r.lineObj){t.display.currentWheelTarget=r;break}var o=t.display,s=o.scroller;if(n&&!Ki&&!Fi&&null!=er)return i&&le(t,Math.max(0,Math.min(s.scrollTop+i*er,s.scrollHeight-s.clientHeight))),ue(t,Math.max(0,Math.min(s.scrollLeft+n*er,s.scrollWidth-s.clientWidth))),Un(e),o.wheelStartX=null,void 0;if(i&&null!=er){var a=i*er,c=t.view.scrollTop,l=c+o.wrapper.clientHeight;0>a?c=Math.max(0,c+a-50):l=Math.min(t.view.doc.height,l+a+50),y(t,[],{top:c,bottom:l})}20>tr&&(null==o.wheelStartX?(o.wheelStartX=s.scrollLeft,o.wheelStartY=s.scrollTop,o.wheelDX=n,o.wheelDY=i,setTimeout(function(){if(null!=o.wheelStartX){var t=s.scrollLeft-o.wheelStartX,e=s.scrollTop-o.wheelStartY,n=e&&o.wheelDY&&e/o.wheelDY||t&&o.wheelDX&&t/o.wheelDX;o.wheelStartX=o.wheelStartY=null,n&&(er=(er*tr+n)/(tr+1),++tr)}},200)):(o.wheelDX+=n,o.wheelDY+=i))}function de(t,e,n){if("string"==typeof e&&(e=dr[e],!e))return!1;t.display.pollingFast&&J(t)&&(t.display.pollingFast=!1);var i=t.view,r=i.sel.shift;try{ee(t)&&(i.suppressEdits=!0),n&&(i.sel.shift=!1),e(t)}catch(o){if(o!=yr)throw o;return!1}finally{i.sel.shift=r,i.suppressEdits=!1}return!0}function pe(t){var e=t.view.keyMaps.slice(0);return e.push(t.options.keyMap),t.options.extraKeys&&e.unshift(t.options.extraKeys),e}function fe(t,e){function n(){a=!0}var i=Ue(t.options.keyMap),r=i.auto;clearTimeout(nr),r&&!Xe(e)&&(nr=setTimeout(function(){Ue(t.options.keyMap)==i&&(t.options.keyMap=r.call?r.call(null,t):r)},50));var o=Lr[Zn(e,"keyCode")],s=!1;if(null==o||e.altGraphKey)return!1;Zn(e,"altKey")&&(o="Alt-"+o),Zn(e,Qi?"metaKey":"ctrlKey")&&(o="Ctrl-"+o),Zn(e,Qi?"ctrlKey":"metaKey")&&(o="Cmd-"+o);var a=!1,c=pe(t);return s=Zn(e,"shiftKey")?Ve("Shift-"+o,c,function(e){return de(t,e,!0)},n)||Ve(o,c,function(e){return"string"==typeof e&&/^go[A-Z]/.test(e)?de(t,e):void 0},n):Ve(o,c,function(e){return de(t,e)},n),a&&(s=!1),s&&(Un(e),D(t),Ei&&(e.oldKeyCode=e.keyCode,e.keyCode=0)),s}function ge(t,e,n){var i=Ve("'"+n+"'",pe(t),function(e){return de(t,e,!0)});return i&&(Un(e),D(t)),i}function me(t){var e=this;if(e.view.focused||ye(e),Ai&&27==t.keyCode&&(t.returnValue=!1),!e.options.onKeyEvent||!e.options.onKeyEvent(e,Yn(t))){var n=Zn(t,"keyCode");e.view.sel.shift=16==n||Zn(t,"shiftKey");var i=fe(e,t);Fi&&(rr=i?n:null,i||88!=n||Dr||!Zn(t,Gi?"metaKey":"ctrlKey")||e.replaceSelection(""))}}function ve(t){var e=this;if(!e.options.onKeyEvent||!e.options.onKeyEvent(e,Yn(t))){var n=Zn(t,"keyCode"),i=Zn(t,"charCode");if(Fi&&n==rr)return rr=null,Un(t),void 0;if(!(Fi&&(!t.which||t.which<10)||Hi)||!fe(e,t)){var r=String.fromCharCode(null==i?n:i);this.options.electricChars&&this.view.mode.electricChars&&this.options.smartIndent&&!ee(this)&&this.view.mode.electricChars.indexOf(r)>-1&&setTimeout(U(e,function(){ze(e,e.view.sel.to.line,"smart")}),75),ge(e,t,r)||Q(e)}}}function ye(t){"nocursor"!=t.options.readOnly&&(t.view.focused||(ni(t,"focus",t),t.view.focused=!0,-1==t.display.scroller.className.search(/\bCodeMirror-focused\b/)&&(t.display.scroller.className+=" CodeMirror-focused"),Z(t,!0)),X(t),D(t))}function we(t){t.view.focused&&(ni(t,"blur",t),t.view.focused=!1,t.display.scroller.className=t.display.scroller.className.replace(" CodeMirror-focused","")),clearInterval(t.display.blinker),setTimeout(function(){t.view.focused||(t.view.sel.shift=!1)},150)}function _e(t,e){function n(){if(i.inputDiv.style.position="relative",i.input.style.cssText=a,Ei&&(i.scrollbarV.scrollTop=i.scroller.scrollTop=s),X(t),null!=i.input.selectionStart){clearTimeout(ir);var e=i.input.value=" "+(ke(r.from,r.to)?"":i.input.value),n=0;i.prevInput=" ",i.input.selectionStart=1,i.input.selectionEnd=e.length,ir=setTimeout(function o(){" "==i.prevInput&&0==i.input.selectionStart?U(t,dr.selectAll)(t):n++<10?ir=setTimeout(o,500):Z(t)},200)}}var i=t.display;if(!ie(i,e)){var r=t.view.sel,o=re(t,e),s=i.scroller.scrollTop;if(o&&!Fi){(ke(r.from,r.to)||Pe(o,r.from)||!Pe(o,r.to))&&U(t,Ee)(t,o,o);var a=i.input.style.cssText;i.inputDiv.style.position="absolute",i.input.style.cssText="position: fixed; width: 30px; height: 30px; top: "+(e.clientY-5)+"px; left: "+(e.clientX-5)+"px; z-index: 1000; background: white; outline: none;"+"border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);",te(t),Z(t,!0),ke(r.from,r.to)&&(i.input.value=i.prevInput=" "),Ki?(Xn(e),ti(window,"mouseup",function c(){ei(window,"mouseup",c),setTimeout(n,20)})):setTimeout(n,50)}}}function be(t,e,n,i,r,o){var s=Ji&&an(t.view.doc,e,n);if(!s)return xe(t,e,n,i,r,o);for(var a=s.length-1;a>=1;--a)xe(t,s[a].from,s[a].to,[""],o);return s.length?xe(t,s[0].from,s[0].to,i,r,o):void 0}function xe(t,e,n,i,r,o){if(!t.view.suppressEdits){var s=t.view,a=s.doc,c=[];a.iter(e.line,n.line+1,function(t){c.push(mn(t.text,t.markedSpans))});var l=s.sel.from,u=s.sel.to,h=sn(gn(c[0]),gn(ci(c)),e.ch,n.ch,i),d=Ce(t,e,n,h,r,o);return s.history&&Gn(t,e.line,i.length,c,o,l,u,s.sel.from,s.sel.to),d}}function Se(t,e){var n=t.view.doc,i=t.view.history,r=("undo"==e?i.done:i.undone).pop();if(r){for(var o={events:[],fromBefore:r.fromAfter,toBefore:r.toAfter,fromAfter:r.fromBefore,toAfter:r.toBefore},s=r.events.length-1;s>=0;s-=1){i.dirtyCounter+="undo"==e?-1:1;var a=r.events[s],c=[],l=a.start+a.added;n.iter(a.start,l,function(t){c.push(mn(t.text,t.markedSpans))}),o.events.push({start:a.start,added:a.old.length,old:c});var u=s?null:{from:r.fromBefore,to:r.toBefore};Ce(t,{line:a.start,ch:0},{line:l-1,ch:Fn(n,l-1).text.length},a.old,u,e)}("undo"==e?i.undone:i.done).push(o)}}function Ce(t,e,n,i,r,o){var s=t.view,a=s.doc,c=t.display;if(!s.suppressEdits){var u=n.line-e.line,h=Fn(a,e.line),d=Fn(a,n.line),p=!1,f=e.line;t.options.lineWrapping||(f=Hn(hn(a,h)),a.iter(f,n.line+1,function(t){return t==s.maxLine?(p=!0,!0):void 0}));var g=ci(i),m=$(c);if(0==e.ch&&0==n.ch&&""==fn(g)){for(var v=[],y=0,w=i.length-1;w>y;++y)v.push(xn(fn(i[y]),gn(i[y]),m));Sn(t,d,d.text,gn(g)),u&&a.remove(e.line,u,t),v.length&&a.insert(e.line,v)}else if(h==d)if(1==i.length)Sn(t,h,h.text.slice(0,e.ch)+fn(i[0])+h.text.slice(n.ch),gn(i[0]));else{for(var v=[],y=1,w=i.length-1;w>y;++y)v.push(xn(fn(i[y]),gn(i[y]),m));v.push(xn(fn(g)+h.text.slice(n.ch),gn(g),m)),Sn(t,h,h.text.slice(0,e.ch)+fn(i[0]),gn(i[0])),a.insert(e.line+1,v)}else if(1==i.length)Sn(t,h,h.text.slice(0,e.ch)+fn(i[0])+d.text.slice(n.ch),gn(i[0])),a.remove(e.line+1,u,t);else{var v=[];Sn(t,h,h.text.slice(0,e.ch)+fn(i[0]),gn(i[0])),Sn(t,d,fn(g)+d.text.slice(n.ch),gn(g));for(var y=1,w=i.length-1;w>y;++y)v.push(xn(fn(i[y]),gn(i[y]),m));u>1&&a.remove(e.line+1,u-1,t),a.insert(e.line+1,v)}if(t.options.lineWrapping){var _=Math.max(5,c.scroller.clientWidth/G(c)-3);a.iter(e.line,e.line+i.length,function(t){if(0!=t.height){var e=(Math.ceil(t.text.length/_)||1)*m;e!=t.height&&Rn(t,e)}})}else a.iter(f,e.line+i.length,function(t){var e=l(a,t);e>s.maxLineLength&&(s.maxLine=t,s.maxLineLength=e,s.maxLineChanged=!0,p=!1)}),p&&(t.curOp.updateMaxLine=!0);s.frontier=Math.min(s.frontier,e.line),L(t,400);var b=i.length-u-1;if(V(t,e.line,n.line+1,b),ri(t,"change")){for(var y=0;y<i.length;++y)"string"!=typeof i[y]&&(i[y]=i[y].text);var x={from:e,to:n,text:i,origin:o};if(t.curOp.textChanged){for(var S=t.curOp.textChanged;S.next;S=S.next);S.next=x}else t.curOp.textChanged=x}var C,T,k={line:e.line+i.length-1,ch:fn(g).length+(1==i.length?e.ch:0)};if(r&&"string"!=typeof r)r.from?(C=r.from,T=r.to):C=T=r;else if("end"==r)C=T=k;else if("start"==r)C=T=e;else if("around"==r)C=e,T=k;else{var P=function(t){if(Pe(t,e))return t;if(!Pe(n,t))return k;var i=t.line+b,r=t.ch;return t.line==n.line&&(r+=fn(g).length-(n.ch-(n.line==e.line?e.ch:0))),{line:i,ch:r}};C=P(s.sel.from),T=P(s.sel.to)}return Ee(t,C,T,null,!0),k}}function Te(t,e,n,i,r){if(i||(i=n),Pe(i,n)){var o=i;i=n,n=o}return be(t,n,i,kr(e),null,r)}function ke(t,e){return t.line==e.line&&t.ch==e.ch}function Pe(t,e){return t.line<e.line||t.line==e.line&&t.ch<e.ch}function De(t){return{line:t.line,ch:t.ch}}function Le(t,e){return Math.max(0,Math.min(e,t.size-1))}function Ke(t,e){if(e.line<0)return{line:0,ch:0};if(e.line>=t.size)return{line:t.size-1,ch:Fn(t,t.size-1).text.length};var n=e.ch,i=Fn(t,e.line).text.length;return null==n||n>i?{line:e.line,ch:i}:0>n?{line:e.line,ch:0}:e}function Ae(t,e){return e>=0&&e<t.size}function Me(t,e,n,i){var r=t.view.sel;if(r.shift||r.extend){var o=r.anchor;if(n){var s=Pe(e,o);s!=Pe(n,o)?(o=e,e=n):s!=Pe(e,n)&&(e=n)}Ee(t,o,e,i)}else Ee(t,e,n||e,i);t.curOp.userSelChange=!0}function Ee(t,e,n,i,r){t.view.goalColumn=null;var o=t.view.sel;if((r||!ke(e,o.anchor))&&(e=Oe(t,e,i,"push"!=r)),(r||!ke(n,o.head))&&(n=Oe(t,n,i,"push"!=r)),!ke(o.anchor,e)||!ke(o.head,n)){o.anchor=e,o.head=n;var s=Pe(n,e);o.from=s?n:e,o.to=s?e:n,t.curOp.updateInput=!0,t.curOp.selectionChanged=!0}}function Ne(t){Ee(t,t.view.sel.from,t.view.sel.to,null,"push")}function Oe(t,e,n,i){var r=t.view.doc,o=!1,s=e,a=n||1;t.view.cantEdit=!1;t:for(;;){var c,l=Fn(r,s.line);if(l.markedSpans){for(var u=0;u<l.markedSpans.length;++u){var h=l.markedSpans[u],d=h.marker;if((null==h.from||(d.inclusiveLeft?h.from<=s.ch:h.from<s.ch))&&(null==h.to||(d.inclusiveRight?h.to>=s.ch:h.to>s.ch))){if(i&&d.clearOnEnter){(c||(c=[])).push(d);continue}if(!d.atomic)continue;var p=d.find()[0>a?"from":"to"];if(ke(p,s)&&(p.ch+=a,p.ch<0?p=p.line?Ke(r,{line:p.line-1}):null:p.ch>l.text.length&&(p=p.line<r.size-1?{line:p.line+1,ch:0}:null),!p)){if(o)return i?(t.view.cantEdit=!0,{line:0,ch:0}):Oe(t,e,n,!0);o=!0,p=e,a=-a}s=p;continue t}}if(c)for(var u=0;u<c.length;++u)c[u].clear()}return s}}function Ie(t){var e=t.view,n=Fe(t,e.sel.head);if(e.focused){var i=t.display,r=i.sizer.getBoundingClientRect(),o=null;if(n.top+r.top<0?o=!0:n.bottom+r.top>(window.innerHeight||document.documentElement.clientHeight)&&(o=!1),null!=o&&!qi){var s="none"==i.cursor.style.display;s&&(i.cursor.style.display="",i.cursor.style.left=n.left+"px",i.cursor.style.top=n.top-i.viewOffset+"px"),i.cursor.scrollIntoView(o),s&&(i.cursor.style.display="none")}}}function Fe(t,e){for(;;){var n=!1,i=W(t,e),r=He(t,i.left,i.top,i.left,i.bottom),o=t.view.scrollTop,s=t.view.scrollLeft;if(null!=r.scrollTop&&(le(t,r.scrollTop),Math.abs(t.view.scrollTop-o)>1&&(n=!0)),null!=r.scrollLeft&&(ue(t,r.scrollLeft),Math.abs(t.view.scrollLeft-s)>1&&(n=!0)),!n)return i}}function Re(t,e,n,i,r){var o=He(t,e,n,i,r);null!=o.scrollTop&&le(t,o.scrollTop),null!=o.scrollLeft&&ue(t,o.scrollLeft)}function He(t,e,n,i,r){var o=t.display,s=E(o);n+=s,r+=s;var a=o.scroller.clientHeight-vr,c=o.scroller.scrollTop,l={},u=t.view.doc.height+2*s,h=s+10>n,d=r+s>u-10;c>n?l.scrollTop=h?0:Math.max(0,n):r>c+a&&(l.scrollTop=(d?u:r)-a);var p=o.scroller.clientWidth-vr,f=o.scroller.scrollLeft;e+=o.gutters.offsetWidth,i+=o.gutters.offsetWidth;var g=o.gutters.offsetWidth,m=g+10>e;return f+g>e||m?(m&&(e=0),l.scrollLeft=Math.max(0,e-10-g)):i>p+f-3&&(l.scrollLeft=i+10-p),l}function ze(t,e,n,i){var r=t.view.doc;if(n||(n="add"),"smart"==n)if(t.view.mode.indent)var o=M(t,e);else n="prev";var s,a=t.options.tabSize,c=Fn(r,e),l=si(c.text,null,a),u=c.text.match(/^\s*/)[0];if("smart"==n&&(s=t.view.mode.indent(o,c.text.slice(u.length),c.text),s==yr)){if(!i)return;n="prev"}"prev"==n?s=e?si(Fn(r,e-1).text,null,a):0:"add"==n?s=l+t.options.indentUnit:"subtract"==n&&(s=l-t.options.indentUnit),s=Math.max(0,s);var h="",d=0;if(t.options.indentWithTabs)for(var p=Math.floor(s/a);p;--p)d+=a,h+="	";s>d&&(h+=ai(s-d)),h!=u&&Te(t,h,{line:e,ch:0},{line:e,ch:u.length},"input"),c.stateAfter=null}function We(t,e,n){var i=e,r=e,o=t.view.doc;return"number"==typeof e?r=Fn(o,Le(o,e)):i=Hn(e),null==i?null:n(r,i)?(V(t,i,i+1),r):null}function qe(t,e,n,i){function r(){var t=c+e;return 0>t||t==s.size?!1:(c=t,u=Fn(s,t))}function o(t){var n=(i?Di:Li)(u,l,e,!0);if(null==n){if(t||!r())return!1;l=i?(0>e?Ti:Ci)(u):0>e?u.text.length:0}else l=n;return!0}var s=t.view.doc,a=t.view.sel.head,c=a.line,l=a.ch,u=Fn(s,c);if("char"==n)o();else if("column"==n)o(!0);else if("word"==n)for(var h=!1;!(0>e)||o();){if(pi(u.text.charAt(l)))h=!0;else if(h){0>e&&(e=1,o());break}if(e>0&&!o())break}return Oe(t,{line:c,ch:l},e,!0)}function je(t,e){var n=e.ch,i=e.ch;if(t){e.after===!1||i==t.length?--n:++i;for(var r=t.charAt(n),o=pi(r)?pi:/\s/.test(r)?function(t){return/\s/.test(t)}:function(t){return!/\s/.test(t)&&!pi(t)};n>0&&o(t.charAt(n-1));)--n;for(;i<t.length&&o(t.charAt(i));)++i}return{from:{line:e.line,ch:n},to:{line:e.line,ch:i}}}function $e(t,e){Me(t,{line:e,ch:0},Ke(t.view.doc,{line:e+1,ch:0}))}function Ge(e,n,i,r){t.defaults[e]=n,i&&(or[e]=r?function(t,e,n){n!=ar&&i(t,e,n)}:i)}function Be(t,e){if(e===!0)return e;if(t.copyState)return t.copyState(e);var n={};for(var i in e){var r=e[i];r instanceof Array&&(r=r.concat([])),n[i]=r}return n}function Ye(t,e,n){return t.startState?t.startState(e,n):!0}function Ue(t){return"string"==typeof t?pr[t]:t}function Ve(t,e,n,i){function r(e){e=Ue(e);var o=e[t];if(o===!1)return i&&i(),!0;if(null!=o&&n(o))return!0;if(e.nofallthrough)return i&&i(),!0;var s=e.fallthrough;if(null==s)return!1;if("[object Array]"!=Object.prototype.toString.call(s))return r(s);for(var a=0,c=s.length;c>a;++a)if(r(s[a]))return!0;return!1}for(var o=0;o<e.length;++o)if(r(e[o]))return!0}function Xe(t){var e=Lr[Zn(t,"keyCode")];return"Ctrl"==e||"Alt"==e||"Shift"==e||"Mod"==e}function Qe(t,e){this.pos=this.start=0,this.string=t,this.tabSize=e||8}function Je(t,e){this.lines=[],this.type=e,this.cm=t}function Ze(t,e,n,i,r){var o=t.view.doc,s=new Je(t,r);if("range"==r&&!Pe(e,n))return s;if(i)for(var a in i)i.hasOwnProperty(a)&&(s[a]=i[a]);s.replacedWith&&(s.collapsed=!0,s.replacedWith=gi("span",[s.replacedWith],"CodeMirror-widget")),s.collapsed&&(Zi=!0);var c,l,u=e.line,h=0;if(o.iter(u,n.line+1,function(i){s.collapsed&&!t.options.lineWrapping&&hn(o,i)==t.view.maxLine&&(t.curOp.updateMaxLine=!0);var r={from:null,to:null,marker:s};h+=i.text.length,u==e.line&&(r.from=e.ch,h-=e.ch),u==n.line&&(r.to=n.ch,h-=i.text.length-n.ch),s.collapsed&&(u==n.line&&(l=cn(i,n.ch)),u==e.line?c=cn(i,e.ch):Rn(i,0)),nn(i,r),++u}),s.collapsed&&o.iter(e.line,n.line+1,function(t){dn(t)&&Rn(t,0)}),s.readOnly&&(Ji=!0,(t.view.history.done.length||t.view.history.undone.length)&&t.clearHistory()),s.collapsed){if(c!=l)throw new Error("Inserting collapsed marker overlapping an existing one");s.size=h,s.atomic=!0}return(s.className||s.startStyle||s.endStyle||s.collapsed)&&V(t,e.line,n.line+1),s.atomic&&Ne(t),s}function tn(t,e){if(t)for(var n=0;n<t.length;++n){var i=t[n];if(i.marker==e)return i}}function en(t,e){for(var n,i=0;i<t.length;++i)t[i]!=e&&(n||(n=[])).push(t[i]);return n}function nn(t,e){t.markedSpans=t.markedSpans?t.markedSpans.concat([e]):[e],e.marker.lines.push(t)}function rn(t,e){if(t)for(var n,i=0;i<t.length;++i){var r=t[i],o=r.marker,s=null==r.from||(o.inclusiveLeft?r.from<=e:r.from<e);if(s||"bookmark"==o.type&&r.from==e){var a=null==r.to||(o.inclusiveRight?r.to>=e:r.to>e);(n||(n=[])).push({from:r.from,to:a?null:r.to,marker:o})}}return n}function on(t,e,n){if(t)for(var i,r=0;r<t.length;++r){var o=t[r],s=o.marker,a=null==o.to||(s.inclusiveRight?o.to>=n:o.to>n);if(a||"bookmark"==s.type&&o.from==n&&o.from!=e){var c=null==o.from||(s.inclusiveLeft?o.from<=n:o.from<n);(i||(i=[])).push({from:c?null:o.from-n,to:null==o.to?null:o.to-n,marker:s})}}return i}function sn(t,e,n,i,r){if(!t&&!e)return r;var o=rn(t,n),s=on(e,n,i),a=1==r.length,c=ci(r).length+(a?n:0);if(o)for(var l=0;l<o.length;++l){var u=o[l];if(null==u.to){var h=tn(s,u.marker);h?a&&(u.to=null==h.to?null:h.to+c):u.to=n}}if(s)for(var l=0;l<s.length;++l){var u=s[l];if(null!=u.to&&(u.to+=c),null==u.from){var h=tn(o,u.marker);h||(u.from=c,a&&(o||(o=[])).push(u))}else u.from+=c,a&&(o||(o=[])).push(u)}var d=[mn(r[0],o)];if(!a){var p,f=r.length-2;if(f>0&&o)for(var l=0;l<o.length;++l)null==o[l].to&&(p||(p=[])).push({from:null,to:null,marker:o[l].marker});for(var l=0;f>l;++l)d.push(mn(r[l+1],p));d.push(mn(ci(r),s))}return d}function an(t,e,n){var i=null;if(t.iter(e.line,n.line+1,function(t){if(t.markedSpans)for(var e=0;e<t.markedSpans.length;++e){var n=t.markedSpans[e].marker;!n.readOnly||i&&-1!=ui(i,n)||(i||(i=[])).push(n)}}),!i)return null;for(var r=[{from:e,to:n}],o=0;o<i.length;++o)for(var s=i[o].find(),a=0;a<r.length;++a){var c=r[a];if(Pe(s.from,c.to)&&!Pe(s.to,c.from)){var l=[a,1];Pe(c.from,s.from)&&l.push({from:c.from,to:s.from}),Pe(s.to,c.to)&&l.push({from:s.to,to:c.to}),r.splice.apply(r,l),a+=l.length-1}}return r}function cn(t,e){var n,i=Zi&&t.markedSpans;if(i)for(var r,o=0;o<i.length;++o)r=i[o],r.marker.collapsed&&(null==r.from||r.from<e)&&(null==r.to||r.to>e)&&(!n||n.width<r.marker.width)&&(n=r.marker);return n}function ln(t){return cn(t,-1)}function un(t){return cn(t,t.text.length+1)}function hn(t,e){for(var n;n=ln(e);)e=Fn(t,n.find().from.line);return e}function dn(t){var e=Zi&&t.markedSpans;if(e)for(var n,i=0;i<e.length;++i)if(n=e[i],n.marker.collapsed){if(null==n.from)return!0;if(0==n.from&&n.marker.inclusiveLeft&&pn(t,n))return!0}}function pn(t,e){if(null==e.to){var n=e.marker.find().to,i=Fn(zn(t),n.line);return pn(i,tn(i.markedSpans,e.marker))}if(e.marker.inclusiveRight&&e.to==t.text.length)return!0;for(var r,o=0;o<t.markedSpans.length;++o)if(r=t.markedSpans[o],r.marker.collapsed&&r.from==e.to&&(r.marker.inclusiveLeft||e.marker.inclusiveRight)&&pn(t,r))return!0}function fn(t){return"string"==typeof t?t:t.text}function gn(t){if("string"==typeof t)return null;for(var e=t.markedSpans,n=null,i=0;i<e.length;++i)e[i].marker.explicitlyCleared?n||(n=e.slice(0,i)):n&&n.push(e[i]);return n?n.length?n:null:e}function mn(t,e){return e?{text:t,markedSpans:e}:t}function vn(t){var e=t.markedSpans;if(e){for(var n=0;n<e.length;++n){var i=e[n].marker.lines,r=ui(i,t);i.splice(r,1)}t.markedSpans=null}}function yn(t,e){if(e){for(var n=0;n<e.length;++n)e[n].marker.lines.push(t);t.markedSpans=e}}function wn(t){return function(){B(this.cm);try{var e=t.apply(this,arguments)}finally{Y(this.cm)}return e}}function _n(t){return null!=t.height?t.height:(t.node.parentNode&&1==t.node.parentNode.nodeType||vi(t.cm.display.measure,gi("div",[t.node],null,"position: relative")),t.height=t.node.offsetHeight)}function bn(t,e,n,i){var r=new fr(t,n,i);return r.noHScroll&&(t.display.alignWidgets=!0),We(t,e,function(e){if((e.widgets||(e.widgets=[])).push(r),r.line=e,!dn(e)||r.showIfHidden){var n=qn(t,e)<t.display.scroller.scrollTop;Rn(e,e.height+_n(r)),n&&setTimeout(function(){t.display.scroller.scrollTop+=r.height})}return!0}),r}function xn(t,e,n){var i={text:t,height:n};return yn(i,e),dn(i)&&(i.height=0),i}function Sn(t,e,n,i){e.text=n,e.stateAfter&&(e.stateAfter=null),e.styles&&(e.styles=null),null!=e.order&&(e.order=null),vn(e),yn(e,i),dn(e)?e.height=0:e.height||(e.height=$(t.display)),ii(t,e,"change")}function Cn(t){t.parent=null,vn(t)}function Tn(t,e,n,i,r){var o=t.options.flattenSpans,s="",a=null,c=new Qe(e,t.options.tabSize);for(""==e&&n.blankLine&&n.blankLine(i);!c.eol();){var l=n.token(c,i);c.pos>5e3&&(o=!1,c.pos=Math.min(e.length,c.start+5e4),l=null);var u=c.current();c.start=c.pos,o&&a==l?s+=u:(s&&r(s,a),s=u,a=l)}s&&r(s,a)}function kn(t,e,n){var i=[t.view.modeGen];Tn(t,e.text,t.view.mode,n,function(t,e){i.push(t,e)});for(var r=0;r<t.view.overlays.length;++r){var o=t.view.overlays[r],s=1;Tn(t,e.text,o.mode,!0,function(t,e){for(var n=s,r=t.length;r;){var a=i[s],c=a.length;r>=c?r-=c:(i.splice(s,1,a.slice(0,r),i[s+1],a.slice(r)),r=0),s+=2}if(e)if(o.opaque)i.splice(n,s-n,t,e),s=n+2;else for(;s>n;n+=2){var a=i[n+1];i[n+1]=a?a+" "+e:e}})}return i}function Pn(t,e){return e.styles&&e.styles[0]==t.view.modeGen||(e.styles=kn(t,e,e.stateAfter=M(t,Hn(e)))),e.styles}function Dn(t,e,n){var i=t.view.mode,r=new Qe(e.text,t.options.tabSize);for(""==e.text&&i.blankLine&&i.blankLine(n);!r.eol()&&r.pos<=5e3;)i.token(r,n),r.start=r.pos}function Ln(t){return t?gr[t]||(gr[t]="cm-"+t.replace(/ +/g," cm-")):null}function Kn(t,e,n){for(var i,r,o,s=e,a=!0;i=ln(s);)a=!1,s=Fn(t.view.doc,i.find().from.line),r||(r=s);var c={pre:gi("pre"),col:0,pos:0,display:!n,measure:null,addedOne:!1,cm:t};s.textClass&&(c.pre.className=s.textClass);do{c.measure=s==e&&n,c.pos=0,c.addToken=c.measure?Mn:An,n&&o&&s!=e&&!c.addedOne&&(n[0]=c.pre.appendChild(_i(t.display.measure)),c.addedOne=!0);var l=Nn(s,c,Pn(t,s));o=s==r,l&&(s=Fn(t.view.doc,l.to.line),a=!1)}while(l);return n&&!c.addedOne&&(n[0]=c.pre.appendChild(a?gi("span"," "):_i(t.display.measure))),c.pre.firstChild||dn(e)||c.pre.appendChild(document.createTextNode(" ")),c.pre}function An(t,e,n,i,r){if(e){if(mr.test(e))for(var o=document.createDocumentFragment(),s=0;;){mr.lastIndex=s;var a=mr.exec(e),c=a?a.index-s:e.length-s;if(c&&(o.appendChild(document.createTextNode(e.slice(s,s+c))),t.col+=c),!a)break;if(s+=c+1,"	"==a[0]){var l=t.cm.options.tabSize,u=l-t.col%l;o.appendChild(gi("span",ai(u),"cm-tab")),t.col+=u}else{var h=gi("span","•","cm-invalidchar");h.title="\\u"+a[0].charCodeAt(0).toString(16),o.appendChild(h),t.col+=1}}else{t.col+=e.length;var o=document.createTextNode(e)}if(n||i||r||t.measure){var d=n||"";return i&&(d+=i),r&&(d+=r),t.pre.appendChild(gi("span",[o],d))}t.pre.appendChild(o)}}function Mn(t,e,n,i,r){for(var o=0;o<e.length;++o)o&&o<e.length&&t.cm.options.lineWrapping&&Sr.test(e.slice(o-1,o+1))&&t.pre.appendChild(gi("wbr")),t.measure[t.pos++]=An(t,e.charAt(o),n,0==o&&i,o==e.length-1&&r);e.length&&(t.addedOne=!0)}function En(t,e,n){n&&(t.display||(n=n.cloneNode(!0)),t.pre.appendChild(n),t.measure&&e&&(t.measure[t.pos]=n,t.addedOne=!0)),t.pos+=e}function Nn(t,e,n){var i=t.markedSpans;if(i)for(var r,o,s,a,c,l=t.text,u=l.length,h=0,d=1,p="",f=0;;){if(f==h){o=s=a="",c=null,f=1/0;for(var g=null,m=0;m<i.length;++m){var v=i[m],y=v.marker;v.from<=h&&(null==v.to||v.to>h)?(null!=v.to&&f>v.to&&(f=v.to,s=""),y.className&&(o+=" "+y.className),y.startStyle&&v.from==h&&(a+=" "+y.startStyle),y.endStyle&&v.to==f&&(s+=" "+y.endStyle),y.collapsed&&(!c||c.marker.width<y.width)&&(c=v)):v.from>h&&f>v.from&&(f=v.from),"bookmark"==y.type&&v.from==h&&y.replacedWith&&(g=y.replacedWith)}if(c&&(c.from||0)==h&&(En(e,(null==c.to?u:c.to)-h,null!=c.from&&c.marker.replacedWith),null==c.to))return c.marker.find();g&&!c&&En(e,0,g)}if(h>=u)break;for(var w=Math.min(u,f);;){if(p){var _=h+p.length;if(!c){var b=_>w?p.slice(0,w-h):p;e.addToken(e,b,r+o,a,h+b.length==f?s:"")}if(_>=w){p=p.slice(w-h),h=w;break}h=_,a=""}p=n[d++],r=Ln(n[d++])}}else for(var d=1;d<n.length;d+=2)e.addToken(e,n[d],Ln(n[d+1]))}function On(t){this.lines=t,this.parent=null;for(var e=0,n=t.length,i=0;n>e;++e)t[e].parent=this,i+=t[e].height;this.height=i}function In(t){this.children=t;for(var e=0,n=0,i=0,r=t.length;r>i;++i){var o=t[i];e+=o.chunkSize(),n+=o.height,o.parent=this}this.size=e,this.height=n,this.parent=null}function Fn(t,e){for(;!t.lines;)for(var n=0;;++n){var i=t.children[n],r=i.chunkSize();if(r>e){t=i;break}e-=r}return t.lines[e]}function Rn(t,e){for(var n=e-t.height,i=t;i;i=i.parent)i.height+=n}function Hn(t){if(null==t.parent)return null;for(var e=t.parent,n=ui(e.lines,t),i=e.parent;i;e=i,i=i.parent)for(var r=0;i.children[r]!=e;++r)n+=i.children[r].chunkSize();return n}function zn(t){for(var e=t.parent;e.parent;e=e.parent);return e}function Wn(t,e){var n=0;t:do{for(var i=0,r=t.children.length;r>i;++i){var o=t.children[i],s=o.height;if(s>e){t=o;continue t}e-=s,n+=o.chunkSize()}return n}while(!t.lines);for(var i=0,r=t.lines.length;r>i;++i){var a=t.lines[i],c=a.height;if(c>e)break;e-=c}return n+i}function qn(t,e){e=hn(t.view.doc,e);for(var n=0,i=e.parent,r=0;r<i.lines.length;++r){var o=i.lines[r];if(o==e)break;n+=o.height}for(var s=i.parent;s;i=s,s=i.parent)for(var r=0;r<s.children.length;++r){var a=s.children[r];if(a==i)break;n+=a.height}return n}function jn(t){var e=t.order;return null==e&&(e=t.order=Kr(t.text)),e}function $n(){return{done:[],undone:[],lastTime:0,lastOp:null,lastOrigin:null,dirtyCounter:0}}function Gn(t,e,n,i,r,o,s,a,c){var l=t.view.history;l.undone.length=0;var u=+new Date,h=ci(l.done);if(h&&(l.lastOp==t.curOp.id||l.lastOrigin==r&&("input"==r||"delete"==r)&&l.lastTime>u-600)){var d=ci(h.events);if(d.start>e+i.length||d.start+d.added<e)h.events.push({start:e,added:n,old:i});else{for(var p=Math.max(0,d.start-e),f=Math.max(0,e+i.length-(d.start+d.added)),g=p;g>0;--g)d.old.unshift(i[g-1]);for(var g=f;g>0;--g)d.old.push(i[i.length-g]);p&&(d.start=e),d.added+=n-(i.length-p-f)}h.fromAfter=a,h.toAfter=c}else{for(h={events:[{start:e,added:n,old:i}],fromBefore:o,toBefore:s,fromAfter:a,toAfter:c},l.done.push(h);l.done.length>t.options.undoDepth;)l.done.shift();l.dirtyCounter<0?l.dirtyCounter=0/0:l.dirtyCounter++}l.lastTime=u,l.lastOp=t.curOp.id,l.lastOrigin=r}function Bn(){Xn(this)}function Yn(t){return t.stop||(t.stop=Bn),t}function Un(t){t.preventDefault?t.preventDefault():t.returnValue=!1}function Vn(t){t.stopPropagation?t.stopPropagation():t.cancelBubble=!0}function Xn(t){Un(t),Vn(t)}function Qn(t){return t.target||t.srcElement}function Jn(t){var e=t.which;return null==e&&(1&t.button?e=1:2&t.button?e=3:4&t.button&&(e=2)),Gi&&t.ctrlKey&&1==e&&(e=3),e}function Zn(t,e){var n=t.override&&t.override.hasOwnProperty(e);return n?t.override[e]:t[e]}function ti(t,e,n){if(t.addEventListener)t.addEventListener(e,n,!1);else if(t.attachEvent)t.attachEvent("on"+e,n);else{var i=t._handlers||(t._handlers={}),r=i[e]||(i[e]=[]);r.push(n)}}function ei(t,e,n){if(t.removeEventListener)t.removeEventListener(e,n,!1);else if(t.detachEvent)t.detachEvent("on"+e,n);else{var i=t._handlers&&t._handlers[e];if(!i)return;for(var r=0;r<i.length;++r)if(i[r]==n){i.splice(r,1);break}}}function ni(t,e){var n=t._handlers&&t._handlers[e];if(n)for(var i=Array.prototype.slice.call(arguments,2),r=0;r<n.length;++r)n[r].apply(null,i)}function ii(t,e,n){function i(t){return function(){t.apply(null,o)}}var r=e._handlers&&e._handlers[n];if(r)for(var o=Array.prototype.slice.call(arguments,3),s=t.curOp&&t.curOp.delayedCallbacks,a=0;a<r.length;++a)s?s.push(i(r[a])):r[a].apply(null,o)}function ri(t,e){var n=t._handlers&&t._handlers[e];return n&&n.length>0}function oi(){this.id=null}function si(t,e,n){null==e&&(e=t.search(/[^\s\u00a0]/),-1==e&&(e=t.length));for(var i=0,r=0;e>i;++i)"	"==t.charAt(i)?r+=n-r%n:++r;return r}function ai(t){for(;wr.length<=t;)wr.push(ci(wr)+" ");return wr[t]}function ci(t){return t[t.length-1]}function li(t){ji?(t.selectionStart=0,t.selectionEnd=t.value.length):t.select()}function ui(t,e){if(t.indexOf)return t.indexOf(e);for(var n=0,i=t.length;i>n;++n)if(t[n]==e)return n;return-1}function hi(t){for(var e=[],n=0;t>n;++n)e.push(void 0);return e}function di(t){var e=Array.prototype.slice.call(arguments,1);return function(){return t.apply(null,e)}}function pi(t){return/\w/.test(t)||t>""&&(t.toUpperCase()!=t.toLowerCase()||_r.test(t))}function fi(t){var e=0;for(var n in t)t.hasOwnProperty(n)&&t[n]&&++e;
return!e}function gi(t,e,n,i){var r=document.createElement(t);if(n&&(r.className=n),i&&(r.style.cssText=i),"string"==typeof e)yi(r,e);else if(e)for(var o=0;o<e.length;++o)r.appendChild(e[o]);return r}function mi(t){if(Ai)for(;t.firstChild;)t.removeChild(t.firstChild);else t.innerHTML="";return t}function vi(t,e){return mi(t).appendChild(e)}function yi(t,e){Ei?(t.innerHTML="",t.appendChild(document.createTextNode(e))):t.textContent=e}function wi(t){if(null!=Cr)return Cr;var e=gi("div",null,null,"width: 50px; height: 50px; overflow-x: scroll");return vi(t,e),e.offsetWidth&&(Cr=e.offsetHeight-e.clientHeight),Cr||0}function _i(t){if(null==Tr){var e=gi("span","​");vi(t,gi("span",[e,document.createTextNode("x")])),0!=t.firstChild.offsetHeight&&(Tr=e.offsetWidth<=1&&e.offsetHeight>2&&!Mi)}return Tr?gi("span","​"):gi("span"," ",null,"display: inline-block; width: 1px; margin-right: -1px")}function bi(t,e,n,i){if(!t)return i(e,n,"ltr");for(var r=0;r<t.length;++r){var o=t[r];(o.from<n&&o.to>e||e==n&&o.to==e)&&i(Math.max(o.from,e),Math.min(o.to,n),1==o.level?"rtl":"ltr")}}function xi(t){return t.level%2?t.to:t.from}function Si(t){return t.level%2?t.from:t.to}function Ci(t){var e=jn(t);return e?xi(e[0]):0}function Ti(t){var e=jn(t);return e?Si(ci(e)):t.text.length}function ki(t,e){var n=Fn(t.view.doc,e),i=hn(t.view.doc,n);i!=n&&(e=Hn(i));var r=jn(i),o=r?r[0].level%2?Ti(i):Ci(i):0;return{line:e,ch:o}}function Pi(t,e){for(var n,i;n=un(i=Fn(t.view.doc,e));)e=n.find().to.line;var r=jn(i),o=r?r[0].level%2?Ci(i):Ti(i):i.text.length;return{line:e,ch:o}}function Di(t,e,n,i){var r=jn(t);if(!r)return Li(t,e,n,i);for(var o=i?function(e,n){do e+=n;while(e>0&&br.test(t.text.charAt(e)));return e}:function(t,e){return t+e},s=r[0].level,a=0;a<r.length;++a){var c=r[a],l=c.level%2==s;if(c.from<e&&c.to>e||l&&(c.from==e||c.to==e))break}for(var u=o(e,c.level%2?-n:n);null!=u;)if(c.level%2==s){if(!(u<c.from||u>c.to))break;c=r[a+=n],u=c&&(n>0==c.level%2?o(c.to,-1):o(c.from,1))}else if(u==xi(c))c=r[--a],u=c&&Si(c);else{if(u!=Si(c))break;c=r[++a],u=c&&xi(c)}return 0>u||u>t.text.length?null:u}function Li(t,e,n,i){var r=e+n;if(i)for(;r>0&&br.test(t.text.charAt(r));)r+=n;return 0>r||r>t.text.length?null:r}var Ki=/gecko\/\d/i.test(navigator.userAgent),Ai=/MSIE \d/.test(navigator.userAgent),Mi=Ai&&(null==document.documentMode||document.documentMode<8),Ei=Ai&&(null==document.documentMode||document.documentMode<9),Ni=/WebKit\//.test(navigator.userAgent),Oi=Ni&&/Qt\/\d+\.\d+/.test(navigator.userAgent),Ii=/Chrome\//.test(navigator.userAgent),Fi=/Opera\//.test(navigator.userAgent),Ri=/Apple Computer/.test(navigator.vendor),Hi=/KHTML\//.test(navigator.userAgent),zi=/Mac OS X 1\d\D([7-9]|\d\d)\D/.test(navigator.userAgent),Wi=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(navigator.userAgent),qi=/PhantomJS/.test(navigator.userAgent),ji=/AppleWebKit/.test(navigator.userAgent)&&/Mobile\/\w+/.test(navigator.userAgent),$i=ji||/Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(navigator.userAgent),Gi=ji||/Mac/.test(navigator.platform),Bi=/windows/i.test(navigator.platform),Yi=Fi&&navigator.userAgent.match(/Version\/(\d*\.\d*)/);Yi&&(Yi=Number(Yi[1]));var Ui,Vi,Xi,Qi=Gi&&(Oi||Fi&&(null==Yi||12.11>Yi)),Ji=!1,Zi=!1,tr=0,er=null;Ai?er=-.53:Ki?er=15:Ii?er=-.7:Ri&&(er=-1/3);var nr,ir,rr=null;t.prototype={getValue:function(t){var e=[],n=this.view.doc;return n.iter(0,n.size,function(t){e.push(t.text)}),e.join(t||"\n")},setValue:U(null,function(t){var e=this.view.doc,n={line:0,ch:0},i=Fn(e,e.size-1).text.length;xe(this,n,{line:e.size-1,ch:i},kr(t),n,n,"setValue")}),getSelection:function(t){return this.getRange(this.view.sel.from,this.view.sel.to,t)},replaceSelection:U(null,function(t,e,n){var i=this.view.sel;be(this,i.from,i.to,kr(t),e||"around",n)}),focus:function(){window.focus(),te(this),ye(this),Q(this)},setOption:function(t,e){var n=this.options,i=n[t];(n[t]!=e||"mode"==t)&&(n[t]=e,or.hasOwnProperty(t)&&U(this,or[t])(this,e,i))},getOption:function(t){return this.options[t]},getMode:function(){return this.view.mode},addKeyMap:function(t){this.view.keyMaps.push(t)},removeKeyMap:function(t){for(var e=this.view.keyMaps,n=0;n<e.length;++n)if(("string"==typeof t?e[n].name:e[n])==t)return e.splice(n,1),!0},addOverlay:U(null,function(e,n){var i=e.token?e:t.getMode(this.options,e);if(i.startState)throw new Error("Overlays may not be stateful.");this.view.overlays.push({mode:i,modeSpec:e,opaque:n&&n.opaque}),this.view.modeGen++,V(this,0,this.view.doc.size)}),removeOverlay:U(null,function(t){for(var e=this.view.overlays,n=0;n<e.length;++n)if(e[n].modeSpec==t)return e.splice(n,1),this.view.modeGen++,V(this,0,this.view.doc.size),void 0}),undo:U(null,function(){Se(this,"undo")}),redo:U(null,function(){Se(this,"redo")}),indentLine:U(null,function(t,e,n){"string"!=typeof e&&(e=null==e?this.options.smartIndent?"smart":"prev":e?"add":"subtract"),Ae(this.view.doc,t)&&ze(this,t,e,n)}),indentSelection:U(null,function(t){var e=this.view.sel;if(ke(e.from,e.to))return ze(this,e.from.line,t);for(var n=e.to.line-(e.to.ch?0:1),i=e.from.line;n>=i;++i)ze(this,i,t)}),historySize:function(){var t=this.view.history;return{undo:t.done.length,redo:t.undone.length}},clearHistory:function(){this.view.history=$n()},markClean:function(){this.view.history.dirtyCounter=0,this.view.history.lastOp=this.view.history.lastOrigin=null},isClean:function(){return 0==this.view.history.dirtyCounter},getHistory:function(){function t(t){for(var e,n=0,i=[];n<t.length;++n){var r=t[n];i.push({events:e=[],fromBefore:r.fromBefore,toBefore:r.toBefore,fromAfter:r.fromAfter,toAfter:r.toAfter});for(var o=0,s=r.events;o<s.length;++o){var a=[],c=s[o];e.push({start:c.start,added:c.added,old:a});for(var l=0;l<c.old.length;++l)a.push(fn(c.old[l]))}}return i}var e=this.view.history;return{done:t(e.done),undone:t(e.undone)}},setHistory:function(t){var e=this.view.history=$n();e.done=t.done,e.undone=t.undone},getTokenAt:function(t){var e=this.view.doc;t=Ke(e,t);for(var n=M(this,t.line),i=this.view.mode,r=Fn(e,t.line),o=new Qe(r.text,this.options.tabSize);o.pos<t.ch&&!o.eol();){o.start=o.pos;var s=i.token(o,n)}return{start:o.start,end:o.pos,string:o.current(),className:s||null,type:s||null,state:n}},getStateAfter:function(t){var e=this.view.doc;return t=Le(e,null==t?e.size-1:t),M(this,t+1)},cursorCoords:function(t,e){var n,i=this.view.sel;return n=null==t?i.head:"object"==typeof t?Ke(this.view.doc,t):t?i.from:i.to,W(this,n,e||"page")},charCoords:function(t,e){return z(this,Ke(this.view.doc,t),e||"page")},coordsChar:function(t){var e=this.display.lineSpace.getBoundingClientRect();return q(this,t.left-e.left,t.top-e.top)},defaultTextHeight:function(){return $(this.display)},markText:U(null,function(t,e,n){return Ze(this,Ke(this.view.doc,t),Ke(this.view.doc,e),n,"range")}),setBookmark:U(null,function(t,e){return t=Ke(this.view.doc,t),Ze(this,t,t,e?{replacedWith:e}:{},"bookmark")}),findMarksAt:function(t){var e=this.view.doc;t=Ke(e,t);var n=[],i=Fn(e,t.line).markedSpans;if(i)for(var r=0;r<i.length;++r){var o=i[r];(null==o.from||o.from<=t.ch)&&(null==o.to||o.to>=t.ch)&&n.push(o.marker)}return n},setGutterMarker:U(null,function(t,e,n){return We(this,t,function(t){var i=t.gutterMarkers||(t.gutterMarkers={});return i[e]=n,!n&&fi(i)&&(t.gutterMarkers=null),!0})}),clearGutter:U(null,function(t){var e=0,n=this,i=n.view.doc;i.iter(0,i.size,function(i){i.gutterMarkers&&i.gutterMarkers[t]&&(i.gutterMarkers[t]=null,V(n,e,e+1),fi(i.gutterMarkers)&&(i.gutterMarkers=null)),++e})}),addLineClass:U(null,function(t,e,n){return We(this,t,function(t){var i="text"==e?"textClass":"background"==e?"bgClass":"wrapClass";if(t[i]){if(new RegExp("\\b"+n+"\\b").test(t[i]))return!1;t[i]+=" "+n}else t[i]=n;return!0})}),removeLineClass:U(null,function(t,e,n){return We(this,t,function(t){var i="text"==e?"textClass":"background"==e?"bgClass":"wrapClass",r=t[i];if(!r)return!1;if(null==n)t[i]=null;else{var o=r.replace(new RegExp("^"+n+"\\b\\s*|\\s*\\b"+n+"\\b"),"");if(o==r)return!1;t[i]=o||null}return!0})}),addLineWidget:U(null,function(t,e,n){return bn(this,t,e,n)}),removeLineWidget:function(t){t.clear()},lineInfo:function(t){if("number"==typeof t){if(!Ae(this.view.doc,t))return null;var e=t;if(t=Fn(this.view.doc,t),!t)return null}else{var e=Hn(t);if(null==e)return null}return{line:e,handle:t,text:t.text,gutterMarkers:t.gutterMarkers,textClass:t.textClass,bgClass:t.bgClass,wrapClass:t.wrapClass,widgets:t.widgets}},getViewport:function(){return{from:this.display.showingFrom,to:this.display.showingTo}},addWidget:function(t,e,n,i,r){var o=this.display;t=W(this,Ke(this.view.doc,t));var s=t.top,a=t.left;if(e.style.position="absolute",o.sizer.appendChild(e),"over"==i)s=t.top;else if("near"==i){var c=Math.max(o.wrapper.clientHeight,this.view.doc.height),l=Math.max(o.sizer.clientWidth,o.lineSpace.clientWidth);t.bottom+e.offsetHeight>c&&t.top>e.offsetHeight&&(s=t.top-e.offsetHeight),a+e.offsetWidth>l&&(a=l-e.offsetWidth)}e.style.top=s+E(o)+"px",e.style.left=e.style.right="","right"==r?(a=o.sizer.clientWidth-e.offsetWidth,e.style.right="0px"):("left"==r?a=0:"middle"==r&&(a=(o.sizer.clientWidth-e.offsetWidth)/2),e.style.left=a+"px"),n&&Re(this,a,s,a+e.offsetWidth,s+e.offsetHeight)},lineCount:function(){return this.view.doc.size},clipPos:function(t){return Ke(this.view.doc,t)},getCursor:function(t){var e,n=this.view.sel;return e=null==t||"head"==t?n.head:"anchor"==t?n.anchor:"end"==t||t===!1?n.to:n.from,De(e)},somethingSelected:function(){return!ke(this.view.sel.from,this.view.sel.to)},setCursor:U(null,function(t,e,n){var i=Ke(this.view.doc,"number"==typeof t?{line:t,ch:e||0}:t);n?Me(this,i):Ee(this,i,i)}),setSelection:U(null,function(t,e){var n=this.view.doc;Ee(this,Ke(n,t),Ke(n,e||t))}),extendSelection:U(null,function(t,e){var n=this.view.doc;Me(this,Ke(n,t),e&&Ke(n,e))}),setExtending:function(t){this.view.sel.extend=t},getLine:function(t){var e=this.getLineHandle(t);return e&&e.text},getLineHandle:function(t){var e=this.view.doc;return Ae(e,t)?Fn(e,t):void 0},getLineNumber:function(t){return Hn(t)},setLine:U(null,function(t,e){Ae(this.view.doc,t)&&Te(this,e,{line:t,ch:0},{line:t,ch:Fn(this.view.doc,t).text.length})}),removeLine:U(null,function(t){Ae(this.view.doc,t)&&Te(this,"",{line:t,ch:0},Ke(this.view.doc,{line:t+1,ch:0}))}),replaceRange:U(null,function(t,e,n){var i=this.view.doc;return e=Ke(i,e),n=n?Ke(i,n):e,Te(this,t,e,n)}),getRange:function(t,e,n){var i=this.view.doc;t=Ke(i,t),e=Ke(i,e);var r=t.line,o=e.line;if(r==o)return Fn(i,r).text.slice(t.ch,e.ch);var s=[Fn(i,r).text.slice(t.ch)];return i.iter(r+1,o,function(t){s.push(t.text)}),s.push(Fn(i,o).text.slice(0,e.ch)),s.join(n||"\n")},triggerOnKeyDown:U(null,me),execCommand:function(t){return dr[t](this)},moveH:U(null,function(t,e){var n=this.view.sel,i=0>t?n.from:n.to;(n.shift||n.extend||ke(n.from,n.to))&&(i=qe(this,t,e,this.options.rtlMoveVisually)),Me(this,i,i,t)}),deleteH:U(null,function(t,e){var n=this.view.sel;ke(n.from,n.to)?Te(this,"",n.from,qe(this,t,e,!1),"delete"):Te(this,"",n.from,n.to,"delete"),this.curOp.userSelChange=!0}),moveV:U(null,function(t,e){var n,i=this.view,r=i.doc,o=this.display,s=i.sel.head,a=W(this,s,"div"),c=a.left;if(null!=i.goalColumn&&(c=i.goalColumn),"page"==e){var l=Math.min(o.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight);n=a.top+t*l}else"line"==e&&(n=t>0?a.bottom+3:a.top-3);do{var u=q(this,c,n);n+=5*t}while(u.outside&&(0>t?n>0:n<r.height));"page"==e&&(o.scrollbarV.scrollTop+=z(this,u,"div").top-a.top),Me(this,u,u,t),i.goalColumn=c}),toggleOverwrite:function(){(this.view.overwrite=!this.view.overwrite)?this.display.cursor.className+=" CodeMirror-overwrite":this.display.cursor.className=this.display.cursor.className.replace(" CodeMirror-overwrite","")},posFromIndex:function(t){var e,n=0,i=this.view.doc;return i.iter(0,i.size,function(i){var r=i.text.length+1;return r>t?(e=t,!0):(t-=r,++n,void 0)}),Ke(i,{line:n,ch:e})},indexFromPos:function(t){t=Ke(this.view.doc,t);var e=t.ch;return this.view.doc.iter(0,t.line,function(t){e+=t.text.length+1}),e},scrollTo:function(t,e){null!=t&&(this.display.scrollbarH.scrollLeft=this.display.scroller.scrollLeft=t),null!=e&&(this.display.scrollbarV.scrollTop=this.display.scroller.scrollTop=e),y(this,[])},getScrollInfo:function(){var t=this.display.scroller,e=vr;return{left:t.scrollLeft,top:t.scrollTop,height:t.scrollHeight-e,width:t.scrollWidth-e,clientHeight:t.clientHeight-e,clientWidth:t.clientWidth-e}},scrollIntoView:function(t){"number"==typeof t&&(t={line:t,ch:0}),t&&null==t.line?Re(this,t.left,t.top,t.right,t.bottom):(t=t?Ke(this.view.doc,t):this.view.sel.head,Fe(this,t))},setSize:function(t,e){function n(t){return"number"==typeof t||/^\d+$/.test(String(t))?t+"px":t}null!=t&&(this.display.wrapper.style.width=n(t)),null!=e&&(this.display.wrapper.style.height=n(e)),this.refresh()},on:function(t,e){ti(this,t,e)},off:function(t,e){ei(this,t,e)},operation:function(t){return U(this,t)()},refresh:function(){R(this);var t=this.view.scrollTop,e=this.view.scrollLeft;this.display.scroller.scrollHeight>t&&(this.display.scrollbarV.scrollTop=this.display.scroller.scrollTop=t),this.display.scroller.scrollWidth>e&&(this.display.scrollbarH.scrollLeft=this.display.scroller.scrollLeft=e),y(this,!0)},getInputField:function(){return this.display.input},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}};var or=t.optionHandlers={},sr=t.defaults={},ar=t.Init={toString:function(){return"CodeMirror.Init"}};Ge("value","",function(t,e){t.setValue(e)},!0),Ge("mode",null,i,!0),Ge("indentUnit",2,i,!0),Ge("indentWithTabs",!1),Ge("smartIndent",!0),Ge("tabSize",4,function(t){i(t),R(t),y(t,!0)},!0),Ge("electricChars",!0),Ge("rtlMoveVisually",!Bi),Ge("theme","default",function(t){s(t),a(t)},!0),Ge("keyMap","default",o),Ge("extraKeys",null),Ge("onKeyEvent",null),Ge("onDragEvent",null),Ge("lineWrapping",!1,r,!0),Ge("gutters",[],function(t){h(t.options),a(t)},!0),Ge("fixedGutter",!0,function(t,e){t.display.gutters.style.left=e?v(t.display)+"px":"0",t.refresh()},!0),Ge("lineNumbers",!1,function(t){h(t.options),a(t)},!0),Ge("firstLineNumber",1,a,!0),Ge("lineNumberFormatter",function(t){return t},a,!0),Ge("showCursorWhenSelecting",!1,T,!0),Ge("readOnly",!1,function(t,e){"nocursor"==e?(we(t),t.display.input.blur()):e||Z(t,!0)}),Ge("dragDrop",!0),Ge("cursorBlinkRate",530),Ge("cursorHeight",1),Ge("workTime",100),Ge("workDelay",100),Ge("flattenSpans",!0),Ge("pollInterval",100),Ge("undoDepth",40),Ge("viewportMargin",10,function(t){t.refresh()},!0),Ge("tabindex",null,function(t,e){t.display.input.tabIndex=e||""}),Ge("autofocus",null);var cr=t.modes={},lr=t.mimeModes={};t.defineMode=function(e,n){if(t.defaults.mode||"null"==e||(t.defaults.mode=e),arguments.length>2){n.dependencies=[];for(var i=2;i<arguments.length;++i)n.dependencies.push(arguments[i])}cr[e]=n},t.defineMIME=function(t,e){lr[t]=e},t.resolveMode=function(e){if("string"==typeof e&&lr.hasOwnProperty(e))e=lr[e];else if("string"==typeof e&&/^[\w\-]+\/[\w\-]+\+xml$/.test(e))return t.resolveMode("application/xml");return"string"==typeof e?{name:e}:e||{name:"null"}},t.getMode=function(e,n){n=t.resolveMode(n);var i=cr[n.name];if(!i)return t.getMode(e,"text/plain");var r=i(e,n);if(ur.hasOwnProperty(n.name)){var o=ur[n.name];for(var s in o)o.hasOwnProperty(s)&&(r.hasOwnProperty(s)&&(r["_"+s]=r[s]),r[s]=o[s])}return r.name=n.name,r},t.defineMode("null",function(){return{token:function(t){t.skipToEnd()}}}),t.defineMIME("text/plain","null");var ur=t.modeExtensions={};t.extendMode=function(t,e){var n=ur.hasOwnProperty(t)?ur[t]:ur[t]={};for(var i in e)e.hasOwnProperty(i)&&(n[i]=e[i])},t.defineExtension=function(e,n){t.prototype[e]=n},t.defineOption=Ge;var hr=[];t.defineInitHook=function(t){hr.push(t)},t.copyState=Be,t.startState=Ye,t.innerMode=function(t,e){for(;t.innerMode;){var n=t.innerMode(e);e=n.state,t=n.mode}return n||{mode:t,state:e}};var dr=t.commands={selectAll:function(t){t.setSelection({line:0,ch:0},{line:t.lineCount()-1})},killLine:function(t){var e=t.getCursor(!0),n=t.getCursor(!1),i=!ke(e,n);i||t.getLine(e.line).length!=e.ch?t.replaceRange("",e,i?n:{line:e.line},"delete"):t.replaceRange("",e,{line:e.line+1,ch:0},"delete")},deleteLine:function(t){var e=t.getCursor().line;t.replaceRange("",{line:e,ch:0},{line:e},"delete")},undo:function(t){t.undo()},redo:function(t){t.redo()},goDocStart:function(t){t.extendSelection({line:0,ch:0})},goDocEnd:function(t){t.extendSelection({line:t.lineCount()-1})},goLineStart:function(t){t.extendSelection(ki(t,t.getCursor().line))},goLineStartSmart:function(t){var e=t.getCursor(),n=ki(t,e.line),i=t.getLineHandle(n.line),r=jn(i);if(r&&0!=r[0].level)t.extendSelection(n);else{var o=Math.max(0,i.text.search(/\S/)),s=e.line==n.line&&e.ch<=o&&e.ch;t.extendSelection({line:n.line,ch:s?0:o})}},goLineEnd:function(t){t.extendSelection(Pi(t,t.getCursor().line))},goLineUp:function(t){t.moveV(-1,"line")},goLineDown:function(t){t.moveV(1,"line")},goPageUp:function(t){t.moveV(-1,"page")},goPageDown:function(t){t.moveV(1,"page")},goCharLeft:function(t){t.moveH(-1,"char")},goCharRight:function(t){t.moveH(1,"char")},goColumnLeft:function(t){t.moveH(-1,"column")},goColumnRight:function(t){t.moveH(1,"column")},goWordLeft:function(t){t.moveH(-1,"word")},goWordRight:function(t){t.moveH(1,"word")},delCharBefore:function(t){t.deleteH(-1,"char")},delCharAfter:function(t){t.deleteH(1,"char")},delWordBefore:function(t){t.deleteH(-1,"word")},delWordAfter:function(t){t.deleteH(1,"word")},indentAuto:function(t){t.indentSelection("smart")},indentMore:function(t){t.indentSelection("add")},indentLess:function(t){t.indentSelection("subtract")},insertTab:function(t){t.replaceSelection("	","end","input")},defaultTab:function(t){t.somethingSelected()?t.indentSelection("add"):t.replaceSelection("	","end","input")},transposeChars:function(t){var e=t.getCursor(),n=t.getLine(e.line);e.ch>0&&e.ch<n.length-1&&t.replaceRange(n.charAt(e.ch)+n.charAt(e.ch-1),{line:e.line,ch:e.ch-1},{line:e.line,ch:e.ch+1})},newlineAndIndent:function(t){U(t,function(){t.replaceSelection("\n","end","input"),t.indentLine(t.getCursor().line,null,!0)})()},toggleOverwrite:function(t){t.toggleOverwrite()}},pr=t.keyMap={};pr.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite"},pr.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Alt-Up":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Down":"goDocEnd","Ctrl-Left":"goWordLeft","Ctrl-Right":"goWordRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delWordBefore","Ctrl-Delete":"delWordAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore",fallthrough:"basic"},pr.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goWordLeft","Alt-Right":"goWordRight","Cmd-Left":"goLineStart","Cmd-Right":"goLineEnd","Alt-Backspace":"delWordBefore","Ctrl-Alt-Backspace":"delWordAfter","Alt-Delete":"delWordAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore",fallthrough:["basic","emacsy"]},pr["default"]=Gi?pr.macDefault:pr.pcDefault,pr.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Alt-F":"goWordRight","Alt-B":"goWordLeft","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-D":"delWordAfter","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars"},t.isModifierKey=Xe,t.fromTextArea=function(e,n){function i(){e.value=c.getValue()}if(n||(n={}),n.value=e.value,!n.tabindex&&e.tabindex&&(n.tabindex=e.tabindex),null==n.autofocus){var r=document.body;try{r=document.activeElement}catch(o){}n.autofocus=r==e||null!=e.getAttribute("autofocus")&&r==document.body}if(e.form){ti(e.form,"submit",i);var s=e.form,a=s.submit;try{s.submit=function l(){i(),s.submit=a,s.submit(),s.submit=l}}catch(o){}}e.style.display="none";var c=t(function(t){e.parentNode.insertBefore(t,e.nextSibling)},n);return c.save=i,c.getTextArea=function(){return e},c.toTextArea=function(){i(),e.parentNode.removeChild(c.getWrapperElement()),e.style.display="",e.form&&(ei(e.form,"submit",i),"function"==typeof e.form.submit&&(e.form.submit=a))},c},Qe.prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return 0==this.pos},peek:function(){return this.string.charAt(this.pos)||void 0},next:function(){return this.pos<this.string.length?this.string.charAt(this.pos++):void 0},eat:function(t){var e=this.string.charAt(this.pos);if("string"==typeof t)var n=e==t;else var n=e&&(t.test?t.test(e):t(e));return n?(++this.pos,e):void 0},eatWhile:function(t){for(var e=this.pos;this.eat(t););return this.pos>e},eatSpace:function(){for(var t=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>t},skipToEnd:function(){this.pos=this.string.length},skipTo:function(t){var e=this.string.indexOf(t,this.pos);return e>-1?(this.pos=e,!0):void 0},backUp:function(t){this.pos-=t},column:function(){return si(this.string,this.start,this.tabSize)},indentation:function(){return si(this.string,null,this.tabSize)},match:function(t,e,n){if("string"!=typeof t){var i=this.string.slice(this.pos).match(t);return i&&i.index>0?null:(i&&e!==!1&&(this.pos+=i[0].length),i)}var r=function(t){return n?t.toLowerCase():t};return r(this.string).indexOf(r(t),this.pos)==this.pos?(e!==!1&&(this.pos+=t.length),!0):void 0},current:function(){return this.string.slice(this.start,this.pos)}},t.StringStream=Qe,t.TextMarker=Je,Je.prototype.clear=function(){if(!this.explicitlyCleared){B(this.cm);for(var t=this.cm.view,e=null,n=null,i=0;i<this.lines.length;++i){var r=this.lines[i],o=tn(r.markedSpans,this);null!=o.to&&(n=Hn(r)),r.markedSpans=en(r.markedSpans,o),null!=o.from?e=Hn(r):this.collapsed&&!dn(r)&&Rn(r,$(this.cm.display))}if(this.collapsed&&!this.cm.options.lineWrapping)for(var i=0;i<this.lines.length;++i){var s=hn(t.doc,this.lines[i]),a=l(t.doc,s);a>t.maxLineLength&&(t.maxLine=s,t.maxLineLength=a,t.maxLineChanged=!0)}null!=e&&V(this.cm,e,n+1),this.lines.length=0,this.explicitlyCleared=!0,this.collapsed&&this.cm.view.cantEdit&&(this.cm.view.cantEdit=!1,Ne(this.cm)),Y(this.cm),ii(this.cm,this,"clear")}},Je.prototype.find=function(){for(var t,e,n=0;n<this.lines.length;++n){var i=this.lines[n],r=tn(i.markedSpans,this);if(null!=r.from||null!=r.to){var o=Hn(i);null!=r.from&&(t={line:o,ch:r.from}),null!=r.to&&(e={line:o,ch:r.to})}}return"bookmark"==this.type?t:t&&{from:t,to:e}},Je.prototype.getOptions=function(t){var e=this.replacedWith;return{className:this.className,inclusiveLeft:this.inclusiveLeft,inclusiveRight:this.inclusiveRight,atomic:this.atomic,collapsed:this.collapsed,clearOnEnter:this.clearOnEnter,replacedWith:t?e&&e.cloneNode(!0):e,readOnly:this.readOnly,startStyle:this.startStyle,endStyle:this.endStyle}};var fr=t.LineWidget=function(t,e,n){for(var i in n)n.hasOwnProperty(i)&&(this[i]=n[i]);this.cm=t,this.node=e};fr.prototype.clear=wn(function(){var t=this.line.widgets,e=Hn(this.line);if(null!=e&&t){for(var n=0;n<t.length;++n)t[n]==this&&t.splice(n--,1);Rn(this.line,Math.max(0,this.line.height-_n(this))),V(this.cm,e,e+1)}}),fr.prototype.changed=wn(function(){var t=this.height;this.height=null;var e=_n(this)-t;if(e){Rn(this.line,this.line.height+e);var n=Hn(this.line);V(this.cm,n,n+1)}});var gr={},mr=/[\t\u0000-\u0019\u200b\u2028\u2029\uFEFF]/g;On.prototype={chunkSize:function(){return this.lines.length},remove:function(t,e,n){for(var i=t,r=t+e;r>i;++i){var o=this.lines[i];this.height-=o.height,Cn(o),ii(n,o,"delete")}this.lines.splice(t,e)},collapse:function(t){t.splice.apply(t,[t.length,0].concat(this.lines))},insertHeight:function(t,e,n){this.height+=n,this.lines=this.lines.slice(0,t).concat(e).concat(this.lines.slice(t));for(var i=0,r=e.length;r>i;++i)e[i].parent=this},iterN:function(t,e,n){for(var i=t+e;i>t;++t)if(n(this.lines[t]))return!0}},In.prototype={chunkSize:function(){return this.size},remove:function(t,e,n){this.size-=e;for(var i=0;i<this.children.length;++i){var r=this.children[i],o=r.chunkSize();if(o>t){var s=Math.min(e,o-t),a=r.height;if(r.remove(t,s,n),this.height-=a-r.height,o==s&&(this.children.splice(i--,1),r.parent=null),0==(e-=s))break;t=0}else t-=o}if(this.size-e<25){var c=[];this.collapse(c),this.children=[new On(c)],this.children[0].parent=this}},collapse:function(t){for(var e=0,n=this.children.length;n>e;++e)this.children[e].collapse(t)},insert:function(t,e){for(var n=0,i=0,r=e.length;r>i;++i)n+=e[i].height;this.insertHeight(t,e,n)},insertHeight:function(t,e,n){this.size+=e.length,this.height+=n;for(var i=0,r=this.children.length;r>i;++i){var o=this.children[i],s=o.chunkSize();if(s>=t){if(o.insertHeight(t,e,n),o.lines&&o.lines.length>50){for(;o.lines.length>50;){var a=o.lines.splice(o.lines.length-25,25),c=new On(a);o.height-=c.height,this.children.splice(i+1,0,c),c.parent=this}this.maybeSpill()}break}t-=s}},maybeSpill:function(){if(!(this.children.length<=10)){var t=this;do{var e=t.children.splice(t.children.length-5,5),n=new In(e);if(t.parent){t.size-=n.size,t.height-=n.height;var i=ui(t.parent.children,t);t.parent.children.splice(i+1,0,n)}else{var r=new In(t.children);r.parent=t,t.children=[r,n],t=r}n.parent=t.parent}while(t.children.length>10);t.parent.maybeSpill()}},iter:function(t,e,n){this.iterN(t,e-t,n)},iterN:function(t,e,n){for(var i=0,r=this.children.length;r>i;++i){var o=this.children[i],s=o.chunkSize();if(s>t){var a=Math.min(e,s-t);if(o.iterN(t,a,n))return!0;if(0==(e-=a))break;t=0}else t-=s}}},t.e_stop=Xn,t.e_preventDefault=Un,t.e_stopPropagation=Vn,t.on=ti,t.off=ei,t.signal=ni;var vr=30,yr=t.Pass={toString:function(){return"CodeMirror.Pass"}};oi.prototype={set:function(t,e){clearTimeout(this.id),this.id=setTimeout(e,t)}},t.countColumn=si;var wr=[""],_r=/[\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc]/,br=/[\u0300-\u036F\u0483-\u0487\u0488-\u0489\u0591-\u05BD\u05BF\u05C1-\u05C2\u05C4-\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7-\u06E8\u06EA-\u06ED\uA66F\uA670-\uA672\uA674-\uA67D\uA69F]/,xr=function(){if(Ei)return!1;var t=gi("div");return"draggable"in t||"dragDrop"in t}(),Sr=/^$/;Ki?Sr=/$'/:Ri?Sr=/\-[^ \-?]|\?[^ !'\"\),.\-\/:;\?\]\}]/:Ii&&(Sr=/\-[^ \-\.?]|\?[^ \-\.?\]\}:;!'\"\),\/]|[\.!\"#&%\)*+,:;=>\]|\}~][\(\{\[<]|\$'/);var Cr,Tr,kr=3!="\n\nb".split(/\n/).length?function(t){for(var e=0,n=[],i=t.length;i>=e;){var r=t.indexOf("\n",e);-1==r&&(r=t.length);var o=t.slice(e,"\r"==t.charAt(r-1)?r-1:r),s=o.indexOf("\r");-1!=s?(n.push(o.slice(0,s)),e+=s+1):(n.push(o),e=r+1)}return n}:function(t){return t.split(/\r\n?|\n/)};t.splitLines=kr;var Pr=window.getSelection?function(t){try{return t.selectionStart!=t.selectionEnd}catch(e){return!1}}:function(t){try{var e=t.ownerDocument.selection.createRange()}catch(n){}return e&&e.parentElement()==t?0!=e.compareEndPoints("StartToEnd",e):!1},Dr=function(){var t=gi("div");return"oncopy"in t?!0:(t.setAttribute("oncopy","return;"),"function"==typeof t.oncopy)}(),Lr={3:"Enter",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",91:"Mod",92:"Mod",93:"Mod",109:"-",107:"=",127:"Delete",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63276:"PageUp",63277:"PageDown",63275:"End",63273:"Home",63234:"Left",63232:"Up",63235:"Right",63233:"Down",63302:"Insert",63272:"Delete"};t.keyNames=Lr,function(){for(var t=0;10>t;t++)Lr[t+48]=String(t);for(var t=65;90>=t;t++)Lr[t]=String.fromCharCode(t);for(var t=1;12>=t;t++)Lr[t+111]=Lr[t+63235]="F"+t}();var Kr=function(){function t(t){return 255>=t?e.charAt(t):t>=1424&&1524>=t?"R":t>=1536&&1791>=t?n.charAt(t-1536):t>=1792&&2220>=t?"r":"L"}var e="bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLL",n="rrrrrrrrrrrr,rNNmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmrrrrrrrnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmNmmmmrrrrrrrrrrrrrrrrrr",i=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,r=/[stwN]/,o=/[LRr]/,s=/[Lb1n]/,a=/[1n]/,c="L";return function(e){if(!i.test(e))return!1;for(var n,l=e.length,u=[],h=0;l>h;++h)u.push(n=t(e.charCodeAt(h)));for(var h=0,d=c;l>h;++h){var n=u[h];"m"==n?u[h]=d:d=n}for(var h=0,p=c;l>h;++h){var n=u[h];"1"==n&&"r"==p?u[h]="n":o.test(n)&&(p=n,"r"==n&&(u[h]="R"))}for(var h=1,d=u[0];l-1>h;++h){var n=u[h];"+"==n&&"1"==d&&"1"==u[h+1]?u[h]="1":","!=n||d!=u[h+1]||"1"!=d&&"n"!=d||(u[h]=d),d=n}for(var h=0;l>h;++h){var n=u[h];if(","==n)u[h]="N";else if("%"==n){for(var f=h+1;l>f&&"%"==u[f];++f);for(var g=h&&"!"==u[h-1]||l-1>f&&"1"==u[f]?"1":"N",m=h;f>m;++m)u[m]=g;h=f-1}}for(var h=0,p=c;l>h;++h){var n=u[h];"L"==p&&"1"==n?u[h]="L":o.test(n)&&(p=n)}for(var h=0;l>h;++h)if(r.test(u[h])){for(var f=h+1;l>f&&r.test(u[f]);++f);for(var v="L"==(h?u[h-1]:c),y="L"==(l-1>f?u[f]:c),g=v||y?"L":"R",m=h;f>m;++m)u[m]=g;h=f-1}for(var w,_=[],h=0;l>h;)if(s.test(u[h])){var b=h;for(++h;l>h&&s.test(u[h]);++h);_.push({from:b,to:h,level:0})}else{var x=h,S=_.length;for(++h;l>h&&"L"!=u[h];++h);for(var m=x;h>m;)if(a.test(u[m])){m>x&&_.splice(S,0,{from:x,to:m,level:1});var C=m;for(++m;h>m&&a.test(u[m]);++m);_.splice(S,0,{from:C,to:m,level:2}),x=m}else++m;h>x&&_.splice(S,0,{from:x,to:h,level:1})}return 1==_[0].level&&(w=e.match(/^\s+/))&&(_[0].from=w[0].length,_.unshift({from:0,to:w[0].length,level:0})),1==ci(_).level&&(w=e.match(/\s+$/))&&(ci(_).to-=w[0].length,_.push({from:l-w[0].length,to:l,level:0})),_[0].level!=ci(_).level&&_.push({from:l,to:l,level:_[0].level}),_}}();return t.version="3.02",t}(),define("codemirror",function(t){return function(){var e;return e||t.CodeMirror}}(this)),function(){function t(t){"_activeLine"in t&&(t.removeLineClass(t._activeLine,"wrap",n),t.removeLineClass(t._activeLine,"background",i))}function e(e){var r=e.getLineHandle(e.getCursor().line);e._activeLine!=r&&(t(e),e.addLineClass(r,"wrap",n),e.addLineClass(r,"background",i),e._activeLine=r)}var n="CodeMirror-activeline",i="CodeMirror-activeline-background";CodeMirror.defineOption("styleActiveLine",!1,function(n,i,r){var o=r&&r!=CodeMirror.Init;i&&!o?(e(n),n.on("cursorActivity",e)):!i&&o&&(n.off("cursorActivity",e),t(n),delete n._activeLine)})}(),define("codemirrormarkselection",function(){}),function(){function t(t){t._selectionMark&&t._selectionMark.clear()}function e(e){t(e),e._selectionMark=e.somethingSelected()?e.markText(e.getCursor("start"),e.getCursor("end"),{className:"CodeMirror-selectedtext"}):null}CodeMirror.defineOption("styleSelectedText",!1,function(n,i,r){var o=r&&r!=CodeMirror.Init;i&&!o?(e(n),n.on("cursorActivity",e)):!i&&o&&(n.off("cursorActivity",e),t(n),delete n._selectionMark)})}(),define("codemirroractiveline",function(){});var __hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var i in e)__hasProp.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};define("application/views/codeeditor",["require","underscore","backbone","codemirror","../events","codemirrormarkselection","codemirroractiveline"],function(t){var e,n,i,r,o;
return o=t("underscore"),e=t("backbone"),i=t("codemirror"),r=t("../events"),t("codemirrormarkselection"),t("codemirroractiveline"),i.defineMode("uml",function(){var t;return t=/^(?:title|participant|as|alt|opt|loop|else|end)$/im,{token:function(e){var n,i;return e.eatSpace()?null:(n=e.next(),"'"===n?(e.skipToEnd(),"comment"):'"'===n?(e.skipTo('"'),"string"):/\w/.test(n)&&(e.eatWhile(/\w/),i=e.current(),t.test(i))?"keyword":void 0)}}}),n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.el="#code-text-area",e.prototype.initialize=function(t){var e=this;return this.context=t.context,this.editor=i.fromTextArea(this.$el.get(0),{mode:"uml",tabSize:2,indentWithTabs:!0,lineNumbers:!0,dragDrop:!1,styleActiveLine:!0}),this.oldCode=this.editor.getValue(),this.editor.on("change",o(function(){return e.onCodeChanged()}).debounce(800)),this.listenTo(r,"exampleSelected",this.onExampleSelected),this.listenTo(r,"documentChanged",this.onDocumentChanged)},e.prototype.setContent=function(t){return this.changing=!0,this.context.setCurrentDocumentContent(t),this.editor.setValue(t),r.trigger("codeChanged",{code:t}),this.changing=!1},e.prototype.onExampleSelected=function(t){var e;return this.context.isCurrentDocumentEditable()?(e=this.editor.getValue(),e&&(e+="\n"),e+=t.example.get("snippet"),this.editor.setValue(e),this.editor.focus()):!1},e.prototype.onDocumentChanged=function(){var t;return this.changing=!0,t=this.context.getCurrentDocumentContent(),this.editor.setOption("readOnly",!this.context.isCurrentDocumentEditable()),this.editor.setValue(t),this.editor.focus(),this.changing=!1},e.prototype.onCodeChanged=function(){var t;return t=this.editor.getValue(),t===this.oldCode?!1:(this.context.setCurrentDocumentContent(t),r.trigger("codeChanged",{code:t}),this.changing||r.trigger("broadcastDocumentContentChange",{content:t}),this.oldCode=t)},e}(e.View)});var __hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var i in e)__hasProp.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};define("application/views/outputgenerator",["require","backbone","../events"],function(t){var e,n,i;return e=t("backbone"),i=t("../events"),n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.el="#output-text-area",e.prototype.initialize=function(){return this.listenTo(i,"parseStarted",this.onParseStarted),this.listenTo(i,"parseWarning parseError",this.onParseWarningOrError),this.listenTo(i,"parseCompleted",this.onParseCompleted)},e.prototype.onParseStarted=function(){return this.$el.val("")},e.prototype.onParseWarningOrError=function(t){var e;return e=this.$el.val(),e&&(e+="\n"),e+=t.message,this.$el.val(e)},e.prototype.onParseCompleted=function(t){var e;return null==(null!=t?t.diagram:void 0)?!1:(e=this.$el.val(),e&&(e+="\n"),e+="Diagram generated successfully.",this.$el.val(e))},e}(e.View)}),define("application/uml/language/sequence/comment",[],function(){var t;return t=function(){function t(){}return t.prototype.handles=function(t){return/^[\s\t]*'/i.test(t.line)},t}()}),define("application/uml/language/sequence/helpers",[],function(){return{trim:function(t){var e,n;if(!t)return t;for(n=t.replace(/^\s+/,""),e=n.length-1;e>=0;){if(/\S/.test(n.charAt(e))){n=n.substring(0,e+1);break}e--}return n}}}),define("application/uml/language/sequence/title",["require","./helpers"],function(t){var e,n;return n=t("./helpers").trim,e=function(){function t(){}return t.prototype.handles=function(t){var e,i;if(i=t.line.match(/^title\s+(\w.*)/i),!i)return!1;if(t.title||t.participants.length||t.commands.length)throw e="Error on line "+t.getLineNumber()+", "+"title must be defined before any other instruction.",new Error(e);return t.setTitle(n(i[1])),!0},t}()}),define("application/uml/language/sequence/participant",["require","./helpers"],function(t){var e,n;return n=t("./helpers").trim,e=function(){function t(){}return t.prototype.handles=function(t){var e,i,r,o,s;if(r=t.line.match(/^participant\s+(.+)/i),!r)return!1;if(s=r[1],r=s.match(/^"(\w.*)"\s+as\s+(\w.*)/i),r?(o=n(r[1]),e=n(r[2])):o=n(s),t.findParticipant(o))throw i="Error on line "+t.getLineNumber()+", "+('participant with name "'+o+'" already exists.'),new Error(i);if(null!=e&&t.findParticipant(e))throw i="Error on line "+t.getLineNumber()+", "+('participant with alias "'+e+'" already exists.'),new Error(i);return t.addParticipant(o,e),!0},t}()}),define("application/uml/language/sequence/message",["require","underscore","./helpers"],function(t){var e,n,i,r,o,s,a,c,l,u,h,d,p;return p=t("underscore"),d=t("./helpers").trim,l={asyncDash:"-->>",syncDash:"-->",asyncLine:"->>",syncLine:"->"},r={asyncDash:"<<--",syncDash:"<--",asyncLine:"<<-",syncLine:"<-"},u=p(l).values(),o=p(r).values(),s=[l.asyncLine,l.syncLine,r.asyncLine,r.syncLine],i=[l.asyncDash,l.syncDash,r.asyncDash,r.syncDash],h=[l.syncDash,l.syncLine,r.syncDash,r.syncLine],n=[l.asyncDash,l.asyncLine,r.asyncDash,r.asyncLine],e=p(u).union(o),c=new RegExp("^[\\s|\\t]*(\\w.*)\\s+("+e.join("|")+")\\s+(\\w.*)\\s*:\\s*(\\w.*)","i"),a=function(){function t(){}return t.prototype.handles=function(t){var e,r,a,l,f,g,m,v;if(f=t.line.match(c),!f)return!1;if(e=d(f[2]),p(u).contains(e))v=t.findOrCreateParticipant(d(f[1])),m=t.findOrCreateParticipant(d(f[3]));else{if(!p(o).contains(e))throw l="Error on line "+t.getLineNumber()+", "+('unrecognized arrow "'+e+'".'),new Error(l);m=t.findOrCreateParticipant(d(f[1])),v=t.findOrCreateParticipant(d(f[3]))}return r=function(){if(p(n).contains(e))return!0;if(p(h).contains(e))return!1;throw l="Error on line "+t.getLineNumber()+", "+('unrecognized arrow "'+e+'".'),new Error(l)}(),a=function(){if(p(i).contains(e))return!0;if(p(s).contains(e))return!1;throw l="Error on line "+t.getLineNumber()+", "+('unrecognized arrow "'+e+'".'),new Error(l)}(),g=d(f[4]),t.addMessage(v,m,g,r,a),!0},t}()}),define("application/uml/models/sequence/grouptype",[],function(){return{opt:"opt",loop:"loop"}}),define("application/uml/language/sequence/group",["require","underscore","../../models/sequence/grouptype","./helpers"],function(t){var e,n,i,r,o,s;return s=t("underscore"),i=t("../../models/sequence/grouptype"),o=t("./helpers").trim,n=s(i).values(),r=new RegExp("^[\\s|\\t]*("+n.join("|")+")\\s*(.*)","i"),e=function(){function t(){}return t.prototype.handles=function(t){var e;return(e=t.line.match(r))?(t.addGroup(o(e[1]),o(e[2])),!0):!1},t}()}),define("application/uml/language/sequence/condition",["require","./helpers"],function(t){var e,n;return n=t("./helpers").trim,e=function(){function t(){}return t.prototype.handles=function(t){var e;return(e=t.line.match(/^[\s\t]*alt\s*(.*)/i))?(t.addIf(n(e[1])),!0):(e=t.line.match(/^[\s\t]*else\s*(.*)/i))?(t.addElse(n(e[1])),!0):!1},t}()}),define("application/uml/language/sequence/end",[],function(){var t;return t=function(){function t(){}return t.prototype.handles=function(t){return/^[\s\t]*end/i.test(t.line)?(t.closeParent(),!0):!1},t}()}),define("application/uml/models/sequence/title",[],function(){var t;return t=function(){function t(t){this.text=t}return t}()}),define("application/uml/models/sequence/participant",[],function(){var t;return t=function(){function t(t,e){this.name=t,this.alias=e}return t}()}),define("application/uml/models/sequence/base",[],function(){var t;return t=function(){function t(t){this.setParent(t)}return t.prototype.setParent=function(t){var e;return this.parent===t?this:(this.parent&&(e=this.parent.children.indexOf(this),e>=0&&this.parent.children.splice(e,1)),this.parent=t,this.parent&&this.parent.children.push(this),this)},t}()});var __hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var i in e)__hasProp.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};define("application/uml/models/sequence/message",["require","./base"],function(t){var e,n;return e=t("./base"),n=function(t){function e(t,n,i,r,o,s){this.sender=t,this.receiver=n,this.name=i,this.async=r,this.callReturn=o,e.__super__.constructor.call(this,s)}return __extends(e,t),e.prototype.selfInvoking=function(){return this.sender===this.receiver},e}(e)});var __hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var i in e)__hasProp.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};define("application/uml/models/sequence/composite",["require","./base"],function(t){var e,n;return e=t("./base"),n=function(t){function e(){this.children=[],e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e}(e)});var __hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var i in e)__hasProp.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};define("application/uml/models/sequence/group",["require","./composite"],function(t){var e,n;return e=t("./composite"),n=function(t){function e(t,n,i){this.label=n,this.type=i,e.__super__.constructor.call(this,t)}return __extends(e,t),e}(e)});var __hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var i in e)__hasProp.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};define("application/uml/models/sequence/condition",["require","underscore","./composite","./group"],function(t){var e,n,i,r;return r=t("underscore"),e=t("./composite"),i=t("./group"),n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.createIfGroup=function(t){return new i(this,t)},e.prototype.addElseGroup=function(t){return new i(this,t)},e.prototype.getIfGroup=function(){return r(this.children).first()},e.prototype.getElseGroups=function(){return r(this.children).rest()},e}(e)}),define("application/uml/models/sequence/diagram",[],function(){var t;return t=function(){function t(t,e,n){this.title=t,this.participants=null!=e?e:[],this.commands=null!=n?n:[]}return t}()}),define("application/uml/language/sequence/context",["require","underscore","../../models/sequence/title","../../models/sequence/participant","../../models/sequence/message","../../models/sequence/group","../../models/sequence/condition","../../models/sequence/diagram"],function(t){var e,n,i,r,o,s,a,c;return c=t("underscore"),a=t("../../models/sequence/title"),s=t("../../models/sequence/participant"),o=t("../../models/sequence/message"),r=t("../../models/sequence/group"),e=t("../../models/sequence/condition"),i=t("../../models/sequence/diagram"),n=function(){function t(t){this.payload=t,this.participants=[],this.commands=[]}return t.prototype.getLineNumber=function(){return(this.index||0)+1},t.prototype.updateLineInfo=function(t,e){this.line=t,this.index=e},t.prototype.setTitle=function(t){return this.title=new a(t)},t.prototype.addParticipant=function(t,e){var n;return n=new s(t,e),this.participants.push(n),n},t.prototype.findParticipant=function(t){return t&&this.participants.length&&c(this.participants).find(function(e){return t===e.name||t===e.alias})},t.prototype.findOrCreateParticipant=function(t){return this.findParticipant(t)||this.addParticipant(t)},t.prototype.addMessage=function(t,e,n,i,r){var s;return s=new o(t,e,n,i,r,this.parentCommand),this.parentCommand||this.commands.push(s),s},t.prototype.addGroup=function(t,e){var n;return n=new r(this.parentCommand,e,t),this.parentCommand||this.commands.push(n),this.parentCommand=n,n},t.prototype.addIf=function(t){var n,i;return n=new e(this.parentCommand),i=n.createIfGroup(t),this.parentCommand||this.commands.push(n),this.parentCommand=i,i},t.prototype.addElse=function(t){var e,n,i,r;if(!(null!=(i=this.parentCommand)?null!=(r=i.parent)?r.getIfGroup():void 0:void 0))throw e="Error on line "+this.getLineNumber()+", cannot "+'use "else" without an "alt".',new Error(e);return n=this.parentCommand.parent.addElseGroup(t),this.parentCommand=n,n},t.prototype.closeParent=function(){var t;if(!this.parentCommand)throw t="Error on line "+this.getLineNumber()+", cannot end "+"without a group start.",new Error(t);return this.parentCommand.parent instanceof e&&(this.parentCommand=this.parentCommand.parent),this.parentCommand=this.parentCommand.parent},t.prototype.done=function(){var t;if(this.parentCommand)throw t='Error! One or more group(s) is not properly closed, please add the missing "end" for unclosed group(s).',new Error(t)},t.prototype.getDiagram=function(){return new i(this.title,this.participants,this.commands)},t}()}),define("application/uml/language/sequence/parser",["require","underscore","./comment","./title","./participant","./message","./group","./condition","./end","./context","./helpers"],function(t){var e,n,i,r,o,s,a,c,l,u,h,d,p;return p=t("underscore"),e=t("./comment"),u=t("./title"),l=t("./participant"),s=t("./message"),o=t("./group"),n=t("./condition"),r=t("./end"),i=t("./context"),d=t("./helpers").trim,a=/(\r\n|\n|\r)/g,h=function(){return[new e,new u,new l,new s,new o,new n,new r]},c=function(){function t(t){null==t&&(t={}),this.callbacks=p(t.callbacks||{}).defaults({onStart:function(){},onWarning:function(){},onError:function(){},onComplete:function(){}}),this.handlers=t.handlers||h()}return t.prototype.contextType=i,t.prototype.parse=function(t){var e,n,i,r,o=this;if(this.callbacks.onStart(),!t)return this.callbacks.onComplete(),!1;r=p(t.split(a)).reject(function(t){return a.test(t)||!(d(t)||"").length}),e=r.join("\n"),n=new this.contextType(e);try{return p(r).each(function(t,e){var i,r;return n.updateLineInfo(t,e),i=p(o.handlers).some(function(t){return t.handles(n)}),i?void 0:(r="Warning on line "+n.getLineNumber()+", "+('unrecognized command "'+t+'".'),o.callbacks.onWarning(r))}),n.done(),i=n.getDiagram(),this.callbacks.onComplete({diagram:i.participants.length?i:void 0,code:e}),!0}catch(s){return this.callbacks.onError(s),!1}},t}()});var __hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var i in e)__hasProp.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};define("application/views/editor",["require","backbone","./codeeditor","./outputgenerator","../uml/language/sequence/parser","../events"],function(t){var e,n,i,r,o,s,a;return e=t("backbone"),n=t("./codeeditor"),r=t("./outputgenerator"),o=t("../uml/language/sequence/parser"),s=t("../events"),i=function(t){function e(){return a=e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.el="#editor-container",e.prototype.codeEditorViewType=n,e.prototype.outputGeneratorViewType=r,e.prototype.parserType=o,e.prototype.initialize=function(t){var e;return this.context=t.context,this.code=new this.codeEditorViewType({context:this.context}),this.output=new this.outputGeneratorViewType,e={onStart:function(){return s.trigger("parseStarted")},onWarning:function(t){return s.trigger("parseWarning",{message:t})},onError:function(t){return s.trigger("parseError",{message:t.message})},onComplete:function(t){return s.trigger("parseCompleted",t)}},this.parser=new this.parserType({callbacks:e}),this.listenTo(s,"codeChanged",this.onCodeChanged),this.listenTo(s,"documentContentChanged",this.onDocumentContentChanged),this.codeLabel=this.$("#code-section").find(".title-bar").find("span").first(),this.listenTo(s,"documentChanged",this.onDocumentChanged)},e.prototype.onCodeChanged=function(t){return this.parser.parse(t.code)},e.prototype.onDocumentContentChanged=function(t){return this.code.setContent(t.code)},e.prototype.onDocumentChanged=function(){var t;return t="Code",this.context.isCurrentDocumentEditable()||(t+=" (readonly)"),this.codeLabel.text(t)},e}(e.View)});var Kinetic={};!function(){Kinetic.version="4.4.3",Kinetic.Filters={},Kinetic.DD={},Kinetic.Global={stages:[],idCounter:0,ids:{},names:{},shapes:{},isDragging:function(){var t=Kinetic.DD;return t?t.isDragging:!1},isDragReady:function(){var t=Kinetic.DD;return t?!!t.node:!1},warn:function(t){window.console&&console.warn&&console.warn("Kinetic warning: "+t)},extend:function(t,e){for(var n in e.prototype)n in t.prototype||(t.prototype[n]=e.prototype[n])},_addId:function(t,e){void 0!==e&&(this.ids[e]=t)},_removeId:function(t){void 0!==t&&delete this.ids[t]},_addName:function(t,e){void 0!==e&&(void 0===this.names[e]&&(this.names[e]=[]),this.names[e].push(t))},_removeName:function(t,e){if(void 0!==t){var n=this.names[t];if(void 0!==n){for(var i=0;i<n.length;i++){var r=n[i];r._id===e&&n.splice(i,1)}0===n.length&&delete this.names[t]}}}}}(),function(t,e){"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define("kinetic",e):t.returnExports=e()}(this,function(){return Kinetic}),function(){var t="canvas",e="2d",n="[object Array]",i="[object Number]",r="[object String]",o=Math.PI/180,s=180/Math.PI;Kinetic.Type={_isElement:function(t){return!(!t||1!=t.nodeType)},_isFunction:function(t){return!!(t&&t.constructor&&t.call&&t.apply)},_isObject:function(t){return!!t&&t.constructor==Object},_isArray:function(t){return Object.prototype.toString.call(t)==n},_isNumber:function(t){return Object.prototype.toString.call(t)==i},_isString:function(t){return Object.prototype.toString.call(t)==r},_hasMethods:function(t){var e,n=[];for(e in t)this._isFunction(t[e])&&n.push(e);return n.length>0},_isInDocument:function(t){for(;t=t.parentNode;)if(t==document)return!0;return!1},_getXY:function(t){if(this._isNumber(t))return{x:t,y:t};if(this._isArray(t)){if(1===t.length){var e=t[0];if(this._isNumber(e))return{x:e,y:e};if(this._isArray(e))return{x:e[0],y:e[1]};if(this._isObject(e))return e}else if(t.length>=2)return{x:t[0],y:t[1]}}else if(this._isObject(t))return t;return null},_getSize:function(t){if(this._isNumber(t))return{width:t,height:t};if(this._isArray(t))if(1===t.length){var e=t[0];if(this._isNumber(e))return{width:e,height:e};if(this._isArray(e)){if(e.length>=4)return{width:e[2],height:e[3]};if(e.length>=2)return{width:e[0],height:e[1]}}else if(this._isObject(e))return e}else{if(t.length>=4)return{width:t[2],height:t[3]};if(t.length>=2)return{width:t[0],height:t[1]}}else if(this._isObject(t))return t;return null},_getPoints:function(t){if(void 0===t)return[];if(this._isArray(t[0])){for(var e=[],n=0;n<t.length;n++)e.push({x:t[n][0],y:t[n][1]});return e}if(this._isObject(t[0]))return t;for(var e=[],n=0;n<t.length;n+=2)e.push({x:t[n],y:t[n+1]});return e},_getImage:function(n,i){var r,o,s,a;n?this._isElement(n)?i(n):this._isString(n)?(r=new Image,r.onload=function(){i(r)},r.src=n):n.data?(o=document.createElement(t),o.width=n.width,o.height=n.height,s=o.getContext(e),s.putImageData(n,0,0),a=o.toDataURL(),r=new Image,r.onload=function(){i(r)},r.src=a):i(null):i(null)},_rgbToHex:function(t,e,n){return((1<<24)+(t<<16)+(e<<8)+n).toString(16).slice(1)},_hexToRgb:function(t){var e=parseInt(t,16);return{r:255&e>>16,g:255&e>>8,b:255&e}},_getRandomColorKey:function(){for(var t=(16777215*Math.random()<<0).toString(16);t.length<6;)t="0"+t;return t},_merge:function(t,e){var n=this._clone(e);for(var i in t)n[i]=this._isObject(t[i])?this._merge(t[i],n[i]):t[i];return n},_clone:function(t){var e={};for(var n in t)e[n]=this._isObject(t[n])?this._clone(t[n]):t[n];return e},_degToRad:function(t){return t*o},_radToDeg:function(t){return t*s},_capitalize:function(t){return t.charAt(0).toUpperCase()+t.slice(1)}}}(),function(){var t=document.createElement("canvas"),e=t.getContext("2d"),n=window.devicePixelRatio||1,i=e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1,r=n/i;Kinetic.Canvas=function(t){this.init(t)},Kinetic.Canvas.prototype={init:function(t){var t=t||{},e=t.width||0,n=t.height||0,i=t.pixelRatio||r,o=t.contextType||"2d";this.pixelRatio=i,this.width=e,this.height=n,this.element=document.createElement("canvas"),this.element.style.padding=0,this.element.style.margin=0,this.element.style.border=0,this.element.style.background="transparent",this.context=this.element.getContext(o),this.setSize(e,n)},getElement:function(){return this.element},getContext:function(){return this.context},setWidth:function(t){this.width=t,this.element.width=t*this.pixelRatio,this.element.style.width=t+"px"},setHeight:function(t){this.height=t,this.element.height=t*this.pixelRatio,this.element.style.height=t+"px"},getWidth:function(){return this.width},getHeight:function(){return this.height},setSize:function(t,e){this.setWidth(t),this.setHeight(e)}},Kinetic.Canvas2D=function(t){Kinetic.Canvas.call(this,t)},Kinetic.Canvas2D.prototype={clear:function(){var t=this.getContext(),e=this.getElement();t.clearRect(0,0,e.width,e.height)},toDataURL:function(t,e){try{return this.element.toDataURL(t,e)}catch(n){try{return this.element.toDataURL()}catch(n){return Kinetic.Global.warn("Unable to get data URL. "+n.message),""}}},fill:function(t){t.getFillEnabled()&&this._fill(t)},stroke:function(t){t.getStrokeEnabled()&&this._stroke(t)},fillStroke:function(t){var e=t.getFillEnabled();e&&this._fill(t),t.getStrokeEnabled()&&this._stroke(t,t.hasShadow()&&t.hasFill()&&e)},applyShadow:function(t,e){var n=this.context;n.save(),this._applyShadow(t),e(),n.restore(),e()},_applyLineCap:function(t){var e=t.getLineCap();e&&(this.context.lineCap=e)},_applyOpacity:function(t){var e=t.getAbsoluteOpacity();1!==e&&(this.context.globalAlpha=e)},_applyLineJoin:function(t){var e=t.getLineJoin();e&&(this.context.lineJoin=e)},_applyAncestorTransforms:function(t){var e=this.context;t._eachAncestorReverse(function(t){var n=t.getTransform(),i=n.getMatrix();e.transform(i[0],i[1],i[2],i[3],i[4],i[5])},!0)},_clip:function(t){var e=this.getContext();e.save(),this._applyAncestorTransforms(t),e.beginPath(),t.getClipFunc()(this),e.clip(),e.setTransform(1,0,0,1,0,0)}},Kinetic.Global.extend(Kinetic.Canvas2D,Kinetic.Canvas),Kinetic.SceneCanvas=function(t){Kinetic.Canvas2D.call(this,t)},Kinetic.SceneCanvas.prototype={setWidth:function(t){var e=this.pixelRatio;Kinetic.Canvas.prototype.setWidth.call(this,t),this.context.scale(e,e)},setHeight:function(t){var e=this.pixelRatio;Kinetic.Canvas.prototype.setHeight.call(this,t),this.context.scale(e,e)},_fillColor:function(t){var e=this.context,n=t.getFill();e.fillStyle=n,t._fillFunc(e)},_fillPattern:function(t){var e=this.context,n=t.getFillPatternImage(),i=t.getFillPatternX(),r=t.getFillPatternY(),o=t.getFillPatternScale(),s=t.getFillPatternRotation(),a=t.getFillPatternOffset(),c=t.getFillPatternRepeat();(i||r)&&e.translate(i||0,r||0),s&&e.rotate(s),o&&e.scale(o.x,o.y),a&&e.translate(-1*a.x,-1*a.y),e.fillStyle=e.createPattern(n,c||"repeat"),e.fill()},_fillLinearGradient:function(t){for(var e=this.context,n=t.getFillLinearGradientStartPoint(),i=t.getFillLinearGradientEndPoint(),r=t.getFillLinearGradientColorStops(),o=e.createLinearGradient(n.x,n.y,i.x,i.y),s=0;s<r.length;s+=2)o.addColorStop(r[s],r[s+1]);e.fillStyle=o,e.fill()},_fillRadialGradient:function(t){for(var e=this.context,n=t.getFillRadialGradientStartPoint(),i=t.getFillRadialGradientEndPoint(),r=t.getFillRadialGradientStartRadius(),o=t.getFillRadialGradientEndRadius(),s=t.getFillRadialGradientColorStops(),a=e.createRadialGradient(n.x,n.y,r,i.x,i.y,o),c=0;c<s.length;c+=2)a.addColorStop(s[c],s[c+1]);e.fillStyle=a,e.fill()},_fill:function(t,e){var n=this.context,i=t.getFill(),r=t.getFillPatternImage(),o=t.getFillLinearGradientStartPoint(),s=t.getFillRadialGradientStartPoint(),a=t.getFillPriority();n.save(),!e&&t.hasShadow()&&this._applyShadow(t),i&&"color"===a?this._fillColor(t):r&&"pattern"===a?this._fillPattern(t):o&&"linear-gradient"===a?this._fillLinearGradient(t):s&&"radial-gradient"===a?this._fillRadialGradient(t):i?this._fillColor(t):r?this._fillPattern(t):o?this._fillLinearGradient(t):s&&this._fillRadialGradient(t),n.restore(),!e&&t.hasShadow()&&this._fill(t,!0)},_stroke:function(t,e){var n=this.context,i=t.getStroke(),r=t.getStrokeWidth(),o=t.getDashArray();(i||r)&&(n.save(),t.getStrokeScaleEnabled()||n.setTransform(1,0,0,1,0,0),this._applyLineCap(t),o&&t.getDashArrayEnabled()&&(n.setLineDash?n.setLineDash(o):"mozDash"in n?n.mozDash=o:"webkitLineDash"in n&&(n.webkitLineDash=o)),!e&&t.hasShadow()&&this._applyShadow(t),n.lineWidth=r||2,n.strokeStyle=i||"black",t._strokeFunc(n),n.restore(),!e&&t.hasShadow()&&this._stroke(t,!0))},_applyShadow:function(t){var e=this.context;if(t.hasShadow()&&t.getShadowEnabled()){var n=t.getAbsoluteOpacity(),i=t.getShadowColor()||"black",r=t.getShadowBlur()||5,o=t.getShadowOffset()||{x:0,y:0};t.getShadowOpacity()&&(e.globalAlpha=t.getShadowOpacity()*n),e.shadowColor=i,e.shadowBlur=r,e.shadowOffsetX=o.x,e.shadowOffsetY=o.y}}},Kinetic.Global.extend(Kinetic.SceneCanvas,Kinetic.Canvas2D),Kinetic.HitCanvas=function(t){Kinetic.Canvas2D.call(this,t)},Kinetic.HitCanvas.prototype={_fill:function(t){var e=this.context;e.save(),e.fillStyle="#"+t.colorKey,t._fillFuncHit(e),e.restore()},_stroke:function(t){var e=this.context,n=t.getStroke(),i=t.getStrokeWidth();(n||i)&&(this._applyLineCap(t),e.save(),e.lineWidth=i||2,e.strokeStyle="#"+t.colorKey,t._strokeFuncHit(e),e.restore())}},Kinetic.Global.extend(Kinetic.HitCanvas,Kinetic.Canvas2D)}(),function(){Kinetic.Tween=function(t,e,n,i,r){this._listeners=[],this.addListener(this),this.propFunc=t,this.begin=n,this._pos=n,this.setDuration(r),this.isPlaying=!1,this._change=0,this.prevTime=0,this.prevPos=0,this.looping=!1,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.name="",this.func=e,this.setFinish(i)},Kinetic.Tween.prototype={setTime:function(t){this.prevTime=this._time,t>this.getDuration()?this.looping?(this.rewind(t-this._duration),this.update(),this.broadcastMessage("onLooped",{target:this,type:"onLooped"})):(this._time=this._duration,this.update(),this.stop(),this.broadcastMessage("onFinished",{target:this,type:"onFinished"})):0>t?(this.rewind(),this.update()):(this._time=t,this.update())},getTime:function(){return this._time},setDuration:function(t){this._duration=null===t||0>=t?1e5:t},getDuration:function(){return this._duration},setPosition:function(t){this.prevPos=this._pos,this.propFunc(t),this._pos=t,this.broadcastMessage("onChanged",{target:this,type:"onChanged"})},getPosition:function(t){return void 0===t&&(t=this._time),this.func(t,this.begin,this._change,this._duration)},setFinish:function(t){this._change=t-this.begin},getFinish:function(){return this.begin+this._change},start:function(){this.rewind(),this.startEnterFrame(),this.broadcastMessage("onStarted",{target:this,type:"onStarted"})},rewind:function(t){this.stop(),this._time=void 0===t?0:t,this.fixTime(),this.update()},fforward:function(){this._time=this._duration,this.fixTime(),this.update()},update:function(){this.setPosition(this.getPosition(this._time))},startEnterFrame:function(){this.stopEnterFrame(),this.isPlaying=!0,this.onEnterFrame()},onEnterFrame:function(){this.isPlaying&&this.nextFrame()},nextFrame:function(){this.setTime((this.getTimer()-this._startTime)/1e3)},stop:function(){this.stopEnterFrame(),this.broadcastMessage("onStopped",{target:this,type:"onStopped"})},stopEnterFrame:function(){this.isPlaying=!1},continueTo:function(t,e){this.begin=this._pos,this.setFinish(t),void 0!==this._duration&&this.setDuration(e),this.start()},resume:function(){this.fixTime(),this.startEnterFrame(),this.broadcastMessage("onResumed",{target:this,type:"onResumed"})},yoyo:function(){this.continueTo(this.begin,this._time)},addListener:function(t){return this.removeListener(t),this._listeners.push(t)},removeListener:function(t){for(var e=this._listeners,n=e.length;n--;)if(e[n]==t)return e.splice(n,1),!0;return!1},broadcastMessage:function(){for(var t=[],e=0;e<arguments.length;e++)t.push(arguments[e]);for(var n=t.shift(),i=this._listeners,r=i.length,e=0;r>e;e++)i[e][n]&&i[e][n].apply(i[e],t)},fixTime:function(){this._startTime=this.getTimer()-1e3*this._time},getTimer:function(){return(new Date).getTime()-this._time}},Kinetic.Tweens={"back-ease-in":function(t,e,n,i){var r=1.70158;return n*(t/=i)*t*((r+1)*t-r)+e},"back-ease-out":function(t,e,n,i){var r=1.70158;return n*((t=t/i-1)*t*((r+1)*t+r)+1)+e},"back-ease-in-out":function(t,e,n,i){var r=1.70158;return(t/=i/2)<1?n/2*t*t*(((r*=1.525)+1)*t-r)+e:n/2*((t-=2)*t*(((r*=1.525)+1)*t+r)+2)+e},"elastic-ease-in":function(t,e,n,i,r,o){var s=0;return 0===t?e:1==(t/=i)?e+n:(o||(o=.3*i),!r||r<Math.abs(n)?(r=n,s=o/4):s=o/(2*Math.PI)*Math.asin(n/r),-(r*Math.pow(2,10*(t-=1))*Math.sin((t*i-s)*2*Math.PI/o))+e)},"elastic-ease-out":function(t,e,n,i,r,o){var s=0;return 0===t?e:1==(t/=i)?e+n:(o||(o=.3*i),!r||r<Math.abs(n)?(r=n,s=o/4):s=o/(2*Math.PI)*Math.asin(n/r),r*Math.pow(2,-10*t)*Math.sin((t*i-s)*2*Math.PI/o)+n+e)},"elastic-ease-in-out":function(t,e,n,i,r,o){var s=0;return 0===t?e:2==(t/=i/2)?e+n:(o||(o=i*.3*1.5),!r||r<Math.abs(n)?(r=n,s=o/4):s=o/(2*Math.PI)*Math.asin(n/r),1>t?-.5*r*Math.pow(2,10*(t-=1))*Math.sin((t*i-s)*2*Math.PI/o)+e:.5*r*Math.pow(2,-10*(t-=1))*Math.sin((t*i-s)*2*Math.PI/o)+n+e)},"bounce-ease-out":function(t,e,n,i){return(t/=i)<1/2.75?n*7.5625*t*t+e:2/2.75>t?n*(7.5625*(t-=1.5/2.75)*t+.75)+e:2.5/2.75>t?n*(7.5625*(t-=2.25/2.75)*t+.9375)+e:n*(7.5625*(t-=2.625/2.75)*t+.984375)+e},"bounce-ease-in":function(t,e,n,i){return n-Kinetic.Tweens["bounce-ease-out"](i-t,0,n,i)+e},"bounce-ease-in-out":function(t,e,n,i){return i/2>t?.5*Kinetic.Tweens["bounce-ease-in"](2*t,0,n,i)+e:.5*Kinetic.Tweens["bounce-ease-out"](2*t-i,0,n,i)+.5*n+e},"ease-in":function(t,e,n,i){return n*(t/=i)*t+e},"ease-out":function(t,e,n,i){return-n*(t/=i)*(t-2)+e},"ease-in-out":function(t,e,n,i){return(t/=i/2)<1?n/2*t*t+e:-n/2*(--t*(t-2)-1)+e},"strong-ease-in":function(t,e,n,i){return n*(t/=i)*t*t*t*t+e},"strong-ease-out":function(t,e,n,i){return n*((t=t/i-1)*t*t*t*t+1)+e},"strong-ease-in-out":function(t,e,n,i){return(t/=i/2)<1?n/2*t*t*t*t*t+e:n/2*((t-=2)*t*t*t*t+2)+e},linear:function(t,e,n,i){return n*t/i+e}}}(),function(){Kinetic.Transform=function(){this.m=[1,0,0,1,0,0]},Kinetic.Transform.prototype={translate:function(t,e){this.m[4]+=this.m[0]*t+this.m[2]*e,this.m[5]+=this.m[1]*t+this.m[3]*e},scale:function(t,e){this.m[0]*=t,this.m[1]*=t,this.m[2]*=e,this.m[3]*=e},rotate:function(t){var e=Math.cos(t),n=Math.sin(t),i=this.m[0]*e+this.m[2]*n,r=this.m[1]*e+this.m[3]*n,o=this.m[0]*-n+this.m[2]*e,s=this.m[1]*-n+this.m[3]*e;this.m[0]=i,this.m[1]=r,this.m[2]=o,this.m[3]=s},getTranslation:function(){return{x:this.m[4],y:this.m[5]}},multiply:function(t){var e=this.m[0]*t.m[0]+this.m[2]*t.m[1],n=this.m[1]*t.m[0]+this.m[3]*t.m[1],i=this.m[0]*t.m[2]+this.m[2]*t.m[3],r=this.m[1]*t.m[2]+this.m[3]*t.m[3],o=this.m[0]*t.m[4]+this.m[2]*t.m[5]+this.m[4],s=this.m[1]*t.m[4]+this.m[3]*t.m[5]+this.m[5];this.m[0]=e,this.m[1]=n,this.m[2]=i,this.m[3]=r,this.m[4]=o,this.m[5]=s},invert:function(){var t=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),e=this.m[3]*t,n=-this.m[1]*t,i=-this.m[2]*t,r=this.m[0]*t,o=t*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),s=t*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=e,this.m[1]=n,this.m[2]=i,this.m[3]=r,this.m[4]=o,this.m[5]=s},getMatrix:function(){return this.m}}}(),function(){Kinetic.Collection=function(){var t=[].slice.call(arguments),e=t.length,n=0;for(this.length=e;e>n;n++)this[n]=t[n];return this},Kinetic.Collection.prototype=new Array,Kinetic.Collection.prototype.each=function(t){for(var e=0;e<this.length;e++)t(this[e],e)},Kinetic.Collection.mapMethods=function(t){var e,n=t.length;for(e=0;n>e;e++)!function(e){var n=t[e];Kinetic.Collection.prototype[n]=function(){var t,e=this.length;for(args=[].slice.call(arguments),t=0;e>t;t++)this[t][n].apply(this[t],args)}}(e)}}(),function(){Kinetic.Filters.Grayscale=function(t){for(var e=t.data,n=0;n<e.length;n+=4){var i=.34*e[n]+.5*e[n+1]+.16*e[n+2];e[n]=i,e[n+1]=i,e[n+2]=i}}}(),function(){Kinetic.Filters.Brighten=function(t,e){for(var n=e.val||0,i=t.data,r=0;r<i.length;r+=4)i[r]+=n,i[r+1]+=n,i[r+2]+=n}}(),function(){Kinetic.Filters.Invert=function(t){for(var e=t.data,n=0;n<e.length;n+=4)e[n]=255-e[n],e[n+1]=255-e[n+1],e[n+2]=255-e[n+2]
}}(),function(t){function e(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}function n(t,n){var o,s,a,c,l,u,h,d,p,f,g,m,v,y,w,_,b,x,S,C,T,k,P,D,L=t.data,K=t.width,A=t.height,M=n+n+1,E=K-1,N=A-1,O=n+1,I=O*(O+1)/2,F=new e,R=F,H=null,z=null,W=i[n],q=r[n];for(a=1;M>a;a++)if(R=R.next=new e,a==O)var j=R;for(R.next=F,h=u=0,s=0;A>s;s++){for(_=b=x=S=d=p=f=g=0,m=O*(C=L[u]),v=O*(T=L[u+1]),y=O*(k=L[u+2]),w=O*(P=L[u+3]),d+=I*C,p+=I*T,f+=I*k,g+=I*P,R=F,a=0;O>a;a++)R.r=C,R.g=T,R.b=k,R.a=P,R=R.next;for(a=1;O>a;a++)c=u+((a>E?E:a)<<2),d+=(R.r=C=L[c])*(D=O-a),p+=(R.g=T=L[c+1])*D,f+=(R.b=k=L[c+2])*D,g+=(R.a=P=L[c+3])*D,_+=C,b+=T,x+=k,S+=P,R=R.next;for(H=F,z=j,o=0;K>o;o++)L[u+3]=P=g*W>>q,0!=P?(P=255/P,L[u]=(d*W>>q)*P,L[u+1]=(p*W>>q)*P,L[u+2]=(f*W>>q)*P):L[u]=L[u+1]=L[u+2]=0,d-=m,p-=v,f-=y,g-=w,m-=H.r,v-=H.g,y-=H.b,w-=H.a,c=h+((c=o+n+1)<E?c:E)<<2,_+=H.r=L[c],b+=H.g=L[c+1],x+=H.b=L[c+2],S+=H.a=L[c+3],d+=_,p+=b,f+=x,g+=S,H=H.next,m+=C=z.r,v+=T=z.g,y+=k=z.b,w+=P=z.a,_-=C,b-=T,x-=k,S-=P,z=z.next,u+=4;h+=K}for(o=0;K>o;o++){for(b=x=S=_=p=f=g=d=0,u=o<<2,m=O*(C=L[u]),v=O*(T=L[u+1]),y=O*(k=L[u+2]),w=O*(P=L[u+3]),d+=I*C,p+=I*T,f+=I*k,g+=I*P,R=F,a=0;O>a;a++)R.r=C,R.g=T,R.b=k,R.a=P,R=R.next;for(l=K,a=1;n>=a;a++)u=l+o<<2,d+=(R.r=C=L[u])*(D=O-a),p+=(R.g=T=L[u+1])*D,f+=(R.b=k=L[u+2])*D,g+=(R.a=P=L[u+3])*D,_+=C,b+=T,x+=k,S+=P,R=R.next,N>a&&(l+=K);for(u=o,H=F,z=j,s=0;A>s;s++)c=u<<2,L[c+3]=P=g*W>>q,P>0?(P=255/P,L[c]=(d*W>>q)*P,L[c+1]=(p*W>>q)*P,L[c+2]=(f*W>>q)*P):L[c]=L[c+1]=L[c+2]=0,d-=m,p-=v,f-=y,g-=w,m-=H.r,v-=H.g,y-=H.b,w-=H.a,c=o+((c=s+O)<N?c:N)*K<<2,d+=_+=H.r=L[c],p+=b+=H.g=L[c+1],f+=x+=H.b=L[c+2],g+=S+=H.a=L[c+3],H=H.next,m+=C=z.r,v+=T=z.g,y+=k=z.b,w+=P=z.a,_-=C,b-=T,x-=k,S-=P,z=z.next,u+=K}}var i=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],r=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];t=t||{},t.Filters=t.Filters||{},t.Filters.Blur=function(t,e){var i=e.radius;i|=0,n(t,i)},window.Kinetic=t}(Kinetic),function(t){function e(t,e,n){var i=4*(n*t.width+e),r=[];return r.push(t.data[i++],t.data[i++],t.data[i++],t.data[i++]),r}function n(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)+Math.pow(t[2]-e[2],2))}function i(t){for(var e=[0,0,0],n=0;n<t.length;n++)e[0]+=t[n][0],e[1]+=t[n][1],e[2]+=t[n][2];return e[0]/=t.length,e[1]/=t.length,e[2]/=t.length,e}function r(t,r){var o=e(t,0,0),s=e(t,t.width-1,0),a=e(t,0,t.height-1),c=e(t,t.width-1,t.height-1),l=r&&r.threshold?r.threshold:10;if(n(o,s)<l&&n(s,c)<l&&n(c,a)<l&&n(a,o)<l){for(var u=i([s,o,c,a]),h=[],d=0;d<t.width*t.height;d++){var p=n(u,[t.data[4*d],t.data[4*d+1],t.data[4*d+2]]);h[d]=l>p?0:255}return h}}function o(t,e){for(var n=0;n<t.width*t.height;n++)t.data[4*n+3]=e[n]}function s(t,e,n){for(var i=[1,1,1,1,0,1,1,1,1],r=Math.round(Math.sqrt(i.length)),o=Math.floor(r/2),s=[],a=0;n>a;a++)for(var c=0;e>c;c++){for(var l=a*e+c,u=0,h=0;r>h;h++)for(var d=0;r>d;d++){var p=a+h-o,f=c+d-o;if(p>=0&&n>p&&f>=0&&e>f){var g=p*e+f,m=i[h*r+d];u+=t[g]*m}}s[l]=2040===u?255:0}return s}function a(t,e,n){for(var i=[1,1,1,1,1,1,1,1,1],r=Math.round(Math.sqrt(i.length)),o=Math.floor(r/2),s=[],a=0;n>a;a++)for(var c=0;e>c;c++){for(var l=a*e+c,u=0,h=0;r>h;h++)for(var d=0;r>d;d++){var p=a+h-o,f=c+d-o;if(p>=0&&n>p&&f>=0&&e>f){var g=p*e+f,m=i[h*r+d];u+=t[g]*m}}s[l]=u>=1020?255:0}return s}function c(t,e,n){for(var i=[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9],r=Math.round(Math.sqrt(i.length)),o=Math.floor(r/2),s=[],a=0;n>a;a++)for(var c=0;e>c;c++){for(var l=a*e+c,u=0,h=0;r>h;h++)for(var d=0;r>d;d++){var p=a+h-o,f=c+d-o;if(p>=0&&n>p&&f>=0&&e>f){var g=p*e+f,m=i[h*r+d];u+=t[g]*m}}s[l]=u}return s}t=t||{},t.Filters=t.Filters||{},t.Filters.Mask=function(t,e){var n=r(t,e);return n&&(n=s(n,t.width,t.height),n=a(n,t.width,t.height),n=c(n,t.width,t.height),o(t,n)),t},window.Kinetic=t}(Kinetic),function(){var t=" ",e="",n=".",i="get",r="set",o="Shape",s="Stage",a="x",c="y",l="kinetic",u="before",h="Change",d="id",p="name",f="mouseenter",g="mouseleave",m="Deg",v="beforeDraw",y="draw";Kinetic.Node=function(t){this._nodeInit(t)},Kinetic.Node.prototype={_nodeInit:function(t){this._id=Kinetic.Global.idCounter++,this.eventListeners={},this.setAttrs(t)},on:function(i,r){var o,s,a,c,l,u,h=i.split(t),d=h.length;for(o=0;d>o;o++)s=h[o],a=s,c=a.split(n),l=c[0],u=c.length>1?c[1]:e,this.eventListeners[l]||(this.eventListeners[l]=[]),this.eventListeners[l].push({name:u,handler:r});return this},off:function(e){var i,r,o,s,a,c=e.split(t),l=c.length;for(i=0;l>i;i++)if(r=c[i],o=r,s=o.split(n),a=s[0],s.length>1)if(a)this.eventListeners[a]&&this._off(a,s[1]);else for(var r in this.eventListeners)this._off(r,s[1]);else delete this.eventListeners[a];return this},remove:function(){var t=this.getParent();t&&t.children&&(t.children.splice(this.index,1),t._setChildrenIndices()),delete this.parent},destroy:function(){for(var t=(this.getParent(),this.getStage(),Kinetic.DD,Kinetic.Global);this.children&&this.children.length>0;)this.children[0].destroy();t._removeId(this.getId()),t._removeName(this.getName(),this._id),this.trans&&this.trans.stop(),this.remove()},getAttr:function(t){var e=i+Kinetic.Type._capitalize(t);return this[e]()},getAttrs:function(){return this.attrs||{}},createAttrs:function(){void 0===this.attrs&&(this.attrs={})},setAttrs:function(t){var e,n;if(t)for(e in t)n=r+Kinetic.Type._capitalize(e),Kinetic.Type._isFunction(this[n])?this[n](t[e]):this.setAttr(e,t[e])},getVisible:function(){var t=this.attrs.visible,e=this.getParent();return void 0===t&&(t=!0),t&&e&&!e.getVisible()?!1:t},getListening:function(){var t=this.attrs.listening,e=this.getParent();return void 0===t&&(t=!0),t&&e&&!e.getListening()?!1:t},show:function(){this.setVisible(!0)},hide:function(){this.setVisible(!1)},getZIndex:function(){return this.index||0},getAbsoluteZIndex:function(){function t(s){for(e=[],n=s.length,i=0;n>i;i++)r=s[i],l++,r.nodeType!==o&&(e=e.concat(r.getChildren())),r._id===c._id&&(i=n);e.length>0&&e[0].getLevel()<=a&&t(e)}var e,n,i,r,a=this.getLevel(),c=(this.getStage(),this),l=0;return c.nodeType!==s&&t(c.getStage().getChildren()),l},getLevel:function(){for(var t=0,e=this.parent;e;)t++,e=e.parent;return t},setPosition:function(){var t=Kinetic.Type._getXY([].slice.call(arguments));this.setAttr(a,t.x),this.setAttr(c,t.y)},getPosition:function(){return{x:this.getX(),y:this.getY()}},getAbsolutePosition:function(){var t=this.getAbsoluteTransform(),e=this.getOffset();return t.translate(e.x,e.y),t.getTranslation()},setAbsolutePosition:function(){var t,e=Kinetic.Type._getXY([].slice.call(arguments)),n=this._clearTransform();this.attrs.x=n.x,this.attrs.y=n.y,delete n.x,delete n.y,t=this.getAbsoluteTransform(),t.invert(),t.translate(e.x,e.y),e={x:this.attrs.x+t.getTranslation().x,y:this.attrs.y+t.getTranslation().y},this.setPosition(e.x,e.y),this._setTransform(n)},move:function(){var t=Kinetic.Type._getXY([].slice.call(arguments)),e=this.getX(),n=this.getY();void 0!==t.x&&(e+=t.x),void 0!==t.y&&(n+=t.y),this.setPosition(e,n)},_eachAncestorReverse:function(t,e){var n,i,r=[],o=this.getParent();for(e&&r.unshift(this);o;)r.unshift(o),o=o.parent;for(n=r.length,i=0;n>i;i++)t(r[i])},rotate:function(t){this.setRotation(this.getRotation()+t)},rotateDeg:function(t){this.setRotation(this.getRotation()+Kinetic.Type._degToRad(t))},moveToTop:function(){var t=this.index;return this.parent.children.splice(t,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0},moveUp:function(){var t=this.index,e=this.parent.getChildren().length;return e-1>t?(this.parent.children.splice(t,1),this.parent.children.splice(t+1,0,this),this.parent._setChildrenIndices(),!0):void 0},moveDown:function(){var t=this.index;return t>0?(this.parent.children.splice(t,1),this.parent.children.splice(t-1,0,this),this.parent._setChildrenIndices(),!0):void 0},moveToBottom:function(){var t=this.index;return t>0?(this.parent.children.splice(t,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0):void 0},setZIndex:function(t){var e=this.index;this.parent.children.splice(e,1),this.parent.children.splice(t,0,this),this.parent._setChildrenIndices()},getAbsoluteOpacity:function(){var t=this.getOpacity();return this.getParent()&&(t*=this.getParent().getAbsoluteOpacity()),t},moveTo:function(t){Kinetic.Node.prototype.remove.call(this),t.add(this)},toObject:function(){var t,e,n=Kinetic.Type,i={},r=this.getAttrs();i.attrs={};for(t in r)e=r[t],n._isFunction(e)||n._isElement(e)||n._isObject(e)&&n._hasMethods(e)||(i.attrs[t]=e);return i.nodeType=this.nodeType,i.shapeType=this.shapeType,i},toJSON:function(){return JSON.stringify(this.toObject())},getParent:function(){return this.parent},getLayer:function(){return this.getParent().getLayer()},getStage:function(){return this.getParent()?this.getParent().getStage():void 0},fire:function(t,e,n){n?this._executeHandlers(t,e||{}):this._handleEvent(t,e||{})},getAbsoluteTransform:function(){var t,e=new Kinetic.Transform;return this._eachAncestorReverse(function(n){t=n.getTransform(),e.multiply(t)},!0),e},getTransform:function(){var t=new Kinetic.Transform,e=this.getX(),n=this.getY(),i=this.getRotation(),r=this.getScale(),o=r.x,s=r.y,a=this.getOffset(),c=a.x,l=a.y;return(0!==e||0!==n)&&t.translate(e,n),0!==i&&t.rotate(i),(1!==o||1!==s)&&t.scale(o,s),(0!==c||0!==l)&&t.translate(-1*c,-1*l),t},clone:function(t){var e,n,i,r,o,s=this.shapeType||this.nodeType,a=new Kinetic[s](this.attrs);for(e in this.eventListeners)for(n=this.eventListeners[e],i=n.length,r=0;i>r;r++)o=n[r],o.name.indexOf(l)<0&&(a.eventListeners[e]||(a.eventListeners[e]=[]),a.eventListeners[e].push(o));return a.setAttrs(t),a},toDataURL:function(t){var t=t||{},e=t.mimeType||null,n=t.quality||null,i=this.getStage(),r=t.x||0,o=t.y||0,s=new Kinetic.SceneCanvas({width:t.width||i.getWidth(),height:t.height||i.getHeight(),pixelRatio:1}),a=s.getContext();return a.save(),(r||o)&&a.translate(-1*r,-1*o),this.drawScene(s),a.restore(),s.toDataURL(e,n)},toImage:function(t){Kinetic.Type._getImage(this.toDataURL(t),function(e){t.callback(e)})},setSize:function(){var t=Kinetic.Type._getSize(Array.prototype.slice.call(arguments));this.setWidth(t.width),this.setHeight(t.height)},getSize:function(){return{width:this.getWidth(),height:this.getHeight()}},getWidth:function(){return this.attrs.width||0},getHeight:function(){return this.attrs.height||0},_get:function(t){return this.nodeType===t?[this]:[]},_off:function(t,e){var n,i=this.eventListeners[t];for(n=0;n<i.length;n++)if(i[n].name===e){if(i.splice(n,1),0===i.length){delete this.eventListeners[t];break}n--}},_clearTransform:function(){var t=this.getScale(),e=this.getOffset(),n={x:this.getX(),y:this.getY(),rotation:this.getRotation(),scale:{x:t.x,y:t.y},offset:{x:e.x,y:e.y}};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scale={x:1,y:1},this.attrs.offset={x:0,y:0},n},_setTransform:function(t){var e;for(e in t)this.attrs[e]=t[e]},_fireBeforeChangeEvent:function(t,e,n){this._handleEvent(u+Kinetic.Type._capitalize(t)+h,{oldVal:e,newVal:n})},_fireChangeEvent:function(t,e,n){this._handleEvent(t+h,{oldVal:e,newVal:n})},setId:function(t){var e=this.getId(),n=(this.getStage(),Kinetic.Global);n._removeId(e),n._addId(this,t),this.setAttr(d,t)},setName:function(t){var e=this.getName(),n=(this.getStage(),Kinetic.Global);n._removeName(e,this._id),n._addName(this,t),this.setAttr(p,t)},getNodeType:function(){return this.nodeType},setAttr:function(t,e){var n;void 0!==e&&(n=this.attrs[t],this._fireBeforeChangeEvent(t,n,e),this.attrs[t]=e,this._fireChangeEvent(t,n,e))},_handleEvent:function(t,e,n){e&&this.nodeType===o&&(e.targetNode=this),this.getStage(),this.eventListeners;var i=!0;t===f&&n&&this._id===n._id?i=!1:t===g&&n&&this._id===n._id&&(i=!1),i&&(this._executeHandlers(t,e),e&&!e.cancelBubble&&this.parent&&(n&&n.parent?this._handleEvent.call(this.parent,t,e,n.parent):this._handleEvent.call(this.parent,t,e)))},_executeHandlers:function(t,e){var n,i,r=this.eventListeners[t];if(r)for(n=r.length,i=0;n>i;i++)r[i].handler.apply(this,[e])},draw:function(){var t={node:this};this.fire(v,t),this.drawScene(),this.drawHit(),this.fire(y,t)},shouldDrawHit:function(){return this.isVisible()&&this.isListening()&&!Kinetic.Global.isDragging()}},Kinetic.Node.addGetterSetter=function(t,e,n){this.addGetter(t,e,n),this.addSetter(t,e)},Kinetic.Node.addPointGetterSetter=function(t,e,n){this.addGetter(t,e,n),this.addPointSetter(t,e)},Kinetic.Node.addRotationGetterSetter=function(t,e,n){this.addRotationGetter(t,e,n),this.addRotationSetter(t,e)},Kinetic.Node.addSetter=function(t,e){var n=r+Kinetic.Type._capitalize(e);t.prototype[n]=function(t){this.setAttr(e,t)}},Kinetic.Node.addPointSetter=function(t,e){var n=r+Kinetic.Type._capitalize(e);t.prototype[n]=function(){var t=Kinetic.Type._getXY([].slice.call(arguments));this.attrs[e]||(this.attrs[e]={x:1,y:1}),t&&void 0===t.x&&(t.x=this.attrs[e].x),t&&void 0===t.y&&(t.y=this.attrs[e].y),this.setAttr(e,t)}},Kinetic.Node.addRotationSetter=function(t,e){var n=r+Kinetic.Type._capitalize(e);t.prototype[n]=function(t){this.setAttr(e,t)},t.prototype[n+m]=function(t){this.setAttr(e,Kinetic.Type._degToRad(t))}},Kinetic.Node.addGetter=function(t,e,n){var r=i+Kinetic.Type._capitalize(e);t.prototype[r]=function(){var t=this.attrs[e];return void 0===t&&(t=n),t}},Kinetic.Node.addRotationGetter=function(t,e,n){var r=i+Kinetic.Type._capitalize(e);t.prototype[r]=function(){var t=this.attrs[e];return void 0===t&&(t=n),t},t.prototype[r+m]=function(){var t=this.attrs[e];return void 0===t&&(t=n),Kinetic.Type._radToDeg(t)}},Kinetic.Node.create=function(t,e){return this._createNode(JSON.parse(t),e)},Kinetic.Node._createNode=function(t,e){var n,i,r,s;if(n=t.nodeType===o?void 0===t.shapeType?o:t.shapeType:t.nodeType,e&&(t.attrs.container=e),i=new Kinetic[n](t.attrs),t.children)for(r=t.children.length,s=0;r>s;s++)i.add(this._createNode(t.children[s]));return i},Kinetic.Node.addGetterSetter(Kinetic.Node,"x",0),Kinetic.Node.addGetterSetter(Kinetic.Node,"y",0),Kinetic.Node.addGetterSetter(Kinetic.Node,"opacity",1),Kinetic.Node.addGetter(Kinetic.Node,"name"),Kinetic.Node.addGetter(Kinetic.Node,"id"),Kinetic.Node.addRotationGetterSetter(Kinetic.Node,"rotation",0),Kinetic.Node.addPointGetterSetter(Kinetic.Node,"scale",{x:1,y:1}),Kinetic.Node.addPointGetterSetter(Kinetic.Node,"offset",{x:0,y:0}),Kinetic.Node.addSetter(Kinetic.Node,"width"),Kinetic.Node.addSetter(Kinetic.Node,"height"),Kinetic.Node.addSetter(Kinetic.Node,"listening"),Kinetic.Node.addSetter(Kinetic.Node,"visible"),Kinetic.Node.prototype.isListening=Kinetic.Node.prototype.getListening,Kinetic.Node.prototype.isVisible=Kinetic.Node.prototype.getVisible,Kinetic.Collection.mapMethods(["on","off"])}(),function(){Kinetic.Animation=function(t,e){this.func=t,this.node=e,this.id=Kinetic.Animation.animIdCounter++,this.frame={time:0,timeDiff:0,lastTime:(new Date).getTime()}},Kinetic.Animation.prototype={isRunning:function(){for(var t=Kinetic.Animation,e=t.animations,n=0;n<e.length;n++)if(e[n].id===this.id)return!0;return!1},start:function(){this.stop(),this.frame.timeDiff=0,this.frame.lastTime=(new Date).getTime(),Kinetic.Animation._addAnimation(this)},stop:function(){Kinetic.Animation._removeAnimation(this)},_updateFrameObject:function(t){this.frame.timeDiff=t-this.frame.lastTime,this.frame.lastTime=t,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1e3/this.frame.timeDiff}},Kinetic.Animation.animations=[],Kinetic.Animation.animIdCounter=0,Kinetic.Animation.animRunning=!1,Kinetic.Animation.fixedRequestAnimFrame=function(t){window.setTimeout(t,1e3/60)},Kinetic.Animation._addAnimation=function(t){this.animations.push(t),this._handleAnimation()},Kinetic.Animation._removeAnimation=function(t){for(var e=t.id,n=this.animations,i=n.length,r=0;i>r;r++)if(n[r].id===e){this.animations.splice(r,1);break}},Kinetic.Animation._runFrames=function(){for(var t={},e=this.animations,n=0;n<e.length;n++){var i=e[n],r=i.node,o=i.func;i._updateFrameObject((new Date).getTime()),r&&void 0!==r._id&&(t[r._id]=r),o&&o(i.frame)}for(var s in t)t[s].draw()},Kinetic.Animation._animationLoop=function(){var t=this;this.animations.length>0?(this._runFrames(),Kinetic.Animation.requestAnimFrame(function(){t._animationLoop()})):this.animRunning=!1},Kinetic.Animation._handleAnimation=function(){var t=this;this.animRunning||(this.animRunning=!0,t._animationLoop())},RAF=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||Kinetic.Animation.fixedRequestAnimFrame}(),Kinetic.Animation.requestAnimFrame=function(t){var e=Kinetic.DD&&Kinetic.DD.isDragging?this.fixedRequestAnimFrame:RAF;e(t)};var t=Kinetic.Node.prototype.moveTo;Kinetic.Node.prototype.moveTo=function(e){t.call(this,e)}}(),function(){Kinetic.DD={anim:new Kinetic.Animation,isDragging:!1,offset:{x:0,y:0},node:null,_drag:function(t){var e=Kinetic.DD,n=e.node;if(n){var i=n.getStage().getPointerPosition(),r=n.getDragBoundFunc(),o={x:i.x-e.offset.x,y:i.y-e.offset.y};void 0!==r&&(o=r.call(n,o,t)),n.setAbsolutePosition(o),e.isDragging||(e.isDragging=!0,n._handleEvent("dragstart",t)),n._handleEvent("dragmove",t)}},_endDragBefore:function(t){var e,n,i=Kinetic.DD,r=i.node;r&&(e=r.nodeType,n=r.getLayer(),i.anim.stop(),i.isDragging&&(i.isDragging=!1,t&&(t.dragEndNode=r)),delete i.node,(n||r).draw())},_endDragAfter:function(t){var t=t||{},e=t.dragEndNode;t&&e&&e._handleEvent("dragend",t)}},Kinetic.Node.prototype.startDrag=function(){var t=Kinetic.DD,e=this.getStage(),n=this.getLayer(),i=e.getPointerPosition(),r=(this.getTransform().getTranslation(),this.getAbsolutePosition()),o=n||this;i&&(t.node&&t.node.stopDrag(),t.node=this,t.offset.x=i.x-r.x,t.offset.y=i.y-r.y,t.anim.node=o,t.anim.start())},Kinetic.Node.prototype.stopDrag=function(){var t=Kinetic.DD,e={};t._endDragBefore(e),t._endDragAfter(e)},Kinetic.Node.prototype.setDraggable=function(t){this.setAttr("draggable",t),this._dragChange()};var t=Kinetic.Node.prototype.destroy;Kinetic.Node.prototype.destroy=function(){var e=Kinetic.DD;e.node&&e.node._id===this._id&&this.stopDrag(),t.call(this)},Kinetic.Node.prototype.isDragging=function(){var t=Kinetic.DD;return t.node&&t.node._id===this._id&&t.isDragging},Kinetic.Node.prototype._listenDrag=function(){this._dragCleanup();var t=this;this.on("mousedown.kinetic touchstart.kinetic",function(e){Kinetic.DD.node||t.startDrag(e)})},Kinetic.Node.prototype._dragChange=function(){if(this.attrs.draggable)this._listenDrag();else{this._dragCleanup();var t=this.getStage(),e=Kinetic.DD;t&&e.node&&e.node._id===this._id&&e.node.stopDrag()}},Kinetic.Node.prototype._dragCleanup=function(){this.off("mousedown.kinetic"),this.off("touchstart.kinetic")},Kinetic.Node.addGetterSetter(Kinetic.Node,"dragBoundFunc"),Kinetic.Node.addGetterSetter(Kinetic.Node,"dragOnTop",!0),Kinetic.Node.addGetter(Kinetic.Node,"draggable",!1),Kinetic.Node.prototype.isDraggable=Kinetic.Node.prototype.getDraggable;var e=document.getElementsByTagName("html")[0];e.addEventListener("mouseup",Kinetic.DD._endDragBefore,!0),e.addEventListener("touchend",Kinetic.DD._endDragBefore,!0),e.addEventListener("mouseup",Kinetic.DD._endDragAfter,!1),e.addEventListener("touchend",Kinetic.DD._endDragAfter,!1)}(),function(){function t(t,e,n,i,r,o){var s=new Kinetic.Tween(function(n){t[e]=n},n,i,r,o);return s}Kinetic.Transition=function(e,n){var i=this,r=n.easing||"linear",o=Kinetic.Tweens[r],s=n.duration||0,a=null,c=0,l={};this.tweens=[],this.attrs={},this.node=e;for(var u in n)"duration"!==u&&"easing"!==u&&"callback"!==u&&(a=n[u],l=e.getAttr(u),Kinetic.Type._isObject(l)?(configValX=a.x,configValY=a.y,this.attrs[u]={},void 0!==configValX&&i.tweens.push(t(this.attrs[u],"x",o,l.x,configValX,s)),void 0!==configValY&&i.tweens.push(t(this.attrs[u],"y",o,l.y,configValY,s))):i.tweens.push(t(this.attrs,u,o,e.getAttr(u),a,s)));c=this.tweens.length-1,this.tweens[c].onStarted=function(){},this.tweens[c].onStopped=function(){e.transAnim.stop()},this.tweens[c].onResumed=function(){e.transAnim.start()},this.tweens[c].onLooped=function(){},this.tweens[c].onChanged=function(){},this.tweens[c].onFinished=function(){var t={};for(var i in n)"duration"!==i&&"easing"!==i&&"callback"!==i&&(t[i]=n[i]);e.transAnim.stop(),e.setAttrs(t),n.callback&&n.callback.call(e)}},Kinetic.Transition.prototype={start:function(){for(var t=0;t<this.tweens.length;t++)this.tweens[t].start()},stop:function(){for(var t=0;t<this.tweens.length;t++)this.tweens[t].stop()},resume:function(){for(var t=0;t<this.tweens.length;t++)this.tweens[t].resume()},_onEnterFrame:function(){for(var t=0;t<this.tweens.length;t++)this.tweens[t].onEnterFrame();this.node.setAttrs(this.attrs)},_add:function(t){this.tweens.push(t)}},Kinetic.Node.prototype.transitionTo=function(t){var e=new Kinetic.Transition(this,t);return this.transAnim||(this.transAnim=new Kinetic.Animation),this.transAnim.func=function(){e._onEnterFrame()},this.transAnim.node="Stage"===this.nodeType?this:this.getLayer(),e.start(),this.transAnim.start(),this.trans=e,e}}(),function(){Kinetic.Container=function(t){this._containerInit(t)},Kinetic.Container.prototype={_containerInit:function(t){this.children=[],Kinetic.Node.call(this,t)},getChildren:function(){return this.children},removeChildren:function(){for(;this.children.length>0;)this.children[0].remove()},add:function(t){var e=(Kinetic.Global,this.children);return t.index=e.length,t.parent=this,e.push(t),this},get:function(t){var e=new Kinetic.Collection;if("#"===t.charAt(0)){var n=this._getNodeById(t.slice(1));n&&e.push(n)}else if("."===t.charAt(0)){var i=this._getNodesByName(t.slice(1));Kinetic.Collection.apply(e,i)}else{for(var r=[],o=this.getChildren(),s=o.length,a=0;s>a;a++)r=r.concat(o[a]._get(t));Kinetic.Collection.apply(e,r)}return e},_getNodeById:function(t){var e=(this.getStage(),Kinetic.Global),n=e.ids[t];return void 0!==n&&this.isAncestorOf(n)?n:null},_getNodesByName:function(t){var e=Kinetic.Global,n=e.names[t]||[];return this._getDescendants(n)},_get:function(t){for(var e=Kinetic.Node.prototype._get.call(this,t),n=this.getChildren(),i=n.length,r=0;i>r;r++)e=e.concat(n[r]._get(t));return e},toObject:function(){var t=Kinetic.Node.prototype.toObject.call(this);t.children=[];for(var e=this.getChildren(),n=e.length,i=0;n>i;i++){var r=e[i];t.children.push(r.toObject())}return t},_getDescendants:function(t){for(var e=[],n=t.length,i=0;n>i;i++){var r=t[i];this.isAncestorOf(r)&&e.push(r)}return e},isAncestorOf:function(t){for(var e=t.getParent();e;){if(e._id===this._id)return!0;e=e.getParent()}return!1},clone:function(t){var e=Kinetic.Node.prototype.clone.call(this,t);for(var n in this.children)e.add(this.children[n].clone());return e},getIntersections:function(){for(var t=Kinetic.Type._getXY(Array.prototype.slice.call(arguments)),e=[],n=this.get("Shape"),i=n.length,r=0;i>r;r++){var o=n[r];o.isVisible()&&o.intersects(t)&&e.push(o)}return e},_setChildrenIndices:function(){for(var t=this.children,e=t.length,n=0;e>n;n++)t[n].index=n},drawScene:function(t){var e,n,i=this.getLayer(),r=!!this.getClipFunc();if(this.getStage(),!t&&i&&(t=i.getCanvas()),this.isVisible()){r&&t._clip(this),e=this.children,n=e.length;for(var o=0;n>o;o++)e[o].drawScene(t);r&&t.getContext().restore()}},drawHit:function(){var t,e=!!this.getClipFunc()&&"Stage"!==this.nodeType,n=0,i=0,r=[];if(this.shouldDrawHit()){for(e&&(t=this.getLayer().hitCanvas,t._clip(this)),r=this.children,i=r.length,n=0;i>n;n++)r[n].drawHit();e&&t.getContext().restore()}}},Kinetic.Global.extend(Kinetic.Container,Kinetic.Node),Kinetic.Node.addGetterSetter(Kinetic.Container,"clipFunc")}(),function(){function t(t){t.fill()}function e(t){t.stroke()}function n(t){t.fill()}function i(t){t.stroke()}Kinetic.Shape=function(t){this._initShape(t)},Kinetic.Shape.prototype={_initShape:function(r){this.nodeType="Shape",this._fillFunc=t,this._strokeFunc=e,this._fillFuncHit=n,this._strokeFuncHit=i;for(var o,s=Kinetic.Global.shapes;;)if(o=Kinetic.Type._getRandomColorKey(),o&&!(o in s))break;this.colorKey=o,s[o]=this,this.createAttrs(),Kinetic.Node.call(this,r)},getContext:function(){return this.getLayer().getContext()},getCanvas:function(){return this.getLayer().getCanvas()},hasShadow:function(){return!!(this.getShadowColor()||this.getShadowBlur()||this.getShadowOffset())},hasFill:function(){return!!(this.getFill()||this.getFillPatternImage()||this.getFillLinearGradientStartPoint()||this.getFillRadialGradientStartPoint())},_get:function(t){return this.nodeType===t||this.shapeType===t?[this]:[]},intersects:function(){var t=Kinetic.Type._getXY(Array.prototype.slice.call(arguments)),e=this.getStage(),n=e.hitCanvas;n.clear(),this.drawScene(n);var i=n.context.getImageData(0|t.x,0|t.y,1,1).data;return i[3]>0},enableFill:function(){this.setAttr("fillEnabled",!0)},disableFill:function(){this.setAttr("fillEnabled",!1)},enableStroke:function(){this.setAttr("strokeEnabled",!0)},disableStroke:function(){this.setAttr("strokeEnabled",!1)},enableStrokeScale:function(){this.setAttr("strokeScaleEnabled",!0)},disableStrokeScale:function(){this.setAttr("strokeScaleEnabled",!1)},enableShadow:function(){this.setAttr("shadowEnabled",!0)},disableShadow:function(){this.setAttr("shadowEnabled",!1)},enableDashArray:function(){this.setAttr("dashArrayEnabled",!0)},disableDashArray:function(){this.setAttr("dashArrayEnabled",!1)},getShapeType:function(){return this.shapeType},destroy:function(){Kinetic.Node.prototype.destroy.call(this),delete Kinetic.Global.shapes[this.colorKey]},drawScene:function(t){var e=this.getAttrs(),n=e.drawFunc,t=t||this.getLayer().getCanvas(),i=t.getContext();n&&this.isVisible()&&(i.save(),t._applyOpacity(this),t._applyLineJoin(this),t._applyAncestorTransforms(this),n.call(this,t),i.restore())},drawHit:function(){var t=this.getAttrs(),e=t.drawHitFunc||t.drawFunc,n=this.getLayer().hitCanvas,i=n.getContext();e&&this.shouldDrawHit()&&(i.save(),n._applyLineJoin(this),n._applyAncestorTransforms(this),e.call(this,n),i.restore())},_setDrawFuncs:function(){!this.attrs.drawFunc&&this.drawFunc&&this.setDrawFunc(this.drawFunc),!this.attrs.drawHitFunc&&this.drawHitFunc&&this.setDrawHitFunc(this.drawHitFunc)}},Kinetic.Global.extend(Kinetic.Shape,Kinetic.Node),Kinetic.Node.addGetterSetter(Kinetic.Shape,"stroke"),Kinetic.Node.addGetterSetter(Kinetic.Shape,"lineJoin"),Kinetic.Node.addGetterSetter(Kinetic.Shape,"lineCap"),Kinetic.Node.addGetterSetter(Kinetic.Shape,"strokeWidth"),Kinetic.Node.addGetterSetter(Kinetic.Shape,"drawFunc"),Kinetic.Node.addGetterSetter(Kinetic.Shape,"drawHitFunc"),Kinetic.Node.addGetterSetter(Kinetic.Shape,"dashArray"),Kinetic.Node.addGetterSetter(Kinetic.Shape,"shadowColor"),Kinetic.Node.addGetterSetter(Kinetic.Shape,"shadowBlur"),Kinetic.Node.addGetterSetter(Kinetic.Shape,"shadowOpacity"),Kinetic.Node.addGetterSetter(Kinetic.Shape,"fillPatternImage"),Kinetic.Node.addGetterSetter(Kinetic.Shape,"fill"),Kinetic.Node.addGetterSetter(Kinetic.Shape,"fillPatternX"),Kinetic.Node.addGetterSetter(Kinetic.Shape,"fillPatternY"),Kinetic.Node.addGetterSetter(Kinetic.Shape,"fillLinearGradientColorStops"),Kinetic.Node.addGetterSetter(Kinetic.Shape,"fillRadialGradientStartRadius"),Kinetic.Node.addGetterSetter(Kinetic.Shape,"fillRadialGradientEndRadius"),Kinetic.Node.addGetterSetter(Kinetic.Shape,"fillRadialGradientColorStops"),Kinetic.Node.addGetterSetter(Kinetic.Shape,"fillPatternRepeat"),Kinetic.Node.addGetterSetter(Kinetic.Shape,"fillEnabled",!0),Kinetic.Node.addGetterSetter(Kinetic.Shape,"strokeEnabled",!0),Kinetic.Node.addGetterSetter(Kinetic.Shape,"shadowEnabled",!0),Kinetic.Node.addGetterSetter(Kinetic.Shape,"dashArrayEnabled",!0),Kinetic.Node.addGetterSetter(Kinetic.Shape,"fillPriority","color"),Kinetic.Node.addGetterSetter(Kinetic.Shape,"strokeScaleEnabled",!0),Kinetic.Node.addPointGetterSetter(Kinetic.Shape,"fillPatternOffset"),Kinetic.Node.addPointGetterSetter(Kinetic.Shape,"fillPatternScale"),Kinetic.Node.addPointGetterSetter(Kinetic.Shape,"fillLinearGradientStartPoint"),Kinetic.Node.addPointGetterSetter(Kinetic.Shape,"fillLinearGradientEndPoint"),Kinetic.Node.addPointGetterSetter(Kinetic.Shape,"fillRadialGradientStartPoint"),Kinetic.Node.addPointGetterSetter(Kinetic.Shape,"fillRadialGradientEndPoint"),Kinetic.Node.addPointGetterSetter(Kinetic.Shape,"shadowOffset"),Kinetic.Node.addRotationGetterSetter(Kinetic.Shape,"fillPatternRotation",0)}(),function(){function t(t,e){t.content.addEventListener(e,function(n){t["_"+e](n)},!1)}var e="Stage",n="string",i="px",r="mouseout",o="mouseleave",r="mouseout",s="mouseover",a="mouseenter",c="mousemove",l="mousedown",u="mouseup",h="click",d="dblclick",p="touchstart";TOUCHEND="touchend",TAP="tap",DBL_TAP="dbltap",TOUCHMOVE="touchmove",DIV="div",RELATIVE="relative",INLINE_BLOCK="inline-block",KINETICJS_CONTENT="kineticjs-content",SPACE=" ",CONTAINER="container",EVENTS=[l,c,u,r,p,TOUCHMOVE,TOUCHEND],eventsLength=EVENTS.length,Kinetic.Stage=function(t){this._initStage(t)},Kinetic.Stage.prototype={_initStage:function(t){this.createAttrs(),Kinetic.Container.call(this,t),this.nodeType=e,this.dblClickWindow=400,this._id=Kinetic.Global.idCounter++,this._buildDOM(),this._bindContentEvents(),Kinetic.Global.stages.push(this)},setContainer:function(t){typeof t===n&&(t=document.getElementById(t)),this.setAttr(CONTAINER,t)},draw:function(){var t,e,n=this.getChildren(),i=n.length;for(t=0;i>t;t++)e=n[t],e.getClearBeforeDraw()&&(e.getCanvas().clear(),e.getHitCanvas().clear());Kinetic.Node.prototype.draw.call(this)},setHeight:function(t){Kinetic.Node.prototype.setHeight.call(this,t),this._resizeDOM()},setWidth:function(t){Kinetic.Node.prototype.setWidth.call(this,t),this._resizeDOM()},clear:function(){var t,e=this.children,n=e.length;for(t=0;n>t;t++)e[t].clear()},remove:function(){var t=this.content;Kinetic.Node.prototype.remove.call(this),t&&Kinetic.Type._isInDocument(t)&&this.getContainer().removeChild(t)},getMousePosition:function(){return this.mousePos},getTouchPosition:function(){return this.touchPos},getPointerPosition:function(){return this.getTouchPosition()||this.getMousePosition()},getStage:function(){return this},getContent:function(){return this.content},toDataURL:function(t){function e(r){var o=c[r],l=o.toDataURL(),u=new Image;u.onload=function(){a.drawImage(u,0,0),r<c.length-1?e(r+1):t.callback(s.toDataURL(n,i))},u.src=l}var t=t||{},n=t.mimeType||null,i=t.quality||null,r=t.x||0,o=t.y||0,s=new Kinetic.SceneCanvas({width:t.width||this.getWidth(),height:t.height||this.getHeight(),pixelRatio:1}),a=s.getContext(),c=this.children;
(r||o)&&a.translate(-1*r,-1*o),e(0)},toImage:function(t){var e=t.callback;t.callback=function(t){Kinetic.Type._getImage(t,function(t){e(t)})},this.toDataURL(t)},getIntersection:function(){var t,e,n=Kinetic.Type._getXY(Array.prototype.slice.call(arguments)),i=this.getChildren(),r=i.length,o=r-1;for(t=o;t>=0;t--)if(e=i[t].getIntersection(n))return e;return null},_resizeDOM:function(){if(this.content){var t,e=this.getWidth(),n=this.getHeight(),r=this.getChildren(),o=r.length;for(this.content.style.width=e+i,this.content.style.height=n+i,this.bufferCanvas.setSize(e,n,1),this.hitCanvas.setSize(e,n),t=0;o>t;t++)layer=r[t],layer.getCanvas().setSize(e,n),layer.hitCanvas.setSize(e,n),layer.draw()}},add:function(t){return Kinetic.Container.prototype.add.call(this,t),t.canvas.setSize(this.attrs.width,this.attrs.height),t.hitCanvas.setSize(this.attrs.width,this.attrs.height),t.draw(),this.content.appendChild(t.canvas.element),this},getParent:function(){return null},getLayer:function(){return null},_setPointerPosition:function(t){t||(t=window.event),this._setMousePosition(t),this._setTouchPosition(t)},_bindContentEvents:function(){var e;for(e=0;eventsLength>e;e++)t(this,EVENTS[e])},_mouseout:function(t){this._setPointerPosition(t);var e=Kinetic.Global,n=this.targetShape;n&&!e.isDragging()&&(n._handleEvent(r,t),n._handleEvent(o,t),this.targetShape=null),this.mousePos=void 0},_mousemove:function(t){this._setPointerPosition(t);var e,n=Kinetic.Global,i=Kinetic.DD,l=this.getIntersection(this.getPointerPosition());l?(e=l.shape,e&&(n.isDragging()||255!==l.pixel[3]||this.targetShape&&this.targetShape._id===e._id?e._handleEvent(c,t):(this.targetShape&&(this.targetShape._handleEvent(r,t,e),this.targetShape._handleEvent(o,t,e)),e._handleEvent(s,t,this.targetShape),e._handleEvent(a,t,this.targetShape),this.targetShape=e))):this.targetShape&&!n.isDragging()&&(this.targetShape._handleEvent(r,t),this.targetShape._handleEvent(o,t),this.targetShape=null),i&&i._drag(t)},_mousedown:function(t){this._setPointerPosition(t);var e,n=Kinetic.Global,i=this.getIntersection(this.getPointerPosition());i&&i.shape&&(e=i.shape,this.clickStart=!0,this.clickStartShape=e,e._handleEvent(l,t)),this.isDraggable()&&!n.isDragReady()&&this.startDrag(t)},_mouseup:function(t){this._setPointerPosition(t);var e,n=this,i=Kinetic.Global,r=this.getIntersection(this.getPointerPosition());r&&r.shape&&(e=r.shape,e._handleEvent(u,t),this.clickStart&&(i.isDragging()||e._id!==this.clickStartShape._id||(e._handleEvent(h,t),this.inDoubleClickWindow&&e._handleEvent(d,t),this.inDoubleClickWindow=!0,setTimeout(function(){n.inDoubleClickWindow=!1},this.dblClickWindow)))),this.clickStart=!1},_touchstart:function(t){this._setPointerPosition(t);var e,n=Kinetic.Global,i=this.getIntersection(this.getPointerPosition());t.preventDefault(),i&&i.shape&&(e=i.shape,this.tapStart=!0,this.tapStartShape=e,e._handleEvent(p,t)),this.isDraggable()&&!n.isDragReady()&&this.startDrag(t)},_touchend:function(t){this._setPointerPosition(t);var e,n=this,i=Kinetic.Global,r=this.getIntersection(this.getPointerPosition());r&&r.shape&&(e=r.shape,e._handleEvent(TOUCHEND,t),this.tapStart&&(i.isDragging()||e._id!==this.tapStartShape._id||(e._handleEvent(TAP,t),this.inDoubleClickWindow&&e._handleEvent(DBL_TAP,t),this.inDoubleClickWindow=!0,setTimeout(function(){n.inDoubleClickWindow=!1},this.dblClickWindow)))),this.tapStart=!1},_touchmove:function(t){this._setPointerPosition(t);var e,n=Kinetic.DD,i=this.getIntersection(this.getPointerPosition());t.preventDefault(),i&&i.shape&&(e=i.shape,e._handleEvent(TOUCHMOVE,t)),n&&n._drag(t)},_setMousePosition:function(t){var e=t.clientX-this._getContentPosition().left,n=t.clientY-this._getContentPosition().top;this.mousePos={x:e,y:n}},_setTouchPosition:function(t){var e,n,i;void 0!==t.touches&&1===t.touches.length&&(e=t.touches[0],n=e.clientX-this._getContentPosition().left,i=e.clientY-this._getContentPosition().top,this.touchPos={x:n,y:i})},_getContentPosition:function(){var t=this.content.getBoundingClientRect();return{top:t.top,left:t.left}},_buildDOM:function(){this.content=document.createElement(DIV),this.content.style.position=RELATIVE,this.content.style.display=INLINE_BLOCK,this.content.className=KINETICJS_CONTENT,this.attrs.container.appendChild(this.content),this.bufferCanvas=new Kinetic.SceneCanvas,this.hitCanvas=new Kinetic.HitCanvas,this._resizeDOM()},_onContent:function(t,e){var n,i,r=t.split(SPACE),o=r.length;for(n=0;o>n;n++)i=r[n],this.content.addEventListener(i,e,!1)}},Kinetic.Global.extend(Kinetic.Stage,Kinetic.Container),Kinetic.Node.addGetter(Kinetic.Stage,"container")}(),function(){Kinetic.Layer=function(t){this._initLayer(t)},Kinetic.Layer.prototype={_initLayer:function(t){this.nodeType="Layer",this.createAttrs(),Kinetic.Container.call(this,t),this.canvas=new Kinetic.SceneCanvas,this.canvas.getElement().style.position="absolute",this.hitCanvas=new Kinetic.HitCanvas},getIntersection:function(){var t,e,n,i=Kinetic.Type._getXY(Array.prototype.slice.call(arguments));if(this.isVisible()&&this.isListening()){if(t=this.hitCanvas.context.getImageData(0|i.x,0|i.y,1,1).data,255===t[3])return e=Kinetic.Type._rgbToHex(t[0],t[1],t[2]),n=Kinetic.Global.shapes[e],{shape:n,pixel:t};if(t[0]>0||t[1]>0||t[2]>0||t[3]>0)return{pixel:t}}return null},drawScene:function(t){var t=t||this.getCanvas();this.getClearBeforeDraw()&&t.clear(),Kinetic.Container.prototype.drawScene.call(this,t)},drawHit:function(){var t=this.getLayer();t&&t.getClearBeforeDraw()&&t.getHitCanvas().clear(),Kinetic.Container.prototype.drawHit.call(this)},getCanvas:function(){return this.canvas},getHitCanvas:function(){return this.hitCanvas},getContext:function(){return this.getCanvas().getContext()},clear:function(){this.getCanvas().clear()},setVisible:function(t){Kinetic.Node.prototype.setVisible.call(this,t),t?(this.getCanvas().element.style.display="block",this.hitCanvas.element.style.display="block"):(this.getCanvas().element.style.display="none",this.hitCanvas.element.style.display="none")},setZIndex:function(t){Kinetic.Node.prototype.setZIndex.call(this,t);var e=this.getStage();e&&(e.content.removeChild(this.getCanvas().element),t<e.getChildren().length-1?e.content.insertBefore(this.getCanvas().element,e.getChildren()[t+1].getCanvas().element):e.content.appendChild(this.getCanvas().element))},moveToTop:function(){Kinetic.Node.prototype.moveToTop.call(this);var t=this.getStage();t&&(t.content.removeChild(this.getCanvas().element),t.content.appendChild(this.getCanvas().element))},moveUp:function(){if(Kinetic.Node.prototype.moveUp.call(this)){var t=this.getStage();t&&(t.content.removeChild(this.getCanvas().element),this.index<t.getChildren().length-1?t.content.insertBefore(this.getCanvas().element,t.getChildren()[this.index+1].getCanvas().element):t.content.appendChild(this.getCanvas().element))}},moveDown:function(){if(Kinetic.Node.prototype.moveDown.call(this)){var t=this.getStage();if(t){var e=t.getChildren();t.content.removeChild(this.getCanvas().element),t.content.insertBefore(this.getCanvas().element,e[this.index+1].getCanvas().element)}}},moveToBottom:function(){if(Kinetic.Node.prototype.moveToBottom.call(this)){var t=this.getStage();if(t){var e=t.getChildren();t.content.removeChild(this.getCanvas().element),t.content.insertBefore(this.getCanvas().element,e[1].getCanvas().element)}}},getLayer:function(){return this},remove:function(){var t=this.getStage(),e=this.getCanvas(),n=e.element;Kinetic.Node.prototype.remove.call(this),t&&e&&Kinetic.Type._isInDocument(n)&&t.content.removeChild(n)}},Kinetic.Global.extend(Kinetic.Layer,Kinetic.Container),Kinetic.Node.addGetterSetter(Kinetic.Layer,"clearBeforeDraw",!0)}(),function(){Kinetic.Group=function(t){this._initGroup(t)},Kinetic.Group.prototype={_initGroup:function(t){this.nodeType="Group",this.createAttrs(),Kinetic.Container.call(this,t)}},Kinetic.Global.extend(Kinetic.Group,Kinetic.Container)}(),function(){Kinetic.Rect=function(t){this._initRect(t)},Kinetic.Rect.prototype={_initRect:function(t){this.createAttrs(),Kinetic.Shape.call(this,t),this.shapeType="Rect",this._setDrawFuncs()},drawFunc:function(t){var e=t.getContext(),n=this.getCornerRadius(),i=this.getWidth(),r=this.getHeight();e.beginPath(),n?(e.moveTo(n,0),e.lineTo(i-n,0),e.arc(i-n,n,n,3*Math.PI/2,0,!1),e.lineTo(i,r-n),e.arc(i-n,r-n,n,0,Math.PI/2,!1),e.lineTo(n,r),e.arc(n,r-n,n,Math.PI/2,Math.PI,!1),e.lineTo(0,n),e.arc(n,n,n,Math.PI,3*Math.PI/2,!1)):e.rect(0,0,i,r),e.closePath(),t.fillStroke(this)}},Kinetic.Global.extend(Kinetic.Rect,Kinetic.Shape),Kinetic.Node.addGetterSetter(Kinetic.Rect,"cornerRadius",0)}(),function(){Kinetic.Circle=function(t){this._initCircle(t)},Kinetic.Circle.prototype={_initCircle:function(t){this.createAttrs(),Kinetic.Shape.call(this,t),this.shapeType="Circle",this._setDrawFuncs()},drawFunc:function(t){var e=t.getContext();e.beginPath(),e.arc(0,0,this.getRadius(),0,2*Math.PI,!0),e.closePath(),t.fillStroke(this)},getWidth:function(){return 2*this.getRadius()},getHeight:function(){return 2*this.getRadius()},setWidth:function(t){Kinetic.Node.prototype.setWidth.call(this,t),this.setRadius(t/2)},setHeight:function(t){Kinetic.Node.prototype.setHeight.call(this,t),this.setRadius(t/2)}},Kinetic.Global.extend(Kinetic.Circle,Kinetic.Shape),Kinetic.Node.addGetterSetter(Kinetic.Circle,"radius",0)}(),function(){Kinetic.Wedge=function(t){this._initWedge(t)},Kinetic.Wedge.prototype={_initWedge:function(t){this.createAttrs(),Kinetic.Shape.call(this,t),this.shapeType="Wedge",this._setDrawFuncs()},drawFunc:function(t){var e=t.getContext();e.beginPath(),e.arc(0,0,this.getRadius(),0,this.getAngle(),this.getClockwise()),e.lineTo(0,0),e.closePath(),t.fillStroke(this)},setAngleDeg:function(t){this.setAngle(Kinetic.Type._degToRad(t))},getAngleDeg:function(){return Kinetic.Type._radToDeg(this.getAngle())}},Kinetic.Global.extend(Kinetic.Wedge,Kinetic.Shape),Kinetic.Node.addGetterSetter(Kinetic.Wedge,"radius",0),Kinetic.Node.addGetterSetter(Kinetic.Wedge,"angle",0),Kinetic.Node.addGetterSetter(Kinetic.Wedge,"clockwise",!1)}(),function(){Kinetic.Ellipse=function(t){this._initEllipse(t)},Kinetic.Ellipse.prototype={_initEllipse:function(t){this.createAttrs(),Kinetic.Shape.call(this,t),this.shapeType="Ellipse",this._setDrawFuncs()},drawFunc:function(t){var e=t.getContext(),n=this.getRadius();e.beginPath(),e.save(),n.x!==n.y&&e.scale(1,n.y/n.x),e.arc(0,0,n.x,0,2*Math.PI,!0),e.restore(),e.closePath(),t.fillStroke(this)},getWidth:function(){return 2*this.getRadius().x},getHeight:function(){return 2*this.getRadius().y},setWidth:function(t){Kinetic.Node.prototype.setWidth.call(this,t),this.setRadius({x:t/2})},setHeight:function(t){Kinetic.Node.prototype.setHeight.call(this,t),this.setRadius({y:t/2})}},Kinetic.Global.extend(Kinetic.Ellipse,Kinetic.Shape),Kinetic.Node.addPointGetterSetter(Kinetic.Ellipse,"radius",{x:0,y:0})}(),function(){var t="Image",e="crop";Kinetic.Image=function(t){this._initImage(t)},Kinetic.Image.prototype={_initImage:function(e){Kinetic.Shape.call(this,e),this.shapeType=t,this._setDrawFuncs()},drawFunc:function(t){var e,n,i,r,o,s=this.getWidth(),a=this.getHeight(),c=this,l=t.getContext(),u=this.getImage(),h=this.getCrop();l.beginPath(),l.rect(0,0,s,a),l.closePath(),t.fillStroke(this),u&&(h?(n=h.x||0,i=h.y||0,r=h.width||0,o=h.height||0,e=[u,n,i,r,o,0,0,s,a]):e=[u,0,0,s,a],this.hasShadow()?t.applyShadow(this,function(){c._drawImage(l,e)}):this._drawImage(l,e))},drawHitFunc:function(t){var e=this.getWidth(),n=this.getHeight(),i=this.imageHitRegion,r=t.getContext();i?(r.drawImage(i,0,0,e,n),r.beginPath(),r.rect(0,0,e,n),r.closePath(),t.stroke(this)):(r.beginPath(),r.rect(0,0,e,n),r.closePath(),t.fillStroke(this))},applyFilter:function(t,e,n){var i=this.getImage(),r=new Kinetic.Canvas({width:i.width,height:i.height}),o=r.getContext(),s=this;o.drawImage(i,0,0);try{var a=o.getImageData(0,0,r.getWidth(),r.getHeight());t(a,e),Kinetic.Type._getImage(a,function(t){s.setImage(t),n&&n()})}catch(c){Kinetic.Global.warn("Unable to apply filter. "+c.message)}},setCrop:function(){var t=[].slice.call(arguments),n=Kinetic.Type._getXY(t),i=Kinetic.Type._getSize(t),r=Kinetic.Type._merge(n,i);this.setAttr(e,Kinetic.Type._merge(r,this.getCrop()))},createImageHitRegion:function(t){var e,n,i,r,o,s=this,a=this.getWidth(),c=this.getHeight(),l=new Kinetic.Canvas({width:a,height:c}),u=l.getContext(),h=this.getImage();u.drawImage(h,0,0);try{for(e=u.getImageData(0,0,a,c),n=e.data,i=Kinetic.Type._hexToRgb(this.colorKey),r=0,o=n.length;o>r;r+=4)n[r+3]>0&&(n[r]=i.r,n[r+1]=i.g,n[r+2]=i.b);Kinetic.Type._getImage(e,function(e){s.imageHitRegion=e,t&&t()})}catch(d){Kinetic.Global.warn("Unable to create image hit region. "+d.message)}},clearImageHitRegion:function(){delete this.imageHitRegion},getWidth:function(){var t=this.getImage();return this.attrs.width||(t?t.width:0)},getHeight:function(){var t=this.getImage();return this.attrs.height||(t?t.height:0)},_drawImage:function(t,e){5===e.length?t.drawImage(e[0],e[1],e[2],e[3],e[4]):9===e.length&&t.drawImage(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])}},Kinetic.Global.extend(Kinetic.Image,Kinetic.Shape),Kinetic.Node.addGetterSetter(Kinetic.Image,"image"),Kinetic.Node.addGetter(Kinetic.Image,"crop")}(),function(){Kinetic.Polygon=function(t){this._initPolygon(t)},Kinetic.Polygon.prototype={_initPolygon:function(t){this.createAttrs(),Kinetic.Shape.call(this,t),this.shapeType="Polygon",this._setDrawFuncs()},drawFunc:function(t){var e=t.getContext(),n=this.getPoints(),i=n.length;e.beginPath(),e.moveTo(n[0].x,n[0].y);for(var r=1;i>r;r++)e.lineTo(n[r].x,n[r].y);e.closePath(),t.fillStroke(this)},setPoints:function(t){this.setAttr("points",Kinetic.Type._getPoints(t))},getPoints:function(){return this.attrs.points||[]}},Kinetic.Global.extend(Kinetic.Polygon,Kinetic.Shape)}(),function(){function t(t){t.fillText(this.partialText,0,0)}function e(t){t.strokeText(this.partialText,0,0)}var n="auto",i="Calibri",r="canvas",o="center",s="Change.kinetic",a="2d",c="-",l="",u="left",h="text",d="Text",p="middle",f="normal",g="px ",m=" ",v="right",y="word",w="char",_="none",b=["fontFamily","fontSize","fontStyle","padding","align","lineHeight","text","width","height","wrap"],x=b.length,S=document.createElement(r).getContext(a);Kinetic.Text=function(t){this._initText(t)},Kinetic.Text.prototype={_initText:function(i){var r=this;this.createAttrs(),this.attrs.width=n,this.attrs.height=n,Kinetic.Shape.call(this,i),this.shapeType=h,this._fillFunc=t,this._strokeFunc=e,this.shapeType=d,this._setDrawFuncs();for(var o=0;x>o;o++)this.on(b[o]+s,r._setTextData);this._setTextData()},drawFunc:function(t){var e=t.getContext(),n=this.getPadding(),i=(this.getFontStyle(),this.getFontSize(),this.getFontFamily(),this.getTextHeight()),r=this.getLineHeight()*i,s=this.textArr,a=s.length,c=this.getWidth();e.font=this._getContextFont(),e.textBaseline=p,e.textAlign=u,e.save(),e.translate(n,0),e.translate(0,n+i/2);for(var l=0;a>l;l++){var h=s[l],d=h.text,f=h.width;e.save(),this.getAlign()===v?e.translate(c-f-2*n,0):this.getAlign()===o&&e.translate((c-f-2*n)/2,0),this.partialText=d,t.fillStroke(this),e.restore(),e.translate(0,r)}e.restore()},drawHitFunc:function(t){var e=t.getContext(),n=this.getWidth(),i=this.getHeight();e.beginPath(),e.rect(0,0,n,i),e.closePath(),t.fillStroke(this)},setText:function(t){var e=Kinetic.Type._isString(t)?t:t.toString();this.setAttr(h,e)},getWidth:function(){return this.attrs.width===n?this.getTextWidth()+2*this.getPadding():this.attrs.width},getHeight:function(){return this.attrs.height===n?this.getTextHeight()*this.textArr.length*this.getLineHeight()+2*this.getPadding():this.attrs.height},getTextWidth:function(){return this.textWidth},getTextHeight:function(){return this.textHeight},_getTextSize:function(t){var e,n=S,i=this.getFontSize();return n.save(),n.font=this._getContextFont(),e=n.measureText(t),n.restore(),{width:e.width,height:parseInt(i,10)}},_getContextFont:function(){return this.getFontStyle()+m+this.getFontSize()+g+this.getFontFamily()},_addTextLine:function(t,e){return this.textArr.push({text:t,width:e})},_getTextWidth:function(t){return S.measureText(t).width},_setTextData:function(){var t=this.getText().split("\n"),e=+this.getFontSize(),i=0,r=this.getLineHeight()*e,o=this.attrs.width,s=this.attrs.height,a=o!==n,l=s!==n,u=this.getPadding(),h=o-2*u,d=s-2*u,p=0,f=this.getWrap(),v=f!==_,y=f!==w&&v;this.textArr=[],S.save(),S.font=this.getFontStyle()+m+e+g+this.getFontFamily();for(var b=0,x=t.length;x>b;++b){var C=t[b],T=this._getTextWidth(C);if(a&&T>h)for(;C.length>0;){for(var k=0,P=C.length,D="",L=0;P>k;){var K=k+P>>>1,A=C.slice(0,K+1),M=this._getTextWidth(A);h>=M?(k=K+1,D=A,L=M):P=K}if(!D)break;if(y){var E=Math.max(D.lastIndexOf(m),D.lastIndexOf(c))+1;E>0&&(k=E,D=D.slice(0,k),L=this._getTextWidth(D))}if(this._addTextLine(D,L),p+=r,!v||l&&p+r>d)break;if(C=C.slice(k),C.length>0&&(T=this._getTextWidth(C),h>=T)){this._addTextLine(C,T),p+=r;break}}else this._addTextLine(C,T),p+=r,i=Math.max(i,T);if(l&&p+r>d)break}S.restore(),this.textHeight=e,this.textWidth=i}},Kinetic.Global.extend(Kinetic.Text,Kinetic.Shape),Kinetic.Node.addGetterSetter(Kinetic.Text,"fontFamily",i),Kinetic.Node.addGetterSetter(Kinetic.Text,"fontSize",12),Kinetic.Node.addGetterSetter(Kinetic.Text,"fontStyle",f),Kinetic.Node.addGetterSetter(Kinetic.Text,"padding",0),Kinetic.Node.addGetterSetter(Kinetic.Text,"align",u),Kinetic.Node.addGetterSetter(Kinetic.Text,"lineHeight",1),Kinetic.Node.addGetterSetter(Kinetic.Text,"wrap",y),Kinetic.Node.addGetter(Kinetic.Text,h,l),Kinetic.Node.addSetter(Kinetic.Text,"width"),Kinetic.Node.addSetter(Kinetic.Text,"height")}(),function(){Kinetic.Line=function(t){this._initLine(t)},Kinetic.Line.prototype={_initLine:function(t){this.createAttrs(),Kinetic.Shape.call(this,t),this.shapeType="Line",this._setDrawFuncs()},drawFunc:function(t){var e=this.getPoints(),n=e.length,i=t.getContext();i.beginPath(),i.moveTo(e[0].x,e[0].y);for(var r=1;n>r;r++){var o=e[r];i.lineTo(o.x,o.y)}t.stroke(this)},setPoints:function(t){this.setAttr("points",Kinetic.Type._getPoints(t))},getPoints:function(){return this.attrs.points||[]}},Kinetic.Global.extend(Kinetic.Line,Kinetic.Shape)}(),function(){Kinetic.Spline=function(t){this._initSpline(t)},Kinetic.Spline._getControlPoints=function(t,e,n,i){var r=t.x,o=t.y,s=e.x,a=e.y,c=n.x,l=n.y,u=Math.sqrt(Math.pow(s-r,2)+Math.pow(a-o,2)),h=Math.sqrt(Math.pow(c-s,2)+Math.pow(l-a,2)),d=i*u/(u+h),p=i*h/(u+h),f=s-d*(c-r),g=a-d*(l-o),m=s+p*(c-r),v=a+p*(l-o);return[{x:f,y:g},{x:m,y:v}]},Kinetic.Spline.prototype={_initSpline:function(t){this.createAttrs(),Kinetic.Line.call(this,t),this.shapeType="Spline"},drawFunc:function(t){var e=this.getPoints(),n=e.length,i=t.getContext(),r=this.getTension();if(i.beginPath(),i.moveTo(e[0].x,e[0].y),0!==r&&n>2){var o=this.allPoints,s=o.length;i.quadraticCurveTo(o[0].x,o[0].y,o[1].x,o[1].y);for(var a=2;s-1>a;)i.bezierCurveTo(o[a].x,o[a++].y,o[a].x,o[a++].y,o[a].x,o[a++].y);i.quadraticCurveTo(o[s-1].x,o[s-1].y,e[n-1].x,e[n-1].y)}else for(var a=1;n>a;a++){var c=e[a];i.lineTo(c.x,c.y)}t.stroke(this)},setPoints:function(t){Kinetic.Line.prototype.setPoints.call(this,t),this._setAllPoints()},setTension:function(t){this.setAttr("tension",t),this._setAllPoints()},_setAllPoints:function(){for(var t=this.getPoints(),e=t.length,n=this.getTension(),i=[],r=1;e-1>r;r++){var o=Kinetic.Spline._getControlPoints(t[r-1],t[r],t[r+1],n);i.push(o[0]),i.push(t[r]),i.push(o[1])}this.allPoints=i}},Kinetic.Global.extend(Kinetic.Spline,Kinetic.Line),Kinetic.Node.addGetter(Kinetic.Spline,"tension",1)}(),function(){Kinetic.Blob=function(t){this._initBlob(t)},Kinetic.Blob.prototype={_initBlob:function(t){Kinetic.Spline.call(this,t),this.shapeType="Blob"},drawFunc:function(t){var e=this.getPoints(),n=e.length,i=t.getContext(),r=this.getTension();if(i.beginPath(),i.moveTo(e[0].x,e[0].y),0!==r&&n>2)for(var o=this.allPoints,s=o.length,a=0;s-1>a;)i.bezierCurveTo(o[a].x,o[a++].y,o[a].x,o[a++].y,o[a].x,o[a++].y);else for(var a=1;n>a;a++){var c=e[a];i.lineTo(c.x,c.y)}i.closePath(),t.fillStroke(this)},_setAllPoints:function(){var t=this.getPoints(),e=t.length,n=this.getTension(),i=Kinetic.Spline._getControlPoints(t[e-1],t[0],t[1],n),r=Kinetic.Spline._getControlPoints(t[e-2],t[e-1],t[0],n);Kinetic.Spline.prototype._setAllPoints.call(this),this.allPoints.unshift(i[1]),this.allPoints.push(r[0]),this.allPoints.push(t[e-1]),this.allPoints.push(r[1]),this.allPoints.push(i[0]),this.allPoints.push(t[0])}},Kinetic.Global.extend(Kinetic.Blob,Kinetic.Spline)}(),function(){Kinetic.Sprite=function(t){this._initSprite(t)},Kinetic.Sprite.prototype={_initSprite:function(t){this.createAttrs(),Kinetic.Shape.call(this,t),this.shapeType="Sprite",this._setDrawFuncs(),this.anim=new Kinetic.Animation;var e=this;this.on("animationChange",function(){e.setIndex(0)})},drawFunc:function(t){var e=this.getAnimation(),n=this.getIndex(),i=this.getAnimations()[e][n],r=t.getContext(),o=this.getImage();o&&r.drawImage(o,i.x,i.y,i.width,i.height,0,0,i.width,i.height)},drawHitFunc:function(t){var e=this.getAnimation(),n=this.getIndex(),i=this.getAnimations()[e][n],r=t.getContext();r.beginPath(),r.rect(0,0,i.width,i.height),r.closePath(),t.fill(this)},start:function(){var t=this,e=this.getLayer();this.anim.node=e,this.interval=setInterval(function(){var e=t.getIndex();t._updateIndex(),t.afterFrameFunc&&e===t.afterFrameIndex&&(t.afterFrameFunc(),delete t.afterFrameFunc,delete t.afterFrameIndex)},1e3/this.getFrameRate()),this.anim.start()},stop:function(){this.anim.stop(),clearInterval(this.interval)},afterFrame:function(t,e){this.afterFrameIndex=t,this.afterFrameFunc=e},_updateIndex:function(){var t=this.getIndex(),e=this.getAnimation(),n=this.getAnimations(),i=n[e],r=i.length;r-1>t?this.setIndex(t+1):this.setIndex(0)}},Kinetic.Global.extend(Kinetic.Sprite,Kinetic.Shape),Kinetic.Node.addGetterSetter(Kinetic.Sprite,"animation"),Kinetic.Node.addGetterSetter(Kinetic.Sprite,"animations"),Kinetic.Node.addGetterSetter(Kinetic.Sprite,"image"),Kinetic.Node.addGetterSetter(Kinetic.Sprite,"index",0),Kinetic.Node.addGetterSetter(Kinetic.Sprite,"frameRate",17)}(),function(){Kinetic.Path=function(t){this._initPath(t)},Kinetic.Path.prototype={_initPath:function(t){this.dataArray=[];var e=this;Kinetic.Shape.call(this,t),this.shapeType="Path",this._setDrawFuncs(),this.dataArray=Kinetic.Path.parsePathData(this.getData()),this.on("dataChange",function(){e.dataArray=Kinetic.Path.parsePathData(this.getData())})},drawFunc:function(t){var e=this.dataArray,n=t.getContext();n.beginPath();for(var i=0;i<e.length;i++){var r=e[i].command,o=e[i].points;switch(r){case"L":n.lineTo(o[0],o[1]);break;case"M":n.moveTo(o[0],o[1]);break;case"C":n.bezierCurveTo(o[0],o[1],o[2],o[3],o[4],o[5]);break;case"Q":n.quadraticCurveTo(o[0],o[1],o[2],o[3]);break;case"A":var s=o[0],a=o[1],c=o[2],l=o[3],u=o[4],h=o[5],d=o[6],p=o[7],f=c>l?c:l,g=c>l?1:c/l,m=c>l?l/c:1;n.translate(s,a),n.rotate(d),n.scale(g,m),n.arc(0,0,f,u,u+h,1-p),n.scale(1/g,1/m),n.rotate(-d),n.translate(-s,-a);break;case"z":n.closePath()}}t.fillStroke(this)}},Kinetic.Global.extend(Kinetic.Path,Kinetic.Shape),Kinetic.Path.getLineLength=function(t,e,n,i){return Math.sqrt((n-t)*(n-t)+(i-e)*(i-e))},Kinetic.Path.getPointOnLine=function(t,e,n,i,r,o,s){void 0===o&&(o=e),void 0===s&&(s=n);var a=(r-n)/(i-e+1e-8),c=Math.sqrt(t*t/(1+a*a));e>i&&(c*=-1);var l,u=a*c;if((s-n)/(o-e+1e-8)===a)l={x:o+c,y:s+u};else{var h,d,p=this.getLineLength(e,n,i,r);if(1e-8>p)return void 0;var f=(o-e)*(i-e)+(s-n)*(r-n);f/=p*p,h=e+f*(i-e),d=n+f*(r-n);var g=this.getLineLength(o,s,h,d),m=Math.sqrt(t*t-g*g);c=Math.sqrt(m*m/(1+a*a)),e>i&&(c*=-1),u=a*c,l={x:h+c,y:d+u}}return l},Kinetic.Path.getPointOnCubicBezier=function(t,e,n,i,r,o,s,a,c){function l(t){return t*t*t}function u(t){return 3*t*t*(1-t)}function h(t){return 3*t*(1-t)*(1-t)}function d(t){return(1-t)*(1-t)*(1-t)}var p=a*l(t)+o*u(t)+i*h(t)+e*d(t),f=c*l(t)+s*u(t)+r*h(t)+n*d(t);return{x:p,y:f}},Kinetic.Path.getPointOnQuadraticBezier=function(t,e,n,i,r,o,s){function a(t){return t*t}function c(t){return 2*t*(1-t)}function l(t){return(1-t)*(1-t)}var u=o*a(t)+i*c(t)+e*l(t),h=s*a(t)+r*c(t)+n*l(t);return{x:u,y:h}},Kinetic.Path.getPointOnEllipticalArc=function(t,e,n,i,r,o){var s=Math.cos(o),a=Math.sin(o),c={x:n*Math.cos(r),y:i*Math.sin(r)};return{x:t+(c.x*s-c.y*a),y:e+(c.x*a+c.y*s)}},Kinetic.Path.parsePathData=function(t){if(!t)return[];var e=t,n=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];e=e.replace(new RegExp(" ","g"),",");for(var i=0;i<n.length;i++)e=e.replace(new RegExp(n[i],"g"),"|"+n[i]);for(var r=e.split("|"),o=[],s=0,a=0,i=1;i<r.length;i++){var c=r[i],l=c.charAt(0);c=c.slice(1),c=c.replace(new RegExp(",-","g"),"-"),c=c.replace(new RegExp("-","g"),",-"),c=c.replace(new RegExp("e,-","g"),"e-");var u=c.split(",");u.length>0&&""===u[0]&&u.shift();for(var h=0;h<u.length;h++)u[h]=parseFloat(u[h]);for(;u.length>0&&!isNaN(u[0]);){var d=null,p=[],f=s,g=a;switch(l){case"l":s+=u.shift(),a+=u.shift(),d="L",p.push(s,a);break;case"L":s=u.shift(),a=u.shift(),p.push(s,a);break;case"m":s+=u.shift(),a+=u.shift(),d="M",p.push(s,a),l="l";break;case"M":s=u.shift(),a=u.shift(),d="M",p.push(s,a),l="L";break;case"h":s+=u.shift(),d="L",p.push(s,a);break;case"H":s=u.shift(),d="L",p.push(s,a);break;case"v":a+=u.shift(),d="L",p.push(s,a);break;case"V":a=u.shift(),d="L",p.push(s,a);break;case"C":p.push(u.shift(),u.shift(),u.shift(),u.shift()),s=u.shift(),a=u.shift(),p.push(s,a);break;case"c":p.push(s+u.shift(),a+u.shift(),s+u.shift(),a+u.shift()),s+=u.shift(),a+=u.shift(),d="C",p.push(s,a);break;case"S":var m=s,v=a,y=o[o.length-1];"C"===y.command&&(m=s+(s-y.points[2]),v=a+(a-y.points[3])),p.push(m,v,u.shift(),u.shift()),s=u.shift(),a=u.shift(),d="C",p.push(s,a);break;case"s":var m=s,v=a,y=o[o.length-1];"C"===y.command&&(m=s+(s-y.points[2]),v=a+(a-y.points[3])),p.push(m,v,s+u.shift(),a+u.shift()),s+=u.shift(),a+=u.shift(),d="C",p.push(s,a);break;case"Q":p.push(u.shift(),u.shift()),s=u.shift(),a=u.shift(),p.push(s,a);break;case"q":p.push(s+u.shift(),a+u.shift()),s+=u.shift(),a+=u.shift(),d="Q",p.push(s,a);break;case"T":var m=s,v=a,y=o[o.length-1];"Q"===y.command&&(m=s+(s-y.points[0]),v=a+(a-y.points[1])),s=u.shift(),a=u.shift(),d="Q",p.push(m,v,s,a);break;case"t":var m=s,v=a,y=o[o.length-1];"Q"===y.command&&(m=s+(s-y.points[0]),v=a+(a-y.points[1])),s+=u.shift(),a+=u.shift(),d="Q",p.push(m,v,s,a);break;case"A":var w=u.shift(),_=u.shift(),b=u.shift(),x=u.shift(),S=u.shift(),C=s,T=a;s=u.shift(),a=u.shift(),d="A",p=this.convertEndpointToCenterParameterization(C,T,s,a,x,S,w,_,b);break;case"a":var w=u.shift(),_=u.shift(),b=u.shift(),x=u.shift(),S=u.shift(),C=s,T=a;s+=u.shift(),a+=u.shift(),d="A",p=this.convertEndpointToCenterParameterization(C,T,s,a,x,S,w,_,b)}o.push({command:d||l,points:p,start:{x:f,y:g},pathLength:this.calcLength(f,g,d||l,p)})}("z"===l||"Z"===l)&&o.push({command:"z",points:[],start:void 0,pathLength:0})}return o},Kinetic.Path.calcLength=function(e,n,i,r){var o,s,a,c=Kinetic.Path;switch(i){case"L":return c.getLineLength(e,n,r[0],r[1]);case"C":for(o=0,s=c.getPointOnCubicBezier(0,e,n,r[0],r[1],r[2],r[3],r[4],r[5]),t=.01;1>=t;t+=.01)a=c.getPointOnCubicBezier(t,e,n,r[0],r[1],r[2],r[3],r[4],r[5]),o+=c.getLineLength(s.x,s.y,a.x,a.y),s=a;return o;case"Q":for(o=0,s=c.getPointOnQuadraticBezier(0,e,n,r[0],r[1],r[2],r[3]),t=.01;1>=t;t+=.01)a=c.getPointOnQuadraticBezier(t,e,n,r[0],r[1],r[2],r[3]),o+=c.getLineLength(s.x,s.y,a.x,a.y),s=a;return o;case"A":o=0;var l=r[4],u=r[5],h=r[4]+u,d=Math.PI/180;if(Math.abs(l-h)<d&&(d=Math.abs(l-h)),s=c.getPointOnEllipticalArc(r[0],r[1],r[2],r[3],l,0),0>u)for(t=l-d;t>h;t-=d)a=c.getPointOnEllipticalArc(r[0],r[1],r[2],r[3],t,0),o+=c.getLineLength(s.x,s.y,a.x,a.y),s=a;else for(t=l+d;h>t;t+=d)a=c.getPointOnEllipticalArc(r[0],r[1],r[2],r[3],t,0),o+=c.getLineLength(s.x,s.y,a.x,a.y),s=a;return a=c.getPointOnEllipticalArc(r[0],r[1],r[2],r[3],h,0),o+=c.getLineLength(s.x,s.y,a.x,a.y)}return 0},Kinetic.Path.convertEndpointToCenterParameterization=function(t,e,n,i,r,o,s,a,c){var l=c*(Math.PI/180),u=Math.cos(l)*(t-n)/2+Math.sin(l)*(e-i)/2,h=-1*Math.sin(l)*(t-n)/2+Math.cos(l)*(e-i)/2,d=u*u/(s*s)+h*h/(a*a);d>1&&(s*=Math.sqrt(d),a*=Math.sqrt(d));var p=Math.sqrt((s*s*a*a-s*s*h*h-a*a*u*u)/(s*s*h*h+a*a*u*u));r==o&&(p*=-1),isNaN(p)&&(p=0);var f=p*s*h/a,g=p*-a*u/s,m=(t+n)/2+Math.cos(l)*f-Math.sin(l)*g,v=(e+i)/2+Math.sin(l)*f+Math.cos(l)*g,y=function(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])},w=function(t,e){return(t[0]*e[0]+t[1]*e[1])/(y(t)*y(e))},_=function(t,e){return(t[0]*e[1]<t[1]*e[0]?-1:1)*Math.acos(w(t,e))},b=_([1,0],[(u-f)/s,(h-g)/a]),x=[(u-f)/s,(h-g)/a],S=[(-1*u-f)/s,(-1*h-g)/a],C=_(x,S);return w(x,S)<=-1&&(C=Math.PI),w(x,S)>=1&&(C=0),0===o&&C>0&&(C-=2*Math.PI),1==o&&0>C&&(C+=2*Math.PI),[m,v,s,a,b,C,l,o]},Kinetic.Node.addGetterSetter(Kinetic.Path,"data")}(),function(){function t(t){t.fillText(this.partialText,0,0)}function e(t){t.strokeText(this.partialText,0,0)}var n="",i="Calibri",r="normal";Kinetic.TextPath=function(t){this._initTextPath(t)},Kinetic.TextPath.prototype={_initTextPath:function(n){var i=this;this.createAttrs(),this.dummyCanvas=document.createElement("canvas"),this.dataArray=[],Kinetic.Shape.call(this,n),this._fillFunc=t,this._strokeFunc=e,this.shapeType="TextPath",this._setDrawFuncs(),this.dataArray=Kinetic.Path.parsePathData(this.attrs.data),this.on("dataChange",function(){i.dataArray=Kinetic.Path.parsePathData(this.attrs.data)});for(var r=["text","textStroke","textStrokeWidth"],o=0;o<r.length;o++){var s=r[o];this.on(s+"Change",i._setTextData)}i._setTextData()},drawFunc:function(t){var e=(this.charArr,t.getContext());e.font=this._getContextFont(),e.textBaseline="middle",e.textAlign="left",e.save();for(var n=this.glyphInfo,i=0;i<n.length;i++){e.save();var r=n[i].p0;n[i].p1,parseFloat(this.attrs.fontSize),e.translate(r.x,r.y),e.rotate(n[i].rotation),this.partialText=n[i].text,t.fillStroke(this),e.restore()}e.restore()},getTextWidth:function(){return this.textWidth},getTextHeight:function(){return this.textHeight},setText:function(t){Kinetic.Text.prototype.setText.call(this,t)},_getTextSize:function(t){var e=this.dummyCanvas,n=e.getContext("2d");n.save(),n.font=this._getContextFont();var i=n.measureText(t);return n.restore(),{width:i.width,height:parseInt(this.attrs.fontSize,10)}},_setTextData:function(){var t=this,e=this._getTextSize(this.attrs.text);this.textWidth=e.width,this.textHeight=e.height,this.glyphInfo=[];for(var n,i,r,o=this.attrs.text.split(""),s=-1,a=0,c=function(){a=0;for(var e=t.dataArray,i=s+1;i<e.length;i++){if(e[i].pathLength>0)return s=i,e[i];"M"==e[i].command&&(n={x:e[i].points[0],y:e[i].points[1]})}return{}},l=function(e){var o=t._getTextSize(e).width,s=0,l=0;for(i=void 0;Math.abs(o-s)/o>.01&&25>l;){l++;for(var u=s;void 0===r;)r=c(),r&&u+r.pathLength<o&&(u+=r.pathLength,r=void 0);if(r==={}||void 0===n)return void 0;var h=!1;switch(r.command){case"L":Kinetic.Path.getLineLength(n.x,n.y,r.points[0],r.points[1])>o?i=Kinetic.Path.getPointOnLine(o,n.x,n.y,r.points[0],r.points[1],n.x,n.y):r=void 0;break;case"A":var d=r.points[4],p=r.points[5],f=r.points[4]+p;0===a?a=d+1e-8:o>s?a+=Math.PI/180*p/Math.abs(p):a-=Math.PI/360*p/Math.abs(p),Math.abs(a)>Math.abs(f)&&(a=f,h=!0),i=Kinetic.Path.getPointOnEllipticalArc(r.points[0],r.points[1],r.points[2],r.points[3],a,r.points[6]);break;case"C":0===a?a=o>r.pathLength?1e-8:o/r.pathLength:o>s?a+=(o-s)/r.pathLength:a-=(s-o)/r.pathLength,a>1&&(a=1,h=!0),i=Kinetic.Path.getPointOnCubicBezier(a,r.start.x,r.start.y,r.points[0],r.points[1],r.points[2],r.points[3],r.points[4],r.points[5]);break;case"Q":0===a?a=o/r.pathLength:o>s?a+=(o-s)/r.pathLength:a-=(s-o)/r.pathLength,a>1&&(a=1,h=!0),i=Kinetic.Path.getPointOnQuadraticBezier(a,r.start.x,r.start.y,r.points[0],r.points[1],r.points[2],r.points[3])}void 0!==i&&(s=Kinetic.Path.getLineLength(n.x,n.y,i.x,i.y)),h&&(h=!1,r=void 0)}},u=0;u<o.length&&(l(o[u]),void 0!==n&&void 0!==i);u++){var h=Kinetic.Path.getLineLength(n.x,n.y,i.x,i.y),d=0,p=Kinetic.Path.getPointOnLine(d+h/2,n.x,n.y,i.x,i.y),f=Math.atan2(i.y-n.y,i.x-n.x);this.glyphInfo.push({transposeX:p.x,transposeY:p.y,text:o[u],rotation:f,p0:n,p1:i}),n=i
}}},Kinetic.TextPath.prototype._getContextFont=Kinetic.Text.prototype._getContextFont,Kinetic.Global.extend(Kinetic.TextPath,Kinetic.Shape),Kinetic.Node.addGetterSetter(Kinetic.TextPath,"fontFamily",i),Kinetic.Node.addGetterSetter(Kinetic.TextPath,"fontSize",12),Kinetic.Node.addGetterSetter(Kinetic.TextPath,"fontStyle",r),Kinetic.Node.addGetter(Kinetic.TextPath,"text",n)}(),function(){Kinetic.RegularPolygon=function(t){this._initRegularPolygon(t)},Kinetic.RegularPolygon.prototype={_initRegularPolygon:function(t){this.createAttrs(),Kinetic.Shape.call(this,t),this.shapeType="RegularPolygon",this._setDrawFuncs()},drawFunc:function(t){var e=t.getContext(),n=this.attrs.sides,i=this.attrs.radius;e.beginPath(),e.moveTo(0,0-i);for(var r=1;n>r;r++){var o=i*Math.sin(2*r*Math.PI/n),s=-1*i*Math.cos(2*r*Math.PI/n);e.lineTo(o,s)}e.closePath(),t.fillStroke(this)}},Kinetic.Global.extend(Kinetic.RegularPolygon,Kinetic.Shape),Kinetic.Node.addGetterSetter(Kinetic.RegularPolygon,"radius",0),Kinetic.Node.addGetterSetter(Kinetic.RegularPolygon,"sides",0)}(),function(){Kinetic.Star=function(t){this._initStar(t)},Kinetic.Star.prototype={_initStar:function(t){this.createAttrs(),Kinetic.Shape.call(this,t),this.shapeType="Star",this._setDrawFuncs()},drawFunc:function(t){var e=t.getContext(),n=this.attrs.innerRadius,i=this.attrs.outerRadius,r=this.attrs.numPoints;e.beginPath(),e.moveTo(0,0-this.attrs.outerRadius);for(var o=1;2*r>o;o++){var s=0===o%2?i:n,a=s*Math.sin(o*Math.PI/r),c=-1*s*Math.cos(o*Math.PI/r);e.lineTo(a,c)}e.closePath(),t.fillStroke(this)}},Kinetic.Global.extend(Kinetic.Star,Kinetic.Shape),Kinetic.Node.addGetterSetter(Kinetic.Star,"numPoints",0),Kinetic.Node.addGetterSetter(Kinetic.Star,"innerRadius",0),Kinetic.Node.addGetterSetter(Kinetic.Star,"outerRadius",0)}(),function(){var t=["fontFamily","fontSize","fontStyle","padding","lineHeight","text"],e="Change.kinetic",n="none",i="up",r="right",o="down",s="left",a=t.length;Kinetic.Label=function(t){this._initLabel(t)},Kinetic.Label.prototype={_initLabel:function(n){var i=this,r=null;this.innerGroup=new Kinetic.Group,this.createAttrs(),Kinetic.Group.call(this,n),r=new Kinetic.Text(n.text),this.setText(r),this.setRect(new Kinetic.LabelRect(n.rect)),this.innerGroup.add(this.getRect()),this.innerGroup.add(r),this.add(this.innerGroup),this._setGroupOffset();for(var o=0;a>o;o++)r.on(t[o]+e,function(){i._setGroupOffset()})},getWidth:function(){return this.getText().getWidth()},getHeight:function(){return this.getText().getHeight()},_setGroupOffset:function(){var t=this.getText(),e=t.getWidth(),n=t.getHeight(),a=this.getRect(),c=a.getPointerDirection(),l=a.getPointerWidth(),u=a.getPointerHeight(),h=0,d=0;switch(c){case i:h=e/2,d=-1*u;break;case r:h=e+l,d=n/2;break;case o:h=e/2,d=n+u;break;case s:h=-1*l,d=n/2}this.setOffset({x:h,y:d})}},Kinetic.Global.extend(Kinetic.Label,Kinetic.Group),Kinetic.Node.addGetterSetter(Kinetic.Label,"text"),Kinetic.Node.addGetterSetter(Kinetic.Label,"rect"),Kinetic.LabelRect=function(t){this._initLabelRect(t)},Kinetic.LabelRect.prototype={_initLabelRect:function(t){this.createAttrs(),Kinetic.Shape.call(this,t),this.shapeType="LabelRect",this._setDrawFuncs()},drawFunc:function(t){var e=this.getParent().getParent(),n=t.getContext(),a=e.getWidth(),c=e.getHeight(),l=this.getPointerDirection(),u=this.getPointerWidth(),h=this.getPointerHeight();this.getCornerRadius(),n.beginPath(),n.moveTo(0,0),l===i&&(n.lineTo((a-u)/2,0),n.lineTo(a/2,-1*h),n.lineTo((a+u)/2,0)),n.lineTo(a,0),l===r&&(n.lineTo(a,(c-h)/2),n.lineTo(a+u,c/2),n.lineTo(a,(c+h)/2)),n.lineTo(a,c),l===o&&(n.lineTo((a+u)/2,c),n.lineTo(a/2,c+h),n.lineTo((a-u)/2,c)),n.lineTo(0,c),l===s&&(n.lineTo(0,(c+h)/2),n.lineTo(-1*u,c/2),n.lineTo(0,(c-h)/2)),n.closePath(),t.fillStroke(this)}},Kinetic.Global.extend(Kinetic.LabelRect,Kinetic.Shape),Kinetic.Node.addGetterSetter(Kinetic.LabelRect,"pointerDirection",n),Kinetic.Node.addGetterSetter(Kinetic.LabelRect,"pointerWidth",0),Kinetic.Node.addGetterSetter(Kinetic.LabelRect,"pointerHeight",0),Kinetic.Node.addGetterSetter(Kinetic.LabelRect,"cornerRadius",0)}(),define("application/uml/drawing/sequence/config",["require","jquery"],function(t){var e,n,i;return e=t("jquery"),n=e("body").css("fontFamily"),i=parseInt(e("body").css("fontSize"),10),{lineSize:1,arrowSize:8,borderColor:"#a80036",backColor:"#ffffcf",foreColor:"#000",fontFamily:n,fontSize:i}}),define("application/uml/drawing/sequence/composite",["require","underscore"],function(t){var e,n;return n=t("underscore"),e=function(){function t(){this.children=[]}return t.prototype.draw=function(){throw new Error("Not implemented.")},t.prototype.remove=function(){return n(this.children).each(function(t){return t.remove()}),this},t.prototype.getX1=function(){var t;return this.children.length?t=n(this.children).chain().map(function(t){return t.getX1()}).sortBy(function(t){return t}).first().value():0},t.prototype.getY1=function(){var t;return this.children.length?t=n(this.children).chain().map(function(t){return t.getY1()}).sortBy(function(t){return t}).first().value():0},t.prototype.getX2=function(){var t;return this.children.length?t=n(this.children).chain().map(function(t){return t.getX2()}).sortBy(function(t){return t}).last().value():0},t.prototype.getY2=function(){var t;return this.children.length?t=n(this.children).chain().map(function(t){return t.getY2()}).sortBy(function(t){return t}).last().value():0},t.prototype.getWidth=function(){var t;return t=this.getX2()-this.getX1()},t.prototype.getHeight=function(){var t;return t=this.getY2()-this.getY1()},t.prototype.show=function(){return n(this.children).each(function(t){return t.show()}),this},t.prototype.hide=function(){return n(this.children).each(function(t){return t.hide()}),this},t.prototype.toBack=function(){return n(this.children).each(function(t){return t.toBack()}),this},t.prototype.toFront=function(){return n(this.children).each(function(t){return t.toFront()}),this},t}()});var __hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var i in e)__hasProp.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};define("application/uml/drawing/sequence/participant",["require","./config","./composite"],function(t){var e,n,i,r,o;return n=t("./config"),e=t("./composite"),i=30,o={fontFamily:n.fontFamily,fontSize:n.fontSize,fill:n.foreColor},r=function(t){function e(t){this.model=t,e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.draw=function(t){var e,r,s,a,c;return s=t.getParticipantShapeStartPoint(this.model),a=t.shapeFactory.text(s.x+i,s.y+i,this.model.name,o).draw(t.surface),c=2*i+a.getWidth(),r=2*i+a.getHeight(),e=t.shapeFactory.rectangle(s.x,s.y,c,r,{stroke:n.borderColor,fill:n.backColor}).draw(t.surface),e.toBack(),a.toFront(),this.children.push(a,e),t.addShape(this),this},e.prototype.getLifelineStartPoint=function(){var t,e;return t=this.getX1()+this.getWidth()/2,e=this.getY1()+this.getHeight(),{x:t,y:e}},e}(e)}),define("application/uml/drawing/linestyle",[],function(){return{line:0,dash:1}});var __hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var i in e)__hasProp.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};define("application/uml/drawing/sequence/lifeline",["require","./config","./composite","../linestyle"],function(t){var e,n,i,r;return n=t("./config"),e=t("./composite"),r=t("../linestyle"),i=function(t){function e(t){this.model=t,e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.draw=function(t){var e,i;return i=t.getLifelinePosition(this.model.name),e=t.shapeFactory.verticalLine(i.x,i.y,i.height,r.dash,{stroke:n.borderColor}).draw(t.surface).toBack(),this.children.push(e),t.addShape(this),this},e}(e)}),define("application/uml/drawing/sequence/context",["require","underscore","./config","./participant","./lifeline","../../models/sequence/composite","../../models/sequence/condition","../../models/sequence/group","../../models/sequence/message"],function(t){var e,n,i,r,o,s,a,c,l,u,h,d;return d=t("underscore"),i=t("./config"),u=t("./participant"),s=t("./lifeline"),e=t("../../models/sequence/composite"),n=t("../../models/sequence/condition"),o=t("../../models/sequence/group"),c=t("../../models/sequence/message"),l=80,h=40,a=10,r=function(){function t(t,e,n){this.diagram=t,this.surface=e,this.shapeFactory=n,this.shapes=[],this.streamlinedMessages=this.getStreamLinedMessages(t.commands),this.totalNesting=this.getNestingLevel()}return t.prototype.getStreamLinedMessages=function(t){var n,i=this;return n=[],d(t).each(function(t){return t instanceof c?n.push(t):t instanceof e?d(i.getStreamLinedMessages(t.children)).each(function(t){return n.push(t)}):!1}),n},t.prototype.getNestingLevel=function(t){var i,r=this;return i=0,t||(t=this.diagram.commands),d(t).chain().filter(function(t){return t instanceof e}).each(function(t){var e;return e=1,t instanceof n?(e+=r.getNestingLevel(t.getIfGroup().children),i=Math.max(e,i),d(t.getElseGroups()).each(function(t){return e+=r.getNestingLevel(t.children),i=Math.max(e,i)})):t instanceof o?(e+=r.getNestingLevel(t.children),i=Math.max(e,i)):!1}),i},t.prototype.getXMargin=function(t){var e;return e=l,t&&(e+=h*t),e},t.prototype.isLast=function(t){var e;return e=d(this.diagram.participants).last()===t},t.prototype.getTitleShapeStartPoint=function(t,e){var n,i,r,o,s,a;return n=d(this.shapes).chain().map(function(t){return t.getX1()}).sortBy(function(t){return t}).first().value(),r=d(this.shapes).chain().map(function(t){return t.getX2()}).sortBy(function(t){return t}).last().value(),s=r-n,o=this.textSize(t,e),a=o.width>s?l:n+(s-o.width)/2,i={x:a,y:this.getNextShapeStartY()}},t.prototype.getResizedSize=function(){var t,e,n;return e=d(this.shapes).chain().map(function(t){return t.getX2()}).sortBy(function(t){return t}).last().value(),t=d(this.shapes).chain().map(function(t){return t.getY2()}).sortBy(function(t){return t}).last().value(),n={width:e+l,height:t+l}},t.prototype.addShape=function(t){return this.shapes.push(t),this},t.prototype.getLastDrawnShape=function(){var t;return t=d(this.shapes).last()},t.prototype.getParticipantShape=function(t){var e;return e=d(this.shapes).chain().filter(function(t){return t instanceof u}).find(function(e){return e.model.name===t}).value()},t.prototype.getParticipantShapeStartPoint=function(t){var e,n,i;return e=this.getLastParticipantShape(),i=e?e.getX2()+this.getMessageWidth(t,e.model)+h:this.getXMargin(this.totalNesting),n={x:i,y:l}},t.prototype.getNextShapeStartY=function(){var t;return t=this.getLastDrawnShape().getY2()+h},t.prototype.getCompositeShapeWidth=function(t){var e,n,i,r;return n=d(this.shapes).chain().filter(function(t){return t instanceof u}).map(function(t){return t.getX1()}).sortBy(function(t){return t}).first().value(),i=d(this.shapes).chain().filter(function(t){return t instanceof u}).map(function(t){return t.getX2()}).sortBy(function(t){return t}).last().value(),e=Math.abs(t-n),r=i+e-t},t.prototype.getCompositeShapeHeight=function(t){var e;return e=this.getNextShapeStartY()-t},t.prototype.getLifelinePosition=function(t){var e,n,r,o,a;return r=this.getParticipantShape(t),o=r.getLifelineStartPoint(),e=d(this.shapes).chain().filter(function(t){return!(t instanceof s)}).map(function(t){return t.getY2()}).sortBy(function(t){return t}).last().value(),n=e-o.y-i.lineSize+h,a={x:o.x,y:o.y+i.lineSize,height:n}},t.prototype.getLastParticipantShape=function(){var t;return t=d(this.shapes).chain().filter(function(t){return t instanceof u}).sortBy(function(t){return t.getX2()}).last().value()},t.prototype.getMessageWidth=function(t,e){var n,i,r=this;return n=d(this.streamlinedMessages).filter(function(n){return n.sender===e&&n.receiver===t||n.sender===t&&n.receiver===e||n.sender===t&&n.receiver===t||n.sender===e&&n.receiver===e}),n.length?(i=d(n).chain().map(function(t){return r.textSize(t.name).width}).max().value(),i+=2*a):0},t.prototype.textSize=function(t,e){var n;return n=this.shapeFactory.textSize(this.surface,t,e)},t}()});var __hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var i in e)__hasProp.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};define("application/uml/drawing/sequence/groupheader",["require","./config","./composite","../linestyle"],function(t){var e,n,i,r,o,s;return n=t("./config"),e=t("./composite"),o=t("../linestyle"),r=8,s={fontFamily:n.fontFamily,fontSize:n.fontSize,fill:n.foreColor},i=function(t){function e(t,n,i,r){this.x=t,this.y=n,this.showType=i,this.model=r,e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.draw=function(t){var e,i,a,c,l,u,h,d;return h=this.x,d=this.y,l=this.model.type,e=this.model.label,u=t.shapeFactory.text(h+r,d+r,l,s).draw(t.surface),this.children.push(u),a=t.shapeFactory.verticalLine(u.getX2()+r,d,u.getY2()-d+r,o.line,{stroke:n.borderColor}).draw(t.surface),this.children.push(a),c=t.shapeFactory.horizontalLine(h,u.getY2()+r,u.getX2()-h+r,o.line,{stroke:n.borderColor}).draw(t.surface),this.children.push(c),e&&(i=t.shapeFactory.text(a.getX2()+r,d+r,"["+e+"]",s).draw(t.surface),this.children.push(i)),this.showType||(u.hide(),a.hide(),c.hide()),t.addShape(this),this},e}(e)}),define("application/uml/drawing/arrowdirection",[],function(){return{left:0,right:1}}),define("application/uml/drawing/arrowstyle",[],function(){return{open:0,close:1}});var __hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var i in e)__hasProp.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};define("application/uml/drawing/sequence/message",["require","./config","./composite","../arrowdirection","../arrowstyle","../linestyle"],function(t){var e,n,i,r,o,s,a,c,l,u;return r=t("./config"),i=t("./composite"),e=t("../arrowdirection"),n=t("../arrowstyle"),o=t("../linestyle"),c=10,a=40,l=function(){return 3*r.lineSize},u={fontFamily:r.fontFamily,fontSize:r.fontSize,fill:r.foreColor},s=function(t){function i(t){this.model=t,i.__super__.constructor.apply(this,arguments)}return __extends(i,t),i.prototype.draw=function(t){var i,r,s,a,c,u,h,d,p,f;return r=this.model.async?n.open:n.close,a=this.model.callReturn?o.dash:o.line,f=t.getNextShapeStartY(),u=t.getParticipantShape(this.model.sender.name),c=t.getParticipantShape(this.model.receiver.name),s=l(),this.model.selfInvoking()?(h=u.getLifelineStartPoint().x,t.isLast(u.model)?(i=e.right,h-=s):(i=e.left,h+=s),this.drawSelfInvoking(t,i,r,a,h,f)):(u.getX1()<c.getX1()?(i=e.right,d=u.getLifelineStartPoint().x+s,p=c.getLifelineStartPoint().x-s):(i=e.left,d=c.getLifelineStartPoint().x+s,p=u.getLifelineStartPoint().x-s),this.drawRegular(t,i,r,a,d,p,f)),t.addShape(this),this},i.prototype.drawRegular=function(t,i,o,s,a,c,h){var d,p,f,g,m,v,y,w;return m=t.shapeFactory.textSize(t.surface,this.model.name,u),y=c-a,v=a+(y-m.width)/2,g=t.shapeFactory.text(v,h,this.model.name,u).draw(t.surface),h+=m.height+l(),f=t.shapeFactory.horizontalLine(a,h,y,s,{stroke:r.borderColor}).draw(t.surface),w=i===e.left?a:c,p={stroke:r.borderColor},o===n.close&&(p.fill=r.borderColor),d=t.shapeFactory.arrow(w,h,i,o,r.arrowSize,p).draw(t.surface),this.children.push(g,f,d)},i.prototype.drawSelfInvoking=function(t,i,o,s,h,d){var p,f,g,m,v,y,w,_,b;return _=t.shapeFactory.textSize(t.surface,this.model.name,u),b=h+c/2,y=_.width+c,i===e.right&&(b=h-_.width-c/2,y=-y),w=t.shapeFactory.text(b,d,this.model.name,u).draw(t.surface),d+=_.height+l(),g=t.shapeFactory.horizontalLine(h,d,y,s,{stroke:r.borderColor}).draw(t.surface),m=t.shapeFactory.verticalLine(h+y,d,a,s,{stroke:r.borderColor}).draw(t.surface),v=t.shapeFactory.horizontalLine(h,d+a,y,s,{stroke:r.borderColor}).draw(t.surface),f={stroke:r.borderColor},o===n.close&&(f.fill=r.borderColor),p=t.shapeFactory.arrow(h,d+a,i,o,r.arrowSize,f).draw(t.surface),this.children.push(w,g,m,v,p)},i}(i)});var __hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var i in e)__hasProp.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};define("application/uml/drawing/sequence/group",["require","underscore","./config","./composite","./groupheader","./message","../../models/sequence/composite","../../models/sequence/condition","../../models/sequence/group","../../models/sequence/message","./condition"],function(t){var e,n,i,r,o,s,a,c,l,u,h,d;return d=t("underscore"),o=t("./config"),e=t("./composite"),a=t("./groupheader"),l=t("./message"),n=t("../../models/sequence/composite"),r=t("../../models/sequence/condition"),c=t("../../models/sequence/group"),u=t("../../models/sequence/message"),i=null,h=function(){return i||(i=t("./condition"))},s=function(t){function e(t,n){this.model=t,this.nestingLevel=n,e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.draw=function(t){var i,s,p,f,g,m,v,y=this;return f=this.nestingLevel,m=t.getXMargin(f),v=t.getNextShapeStartY(),s=new a(m,v,!0,{type:this.model.type,label:this.model.label}).draw(t),this.children.push(s),d(this.model.children).each(function(i){var o,s;return s=null,i instanceof n?(f+=1,i instanceof r?(o=h(),s=new o(i,f)):i instanceof c&&(s=new e(i,f)),f-=1):i instanceof u&&(s=new l(i)),s?y.children.push(s.draw(t)):!1}),g=t.getCompositeShapeWidth(m),p=t.getNextShapeStartY()-v,i=t.shapeFactory.rectangle(m,v,g,p,{stroke:o.borderColor}).draw(t.surface),this.children.push(i),t.addShape(this),this},e}(e)});var __hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var i in e)__hasProp.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};define("application/uml/drawing/sequence/condition",["require","underscore","./config","./composite","./group","./groupheader","./message","../linestyle","../../models/sequence/composite","../../models/sequence/condition","../../models/sequence/group","../../models/sequence/message"],function(t){var e,n,i,r,o,s,a,c,l,u,h,d;return d=t("underscore"),o=t("./config"),e=t("./composite"),s=t("./group"),a=t("./groupheader"),u=t("./message"),l=t("../linestyle"),n=t("../../models/sequence/composite"),r=t("../../models/sequence/condition"),c=t("../../models/sequence/group"),h=t("../../models/sequence/message"),i=function(t){function e(t,n){this.model=t,this.nestingLevel=n,e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.draw=function(t){var e,n,i,r,s,c,u,h,p,f=this;return r=this.model.getIfGroup(),n=this.model.getElseGroups(),c=this.nestingLevel,h=t.getXMargin(c),p=t.getNextShapeStartY(),u=t.getCompositeShapeWidth(h),s=new a(h,p,!0,{type:"alt",label:r.label}).draw(t),this.children.push(s),this.iterate(c,r,t),d(n).each(function(e){var n,i;return n=t.shapeFactory.horizontalLine(h,t.getNextShapeStartY(),u,l.dash,{stroke:o.borderColor}).draw(t.surface),f.children.push(n),i=new a(h,t.getNextShapeStartY(),!1,{type:"alt",label:e.label}).draw(t),f.children.push(i),f.iterate(c,e,t)}),i=t.getNextShapeStartY()-p,e=t.shapeFactory.rectangle(h,p,u,i,{stroke:o.borderColor}).draw(t.surface),this.children.push(e),t.addShape(this),this},e.prototype.iterate=function(t,i,o){var a=this;return d(i.children).each(function(i){var l;return l=null,i instanceof n?(t+=1,i instanceof r?l=new e(i,t):i instanceof c&&(l=new s(i,t)),t-=1):i instanceof h&&(l=new u(i)),l?a.children.push(l.draw(o)):!1})},e}(e)});var __hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var i in e)__hasProp.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};define("application/uml/drawing/sequence/title",["require","./config","./composite"],function(t){var e,n,i,r;return n=t("./config"),e=t("./composite"),r={fontFamily:n.fontFamily,fontSize:1.5*n.fontSize,fill:n.foreColor},i=function(t){function e(t){this.model=t,e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.draw=function(t){var e,n;return e=t.getTitleShapeStartPoint(this.model.text,r),n=t.shapeFactory.text(e.x,e.y,this.model.text,r).draw(t.surface),this.children.push(n),t.addShape(this),this},e}(e)}),define("application/uml/drawing/canvas/base",[],function(){var t;return t=function(){function t(t){this.attributes=null!=t?t:{}}return t.prototype.draw=function(){throw new Error("Not implemented.")},t.prototype.remove=function(){return this.element.destroy(),this},t.prototype.getX1=function(){return this.element.getX()},t.prototype.getY1=function(){return this.element.getY()},t.prototype.getX2=function(){var t;return t=this.getX1()+this.getWidth()},t.prototype.getY2=function(){var t;return t=this.getY1()+this.getHeight()},t.prototype.getWidth=function(){return this.element.getWidth()},t.prototype.getHeight=function(){return this.element.getHeight()},t.prototype.show=function(){return this.element.show(),this},t.prototype.hide=function(){return this.element.hide(),this},t.prototype.toBack=function(){return this.element.moveToBottom(),this},t.prototype.toFront=function(){return this.element.moveToTop(),this},t}()});var __hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var i in e)__hasProp.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};define("application/uml/drawing/canvas/rectangle",["require","underscore","kinetic","./base"],function(t){var e,n,i,r;return r=t("underscore"),n=t("kinetic"),e=t("./base"),i=function(t){function e(t,n,i,r,o){this.x=t,this.y=n,this.width=i,this.height=r,e.__super__.constructor.call(this,o)}return __extends(e,t),e.prototype.draw=function(t){return this.element=new n.Rect({x:this.x,y:this.y,width:this.width,height:this.height}),r(this.attributes).isEmpty()||this.element.setAttrs(this.attributes),this.element.setListening(!1),t.add(this.element),this},e}(e)});var __hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var i in e)__hasProp.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};define("application/uml/drawing/canvas/text",["require","underscore","kinetic","./base"],function(t){var e,n,i,r;return r=t("underscore"),n=t("kinetic"),e=t("./base"),i=function(t){function e(t,n,i,r){this.x=t,this.y=n,this.value=i,e.__super__.constructor.call(this,r)}return __extends(e,t),e.size=function(t,n,i){var r,o;return o=new e(0,0,n,i).draw(t),r={width:o.getWidth(),height:o.getHeight()},o.remove(),r},e.prototype.draw=function(t){return this.element=new n.Text({x:this.x,y:this.y,text:this.value}),this.element.setAttrs(this.attributes),this.element.setListening(!1),t.add(this.element),this},e}(e)});var __hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var i in e)__hasProp.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};define("application/uml/drawing/canvas/line",["require","underscore","kinetic","./base","../linestyle"],function(t){var e,n,i,r,o;return o=t("underscore"),n=t("kinetic"),e=t("./base"),r=t("../linestyle"),i=function(t){function e(t,n,i,o){this.x=t,this.y=n,this.style=null!=i?i:r.line,e.__super__.constructor.call(this,o)}return __extends(e,t),e.prototype.draw=function(t){var e;return e=o(this.attributes).defaults({points:this.getPoints()}),this.style===r.dash&&(e=o(e).defaults({dashArray:[8,3]})),this.element=new n.Line(e),this.element.setListening(!1),t.add(this.element),this},e.prototype.getPoints=function(){throw new Error("Not implemented.")},e.prototype.getX1=function(){return this.x},e.prototype.getY1=function(){return this.y},e}(e)});var __hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var i in e)__hasProp.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};define("application/uml/drawing/canvas/verticalline",["require","./line"],function(t){var e,n;return e=t("./line"),n=function(t){function e(t,n,i,r,o){this.height=i,e.__super__.constructor.call(this,t,n,r,o)}return __extends(e,t),e.prototype.getPoints=function(){return[this.x,this.y,this.x,this.y+this.height]},e.prototype.getHeight=function(){return this.height},e}(e)});var __hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var i in e)__hasProp.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};define("application/uml/drawing/canvas/horizontalline",["require","./line"],function(t){var e,n;return n=t("./line"),e=function(t){function e(t,n,i,r,o){this.width=i,e.__super__.constructor.call(this,t,n,r,o)}return __extends(e,t),e.prototype.getPoints=function(){return[this.x,this.y,this.x+this.width,this.y]},e.prototype.getWidth=function(){return this.width},e}(n)});var __hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var i in e)__hasProp.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};define("application/uml/drawing/canvas/arrow",["require","kinetic","./base","../arrowdirection","../arrowstyle"],function(t){var e,n,i,r,o;return o=t("kinetic"),r=t("./base"),n=t("../arrowdirection"),i=t("../arrowstyle"),e=function(t){function e(t,r,o,s,a,c){this.x=t,this.y=r,this.direction=null!=o?o:n.left,this.style=null!=s?s:i.open,this.size=a,e.__super__.constructor.call(this,c)}return __extends(e,t),e.prototype.getX1=function(){return this.x},e.prototype.getY1=function(){return this.y},e.prototype.draw=function(t){var e;return e=this.generatePath(),this.element=new o.Path({data:e}),this.element.setAttrs(this.attributes),this.element.setListening(!1),t.add(this.element),this},e.prototype.generatePath=function(){var t;return t=null,this.direction===n.right?(t="M"+this.x+" "+this.y+" L"+(this.x-this.size)+" "+(this.y-this.size)+" ",this.style===i.close?t+=""+(this.x-this.size)+" "+(this.y+this.size)+" Z":this.style===i.open&&(t+="M"+this.x+" "+this.y+" L"+(this.x-this.size)+" "+(this.y+this.size))):this.direction===n.left&&(t="M"+this.x+" "+this.y+" L"+(this.x+this.size)+" "+(this.y-this.size)+" ",this.style===i.close?t+=""+(this.x+this.size)+" "+(this.y+this.size)+" Z":this.style===i.open&&(t+="M"+this.x+" "+this.y+" L"+(this.x+this.size)+" "+(this.y+this.size))),t},e}(r)}),define("application/uml/drawing/canvas/factory",["require","./rectangle","./text","./verticalline","./horizontalline","./arrow"],function(t){var e,n,i,r,o,s;return r=t("./rectangle"),o=t("./text"),s=t("./verticalline"),i=t("./horizontalline"),e=t("./arrow"),n=function(){function t(){}return t.prototype.rectangle=function(t,e,n,i,o){return new r(t,e,n,i,o)},t.prototype.text=function(t,e,n,i){return new o(t,e,n,i)},t.prototype.verticalLine=function(t,e,n,i,r){return new s(t,e,n,i,r)},t.prototype.horizontalLine=function(t,e,n,r,o){return new i(t,e,n,r,o)},t.prototype.arrow=function(t,n,i,r,o,s){return new e(t,n,i,r,o,s)},t.prototype.textSize=function(t,e,n){return o.size(t,e,n)},t}()}),define("application/uml/drawing/sequence/renderer",["require","jquery","underscore","kinetic","./context","./participant","./condition","./group","./message","./lifeline","./title","../canvas/factory","../../models/sequence/composite","../../models/sequence/condition","../../models/sequence/group","../../models/sequence/message"],function(t){var e,n,i,r,o,s,a,c,l,u,h,d,p,f,g,m;return e=t("jquery"),m=t("underscore"),l=t("kinetic"),o=t("./context"),p=t("./participant"),i=t("./condition"),a=t("./group"),h=t("./message"),u=t("./lifeline"),g=t("./title"),s=t("../canvas/factory"),n=t("../../models/sequence/composite"),r=t("../../models/sequence/condition"),c=t("../../models/sequence/group"),d=t("../../models/sequence/message"),f=function(){function t(t){var n;this.id=null!=t?t:"canvas",n=e("#"+this.id),this.container=n.parent(),this.originalSize=this.currentSize={width:n.width(),height:n.height()},this.shapeFactory=new s}return t.prototype.reset=function(){return this.currentSize={width:this.originalSize.width,height:this.originalSize.height},this.surface&&this.surface.destroy(),this.surface=new l.Stage({container:this.id,width:this.currentSize.width,height:this.currentSize.height}),this.resetSize()},t.prototype.render=function(t){var e,s,f;return this.reset(),t&&t.participants.length?(f=new l.Layer,e=new o(t,f,this.shapeFactory),m(t.participants).each(function(t){return new p(t).draw(e)}),s=0,m(t.commands).each(function(t){var o;return o=null,t instanceof n?(s+=1,t instanceof r?o=new i(t,s):t instanceof c&&(o=new a(t,s)),s-=1):t instanceof d&&(o=new h(t)),o?o.draw(e):void 0}),m(t.participants).each(function(t){return new u(t).draw(e).toBack()}),t.title&&new g(t.title).draw(e),this.currentSize=e.getResizedSize(),this.surface.add(f),this.resetSize(),this.surface.draw(),!0):!1},t.prototype.resetSize=function(){return this.surface.setWidth(this.currentSize.width),this.surface.setHeight(this.currentSize.height),this.container.width(this.currentSize.width),this.container.height(this.currentSize.height)},t.prototype.serialize=function(){var t,e;if(!(null!=(e=this.surface)?e.getChildren().length:void 0))throw new Error("You cannot export a blank document, add some code prior exporting.");return t=this.surface.getChildren()[0].toDataURL()},t}()}),!function(t){t(function(){t.support.transition=function(){var t=function(){var t,e=document.createElement("bootstrap"),n={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(t in n)if(void 0!==e.style[t])return n[t]}();return t&&{end:t}}()})}(window.jQuery),!function(t){var e='[data-dismiss="alert"]',n=function(n){t(n).on("click",e,this.close)};n.prototype.close=function(e){function n(){i.trigger("closed").remove()}var i,r=t(this),o=r.attr("data-target");o||(o=r.attr("href"),o=o&&o.replace(/.*(?=#[^\s]*$)/,"")),i=t(o),e&&e.preventDefault(),i.length||(i=r.hasClass("alert")?r:r.parent()),i.trigger(e=t.Event("close")),e.isDefaultPrevented()||(i.removeClass("in"),t.support.transition&&i.hasClass("fade")?i.on(t.support.transition.end,n):n())};var i=t.fn.alert;t.fn.alert=function(e){return this.each(function(){var i=t(this),r=i.data("alert");r||i.data("alert",r=new n(this)),"string"==typeof e&&r[e].call(i)})},t.fn.alert.Constructor=n,t.fn.alert.noConflict=function(){return t.fn.alert=i,this},t(document).on("click.alert.data-api",e,n.prototype.close)}(window.jQuery),!function(t){var e=function(e,n){this.$element=t(e),this.options=t.extend({},t.fn.button.defaults,n)};e.prototype.setState=function(t){var e="disabled",n=this.$element,i=n.data(),r=n.is("input")?"val":"html";t+="Text",i.resetText||n.data("resetText",n[r]()),n[r](i[t]||this.options[t]),setTimeout(function(){"loadingText"==t?n.addClass(e).attr(e,e):n.removeClass(e).removeAttr(e)},0)},e.prototype.toggle=function(){var t=this.$element.closest('[data-toggle="buttons-radio"]');t&&t.find(".active").removeClass("active"),this.$element.toggleClass("active")};var n=t.fn.button;t.fn.button=function(n){return this.each(function(){var i=t(this),r=i.data("button"),o="object"==typeof n&&n;r||i.data("button",r=new e(this,o)),"toggle"==n?r.toggle():n&&r.setState(n)})},t.fn.button.defaults={loadingText:"loading..."},t.fn.button.Constructor=e,t.fn.button.noConflict=function(){return t.fn.button=n,this},t(document).on("click.button.data-api","[data-toggle^=button]",function(e){var n=t(e.target);n.hasClass("btn")||(n=n.closest(".btn")),n.button("toggle")})}(window.jQuery),!function(t){var e=function(e,n){this.$element=t(e),this.$indicators=this.$element.find(".carousel-indicators"),this.options=n,"hover"==this.options.pause&&this.$element.on("mouseenter",t.proxy(this.pause,this)).on("mouseleave",t.proxy(this.cycle,this))};e.prototype={cycle:function(e){return e||(this.paused=!1),this.interval&&clearInterval(this.interval),this.options.interval&&!this.paused&&(this.interval=setInterval(t.proxy(this.next,this),this.options.interval)),this
},getActiveIndex:function(){return this.$active=this.$element.find(".item.active"),this.$items=this.$active.parent().children(),this.$items.index(this.$active)},to:function(e){var n=this.getActiveIndex(),i=this;if(!(e>this.$items.length-1||0>e))return this.sliding?this.$element.one("slid",function(){i.to(e)}):n==e?this.pause().cycle():this.slide(e>n?"next":"prev",t(this.$items[e]))},pause:function(e){return e||(this.paused=!0),this.$element.find(".next, .prev").length&&t.support.transition.end&&(this.$element.trigger(t.support.transition.end),this.cycle(!0)),clearInterval(this.interval),this.interval=null,this},next:function(){return this.sliding?void 0:this.slide("next")},prev:function(){return this.sliding?void 0:this.slide("prev")},slide:function(e,n){var i,r=this.$element.find(".item.active"),o=n||r[e](),s=this.interval,a="next"==e?"left":"right",c="next"==e?"first":"last",l=this;if(this.sliding=!0,s&&this.pause(),o=o.length?o:this.$element.find(".item")[c](),i=t.Event("slide",{relatedTarget:o[0],direction:a}),!o.hasClass("active")){if(this.$indicators.length&&(this.$indicators.find(".active").removeClass("active"),this.$element.one("slid",function(){var e=t(l.$indicators.children()[l.getActiveIndex()]);e&&e.addClass("active")})),t.support.transition&&this.$element.hasClass("slide")){if(this.$element.trigger(i),i.isDefaultPrevented())return;o.addClass(e),o[0].offsetWidth,r.addClass(a),o.addClass(a),this.$element.one(t.support.transition.end,function(){o.removeClass([e,a].join(" ")).addClass("active"),r.removeClass(["active",a].join(" ")),l.sliding=!1,setTimeout(function(){l.$element.trigger("slid")},0)})}else{if(this.$element.trigger(i),i.isDefaultPrevented())return;r.removeClass("active"),o.addClass("active"),this.sliding=!1,this.$element.trigger("slid")}return s&&this.cycle(),this}}};var n=t.fn.carousel;t.fn.carousel=function(n){return this.each(function(){var i=t(this),r=i.data("carousel"),o=t.extend({},t.fn.carousel.defaults,"object"==typeof n&&n),s="string"==typeof n?n:o.slide;r||i.data("carousel",r=new e(this,o)),"number"==typeof n?r.to(n):s?r[s]():o.interval&&r.pause().cycle()})},t.fn.carousel.defaults={interval:5e3,pause:"hover"},t.fn.carousel.Constructor=e,t.fn.carousel.noConflict=function(){return t.fn.carousel=n,this},t(document).on("click.carousel.data-api","[data-slide], [data-slide-to]",function(e){var n,i,r=t(this),o=t(r.attr("data-target")||(n=r.attr("href"))&&n.replace(/.*(?=#[^\s]+$)/,"")),s=t.extend({},o.data(),r.data());o.carousel(s),(i=r.attr("data-slide-to"))&&o.data("carousel").pause().to(i).cycle(),e.preventDefault()})}(window.jQuery),!function(t){var e=function(e,n){this.$element=t(e),this.options=t.extend({},t.fn.collapse.defaults,n),this.options.parent&&(this.$parent=t(this.options.parent)),this.options.toggle&&this.toggle()};e.prototype={constructor:e,dimension:function(){var t=this.$element.hasClass("width");return t?"width":"height"},show:function(){var e,n,i,r;if(!this.transitioning&&!this.$element.hasClass("in")){if(e=this.dimension(),n=t.camelCase(["scroll",e].join("-")),i=this.$parent&&this.$parent.find("> .accordion-group > .in"),i&&i.length){if(r=i.data("collapse"),r&&r.transitioning)return;i.collapse("hide"),r||i.data("collapse",null)}this.$element[e](0),this.transition("addClass",t.Event("show"),"shown"),t.support.transition&&this.$element[e](this.$element[0][n])}},hide:function(){var e;!this.transitioning&&this.$element.hasClass("in")&&(e=this.dimension(),this.reset(this.$element[e]()),this.transition("removeClass",t.Event("hide"),"hidden"),this.$element[e](0))},reset:function(t){var e=this.dimension();return this.$element.removeClass("collapse")[e](t||"auto")[0].offsetWidth,this.$element[null!==t?"addClass":"removeClass"]("collapse"),this},transition:function(e,n,i){var r=this,o=function(){"show"==n.type&&r.reset(),r.transitioning=0,r.$element.trigger(i)};this.$element.trigger(n),n.isDefaultPrevented()||(this.transitioning=1,this.$element[e]("in"),t.support.transition&&this.$element.hasClass("collapse")?this.$element.one(t.support.transition.end,o):o())},toggle:function(){this[this.$element.hasClass("in")?"hide":"show"]()}};var n=t.fn.collapse;t.fn.collapse=function(n){return this.each(function(){var i=t(this),r=i.data("collapse"),o=t.extend({},t.fn.collapse.defaults,i.data(),"object"==typeof n&&n);r||i.data("collapse",r=new e(this,o)),"string"==typeof n&&r[n]()})},t.fn.collapse.defaults={toggle:!0},t.fn.collapse.Constructor=e,t.fn.collapse.noConflict=function(){return t.fn.collapse=n,this},t(document).on("click.collapse.data-api","[data-toggle=collapse]",function(e){var n,i=t(this),r=i.attr("data-target")||e.preventDefault()||(n=i.attr("href"))&&n.replace(/.*(?=#[^\s]+$)/,""),o=t(r).data("collapse")?"toggle":i.data();i[t(r).hasClass("in")?"addClass":"removeClass"]("collapsed"),t(r).collapse(o)})}(window.jQuery),!function(t){function e(){t(".dropdown-backdrop").remove(),t(i).each(function(){n(t(this)).removeClass("open")})}function n(e){var n,i=e.attr("data-target");return i||(i=e.attr("href"),i=i&&/#/.test(i)&&i.replace(/.*(?=#[^\s]*$)/,"")),n=i&&t(i),n&&n.length||(n=e.parent()),n}var i="[data-toggle=dropdown]",r=function(e){var n=t(e).on("click.dropdown.data-api",this.toggle);t("html").on("click.dropdown.data-api",function(){n.parent().removeClass("open")})};r.prototype={constructor:r,toggle:function(){var i,r,o=t(this);if(!o.is(".disabled, :disabled"))return i=n(o),r=i.hasClass("open"),e(),r||("ontouchstart"in document.documentElement&&t('<div class="dropdown-backdrop"/>').insertBefore(t(this)).on("click",e),i.toggleClass("open")),o.focus(),!1},keydown:function(e){var r,o,s,a,c;if(/(38|40|27)/.test(e.keyCode)&&(r=t(this),e.preventDefault(),e.stopPropagation(),!r.is(".disabled, :disabled"))){if(s=n(r),a=s.hasClass("open"),!a||a&&27==e.keyCode)return 27==e.which&&s.find(i).focus(),r.click();o=t("[role=menu] li:not(.divider):visible a",s),o.length&&(c=o.index(o.filter(":focus")),38==e.keyCode&&c>0&&c--,40==e.keyCode&&c<o.length-1&&c++,~c||(c=0),o.eq(c).focus())}}};var o=t.fn.dropdown;t.fn.dropdown=function(e){return this.each(function(){var n=t(this),i=n.data("dropdown");i||n.data("dropdown",i=new r(this)),"string"==typeof e&&i[e].call(n)})},t.fn.dropdown.Constructor=r,t.fn.dropdown.noConflict=function(){return t.fn.dropdown=o,this},t(document).on("click.dropdown.data-api",e).on("click.dropdown.data-api",".dropdown form",function(t){t.stopPropagation()}).on("click.dropdown.data-api",i,r.prototype.toggle).on("keydown.dropdown.data-api",i+", [role=menu]",r.prototype.keydown)}(window.jQuery),!function(t){var e=function(e,n){this.options=n,this.$element=t(e).delegate('[data-dismiss="modal"]',"click.dismiss.modal",t.proxy(this.hide,this)),this.options.remote&&this.$element.find(".modal-body").load(this.options.remote)};e.prototype={constructor:e,toggle:function(){return this[this.isShown?"hide":"show"]()},show:function(){var e=this,n=t.Event("show");this.$element.trigger(n),this.isShown||n.isDefaultPrevented()||(this.isShown=!0,this.escape(),this.backdrop(function(){var n=t.support.transition&&e.$element.hasClass("fade");e.$element.parent().length||e.$element.appendTo(document.body),e.$element.show(),n&&e.$element[0].offsetWidth,e.$element.addClass("in").attr("aria-hidden",!1),e.enforceFocus(),n?e.$element.one(t.support.transition.end,function(){e.$element.focus().trigger("shown")}):e.$element.focus().trigger("shown")}))},hide:function(e){e&&e.preventDefault(),e=t.Event("hide"),this.$element.trigger(e),this.isShown&&!e.isDefaultPrevented()&&(this.isShown=!1,this.escape(),t(document).off("focusin.modal"),this.$element.removeClass("in").attr("aria-hidden",!0),t.support.transition&&this.$element.hasClass("fade")?this.hideWithTransition():this.hideModal())},enforceFocus:function(){var e=this;t(document).on("focusin.modal",function(t){e.$element[0]===t.target||e.$element.has(t.target).length||e.$element.focus()})},escape:function(){var t=this;this.isShown&&this.options.keyboard?this.$element.on("keyup.dismiss.modal",function(e){27==e.which&&t.hide()}):this.isShown||this.$element.off("keyup.dismiss.modal")},hideWithTransition:function(){var e=this,n=setTimeout(function(){e.$element.off(t.support.transition.end),e.hideModal()},500);this.$element.one(t.support.transition.end,function(){clearTimeout(n),e.hideModal()})},hideModal:function(){var t=this;this.$element.hide(),this.backdrop(function(){t.removeBackdrop(),t.$element.trigger("hidden")})},removeBackdrop:function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},backdrop:function(e){var n=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var i=t.support.transition&&n;if(this.$backdrop=t('<div class="modal-backdrop '+n+'" />').appendTo(document.body),this.$backdrop.click("static"==this.options.backdrop?t.proxy(this.$element[0].focus,this.$element[0]):t.proxy(this.hide,this)),i&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!e)return;i?this.$backdrop.one(t.support.transition.end,e):e()}else!this.isShown&&this.$backdrop?(this.$backdrop.removeClass("in"),t.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one(t.support.transition.end,e):e()):e&&e()}};var n=t.fn.modal;t.fn.modal=function(n){return this.each(function(){var i=t(this),r=i.data("modal"),o=t.extend({},t.fn.modal.defaults,i.data(),"object"==typeof n&&n);r||i.data("modal",r=new e(this,o)),"string"==typeof n?r[n]():o.show&&r.show()})},t.fn.modal.defaults={backdrop:!0,keyboard:!0,show:!0},t.fn.modal.Constructor=e,t.fn.modal.noConflict=function(){return t.fn.modal=n,this},t(document).on("click.modal.data-api",'[data-toggle="modal"]',function(e){var n=t(this),i=n.attr("href"),r=t(n.attr("data-target")||i&&i.replace(/.*(?=#[^\s]+$)/,"")),o=r.data("modal")?"toggle":t.extend({remote:!/#/.test(i)&&i},r.data(),n.data());e.preventDefault(),r.modal(o).one("hide",function(){n.focus()})})}(window.jQuery),!function(t){var e=function(t,e){this.init("tooltip",t,e)};e.prototype={constructor:e,init:function(e,n,i){var r,o,s,a,c;for(this.type=e,this.$element=t(n),this.options=this.getOptions(i),this.enabled=!0,s=this.options.trigger.split(" "),c=s.length;c--;)a=s[c],"click"==a?this.$element.on("click."+this.type,this.options.selector,t.proxy(this.toggle,this)):"manual"!=a&&(r="hover"==a?"mouseenter":"focus",o="hover"==a?"mouseleave":"blur",this.$element.on(r+"."+this.type,this.options.selector,t.proxy(this.enter,this)),this.$element.on(o+"."+this.type,this.options.selector,t.proxy(this.leave,this)));this.options.selector?this._options=t.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},getOptions:function(e){return e=t.extend({},t.fn[this.type].defaults,this.$element.data(),e),e.delay&&"number"==typeof e.delay&&(e.delay={show:e.delay,hide:e.delay}),e},enter:function(e){var n,i=t.fn[this.type].defaults,r={};return this._options&&t.each(this._options,function(t,e){i[t]!=e&&(r[t]=e)},this),n=t(e.currentTarget)[this.type](r).data(this.type),n.options.delay&&n.options.delay.show?(clearTimeout(this.timeout),n.hoverState="in",this.timeout=setTimeout(function(){"in"==n.hoverState&&n.show()},n.options.delay.show),void 0):n.show()},leave:function(e){var n=t(e.currentTarget)[this.type](this._options).data(this.type);return this.timeout&&clearTimeout(this.timeout),n.options.delay&&n.options.delay.hide?(n.hoverState="out",this.timeout=setTimeout(function(){"out"==n.hoverState&&n.hide()},n.options.delay.hide),void 0):n.hide()},show:function(){var e,n,i,r,o,s,a=t.Event("show");if(this.hasContent()&&this.enabled){if(this.$element.trigger(a),a.isDefaultPrevented())return;switch(e=this.tip(),this.setContent(),this.options.animation&&e.addClass("fade"),o="function"==typeof this.options.placement?this.options.placement.call(this,e[0],this.$element[0]):this.options.placement,e.detach().css({top:0,left:0,display:"block"}),this.options.container?e.appendTo(this.options.container):e.insertAfter(this.$element),n=this.getPosition(),i=e[0].offsetWidth,r=e[0].offsetHeight,o){case"bottom":s={top:n.top+n.height,left:n.left+n.width/2-i/2};break;case"top":s={top:n.top-r,left:n.left+n.width/2-i/2};break;case"left":s={top:n.top+n.height/2-r/2,left:n.left-i};break;case"right":s={top:n.top+n.height/2-r/2,left:n.left+n.width}}this.applyPlacement(s,o),this.$element.trigger("shown")}},applyPlacement:function(t,e){var n,i,r,o,s=this.tip(),a=s[0].offsetWidth,c=s[0].offsetHeight;s.offset(t).addClass(e).addClass("in"),n=s[0].offsetWidth,i=s[0].offsetHeight,"top"==e&&i!=c&&(t.top=t.top+c-i,o=!0),"bottom"==e||"top"==e?(r=0,t.left<0&&(r=-2*t.left,t.left=0,s.offset(t),n=s[0].offsetWidth,i=s[0].offsetHeight),this.replaceArrow(r-a+n,n,"left")):this.replaceArrow(i-c,i,"top"),o&&s.offset(t)},replaceArrow:function(t,e,n){this.arrow().css(n,t?50*(1-t/e)+"%":"")},setContent:function(){var t=this.tip(),e=this.getTitle();t.find(".tooltip-inner")[this.options.html?"html":"text"](e),t.removeClass("fade in top bottom left right")},hide:function(){function e(){var e=setTimeout(function(){n.off(t.support.transition.end).detach()},500);n.one(t.support.transition.end,function(){clearTimeout(e),n.detach()})}var n=this.tip(),i=t.Event("hide");return this.$element.trigger(i),i.isDefaultPrevented()?void 0:(n.removeClass("in"),t.support.transition&&this.$tip.hasClass("fade")?e():n.detach(),this.$element.trigger("hidden"),this)},fixTitle:function(){var t=this.$element;(t.attr("title")||"string"!=typeof t.attr("data-original-title"))&&t.attr("data-original-title",t.attr("title")||"").attr("title","")},hasContent:function(){return this.getTitle()},getPosition:function(){var e=this.$element[0];return t.extend({},"function"==typeof e.getBoundingClientRect?e.getBoundingClientRect():{width:e.offsetWidth,height:e.offsetHeight},this.$element.offset())},getTitle:function(){var t,e=this.$element,n=this.options;return t=e.attr("data-original-title")||("function"==typeof n.title?n.title.call(e[0]):n.title)},tip:function(){return this.$tip=this.$tip||t(this.options.template)},arrow:function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},validate:function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},toggleEnabled:function(){this.enabled=!this.enabled},toggle:function(e){var n=e?t(e.currentTarget)[this.type](this._options).data(this.type):this;n.tip().hasClass("in")?n.hide():n.show()},destroy:function(){this.hide().$element.off("."+this.type).removeData(this.type)}};var n=t.fn.tooltip;t.fn.tooltip=function(n){return this.each(function(){var i=t(this),r=i.data("tooltip"),o="object"==typeof n&&n;r||i.data("tooltip",r=new e(this,o)),"string"==typeof n&&r[n]()})},t.fn.tooltip.Constructor=e,t.fn.tooltip.defaults={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1},t.fn.tooltip.noConflict=function(){return t.fn.tooltip=n,this}}(window.jQuery),!function(t){var e=function(t,e){this.init("popover",t,e)};e.prototype=t.extend({},t.fn.tooltip.Constructor.prototype,{constructor:e,setContent:function(){var t=this.tip(),e=this.getTitle(),n=this.getContent();t.find(".popover-title")[this.options.html?"html":"text"](e),t.find(".popover-content")[this.options.html?"html":"text"](n),t.removeClass("fade top bottom left right in")},hasContent:function(){return this.getTitle()||this.getContent()},getContent:function(){var t,e=this.$element,n=this.options;return t=("function"==typeof n.content?n.content.call(e[0]):n.content)||e.attr("data-content")},tip:function(){return this.$tip||(this.$tip=t(this.options.template)),this.$tip},destroy:function(){this.hide().$element.off("."+this.type).removeData(this.type)}});var n=t.fn.popover;t.fn.popover=function(n){return this.each(function(){var i=t(this),r=i.data("popover"),o="object"==typeof n&&n;r||i.data("popover",r=new e(this,o)),"string"==typeof n&&r[n]()})},t.fn.popover.Constructor=e,t.fn.popover.defaults=t.extend({},t.fn.tooltip.defaults,{placement:"right",trigger:"click",content:"",template:'<div class="popover"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),t.fn.popover.noConflict=function(){return t.fn.popover=n,this}}(window.jQuery),!function(t){function e(e,n){var i,r=t.proxy(this.process,this),o=t(e).is("body")?t(window):t(e);this.options=t.extend({},t.fn.scrollspy.defaults,n),this.$scrollElement=o.on("scroll.scroll-spy.data-api",r),this.selector=(this.options.target||(i=t(e).attr("href"))&&i.replace(/.*(?=#[^\s]+$)/,"")||"")+" .nav li > a",this.$body=t("body"),this.refresh(),this.process()}e.prototype={constructor:e,refresh:function(){var e,n=this;this.offsets=t([]),this.targets=t([]),e=this.$body.find(this.selector).map(function(){var e=t(this),i=e.data("target")||e.attr("href"),r=/^#\w/.test(i)&&t(i);return r&&r.length&&[[r.position().top+(!t.isWindow(n.$scrollElement.get(0))&&n.$scrollElement.scrollTop()),i]]||null}).sort(function(t,e){return t[0]-e[0]}).each(function(){n.offsets.push(this[0]),n.targets.push(this[1])})},process:function(){var t,e=this.$scrollElement.scrollTop()+this.options.offset,n=this.$scrollElement[0].scrollHeight||this.$body[0].scrollHeight,i=n-this.$scrollElement.height(),r=this.offsets,o=this.targets,s=this.activeTarget;if(e>=i)return s!=(t=o.last()[0])&&this.activate(t);for(t=r.length;t--;)s!=o[t]&&e>=r[t]&&(!r[t+1]||e<=r[t+1])&&this.activate(o[t])},activate:function(e){var n,i;this.activeTarget=e,t(this.selector).parent(".active").removeClass("active"),i=this.selector+'[data-target="'+e+'"],'+this.selector+'[href="'+e+'"]',n=t(i).parent("li").addClass("active"),n.parent(".dropdown-menu").length&&(n=n.closest("li.dropdown").addClass("active")),n.trigger("activate")}};var n=t.fn.scrollspy;t.fn.scrollspy=function(n){return this.each(function(){var i=t(this),r=i.data("scrollspy"),o="object"==typeof n&&n;r||i.data("scrollspy",r=new e(this,o)),"string"==typeof n&&r[n]()})},t.fn.scrollspy.Constructor=e,t.fn.scrollspy.defaults={offset:10},t.fn.scrollspy.noConflict=function(){return t.fn.scrollspy=n,this},t(window).on("load",function(){t('[data-spy="scroll"]').each(function(){var e=t(this);e.scrollspy(e.data())})})}(window.jQuery),!function(t){var e=function(e){this.element=t(e)};e.prototype={constructor:e,show:function(){var e,n,i,r=this.element,o=r.closest("ul:not(.dropdown-menu)"),s=r.attr("data-target");s||(s=r.attr("href"),s=s&&s.replace(/.*(?=#[^\s]*$)/,"")),r.parent("li").hasClass("active")||(e=o.find(".active:last a")[0],i=t.Event("show",{relatedTarget:e}),r.trigger(i),i.isDefaultPrevented()||(n=t(s),this.activate(r.parent("li"),o),this.activate(n,n.parent(),function(){r.trigger({type:"shown",relatedTarget:e})})))},activate:function(e,n,i){function r(){o.removeClass("active").find("> .dropdown-menu > .active").removeClass("active"),e.addClass("active"),s?(e[0].offsetWidth,e.addClass("in")):e.removeClass("fade"),e.parent(".dropdown-menu")&&e.closest("li.dropdown").addClass("active"),i&&i()}var o=n.find("> .active"),s=i&&t.support.transition&&o.hasClass("fade");s?o.one(t.support.transition.end,r):r(),o.removeClass("in")}};var n=t.fn.tab;t.fn.tab=function(n){return this.each(function(){var i=t(this),r=i.data("tab");r||i.data("tab",r=new e(this)),"string"==typeof n&&r[n]()})},t.fn.tab.Constructor=e,t.fn.tab.noConflict=function(){return t.fn.tab=n,this},t(document).on("click.tab.data-api",'[data-toggle="tab"], [data-toggle="pill"]',function(e){e.preventDefault(),t(this).tab("show")})}(window.jQuery),!function(t){var e=function(e,n){this.$element=t(e),this.options=t.extend({},t.fn.typeahead.defaults,n),this.matcher=this.options.matcher||this.matcher,this.sorter=this.options.sorter||this.sorter,this.highlighter=this.options.highlighter||this.highlighter,this.updater=this.options.updater||this.updater,this.source=this.options.source,this.$menu=t(this.options.menu),this.shown=!1,this.listen()};e.prototype={constructor:e,select:function(){var t=this.$menu.find(".active").attr("data-value");return this.$element.val(this.updater(t)).change(),this.hide()},updater:function(t){return t},show:function(){var e=t.extend({},this.$element.position(),{height:this.$element[0].offsetHeight});return this.$menu.insertAfter(this.$element).css({top:e.top+e.height,left:e.left}).show(),this.shown=!0,this},hide:function(){return this.$menu.hide(),this.shown=!1,this},lookup:function(){var e;return this.query=this.$element.val(),!this.query||this.query.length<this.options.minLength?this.shown?this.hide():this:(e=t.isFunction(this.source)?this.source(this.query,t.proxy(this.process,this)):this.source,e?this.process(e):this)},process:function(e){var n=this;return e=t.grep(e,function(t){return n.matcher(t)}),e=this.sorter(e),e.length?this.render(e.slice(0,this.options.items)).show():this.shown?this.hide():this},matcher:function(t){return~t.toLowerCase().indexOf(this.query.toLowerCase())},sorter:function(t){for(var e,n=[],i=[],r=[];e=t.shift();)e.toLowerCase().indexOf(this.query.toLowerCase())?~e.indexOf(this.query)?i.push(e):r.push(e):n.push(e);return n.concat(i,r)},highlighter:function(t){var e=this.query.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&");return t.replace(new RegExp("("+e+")","ig"),function(t,e){return"<strong>"+e+"</strong>"})},render:function(e){var n=this;return e=t(e).map(function(e,i){return e=t(n.options.item).attr("data-value",i),e.find("a").html(n.highlighter(i)),e[0]}),e.first().addClass("active"),this.$menu.html(e),this},next:function(){var e=this.$menu.find(".active").removeClass("active"),n=e.next();n.length||(n=t(this.$menu.find("li")[0])),n.addClass("active")},prev:function(){var t=this.$menu.find(".active").removeClass("active"),e=t.prev();e.length||(e=this.$menu.find("li").last()),e.addClass("active")},listen:function(){this.$element.on("focus",t.proxy(this.focus,this)).on("blur",t.proxy(this.blur,this)).on("keypress",t.proxy(this.keypress,this)).on("keyup",t.proxy(this.keyup,this)),this.eventSupported("keydown")&&this.$element.on("keydown",t.proxy(this.keydown,this)),this.$menu.on("click",t.proxy(this.click,this)).on("mouseenter","li",t.proxy(this.mouseenter,this)).on("mouseleave","li",t.proxy(this.mouseleave,this))},eventSupported:function(t){var e=t in this.$element;return e||(this.$element.setAttribute(t,"return;"),e="function"==typeof this.$element[t]),e},move:function(t){if(this.shown){switch(t.keyCode){case 9:case 13:case 27:t.preventDefault();break;case 38:t.preventDefault(),this.prev();break;case 40:t.preventDefault(),this.next()}t.stopPropagation()}},keydown:function(e){this.suppressKeyPressRepeat=~t.inArray(e.keyCode,[40,38,9,13,27]),this.move(e)},keypress:function(t){this.suppressKeyPressRepeat||this.move(t)},keyup:function(t){switch(t.keyCode){case 40:case 38:case 16:case 17:case 18:break;case 9:case 13:if(!this.shown)return;this.select();break;case 27:if(!this.shown)return;this.hide();break;default:this.lookup()}t.stopPropagation(),t.preventDefault()},focus:function(){this.focused=!0},blur:function(){this.focused=!1,!this.mousedover&&this.shown&&this.hide()},click:function(t){t.stopPropagation(),t.preventDefault(),this.select(),this.$element.focus()},mouseenter:function(e){this.mousedover=!0,this.$menu.find(".active").removeClass("active"),t(e.currentTarget).addClass("active")},mouseleave:function(){this.mousedover=!1,!this.focused&&this.shown&&this.hide()}};var n=t.fn.typeahead;t.fn.typeahead=function(n){return this.each(function(){var i=t(this),r=i.data("typeahead"),o="object"==typeof n&&n;r||i.data("typeahead",r=new e(this,o)),"string"==typeof n&&r[n]()})},t.fn.typeahead.defaults={source:[],items:8,menu:'<ul class="typeahead dropdown-menu"></ul>',item:'<li><a href="#"></a></li>',minLength:1},t.fn.typeahead.Constructor=e,t.fn.typeahead.noConflict=function(){return t.fn.typeahead=n,this},t(document).on("focus.typeahead.data-api",'[data-provide="typeahead"]',function(){var e=t(this);e.data("typeahead")||e.typeahead(e.data())})}(window.jQuery),!function(t){var e=function(e,n){this.options=t.extend({},t.fn.affix.defaults,n),this.$window=t(window).on("scroll.affix.data-api",t.proxy(this.checkPosition,this)).on("click.affix.data-api",t.proxy(function(){setTimeout(t.proxy(this.checkPosition,this),1)},this)),this.$element=t(e),this.checkPosition()};e.prototype.checkPosition=function(){if(this.$element.is(":visible")){var e,n=t(document).height(),i=this.$window.scrollTop(),r=this.$element.offset(),o=this.options.offset,s=o.bottom,a=o.top,c="affix affix-top affix-bottom";"object"!=typeof o&&(s=a=o),"function"==typeof a&&(a=o.top()),"function"==typeof s&&(s=o.bottom()),e=null!=this.unpin&&i+this.unpin<=r.top?!1:null!=s&&r.top+this.$element.height()>=n-s?"bottom":null!=a&&a>=i?"top":!1,this.affixed!==e&&(this.affixed=e,this.unpin="bottom"==e?r.top-i:null,this.$element.removeClass(c).addClass("affix"+(e?"-"+e:"")))}};var n=t.fn.affix;t.fn.affix=function(n){return this.each(function(){var i=t(this),r=i.data("affix"),o="object"==typeof n&&n;r||i.data("affix",r=new e(this,o)),"string"==typeof n&&r[n]()})},t.fn.affix.Constructor=e,t.fn.affix.defaults={offset:0},t.fn.affix.noConflict=function(){return t.fn.affix=n,this},t(window).on("load",function(){t('[data-spy="affix"]').each(function(){var e=t(this),n=e.data();n.offset=n.offset||{},n.offsetBottom&&(n.offset.bottom=n.offsetBottom),n.offsetTop&&(n.offset.top=n.offsetTop),e.affix(n)})})}(window.jQuery),define("bootstrap",function(){}),define("flashbar",["require","underscore","jquery","bootstrap"],function(t){var e,n,i,r,o,s;return s=t("underscore"),e=t("jquery"),t("bootstrap"),o=7e3,n=400,r=s('<div class="alert alert-<%= type %> fade.in flash-bar hide">\n  <button type="button" class="close" data-dismiss="alert" title="close">&times;</button>\n  <i class="<%= icon %>"></i>\n  <span><%= message %></span>\n</div>').template(),i=function(t,i){var a,c;return c=function(){switch(t){case"success":return"icon-ok-sign";case"error":return"icon-warning-sign";case"info":return"icon-info-sign";default:throw new Error("Unknown Type.")}}(),a=e(r({icon:c,type:t,message:i})).prependTo("body").alert().slideDown(n),s(function(){return a.slideUp(n,function(){return a.remove()})}).delay(o)},e.showSuccessbar=function(t){return i("success",t)},e.showErrorbar=function(t){return i("error",t)},e.showInfobar=function(t){return i("info",t)},e});var __hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var i in e)__hasProp.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};define("application/views/canvas",["require","jquery","backbone","../uml/drawing/sequence/renderer","../events","flashbar"],function(t){var e,n,i,r,o;return e=t("jquery"),n=t("backbone"),r=t("../uml/drawing/sequence/renderer"),o=t("../events"),t("flashbar"),i=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return __extends(n,t),n.prototype.el="#canvas-container",n.prototype.rendererType=r,n.prototype.initialize=function(t){return this.context=t.context,this.renderer=new this.rendererType,this.listenTo(o,"parseStarted",this.onParseStarted),this.listenTo(o,"parseCompleted",this.onParseCompleted),this.listenTo(o,"exportDocument",this.onExportDocument)},n.prototype.onParseStarted=function(){return this.renderer.reset()},n.prototype.onParseCompleted=function(t){var e,n;return e=null,(null!=t?t.diagram:void 0)&&(e=null!=(n=t.diagram.title)?n.text:void 0,this.renderer.render(t.diagram)),this.context.setCurrentDocumentTitle(e)},n.prototype.onExportDocument=function(){var t;try{return t=this.renderer.serialize(),o.trigger("documentExported",{data:t})}catch(n){return e.showErrorbar(n.message)}},n}(n.View)}),function(t){function e(t,e){return function(n){return c(t.call(this,n),e)}}function n(t,e){return function(n){return this.lang().ordinal(t.call(this,n),e)}}function i(){}function r(t){s(this,t)}function o(t){var e=t.years||t.year||t.y||0,n=t.months||t.month||t.M||0,i=t.weeks||t.week||t.w||0,r=t.days||t.day||t.d||0,o=t.hours||t.hour||t.h||0,s=t.minutes||t.minute||t.m||0,a=t.seconds||t.second||t.s||0,c=t.milliseconds||t.millisecond||t.ms||0;this._input=t,this._milliseconds=c+1e3*a+6e4*s+36e5*o,this._days=r+7*i,this._months=n+12*e,this._data={},this._bubble()}function s(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function a(t){return 0>t?Math.ceil(t):Math.floor(t)}function c(t,e){for(var n=t+"";n.length<e;)n="0"+n;return n}function l(t,e,n,i){var r,o,s=e._milliseconds,a=e._days,c=e._months;s&&t._d.setTime(+t._d+s*n),(a||c)&&(r=t.minute(),o=t.hour()),a&&t.date(t.date()+a*n),c&&t.month(t.month()+c*n),s&&!i&&E.updateOffset(t),(a||c)&&(t.minute(r),t.hour(o))}function u(t){return"[object Array]"===Object.prototype.toString.call(t)}function h(t,e){var n,i=Math.min(t.length,e.length),r=Math.abs(t.length-e.length),o=0;for(n=0;i>n;n++)~~t[n]!==~~e[n]&&o++;return o+r}function d(t){return t?re[t]||t.toLowerCase().replace(/(.)s$/,"$1"):t}function p(t,e){return e.abbr=t,F[t]||(F[t]=new i),F[t].set(e),F[t]}function f(t){if(!t)return E.fn._lang;if(!F[t]&&R)try{require("./lang/"+t)}catch(e){return E.fn._lang}return F[t]}function g(t){return t.match(/\[.*\]/)?t.replace(/^\[|\]$/g,""):t.replace(/\\/g,"")}function m(t){var e,n,i=t.match(W);for(e=0,n=i.length;n>e;e++)i[e]=ce[i[e]]?ce[i[e]]:g(i[e]);return function(r){var o="";for(e=0;n>e;e++)o+=i[e]instanceof Function?i[e].call(r,t):i[e];return o}}function v(t,e){function n(e){return t.lang().longDateFormat(e)||e}for(var i=5;i--&&q.test(e);)e=e.replace(q,n);return oe[e]||(oe[e]=m(e)),oe[e](t)}function y(t,e){switch(t){case"DDDD":return G;case"YYYY":return B;case"YYYYY":return Y;case"S":case"SS":case"SSS":case"DDD":return $;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":return U;case"a":case"A":return f(e._l)._meridiemParse;case"X":return Q;case"Z":case"ZZ":return V;case"T":return X;case"MM":case"DD":case"YY":case"HH":case"hh":case"mm":case"ss":case"M":case"D":case"d":case"H":case"h":case"m":case"s":return j;default:return new RegExp(t.replace("\\",""))}}function w(t){var e=(V.exec(t)||[])[0],n=(e+"").match(ee)||["-",0,0],i=+(60*n[1])+~~n[2];return"+"===n[0]?-i:i}function _(t,e,n){var i,r=n._a;switch(t){case"M":case"MM":r[1]=null==e?0:~~e-1;break;case"MMM":case"MMMM":i=f(n._l).monthsParse(e),null!=i?r[1]=i:n._isValid=!1;break;case"D":case"DD":case"DDD":case"DDDD":null!=e&&(r[2]=~~e);break;case"YY":r[0]=~~e+(~~e>68?1900:2e3);break;case"YYYY":case"YYYYY":r[0]=~~e;break;case"a":case"A":n._isPm=f(n._l).isPM(e);break;case"H":case"HH":case"h":case"hh":r[3]=~~e;break;case"m":case"mm":r[4]=~~e;break;case"s":case"ss":r[5]=~~e;break;case"S":case"SS":case"SSS":r[6]=~~(1e3*("0."+e));break;case"X":n._d=new Date(1e3*parseFloat(e));break;case"Z":case"ZZ":n._useUTC=!0,n._tzm=w(e)}null==e&&(n._isValid=!1)}function b(t){var e,n,i=[];if(!t._d){for(e=0;7>e;e++)t._a[e]=i[e]=null==t._a[e]?2===e?1:0:t._a[e];i[3]+=~~((t._tzm||0)/60),i[4]+=~~((t._tzm||0)%60),n=new Date(0),t._useUTC?(n.setUTCFullYear(i[0],i[1],i[2]),n.setUTCHours(i[3],i[4],i[5],i[6])):(n.setFullYear(i[0],i[1],i[2]),n.setHours(i[3],i[4],i[5],i[6])),t._d=n}}function x(t){var e,n,i=t._f.match(W),r=t._i;for(t._a=[],e=0;e<i.length;e++)n=(y(i[e],t).exec(r)||[])[0],n&&(r=r.slice(r.indexOf(n)+n.length)),ce[i[e]]&&_(i[e],n,t);r&&(t._il=r),t._isPm&&t._a[3]<12&&(t._a[3]+=12),t._isPm===!1&&12===t._a[3]&&(t._a[3]=0),b(t)}function S(t){var e,n,i,o,a,c=99;for(o=0;o<t._f.length;o++)e=s({},t),e._f=t._f[o],x(e),n=new r(e),a=h(e._a,n.toArray()),n._il&&(a+=n._il.length),c>a&&(c=a,i=n);s(t,i)}function C(t){var e,n=t._i,i=J.exec(n);if(i){for(t._f="YYYY-MM-DD"+(i[2]||" "),e=0;4>e;e++)if(te[e][1].exec(n)){t._f+=te[e][0];break}V.exec(n)&&(t._f+=" Z"),x(t)}else t._d=new Date(n)}function T(e){var n=e._i,i=H.exec(n);n===t?e._d=new Date:i?e._d=new Date(+i[1]):"string"==typeof n?C(e):u(n)?(e._a=n.slice(0),b(e)):e._d=n instanceof Date?new Date(+n):new Date(n)}function k(t,e,n,i,r){return r.relativeTime(e||1,!!n,t,i)
}function P(t,e,n){var i=I(Math.abs(t)/1e3),r=I(i/60),o=I(r/60),s=I(o/24),a=I(s/365),c=45>i&&["s",i]||1===r&&["m"]||45>r&&["mm",r]||1===o&&["h"]||22>o&&["hh",o]||1===s&&["d"]||25>=s&&["dd",s]||45>=s&&["M"]||345>s&&["MM",I(s/30)]||1===a&&["y"]||["yy",a];return c[2]=e,c[3]=t>0,c[4]=n,k.apply({},c)}function D(t,e,n){var i,r=n-e,o=n-t.day();return o>r&&(o-=7),r-7>o&&(o+=7),i=E(t).add("d",o),{week:Math.ceil(i.dayOfYear()/7),year:i.year()}}function L(t){var e=t._i,n=t._f;return null===e||""===e?null:("string"==typeof e&&(t._i=e=f().preparse(e)),E.isMoment(e)?(t=s({},e),t._d=new Date(+e._d)):n?u(n)?S(t):x(t):T(t),new r(t))}function K(t,e){E.fn[t]=E.fn[t+"s"]=function(t){var n=this._isUTC?"UTC":"";return null!=t?(this._d["set"+n+e](t),E.updateOffset(this),this):this._d["get"+n+e]()}}function A(t){E.duration.fn[t]=function(){return this._data[t]}}function M(t,e){E.duration.fn["as"+t]=function(){return+this/e}}for(var E,N,O="2.1.0",I=Math.round,F={},R="undefined"!=typeof module&&module.exports,H=/^\/?Date\((\-?\d+)/i,z=/(\-)?(\d*)?\.?(\d+)\:(\d+)\:(\d+)\.?(\d{3})?/,W=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|SS?S?|X|zz?|ZZ?|.)/g,q=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?|l{1,4})/g,j=/\d\d?/,$=/\d{1,3}/,G=/\d{3}/,B=/\d{1,4}/,Y=/[+\-]?\d{1,6}/,U=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,V=/Z|[\+\-]\d\d:?\d\d/i,X=/T/i,Q=/[\+\-]?\d+(\.\d{1,3})?/,J=/^\s*\d{4}-\d\d-\d\d((T| )(\d\d(:\d\d(:\d\d(\.\d\d?\d?)?)?)?)?([\+\-]\d\d:?\d\d)?)?/,Z="YYYY-MM-DDTHH:mm:ssZ",te=[["HH:mm:ss.S",/(T| )\d\d:\d\d:\d\d\.\d{1,3}/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],ee=/([\+\-]|\d\d)/gi,ne="Date|Hours|Minutes|Seconds|Milliseconds".split("|"),ie={Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6},re={ms:"millisecond",s:"second",m:"minute",h:"hour",d:"day",w:"week",M:"month",y:"year"},oe={},se="DDD w W M D d".split(" "),ae="M D H h m s w W".split(" "),ce={M:function(){return this.month()+1},MMM:function(t){return this.lang().monthsShort(this,t)},MMMM:function(t){return this.lang().months(this,t)},D:function(){return this.date()},DDD:function(){return this.dayOfYear()},d:function(){return this.day()},dd:function(t){return this.lang().weekdaysMin(this,t)},ddd:function(t){return this.lang().weekdaysShort(this,t)},dddd:function(t){return this.lang().weekdays(this,t)},w:function(){return this.week()},W:function(){return this.isoWeek()},YY:function(){return c(this.year()%100,2)},YYYY:function(){return c(this.year(),4)},YYYYY:function(){return c(this.year(),5)},gg:function(){return c(this.weekYear()%100,2)},gggg:function(){return this.weekYear()},ggggg:function(){return c(this.weekYear(),5)},GG:function(){return c(this.isoWeekYear()%100,2)},GGGG:function(){return this.isoWeekYear()},GGGGG:function(){return c(this.isoWeekYear(),5)},e:function(){return this.weekday()},E:function(){return this.isoWeekday()},a:function(){return this.lang().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.lang().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return~~(this.milliseconds()/100)},SS:function(){return c(~~(this.milliseconds()/10),2)},SSS:function(){return c(this.milliseconds(),3)},Z:function(){var t=-this.zone(),e="+";return 0>t&&(t=-t,e="-"),e+c(~~(t/60),2)+":"+c(~~t%60,2)},ZZ:function(){var t=-this.zone(),e="+";return 0>t&&(t=-t,e="-"),e+c(~~(10*t/6),4)},z:function(){return this.zoneAbbr()},zz:function(){return this.zoneName()},X:function(){return this.unix()}};se.length;)N=se.pop(),ce[N+"o"]=n(ce[N],N);for(;ae.length;)N=ae.pop(),ce[N+N]=e(ce[N],2);for(ce.DDDD=e(ce.DDD,3),i.prototype={set:function(t){var e,n;for(n in t)e=t[n],"function"==typeof e?this[n]=e:this["_"+n]=e},_months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),months:function(t){return this._months[t.month()]},_monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),monthsShort:function(t){return this._monthsShort[t.month()]},monthsParse:function(t){var e,n,i;for(this._monthsParse||(this._monthsParse=[]),e=0;12>e;e++)if(this._monthsParse[e]||(n=E([2e3,e]),i="^"+this.months(n,"")+"|^"+this.monthsShort(n,""),this._monthsParse[e]=new RegExp(i.replace(".",""),"i")),this._monthsParse[e].test(t))return e},_weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdays:function(t){return this._weekdays[t.day()]},_weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysShort:function(t){return this._weekdaysShort[t.day()]},_weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),weekdaysMin:function(t){return this._weekdaysMin[t.day()]},weekdaysParse:function(t){var e,n,i;for(this._weekdaysParse||(this._weekdaysParse=[]),e=0;7>e;e++)if(this._weekdaysParse[e]||(n=E([2e3,1]).day(e),i="^"+this.weekdays(n,"")+"|^"+this.weekdaysShort(n,"")+"|^"+this.weekdaysMin(n,""),this._weekdaysParse[e]=new RegExp(i.replace(".",""),"i")),this._weekdaysParse[e].test(t))return e},_longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},longDateFormat:function(t){var e=this._longDateFormat[t];return!e&&this._longDateFormat[t.toUpperCase()]&&(e=this._longDateFormat[t.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(t){return t.slice(1)}),this._longDateFormat[t]=e),e},isPM:function(t){return"p"===(t+"").toLowerCase()[0]},_meridiemParse:/[ap]\.?m?\.?/i,meridiem:function(t,e,n){return t>11?n?"pm":"PM":n?"am":"AM"},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},calendar:function(t,e){var n=this._calendar[t];return"function"==typeof n?n.apply(e):n},_relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(t,e,n,i){var r=this._relativeTime[n];return"function"==typeof r?r(t,e,n,i):r.replace(/%d/i,t)},pastFuture:function(t,e){var n=this._relativeTime[t>0?"future":"past"];return"function"==typeof n?n(e):n.replace(/%s/i,e)},ordinal:function(t){return this._ordinal.replace("%d",t)},_ordinal:"%d",preparse:function(t){return t},postformat:function(t){return t},week:function(t){return D(t,this._week.dow,this._week.doy).week},_week:{dow:0,doy:6}},E=function(t,e,n){return L({_i:t,_f:e,_l:n,_isUTC:!1})},E.utc=function(t,e,n){return L({_useUTC:!0,_isUTC:!0,_l:n,_i:t,_f:e})},E.unix=function(t){return E(1e3*t)},E.duration=function(t,e){var n,i,r=E.isDuration(t),s="number"==typeof t,a=r?t._input:s?{}:t,c=z.exec(t);return s?e?a[e]=t:a.milliseconds=t:c&&(n="-"===c[1]?-1:1,a={y:0,d:~~c[2]*n,h:~~c[3]*n,m:~~c[4]*n,s:~~c[5]*n,ms:~~c[6]*n}),i=new o(a),r&&t.hasOwnProperty("_lang")&&(i._lang=t._lang),i},E.version=O,E.defaultFormat=Z,E.updateOffset=function(){},E.lang=function(t,e){return t?(e?p(t,e):F[t]||f(t),E.duration.fn._lang=E.fn._lang=f(t),void 0):E.fn._lang._abbr},E.langData=function(t){return t&&t._lang&&t._lang._abbr&&(t=t._lang._abbr),f(t)},E.isMoment=function(t){return t instanceof r},E.isDuration=function(t){return t instanceof o},E.fn=r.prototype={clone:function(){return E(this)},valueOf:function(){return+this._d+6e4*(this._offset||0)},unix:function(){return Math.floor(+this/1e3)},toString:function(){return this.format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},toDate:function(){return this._offset?new Date(+this):this._d},toISOString:function(){return v(E(this).utc(),"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},toArray:function(){var t=this;return[t.year(),t.month(),t.date(),t.hours(),t.minutes(),t.seconds(),t.milliseconds()]},isValid:function(){return null==this._isValid&&(this._isValid=this._a?!h(this._a,(this._isUTC?E.utc(this._a):E(this._a)).toArray()):!isNaN(this._d.getTime())),!!this._isValid},utc:function(){return this.zone(0)},local:function(){return this.zone(0),this._isUTC=!1,this},format:function(t){var e=v(this,t||E.defaultFormat);return this.lang().postformat(e)},add:function(t,e){var n;return n="string"==typeof t?E.duration(+e,t):E.duration(t,e),l(this,n,1),this},subtract:function(t,e){var n;return n="string"==typeof t?E.duration(+e,t):E.duration(t,e),l(this,n,-1),this},diff:function(t,e,n){var i,r,o=this._isUTC?E(t).zone(this._offset||0):E(t).local(),s=6e4*(this.zone()-o.zone());return e=d(e),"year"===e||"month"===e?(i=432e5*(this.daysInMonth()+o.daysInMonth()),r=12*(this.year()-o.year())+(this.month()-o.month()),r+=(this-E(this).startOf("month")-(o-E(o).startOf("month")))/i,r-=6e4*(this.zone()-E(this).startOf("month").zone()-(o.zone()-E(o).startOf("month").zone()))/i,"year"===e&&(r/=12)):(i=this-o,r="second"===e?i/1e3:"minute"===e?i/6e4:"hour"===e?i/36e5:"day"===e?(i-s)/864e5:"week"===e?(i-s)/6048e5:i),n?r:a(r)},from:function(t,e){return E.duration(this.diff(t)).lang(this.lang()._abbr).humanize(!e)},fromNow:function(t){return this.from(E(),t)},calendar:function(){var t=this.diff(E().startOf("day"),"days",!0),e=-6>t?"sameElse":-1>t?"lastWeek":0>t?"lastDay":1>t?"sameDay":2>t?"nextDay":7>t?"nextWeek":"sameElse";return this.format(this.lang().calendar(e,this))},isLeapYear:function(){var t=this.year();return 0===t%4&&0!==t%100||0===t%400},isDST:function(){return this.zone()<this.clone().month(0).zone()||this.zone()<this.clone().month(5).zone()},day:function(t){var e=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=t?"string"==typeof t&&(t=this.lang().weekdaysParse(t),"number"!=typeof t)?this:this.add({d:t-e}):e},month:function(t){var e,n=this._isUTC?"UTC":"";return null!=t?"string"==typeof t&&(t=this.lang().monthsParse(t),"number"!=typeof t)?this:(e=this.date(),this.date(1),this._d["set"+n+"Month"](t),this.date(Math.min(e,this.daysInMonth())),E.updateOffset(this),this):this._d["get"+n+"Month"]()},startOf:function(t){switch(t=d(t)){case"year":this.month(0);case"month":this.date(1);case"week":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===t&&this.weekday(0),this},endOf:function(t){return this.startOf(t).add(t,1).subtract("ms",1)},isAfter:function(t,e){return e="undefined"!=typeof e?e:"millisecond",+this.clone().startOf(e)>+E(t).startOf(e)},isBefore:function(t,e){return e="undefined"!=typeof e?e:"millisecond",+this.clone().startOf(e)<+E(t).startOf(e)},isSame:function(t,e){return e="undefined"!=typeof e?e:"millisecond",+this.clone().startOf(e)===+E(t).startOf(e)},min:function(t){return t=E.apply(null,arguments),this>t?this:t},max:function(t){return t=E.apply(null,arguments),t>this?this:t},zone:function(t){var e=this._offset||0;return null==t?this._isUTC?e:this._d.getTimezoneOffset():("string"==typeof t&&(t=w(t)),Math.abs(t)<16&&(t=60*t),this._offset=t,this._isUTC=!0,e!==t&&l(this,E.duration(e-t,"m"),1,!0),this)},zoneAbbr:function(){return this._isUTC?"UTC":""},zoneName:function(){return this._isUTC?"Coordinated Universal Time":""},daysInMonth:function(){return E.utc([this.year(),this.month()+1,0]).date()},dayOfYear:function(t){var e=I((E(this).startOf("day")-E(this).startOf("year"))/864e5)+1;return null==t?e:this.add("d",t-e)},weekYear:function(t){var e=D(this,this.lang()._week.dow,this.lang()._week.doy).year;return null==t?e:this.add("y",t-e)},isoWeekYear:function(t){var e=D(this,1,4).year;return null==t?e:this.add("y",t-e)},week:function(t){var e=this.lang().week(this);return null==t?e:this.add("d",7*(t-e))},isoWeek:function(t){var e=D(this,1,4).week;return null==t?e:this.add("d",7*(t-e))},weekday:function(t){var e=(this._d.getDay()+7-this.lang()._week.dow)%7;return null==t?e:this.add("d",t-e)},isoWeekday:function(t){return null==t?this.day()||7:this.day(this.day()%7?t:t-7)},lang:function(e){return e===t?this._lang:(this._lang=f(e),this)}},N=0;N<ne.length;N++)K(ne[N].toLowerCase().replace(/s$/,""),ne[N]);K("year","FullYear"),E.fn.days=E.fn.day,E.fn.months=E.fn.month,E.fn.weeks=E.fn.week,E.fn.isoWeeks=E.fn.isoWeek,E.fn.toJSON=E.fn.toISOString,E.duration.fn=o.prototype={_bubble:function(){var t,e,n,i,r=this._milliseconds,o=this._days,s=this._months,c=this._data;c.milliseconds=r%1e3,t=a(r/1e3),c.seconds=t%60,e=a(t/60),c.minutes=e%60,n=a(e/60),c.hours=n%24,o+=a(n/24),c.days=o%30,s+=a(o/30),c.months=s%12,i=a(s/12),c.years=i},weeks:function(){return a(this.days()/7)},valueOf:function(){return this._milliseconds+864e5*this._days+2592e6*(this._months%12)+31536e6*~~(this._months/12)},humanize:function(t){var e=+this,n=P(e,!t,this.lang());return t&&(n=this.lang().pastFuture(e,n)),this.lang().postformat(n)},add:function(t,e){var n=E.duration(t,e);return this._milliseconds+=n._milliseconds,this._days+=n._days,this._months+=n._months,this._bubble(),this},subtract:function(t,e){var n=E.duration(t,e);return this._milliseconds-=n._milliseconds,this._days-=n._days,this._months-=n._months,this._bubble(),this},get:function(t){return t=d(t),this[t.toLowerCase()+"s"]()},as:function(t){return t=d(t),this["as"+t.charAt(0).toUpperCase()+t.slice(1)+"s"]()},lang:E.fn.lang};for(N in ie)ie.hasOwnProperty(N)&&(M(N,ie[N]),A(N.toLowerCase()));M("Weeks",6048e5),E.duration.fn.asMonths=function(){return(+this-31536e6*this.years())/2592e6+12*this.years()},E.lang("en",{ordinal:function(t){var e=t%10,n=1===~~(t%100/10)?"th":1===e?"st":2===e?"nd":3===e?"rd":"th";return t+n}}),R&&(module.exports=E),"undefined"==typeof ender&&(this.moment=E),"function"==typeof define&&define.amd&&define("moment",[],function(){return E})}.call(this),define("form",["require","underscore","jquery"],function(t){var e,n,i,r;return r=t("underscore"),e=t("jquery"),e.fn.serializeFields=function(){var t;return t={},this.each(function(){return e.each(e(this).serializeArray(),function(){return t[this.name]=this.value})}),t},e.fn.deserializeFields=function(t){return this.each(function(){var n=this;return r(t).chain().keys().each(function(i){return e(n).find(":input[name='"+i+"']").val(t[i])})})},e.fn.resetFields=function(){return this.each(function(){var t;return t=e(this),t.is("form")?t.get(0).reset():t.find("form").each(function(){return this.reset()})})},n=400,i=5e3,e.fn.hideFieldErrors=function(){return this.each(function(){return e(this).find(".control-group").filter(".error").removeClass("error").find(".help-block,.help-inline").slideUp(n,function(){return e(this).remove()})})},e.fn.showFieldErrors=function(t){var o,s,a,c,l=this;return t=e.extend({inline:!1,errors:{}},t),c=t.inline,o=c?"help-inline":"help-block",s=t.errors||{},a=null,this.each(function(){return e(this).find(":input").each(function(){var t,i,l;return t=e(this),(i=t.attr("name"))?(l=i.toLowerCase(),r(s).chain().keys().filter(function(t){return s[t].length}).filter(function(t){return t.toLowerCase()===l}).each(function(i){var l;return a||(a=t),t.closest(".control-group").addClass("error"),l=c?t.parent():t.closest(".controls"),r(s[i]).each(function(t){return e("<span>",{text:t,"class":o}).appendTo(l).hide().slideDown(n)})})):!1})}),a&&a.first().focus(),r(function(){return l.hideFieldErrors()}).delay(i),this},e.fn.hideSummaryError=function(){return this.each(function(){var t;return t=e(this),t.is("form")||(t=t.find("form")),t.find(".alert").slideUp(n,function(){return e(this).remove()})})},function(){var t;return t=r('<div class="alert alert-error fade in">\n  <button type="button" class="close" data-dismiss="alert" title="close">&times;</button>\n  <i class="icon-warning-sign"></i> \n  <span><%= message %></span>\n</div>').template(),e.fn.showSummaryError=function(o){var s=this;return o=e.extend({message:"An unexpected error has occurred while performing your last operation."},o),this.each(function(){var i;return i=e(this),i.is("form")||(i=i.find("form")),e(t({message:o.message})).prependTo(i).hide().slideDown(n)}),r(function(){return s.hideSummaryError()}).delay(i)}}(),e.fn.putFocus=function(){var t=this;return r(function(){return t.find(":input").not(":button").not(":checkbox").not(":radio").not(":disabled").first().select().focus()}).delay(80),this},e}),define("application/views/helpers",["require","jquery","underscore","moment","form"],function(t){var e,n,i;return e=t("jquery"),i=t("underscore"),n=t("moment"),t("form"),{formatAsRelativeTime:function(t){return n(t).fromNow()},formatAsHumanizeTime:function(t){return n(t).format("dddd, MMMM Do YYYY, h:mm a")},hasModelErrors:function(t){return 400===t.status},getModelErrors:function(t){var n,r,o;try{o=e.parseJSON(t.responseText)}catch(s){n=s,o=null}return o&&(r=i(o).chain().keys().filter(function(t){return"modelstate"===t.toLowerCase()}).first().value())?o[r]:void 0},subscribeModelInvalidEvent:function(t,e){return t.once("invalid",function(){return e.showFieldErrors({errors:t.validationError})})}}});var __hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var i in e)__hasProp.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};define("application/views/membershipform",["require","backbone","./helpers","../events","form"],function(t){var e,n,i,r,o;return e=t("backbone"),r=t("./helpers"),i=t("../events"),t("form"),n=function(t){function e(){return o=e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.modelType=null,e.prototype.successEvent=null,e.prototype.events={submit:"onSubmit"},e.prototype.handleError=function(){},e.prototype.onSubmit=function(t){var e,n=this;return t.preventDefault(),this.$el.hideSummaryError().hideFieldErrors(),e=new this.modelType,r.subscribeModelInvalidEvent(e,this.$el),e.save(this.$el.serializeFields(),{success:function(){return i.trigger(n.successEvent)},error:function(t,e){return n.handleError(e)}})},e}(e.View)}),define("application/models/validation",[],function(){return{isValidEmailFormat:function(t){return t&&/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(t)},isValidPasswordLength:function(t){var e;return t&&64>=(e=t.length)&&e>=6},addError:function(t,e,n){return(t[e]||(t[e]=[])).push(n)}}});var __hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var i in e)__hasProp.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};define("application/models/session",["require","underscore","backbone","./validation"],function(t){var e,n,i,r;return r=t("underscore"),e=t("backbone"),i=t("./validation"),n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.url="/api/sessions",e.prototype.defaults=function(){return{email:null,password:null,rememberMe:!1}},e.prototype.validate=function(t){var e;return e={},t.email||i.addError(e,"email","Email is required."),t.password||i.addError(e,"password","Password is required."),r(e).isEmpty()?void 0:e},e}(e.Model)});var __hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var i in e)__hasProp.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};define("application/views/signin",["require","./membershipform","../models/session","./helpers"],function(t){var e,n,i,r,o;return e=t("./membershipform"),n=t("../models/session"),r=t("./helpers"),i=function(t){function e(){return o=e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.el="#sign-in-form",e.prototype.handleError=function(t){var e;return e=r.hasModelErrors(t)?"Invalid credentials.":"An unexpected error has occurred while signing in.",this.$el.showSummaryError({message:e})},e}(e),i.prototype.modelType=n,i.prototype.successEvent="signedIn",i});var __hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var i in e)__hasProp.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};define("application/models/forgotpassword",["require","underscore","backbone","./validation"],function(t){var e,n,i,r;return r=t("underscore"),e=t("backbone"),i=t("./validation"),n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.url="/api/passwords/forgot",e.prototype.defaults=function(){return{email:null}},e.prototype.validate=function(t){var e;return e={},t.email?i.isValidEmailFormat(t.email)||i.addError(e,"email","Invalid email format."):i.addError(e,"email","Email is required."),r(e).isEmpty()?void 0:e},e}(e.Model)});var __hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var i in e)__hasProp.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};define("application/views/forgotpassword",["require","./membershipform","../models/forgotpassword"],function(t){var e,n,i;return i=t("./membershipform"),e=t("../models/forgotpassword"),n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.el="#forgot-password-form",e.prototype.handleError=function(){var t;return t="An unexpected error has occurred while sending forgot password request.",this.$el.showSummaryError({message:t})},e}(i),n.prototype.modelType=e,n.prototype.successEvent="passwordResetTokenRequested",n});var __hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var i in e)__hasProp.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};define("application/models/user",["require","underscore","backbone","./validation"],function(t){var e,n,i,r;return r=t("underscore"),e=t("backbone"),i=t("./validation"),n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.url="/api/users",e.prototype.defaults=function(){return{email:null,password:null,confirmPassword:null}},e.prototype.validate=function(t){var e;return e={},t.email?i.isValidEmailFormat(t.email)||i.addError(e,"email","Invalid email format."):i.addError(e,"email","Email is required."),t.password?i.isValidPasswordLength(t.password)||i.addError(e,"password","Password length must be between 6 to 64 characters."):i.addError(e,"password","Password is required."),t.confirmPassword?t.password&&t.confirmPassword!==t.password&&i.addError(e,"confirmPassword","Password and confirmation password do not match."):i.addError(e,"confirmPassword","Confirm password is required."),r(e).isEmpty()?void 0:e},e}(e.Model)});var __hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var i in e)__hasProp.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};define("application/views/signup",["require","./membershipform","../models/user","./helpers"],function(t){var e,n,i,r;return e=t("./membershipform"),i=t("../models/user"),r=t("./helpers"),n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.el="#sign-up-form",e.prototype.handleError=function(t){var e;return r.hasModelErrors(t)&&(e=r.getModelErrors(t))?this.$el.showFieldErrors({errors:e}):this.$el.showSummaryError({message:"An unexpected error has occurred while signing up."})},e}(e),n.prototype.modelType=i,n.prototype.successEvent="signedUp",n});var __hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var i in e)__hasProp.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};define("application/views/membership",["require","underscore","backbone","./signin","./forgotpassword","./signup","../events","bootstrap","form"],function(t){var e,n,i,r,o,s,a;return a=t("underscore"),e=t("backbone"),r=t("./signin"),n=t("./forgotpassword"),o=t("./signup"),s=t("../events"),t("bootstrap"),t("form"),i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.el="#membership-dialog",e.prototype.signInViewType=r,e.prototype.forgotPasswordViewType=n,e.prototype.signUpViewType=o,e.prototype.events={'shown a[data-toggle="tab"]':"onTabHeaderShown",show:"onDialogShow",shown:"onDialogShown",hidden:"onDialogHidden"},e.prototype.initialize=function(){return this.signIn=new this.signInViewType,this.forgotPassword=new this.forgotPasswordViewType,this.signUp=new this.signUpViewType,this.firstTabHead=this.$('a[data-toggle="tab"]').first(),this.$el.modal({show:!1}),this.listenTo(s,"showMembership",this.onShowMembership),this.listenTo(s,"signedIn passwordResetTokenRequested signedUp",this.onSignedInOrPasswordResetTokenRequestedOrSignedUp)},e.prototype.onShowMembership=function(t){return this.ok=t&&a(t.ok).isFunction()?t.ok:void 0,this.cancel=t&&a(t.cancel).isFunction()?t.cancel:void 0,this.firstTabHead.trigger("click"),this.$el.modal("show")},e.prototype.onSignedInOrPasswordResetTokenRequestedOrSignedUp=function(){return this.canceled=!1,this.$el.modal("hide")},e.prototype.onTabHeaderShown=function(t){var e;return null==(null!=(e=t.target)?e.hash:void 0)?!1:this.$(t.target.hash).putFocus()},e.prototype.onDialogShow=function(){return this.canceled=!0,this.$el.resetFields().hideSummaryError().hideFieldErrors()},e.prototype.onDialogShown=function(){return this.$el.putFocus()},e.prototype.onDialogHidden=function(){return this.canceled&&null!=this.cancel?this.cancel():null!=this.ok?this.ok():!1},e}(e.View)});var __hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var i in e)__hasProp.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};define("application/models/changepassword",["require","underscore","backbone","./validation"],function(t){var e,n,i,r,o;return r=t("underscore"),e=t("backbone"),i=t("./validation"),n=function(t){function e(){return o=e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.url=function(){return"/api/passwords/change"},e.prototype.defaults=function(){return{oldPassword:null,newPassword:null,confirmPassword:null}},e.prototype.validate=function(t){var e;return e={},t.oldPassword||i.addError(e,"oldPassword","Old password is required."),t.newPassword?i.isValidPasswordLength(t.newPassword)||i.addError(e,"newPassword","New password length must be between 6 to 64 characters."):i.addError(e,"newPassword","New password is required."),t.confirmPassword?t.newPassword&&t.confirmPassword!==t.newPassword&&i.addError(e,"confirmPassword","New password and confirmation password do not match."):i.addError(e,"confirmPassword","Confirm password is required."),r(e).isEmpty()?void 0:e},e}(e.Model)}),define("confirm",["require","underscore","jquery","bootstrap"],function(t){var e,n,i,r;return r=t("underscore"),e=t("jquery"),t("bootstrap"),i=r('<div class="modal fade hide">\n  <div class="modal-header">\n    <button type="button" class="close" title="close" data-dismiss="modal">&times;</button>\n    <h3><%= title %></h3>\n  </div>\n  <div class="modal-body"><%= prompt %></div>\n  <div class="modal-footer">\n    <button type="button" class="btn">Ok</button>\n    <button type="button" class="btn btn-primary" data-dismiss="modal">Cancel</button>\n  </div>\n</div>').template(),n={title:"Confirm",prompt:"Are you sure you want to perform this action?",ok:function(){},cancel:function(){}},e.confirm=function(t){var r,o;return t=e.extend(n,t),r={title:t.title,prompt:t.prompt},o=e(i(r)).appendTo("body").modal({show:!1}),o.on("click",".modal-footer .btn",function(n){return e(n.currentTarget).is(".btn-primary")?"function"==typeof t.cancel?t.cancel():void 0:(o.modal("hide"),"function"==typeof t.ok?t.ok():void 0)}),o.on("hidden",function(){return o.remove()}).modal("show")},e});var __hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var i in e)__hasProp.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};define("application/views/profile",["require","jquery","backbone","../models/changepassword","../models/session","./helpers","../events","bootstrap","form","confirm"],function(t){var e,n,i,r,o,s,a;return e=t("jquery"),n=t("backbone"),i=t("../models/changepassword"),o=t("../models/session"),a=t("./helpers"),s=t("../events"),t("bootstrap"),t("form"),t("confirm"),r=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return __extends(n,t),n.prototype.el="#profile-dialog",n.prototype.changePasswordType=i,n.prototype.sessionType=o,n.prototype.events={shown:"onDialogShown","submit form":"onChangePassword","click #sign-out-button":"onSignOut"},n.prototype.initialize=function(){return this.changePasswordForm=this.$("form"),this.$el.modal({show:!1}),this.listenTo(s,"showProfile",this.onShowProfile)},n.prototype.onShowProfile=function(){return this.changePasswordForm.resetFields().hideSummaryError().hideFieldErrors(),this.$el.modal("show")},n.prototype.onDialogShown=function(){return this.changePasswordForm.putFocus()},n.prototype.onChangePassword=function(t){var e,n=this;return t.preventDefault(),this.changePasswordForm.hideSummaryError().hideFieldErrors(),e=new this.changePasswordType,a.subscribeModelInvalidEvent(e,this.changePasswordForm),e.save(this.changePasswordForm.serializeFields(),{success:function(){return n.$el.modal("hide"),s.trigger("passwordChanged")},error:function(t,e){var i;return a.hasModelErrors(e)&&(i=a.getModelErrors(e))?n.changePasswordForm.showFieldErrors({errors:i}):n.changePasswordForm.showSummaryError({message:"An unexpected error has occurred while changing your password."})}})},n.prototype.onSignOut=function(t){var n=this;return t.preventDefault(),this.$el.modal("hide"),e.confirm({prompt:"Are you sure you want to sign out?",ok:function(){return new n.sessionType({id:Date.now()}).destroy({success:function(){return s.trigger("signedOut")}})}})},n}(n.View)});var __hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var i in e)__hasProp.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};define("application/views/documenttitle",["require","backbone","../events","form","bootstrap"],function(t){var e,n,i;return e=t("backbone"),i=t("../events"),t("form"),t("bootstrap"),n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.el="#document-title-dialog",e.prototype.events={show:"onDialogShow",shown:"onDiaglogShown","click button":"onSubmit"},e.prototype.initialize=function(t){return this.context=t.context,this.input=this.$('input[type="text"]'),this.$el.modal({show:!1}),this.listenTo(i,"showNewDocumentTitle",this.onShowNewDocumentTitle)},e.prototype.onShowNewDocumentTitle=function(){return this.input.val(this.context.getNewDocumentTitle()),this.$el.modal("show")},e.prototype.onDialogShow=function(){return this.$el.hideFieldErrors()},e.prototype.onDiaglogShown=function(){return this.$el.putFocus()},e.prototype.onSubmit=function(t){var e,n;return t.preventDefault(),(n=this.input.val())?(this.context.setCurrentDocumentTitle(n),this.$el.modal("hide"),i.trigger("newDocumentTitleAssigned")):(e={title:["Title is required."]},this.$el.showFieldErrors({errors:e}))},e}(e.View)});var __hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var i in e)__hasProp.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};define("application/views/documentlistitem",["require","underscore","backbone","./helpers"],function(t){var e,n,i,r;return r=t("underscore"),e=t("backbone"),i=t("./helpers"),n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.tagName="li",e.prototype.initialize=function(t){return this.template=t.template,this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove)
},e.prototype.render=function(){var t;return t=r(this.model.toJSON()).extend({lastUpdatedInRelativeTime:function(){return i.formatAsRelativeTime(this.updatedAt)},lastUpdatedInHumanizeTime:function(){return i.formatAsHumanizeTime(this.updatedAt)}}),this.$el.html(this.template(t)),this},e.prototype.remove=function(t){var n=this;return null==t&&(t=!0),t?(this.trigger("removing"),this.$el.fadeOut(function(){return e.__super__.remove.apply(n,arguments)}),this):e.__super__.remove.apply(this,arguments)},e}(e.View)});var __hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var i in e)__hasProp.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};define("application/views/documentlistedititem",["require","jquery","underscore","./documentlistitem"],function(t){var e,n,i,r;return e=t("jquery"),r=t("underscore"),i=t("./documentlistitem"),n=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return __extends(n,t),n.prototype.events={"dblclick .display span":"onEdit",'click [data-command="delete"]':"onDestroy",'keydown input[type="text"]':"onUpdateOrCancel",'blur input[type="text"]':"onCancel"},n.prototype.showDisplay=function(){return this.$(".edit").hide(),this.$(".display").show()},n.prototype.showEdit=function(){return this.$(".display").hide(),this.$(".edit").show().find('input[type="text"]').val(this.model.get("title")).select().focus()},n.prototype.onEdit=function(t){return t.preventDefault(),t.stopPropagation(),this.showEdit()},n.prototype.onCancel=function(t){return t.preventDefault(),t.stopPropagation(),this.showDisplay()},n.prototype.onUpdateOrCancel=function(t){var n;return t.stopPropagation(),13===t.which?(t.preventDefault(),n=e(t.currentTarget).val(),n&&n!==this.model.get("title")&&this.model.save({title:n}),this.showDisplay()):27===t.which?(t.preventDefault(),this.showDisplay()):!0},n.prototype.onDestroy=function(t){var n=this;return t.preventDefault(),t.stopPropagation(),e.confirm({prompt:"Are you sure you want to delete "+("<strong>"+this.model.get("title")+"</strong>?"),ok:function(){return n.model.destroy()}})},n}(i)});var __hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var i in e)__hasProp.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};define("application/views/documentlist",["require","jquery","underscore","backbone","./documentlistitem","./documentlistedititem"],function(t){var e,n,i,r,o,s;return e=t("jquery"),s=t("underscore"),n=t("backbone"),r=t("./documentlistitem"),i=t("./documentlistedititem"),o=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return __extends(n,t),n.prototype.el="#document-list",n.prototype.itemViewType=r,n.prototype.editItemViewType=i,n.prototype.events={"click .btn-toolbar .btn":"onSort","keydown .list-container":"onNavigate","scroll .list-container":"onScroll","click .list-container li":"onSelect","dblclick .list-container li":"onOpen"},n.prototype.initialize=function(){return this.listContainer=this.$(".list-container"),this.list=this.listContainer.find("> ul"),this.children=[],this.itemTemplate=s(this.$("#document-item-template").html()).template(),this.editItemTemplate=s(this.$("#document-edit-item-template").html()).template(),this.listenTo(this.collection,"reset sort",this.render),this.listenTo(this.collection,"add",this.renderItem),this.render()},n.prototype.getSelectedId=function(){return this.selectedId},n.prototype.resetSelection=function(){return this.list.children().removeClass("active"),this.selectedId=void 0},n.prototype.scrollToTop=function(){return this.listContainer.scrollTop(0)},n.prototype.render=function(){var t=this;return this.removeChildren(),this.collection.each(function(e){return t.renderItem(e)}),this},n.prototype.renderItem=function(t){var e,n=this;return e=t.get("editable")?new this.editItemViewType({model:t,template:this.editItemTemplate}):new this.itemViewType({model:t,template:this.itemTemplate}),this.listenTo(e,"removing",function(){var t;return t=s(n.children).indexOf(e),n.stopListening(e,"removing"),n.children.splice(t,1)}),e.render().$el.attr("data-id",t.id).appendTo(this.list),this.children.push(e),e},n.prototype.remove=function(){return this.removeChildren(),n.__super__.remove.apply(this,arguments)},n.prototype.removeChildren=function(){var t,e;for(e=[];t=this.children.pop();)this.stopListening(t,"removing"),e.push(t.remove(!1));return e},n.prototype.onSort=function(t){var n,i,r,o=this;if(n=e(t.currentTarget),i=n.attr("data-sort-attribute"),r=n.attr("data-sort-order"),i){if(i===this.collection.sortAttribute)return!1;this.collection.sortAttribute=i}else if(r){if(parseInt(r,10)===this.collection.sortOrder)return!1;this.collection.sortOrder=parseInt(r,10)}return this.collection.pageIndex=0,this.collection.fetch({reset:!0,success:function(){return o.scrollToTop()}})},n.prototype.onScroll=function(){return this.collection.pageIndex>=this.collection.pageCount?!1:this.isEndOfScrolling()?(this.collection.pageIndex+=1,this.collection.fetch({update:!0,add:!0,remove:!1})):!1},n.prototype.onNavigate=function(t){var n,i,r;if(r=t.which,38===r||40===r){if(i=this.list.children("li"),n=i.index(this.list.find("li.active")),38===r){if(!n)return!1;n-=1}else if(40===r){if(n>=i.length-1)return!1;n+=1}return e(i.get(n)).trigger("click")}return 32===r?(t.preventDefault(),this.list.find("li.active").trigger("dblclick")):!0},n.prototype.onSelect=function(t){return this.triggerEvent(t,"selected")},n.prototype.onOpen=function(t){return this.triggerEvent(t,"opened")},n.prototype.isEndOfScrolling=function(){var t;return t=this.listContainer.get(0),t.scrollTop+t.clientHeight+125>t.scrollHeight},n.prototype.triggerEvent=function(t,n){var i,r;return t.preventDefault(),i=e(t.currentTarget),r=i.attr("data-id"),this.resetSelection(),i.addClass("active"),this.selectedId=r,this.trigger(n)},n}(n.View)});var __hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var i in e)__hasProp.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};define("application/views/documentbrowser",["require","underscore","backbone","./documentlist","../events","bootstrap"],function(t){var e,n,i,r,o;return o=t("underscore"),e=t("backbone"),i=t("./documentlist"),r=t("../events"),t("bootstrap"),n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.el="#document-browser-dialog",e.prototype.listViewType=i,e.prototype.events={show:"onDiaglogShow",hidden:"onDialogHidden","click .btn-primary":"onSubmit"},e.prototype.initialize=function(t){return this.list=new this.listViewType({collection:t.context.documents}),this.submitButton=this.$(".btn-primary"),this.$el.modal({show:!1}),this.listenTo(r,"showDocuments",this.onShowDocuments),this.listenTo(this.list,"selected",this.onDocumentSelected),this.listenTo(this.list,"opened",this.onDocumentOpened)},e.prototype.onShowDocuments=function(t){return this.cancel=t&&o(t.cancel).isFunction()?t.cancel:void 0,this.$el.modal("show")},e.prototype.onDiaglogShow=function(){return this.canceled=!0,this.list.scrollToTop(),this.list.resetSelection(),this.submitButton.prop("disabled",!0)},e.prototype.onDialogHidden=function(){return this.canceled?"function"==typeof this.cancel?this.cancel():void 0:!1},e.prototype.onDocumentSelected=function(){return this.submitButton.prop("disabled",!1)},e.prototype.onDocumentOpened=function(){return this.submitButton.trigger("click")},e.prototype.onSubmit=function(t){return t.preventDefault(),this.canceled=!1,this.$el.modal("hide"),r.trigger("documentSelected",{id:this.list.getSelectedId()})},e}(e.View)});var __hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var i in e)__hasProp.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};define("application/views/exporteddocument",["require","backbone","../events","bootstrap"],function(t){var e,n,i;return e=t("backbone"),i=t("../events"),t("bootstrap"),n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.el="#exported-document-dialog",e.prototype.events={shown:"onDialogShown",hide:"onDialogHide"},e.prototype.initialize=function(){return this.messageBox=this.$(".alert"),this.image=this.$("img"),this.$el.modal({show:!1}),this.listenTo(i,"documentExported",this.onDocumentExported)},e.prototype.onDocumentExported=function(t){return this.image.prop("src",t.data),this.$el.modal("show")},e.prototype.onDialogShown=function(){return this.messageBox.fadeIn(400)},e.prototype.onDialogHide=function(){return this.messageBox.hide()},e}(e.View)});var __hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var i in e)__hasProp.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};define("application/models/share",["require","underscore","backbone","./validation"],function(t){var e,n,i,r,o;return r=t("underscore"),e=t("backbone"),i=t("./validation"),n=function(t){function e(){return o=e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.defaults=function(){return{email:null,canEdit:!1}},e.prototype.validate=function(t){var e;return e={},t.email?i.isValidEmailFormat(t.email)||i.addError(e,"email","Invalid email format."):i.addError(e,"email","Email is required."),r(e).isEmpty()?void 0:e},e}(e.Model)});var __hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var i in e)__hasProp.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};define("application/models/shares",["require","backbone","./share"],function(t){var e,n,i,r;return e=t("backbone"),n=t("./share"),i=function(t){function i(){return r=i.__super__.constructor.apply(this,arguments)}return __extends(i,t),i.prototype.model=n,i.prototype.url=function(){return"/api/documents/"+this.documentId+"/shares"},i.prototype.update=function(t){return e.sync("update",this,t)},i}(e.Collection)});var __hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var i in e)__hasProp.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};define("application/views/sharedocument",["require","jquery","underscore","backbone","../models/share","../models/shares","../events","./helpers","bootstrap","form"],function(t){var e,n,i,r,o,s,a,c,l;return e=t("jquery"),c=t("underscore"),n=t("backbone"),i=t("../models/share"),o=t("../models/shares"),s=t("../events"),a=t("./helpers"),t("bootstrap"),t("form"),r=function(t){function n(){return l=n.__super__.constructor.apply(this,arguments)}return __extends(n,t),n.prototype.el="#document-share-dialog",n.prototype.events={shown:"onDialogShown","submit .new-share":"onAdd","submit .share-list .edit-share":"onRemove","click .modal-footer .btn-primary":"onSave"},n.prototype.initialize=function(t){return this.context=t.context,this.container=this.$(".modal-body > .share-list"),this.template=c(this.$("#share-item-template").html()).template(),this.$el.modal({show:!1}),this.listenTo(s,"shareDocument",this.onShare)},n.prototype.render=function(){var t=this;return this.container.empty(),this.collection.each(function(n){return e(t.template(n.toJSON())).appendTo(t.container)}),this},n.prototype.onDialogShown=function(){return this.$el.putFocus()},n.prototype.onAdd=function(t){var n,r;return t.preventDefault(),n=e(t.currentTarget),r=new i,a.subscribeModelInvalidEvent(r,n),r.set(n.serializeFields(),{validate:!0})?(e(this.template(r.toJSON())).hide().prependTo(this.container).fadeIn(),n.resetFields().putFocus()):!1},n.prototype.onRemove=function(t){return t.preventDefault(),e(t.currentTarget).fadeOut(function(){return e(this).remove()})},n.prototype.onSave=function(t){var n,r,o=this;return t.preventDefault(),n=[],this.container.find(".edit-share").each(function(){return n.push({model:new i,form:e(this)})}),(r=c(n).chain().map(function(t){return a.subscribeModelInvalidEvent(t.model,t.form),t.model.set(t.form.serializeFields(),{validate:!0})}).all().value())?(this.collection.reset({silent:!0}),this.collection.set(c(n).map(function(t){return t.model})),this.collection.update({success:function(){return o.$el.modal("hide"),s.trigger("documentSharing",{id:o.context.getCurrentDocumentId(),shared:!o.collection.isEmpty()})}})):!1},n.prototype.onShare=function(){var t=this;return this.context.isUserSignedIn()?this.context.isCurrentDocumentNew()?s.trigger("showNewDocumentTitle"):this.context.isCurrentDocumentOwned()?(this.collection=new o,this.collection.documentId=this.context.getCurrentDocumentId(),this.collection.fetch({success:function(){return t.render(),t.$el.modal("show")}})):e.showErrorbar("Only document owner is allowed to share."):s.trigger("showMembership")},n}(n.View)}),define("application/models/sortorder",[],function(){return{ascending:0,descending:1}});var __hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var i in e)__hasProp.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};define("application/models/document",["require","underscore","backbone","./validation"],function(t){var e,n,i,r;return r=t("underscore"),e=t("backbone"),i=t("./validation"),n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.urlRoot=function(){return"/api/documents"},e.prototype.defaults=function(){return{title:null,content:null,owned:null,shared:null,editable:null,createdAt:null,updatedAt:null}},e.prototype.validate=function(t){var e;return e={},t.title||i.addError(e,"title","Title is required."),r(e).isEmpty()?void 0:e},e}(e.Model)});var __hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var i in e)__hasProp.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};define("application/models/documents",["require","jquery","underscore","./sortorder","./document"],function(t){var e,n,i,r,o;return e=t("jquery"),o=t("underscore"),r=t("./sortorder"),n=t("./document"),i=function(t){function i(){i.__super__.constructor.apply(this,arguments),this.resetSorting(),this.resetPaging()}return __extends(i,t),i.prototype.defaultSortAttribute="updatedAt",i.prototype.defaultSortOrder=r.descending,i.prototype.countAttribute="count",i.prototype.resultAttribute="data",i.prototype.defaultPageSize=25,i.prototype.filter=null,i.prototype.model=n,i.prototype.parse=function(t){return this.setCounts(t[this.countAttribute]),t[this.resultAttribute]},i.prototype.url=function(){var t,n;return n={top:this.pageSize},this.pageIndex&&(n.skip=this.pageSize*this.pageIndex),this.sortAttribute&&(t=this.sortAttribute,this.sortOrder===r.ascending?t+=" asc":this.sortOrder===r.descending&&(t+=" desc"),n.orderBy=t),this.filter&&(n.filter=this.filter),"/api/documents?"+e.param(n)},i.prototype.fetchOne=function(t,e){var i,r,s=this;return e=o(e).defaults({success:function(){},error:function(){}}),i=this.get(t),i?o(function(){return e.success(i)}).defer():(i=new n,i.id=t,r=e.success,e.success=function(){return s.add(i),r(i)},i.fetch(e))},i.prototype.setCounts=function(t){return this.totalCount=t,this.pageCount=Math.ceil(t/this.pageSize),this},i.prototype.resetSorting=function(){return this.sortAttribute=this.defaultSortAttribute,this.sortOrder=this.defaultSortOrder},i.prototype.resetPaging=function(){return this.pageSize=this.defaultPageSize,this.pageIndex=0,this.pageCount=0,this.totalCount=0},i}(Backbone.Collection)}),define("application/context",["require","./models/documents"],function(t){var e,n;return n=t("./models/documents"),e=function(){function t(t){this.resetCurrentDocument(),this.documents=new this.documentsType,t.userSignedIn&&(t.documents&&(this.documents.reset(t.documents.data),this.documents.setCounts(t.documents.count)),this.userSignedIn(!1))}return t.prototype.documentsType=n,t.prototype.isUserSignedIn=function(){return this.signedIn},t.prototype.userSignedIn=function(t){return null==t&&(t=!0),this.signedIn=!0,t?this.documents.fetch({reset:!0}):void 0},t.prototype.userSignedOut=function(){return this.signedIn=!1,this.documents.reset(),this.resetCurrentDocument()},t.prototype.resetCurrentDocument=function(){return this.id=null,this.title=null,this.content=null,this.owned=!0,this.shared=!1,this.editable=!0},t.prototype.setCurrentDocument=function(t,e){var n=this;return this.documents.fetchOne(t,{success:function(t){var i;return i=t.toJSON(),n.id=i.id,n.title=i.title,n.content=i.content,n.owned=i.owned,n.shared=i.shared,n.editable=i.editable,"function"==typeof e?e(t):void 0},error:function(){return n.resetCurrentDocument(),"function"==typeof e?e():void 0}})},t.prototype.getCurrentDocumentId=function(){return this.id},t.prototype.getCurrentDocumentTitle=function(){return this.title||""},t.prototype.setCurrentDocumentTitle=function(t){return this.isCurrentDocumentEditable()?(t||(t=null),this.title=t):!1},t.prototype.getCurrentDocumentContent=function(){return this.content||""},t.prototype.setCurrentDocumentContent=function(t){return this.isCurrentDocumentEditable()?(t||(t=null),this.content=t):!1},t.prototype.isCurrentDocumentNew=function(){return!this.id},t.prototype.isCurrentDocumentEditable=function(){return this.editable},t.prototype.isCurrentDocumentOwned=function(){return this.owned},t.prototype.isCurrentDocumentShared=function(){return this.shared},t.prototype.canShareCurrentDocumentUpdate=function(){return this.isCurrentDocumentShared()&&this.isCurrentDocumentEditable()},t.prototype.saveCurrentDocument=function(t){var e,n,i=this;return this.isCurrentDocumentEditable()?(e={content:this.content},this.isCurrentDocumentNew()?(e.title=this.title,this.documents.create(e,{wait:!0,success:function(e){return i.id=e.id,"function"==typeof t?t():void 0}})):(n=this.documents.get(this.id),n.save(e,{success:function(){return"function"==typeof t?t():void 0}}))):!1},t.prototype.getNewDocumentTitle=function(){var t,e;return e=this.title,e||(t=this.documents.length+1,e="New document "+t),e},t}()});var __hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var i in e)__hasProp.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};define("application/router",["require","jquery","underscore","backbone","./events","flashbar","confirm"],function(t){var e,n,i,r,o;return e=t("jquery"),o=t("underscore"),n=t("backbone"),r=t("./events"),t("flashbar"),t("confirm"),i=function(t){function i(){var t=this;i.__super__.constructor.apply(this,arguments),this.navigationHistory=[],this.on("all",function(){var e;return e=n.history.fragment,t.navigationHistory.length&&o(t.navigationHistory).last()===e?!1:t.navigationHistory.push(e)})}return __extends(i,t),i.prototype.routes={"!/documents/new":"newDocument","!/documents/:id":"openDocument","!/documents":"openDocuments"},i.prototype.initialize=function(t){return this.context=t.context,this.defaultUrl=t.defaultUrl},i.prototype.newDocument=function(){return this.context.resetCurrentDocument(),r.trigger("documentChanged")},i.prototype.openDocument=function(t){var n=this;return this.ensureSignedIn(function(){return n.context.setCurrentDocument(t,function(i){return i||(e.showErrorbar("Document with id <strong>"+t+"</strong> "+"does not exist."),n.redirecToPrevious()),r.trigger("documentChanged")})})},i.prototype.openDocuments=function(){var t=this;return this.ensureSignedIn(function(){return r.trigger("showDocuments",{cancel:function(){return t.redirectToPrevious(!1)}})})},i.prototype.ensureSignedIn=function(t){var e=this;return this.context.isUserSignedIn()?t():r.trigger("showMembership",{ok:function(){return e.context.isUserSignedIn()?t():e.redirectToPrevious()},cancel:function(){return e.redirectToPrevious()}})},i.prototype.redirectToPrevious=function(t){var e;return null==t&&(t=!0),e=this.navigationHistory.length>1?this.navigationHistory[this.navigationHistory.length-2]:this.defaultUrl,this.navigate(e,t)},i}(n.Router)}),function(t,e){function n(e,n){if(t.isArray(e)){for(var i=e.length-1;i>=0;i--){var r=e[i];"object"===t.type(e)||"string"===t.type(r)&&s.transports[r]||(n.log("Invalid transport: "+r+", removing it from the transports list."),e.splice(i,1))}0===e.length&&(n.log("No transports remain within the specified transport array."),e=null)}else if("object"===t.type(e)||s.transports[e]||"auto"===e){if("auto"===e&&s._.ieVersion<=8)return["longPolling"]}else n.log("Invalid transport: "+e.toString()),e=null;return e}function i(t){return"http:"===t?80:"https:"===t?443:void 0}function r(t,e){return e.match(/:\d+$/)?e:e+":"+i(t)}function o(e,n){var i=this,r=[];i.tryBuffer=function(n){return e.state===t.signalR.connectionState.connecting?(r.push(n),!0):!1},i.drain=function(){if(e.state===t.signalR.connectionState.connected)for(;r.length>0;)n(r.shift())},i.clear=function(){r=[]}}if("function"!=typeof t)throw new Error("SignalR: jQuery not found. Please ensure jQuery is referenced before the SignalR.js file.");var s,a,c="complete"===e.document.readyState,l=t(e),u="__Negotiate Aborted__",h={onStart:"onStart",onStarting:"onStarting",onReceived:"onReceived",onError:"onError",onConnectionSlow:"onConnectionSlow",onReconnecting:"onReconnecting",onReconnect:"onReconnect",onStateChanged:"onStateChanged",onDisconnect:"onDisconnect"},d=function(t,n){if(n!==!1){var i;"undefined"!=typeof e.console&&(i="["+(new Date).toTimeString()+"] SignalR: "+t,e.console.debug?e.console.debug(i):e.console.log&&e.console.log(i))}},p=function(e,n,i){return n===e.state?(e.state=i,t(e).triggerHandler(h.onStateChanged,[{oldState:n,newState:i}]),!0):!1},f=function(t){return t.state===s.connectionState.disconnected},g=function(t){var n,i;t._.configuredStopReconnectingTimeout||(i=function(t){t.log("Couldn't reconnect within the configured timeout ("+t.disconnectTimeout+"ms), disconnecting."),t.stop(!1,!1)},t.reconnecting(function(){var t=this;t.state===s.connectionState.reconnecting&&(n=e.setTimeout(function(){i(t)},t.disconnectTimeout))}),t.stateChanged(function(t){t.oldState===s.connectionState.reconnecting&&e.clearTimeout(n)}),t._.configuredStopReconnectingTimeout=!0)};s=function(t,e,n){return new s.fn.init(t,e,n)},s._={defaultContentType:"application/x-www-form-urlencoded; charset=UTF-8",ieVersion:function(){var t,n;return"Microsoft Internet Explorer"===e.navigator.appName&&(n=/MSIE ([0-9]+\.[0-9]+)/.exec(e.navigator.userAgent),n&&(t=e.parseFloat(n[1]))),t}()},s.events=h,s.changeState=p,s.isDisconnecting=f,s.connectionState={connecting:0,connected:1,reconnecting:2,disconnected:4},s.hub={start:function(){throw new Error("SignalR: Error loading hubs. Ensure your hubs reference is correct, e.g. <script src='/signalr/js'></script>.")}},l.load(function(){c=!0}),s.fn=s.prototype={init:function(e,n,i){var r=t(this);this.url=e,this.qs=n,this._={connectingMessageBuffer:new o(this,function(t){r.triggerHandler(h.onReceived,[t])}),onFailedTimeoutHandle:null},"boolean"==typeof i&&(this.logging=i)},_parseResponse:function(t){var e=this;return t?"text"===e.ajaxDataType?e.json.parse(t):t:t},json:e.JSON,isCrossDomain:function(n,i){var o;return n=t.trim(n),0!==n.indexOf("http")?!1:(i=i||e.location,o=e.document.createElement("a"),o.href=n,o.protocol+r(o.protocol,o.host)!==i.protocol+r(i.protocol,i.host))},ajaxDataType:"text",contentType:"application/json; charset=UTF-8",logging:!1,state:s.connectionState.disconnected,keepAliveData:{},clientProtocol:"1.3",reconnectDelay:2e3,transportConnectTimeout:0,disconnectTimeout:3e4,keepAliveWarnAt:2/3,start:function(i,r){var o,a=this,d={waitForPageLoad:!0,transport:"auto",jsonp:!1},f=a._deferral||t.Deferred(),m=e.document.createElement("a");if(a._deferral=f,!a.json)throw new Error("SignalR: No JSON parser found. Please ensure json2.js is referenced before the SignalR.js file if you need to support clients without native JSON parsing support, e.g. IE<8.");if("function"===t.type(i)?r=i:"object"===t.type(i)&&(t.extend(d,i),"function"===t.type(d.callback)&&(r=d.callback)),d.transport=n(d.transport,a),!d.transport)throw new Error("SignalR: Invalid transport(s) specified, aborting start.");if(a._.config=d,!c&&d.waitForPageLoad===!0)return l.load(function(){a.start(i,r)}),f.promise();if(g(a),a.state===s.connectionState.connecting)return f.promise();if(p(a,s.connectionState.disconnected,s.connectionState.connecting)===!1)return f.resolve(a),f.promise();m.href=a.url,m.protocol&&":"!==m.protocol?(a.protocol=m.protocol,a.host=m.host,a.baseUrl=m.protocol+"//"+m.host):(a.protocol=e.document.location.protocol,a.host=e.document.location.host,a.baseUrl=a.protocol+"//"+a.host),a.wsProtocol="https:"===a.protocol?"wss://":"ws://","auto"===d.transport&&d.jsonp===!0&&(d.transport="longPolling"),this.isCrossDomain(a.url)&&(a.log("Auto detected cross domain url."),"auto"===d.transport&&(d.transport=["webSockets","longPolling"]),d.jsonp||(d.jsonp=!t.support.cors,d.jsonp&&a.log("Using jsonp because this browser doesn't support CORS")),a.contentType=s._.defaultContentType),a.ajaxDataType=d.jsonp?"jsonp":"text",t(a).bind(h.onStart,function(){"function"===t.type(r)&&r.call(a),f.resolve(a)}),o=function(n,i){if(i=i||0,i>=n.length)return t(a).triggerHandler(h.onError,["SignalR: No transport could be initialized successfully. Try specifying a different transport or none at all for auto initialization."]),f.reject("SignalR: No transport could be initialized successfully. Try specifying a different transport or none at all for auto initialization."),a.stop(),void 0;if(a.state!==s.connectionState.disconnected){var r=n[i],c="object"===t.type(r)?r:s.transports[r],u=!1,d=function(){u||(u=!0,e.clearTimeout(a._.onFailedTimeoutHandle),c.stop(a),o(n,i+1))};if(a.transport=c,0===r.indexOf("_"))return o(n,i+1),void 0;try{a._.onFailedTimeoutHandle=e.setTimeout(function(){a.log(c.name+" timed out when trying to connect."),d()},a.transportConnectTimeout),c.start(a,function(){a.state!==s.connectionState.disconnected&&(u||(u=!0,e.clearTimeout(a._.onFailedTimeoutHandle),c.supportsKeepAlive&&a.keepAliveData.activated&&s.transports._logic.monitorKeepAlive(a),p(a,s.connectionState.connecting,s.connectionState.connected),a._.connectingMessageBuffer.drain(),t(a).triggerHandler(h.onStart),l.unload(function(){a.stop(!1)})))},d)}catch(g){a.log("SignalR: "+c.name+" transport threw '"+g.message+"' when attempting to start."),d()}}};var v=a.url+"/negotiate";return v=s.transports._logic.addQs(v,a.qs),v=s.transports._logic.addQs(v,{clientProtocol:a.clientProtocol}),a.log("Negotiating with '"+v+"'."),a._.negotiateRequest=t.ajax({url:v,global:!1,cache:!1,type:"GET",contentType:a.contentType,data:{},dataType:a.ajaxDataType,error:function(e,n){n!==u&&(t(a).triggerHandler(h.onError,[e.responseText]),f.reject("SignalR: Error during negotiation request: "+e.responseText),a.stop())},success:function(e){var n=a._parseResponse(e),i=a.keepAliveData;if(a.appRelativeUrl=n.Url,a.id=n.ConnectionId,a.token=n.ConnectionToken,a.webSocketServerUrl=n.WebSocketServerUrl,a.disconnectTimeout=1e3*n.DisconnectTimeout,a.transportConnectTimeout=a.transportConnectTimeout+1e3*n.TransportConnectTimeout,n.KeepAliveTimeout?(i.activated=!0,i.timeout=1e3*n.KeepAliveTimeout,i.timeoutWarning=i.timeout*a.keepAliveWarnAt,i.checkInterval=(i.timeout-i.timeoutWarning)/3):i.activated=!1,!n.ProtocolVersion||n.ProtocolVersion!==a.clientProtocol)return t(a).triggerHandler(h.onError,["You are using a version of the client that isn't compatible with the server. Client version "+a.clientProtocol+", server version "+n.ProtocolVersion+"."]),f.reject("You are using a version of the client that isn't compatible with the server. Client version "+a.clientProtocol+", server version "+n.ProtocolVersion+"."),void 0;t(a).triggerHandler(h.onStarting);var r=[],c=[];t.each(s.transports,function(t){return"webSockets"!==t||n.TryWebSockets?(c.push(t),void 0):!0}),t.isArray(d.transport)?t.each(d.transport,function(){var e=this;("object"===t.type(e)||"string"===t.type(e)&&t.inArray(""+e,c)>=0)&&r.push("string"===t.type(e)?""+e:e)}):"object"===t.type(d.transport)||t.inArray(d.transport,c)>=0?r.push(d.transport):r=c,o(r)}}),f.promise()},starting:function(e){var n=this;return t(n).bind(h.onStarting,function(){e.call(n)}),n},send:function(t){var e=this;if(e.state===s.connectionState.disconnected)throw new Error("SignalR: Connection must be started before data can be sent. Call .start() before .send()");if(e.state===s.connectionState.connecting)throw new Error("SignalR: Connection has not been fully initialized. Use .start().done() or .start().fail() to run logic after the connection has started.");return e.transport.send(e,t),e},received:function(e){var n=this;return t(n).bind(h.onReceived,function(t,i){n._.connectingMessageBuffer.tryBuffer(i)||e.call(n,i)}),n},stateChanged:function(e){var n=this;return t(n).bind(h.onStateChanged,function(t,i){e.call(n,i)}),n},error:function(e){var n=this;return t(n).bind(h.onError,function(t,i){e.call(n,i)}),n},disconnected:function(e){var n=this;return t(n).bind(h.onDisconnect,function(){e.call(n)}),n},connectionSlow:function(e){var n=this;return t(n).bind(h.onConnectionSlow,function(){e.call(n)}),n},reconnecting:function(e){var n=this;return t(n).bind(h.onReconnecting,function(){e.call(n)}),n},reconnected:function(e){var n=this;return t(n).bind(h.onReconnect,function(){e.call(n)}),n},stop:function(n,i){var r=this;if(!(c||r._.config&&r._.config.waitForPageLoad!==!0))return l.load(function(){r.stop(n,i)}),void 0;if(r.state!==s.connectionState.disconnected){try{r.log("SignalR: Stopping connection."),e.clearTimeout(r._.onFailedTimeoutHandle),r.transport&&(i!==!1&&r.transport.abort(r,n),r.transport.supportsKeepAlive&&r.keepAliveData.activated&&s.transports._logic.stopMonitoringKeepAlive(r),r.transport.stop(r),r.transport=null),r._.negotiateRequest&&(r._.negotiateRequest.abort(u),delete r._.negotiateRequest),t(r).triggerHandler(h.onDisconnect),delete r.messageId,delete r.groupsToken,delete r.id,delete r._deferral,delete r._.config,r._.connectingMessageBuffer.clear()}finally{p(r,r.state,s.connectionState.disconnected)}return r}},log:function(t){d(t,this.logging)}},s.fn.init.prototype=s.fn,s.noConflict=function(){return t.connection===s&&(t.connection=a),s},t.connection&&(a=t.connection),t.connection=t.signalR=s}(window.jQuery,window),function(t,e){function n(i){var r,a,c=i.keepAliveData;i.state===o.connectionState.connected&&(r=new Date,r.setTime(r-c.lastKeepAlive),a=r.getTime(),a>=c.timeout?(i.log("Keep alive timed out.  Notifying transport that connection has been lost."),i.transport.lostConnection(i)):a>=c.timeoutWarning?c.userNotified||(i.log("Keep alive has been missed, connection may be dead/slow."),t(i).triggerHandler(s.onConnectionSlow),c.userNotified=!0):c.userNotified=!1),c.monitoring&&e.setTimeout(function(){n(i)},c.checkInterval)}function i(t){return t.state===o.connectionState.connected||t.state===o.connectionState.reconnecting}var r,o=t.signalR,s=t.signalR.events,a=t.signalR.changeState;o.transports={},r=o.transports._logic={pingServer:function(e,n){var i="webSockets"===n?"":e.baseUrl,r=i+e.appRelativeUrl+"/ping",o=t.Deferred();return r=this.addQs(r,e.qs),t.ajax({url:r,global:!1,cache:!1,type:"GET",contentType:e.contentType,data:{},dataType:e.ajaxDataType,success:function(t){var n=e._parseResponse(t);"pong"===n.Response?o.resolve():o.reject("SignalR: Invalid ping response when pinging server: "+(n.responseText||n.statusText))},error:function(t){o.reject("SignalR: Error pinging server: "+(t.responseText||t.statusText))}}),o.promise()},addQs:function(e,n){var i,r=-1!==e.indexOf("?")?"&":"?";if(!n)return e;if("object"==typeof n)return e+r+t.param(n);if("string"==typeof n)return i=n.charAt(0),("?"===i||"&"===i)&&(r=""),e+r+n;throw new Error("Query string property must be either a string or object.")
},getUrl:function(t,n,i,o){var s="webSockets"===n?"":t.baseUrl,a=s+t.appRelativeUrl,c="transport="+n+"&connectionToken="+e.encodeURIComponent(t.token);return t.data&&(c+="&connectionData="+e.encodeURIComponent(t.data)),t.groupsToken&&(c+="&groupsToken="+e.encodeURIComponent(t.groupsToken)),i?(a+=o?"/poll":"/reconnect",t.messageId&&(c+="&messageId="+e.encodeURIComponent(t.messageId))):a+="/connect",a+="?"+c,a=r.addQs(a,t.qs),a+="&tid="+Math.floor(11*Math.random())},maximizePersistentResponse:function(t){return{MessageId:t.C,Messages:t.M,Initialized:"undefined"!=typeof t.S?!0:!1,Disconnect:"undefined"!=typeof t.D?!0:!1,TimedOut:"undefined"!=typeof t.T?!0:!1,LongPollDelay:t.L,GroupsToken:t.G}},updateGroups:function(t,e){e&&(t.groupsToken=e)},ajaxSend:function(n,i){var r=n.url+"/send"+"?transport="+n.transport.name+"&connectionToken="+e.encodeURIComponent(n.token);return r=this.addQs(r,n.qs),t.ajax({url:r,global:!1,type:"jsonp"===n.ajaxDataType?"GET":"POST",contentType:o._.defaultContentType,dataType:n.ajaxDataType,data:{data:i},success:function(e){e&&t(n).triggerHandler(s.onReceived,[n._parseResponse(e)])},error:function(e,i){"abort"!==i&&"parsererror"!==i&&t(n).triggerHandler(s.onError,[e])}})},ajaxAbort:function(n,i){if("undefined"!=typeof n.transport){i="undefined"==typeof i?!0:i;var r=n.url+"/abort"+"?transport="+n.transport.name+"&connectionToken="+e.encodeURIComponent(n.token);r=this.addQs(r,n.qs),t.ajax({url:r,async:i,timeout:1e3,global:!1,type:"POST",contentType:n.contentType,dataType:n.ajaxDataType,data:{}}),n.log("Fired ajax abort async = "+i)}},tryInitialize:function(t,e){t.Initialized&&e()},processMessages:function(e,n,i){var o,a=t(e);if(e.transport&&e.transport.supportsKeepAlive&&e.keepAliveData.activated&&this.updateKeepAlive(e),n){if(o=this.maximizePersistentResponse(n),o.Disconnect)return e.log("Disconnect command received from server"),e.stop(!1,!1),void 0;this.updateGroups(e,o.GroupsToken),o.MessageId&&(e.messageId=o.MessageId),o.Messages&&(t.each(o.Messages,function(t,e){a.triggerHandler(s.onReceived,[e])}),r.tryInitialize(o,i))}},monitorKeepAlive:function(e){var i=e.keepAliveData,r=this;i.monitoring?e.log("Tried to monitor keep alive but it's already being monitored"):(i.monitoring=!0,r.updateKeepAlive(e),e.keepAliveData.reconnectKeepAliveUpdate=function(){r.updateKeepAlive(e)},t(e).bind(s.onReconnect,e.keepAliveData.reconnectKeepAliveUpdate),e.log("Now monitoring keep alive with a warning timeout of "+i.timeoutWarning+" and a connection lost timeout of "+i.timeout),n(e))},stopMonitoringKeepAlive:function(e){var n=e.keepAliveData;n.monitoring&&(n.monitoring=!1,t(e).unbind(s.onReconnect,e.keepAliveData.reconnectKeepAliveUpdate),e.keepAliveData={},e.log("Stopping the monitoring of the keep alive"))},updateKeepAlive:function(t){t.keepAliveData.lastKeepAlive=new Date},ensureReconnectingState:function(e){return a(e,o.connectionState.connected,o.connectionState.reconnecting)===!0&&t(e).triggerHandler(s.onReconnecting),e.state===o.connectionState.reconnecting},clearReconnectTimeout:function(t){t&&t._.reconnectTimeout&&(e.clearTimeout(t._.reconnectTimeout),delete t._.reconnectTimeout)},reconnect:function(t,n){var r=o.transports[n],s=this;i(t)&&!t._.reconnectTimeout&&(t._.reconnectTimeout=e.setTimeout(function(){r.stop(t),s.ensureReconnectingState(t)&&(t.log(n+" reconnecting"),r.start(t))},t.reconnectDelay))},foreverFrame:{count:0,connections:{}}}}(window.jQuery,window),function(t,e){var n=t.signalR,i=t.signalR.events,r=t.signalR.changeState,o=n.transports._logic;n.transports.webSockets={name:"webSockets",supportsKeepAlive:!0,send:function(t,e){t.socket.send(e)},start:function(s,a,c){var l,u=!1,h=this,d=!a,p=t(s);return e.WebSocket?(s.socket||(l=s.webSocketServerUrl?s.webSocketServerUrl:s.wsProtocol+s.host,l+=o.getUrl(s,this.name,d),s.log("Connecting to websocket endpoint '"+l+"'"),s.socket=new e.WebSocket(l),s.socket.onopen=function(){u=!0,s.log("Websocket opened"),o.clearReconnectTimeout(s),r(s,n.connectionState.reconnecting,n.connectionState.connected)===!0&&p.triggerHandler(i.onReconnect)},s.socket.onclose=function(e){if(this===s.socket){if(!u)return c?c():d&&h.reconnect(s),void 0;"undefined"!=typeof e.wasClean&&e.wasClean===!1?(t(s).triggerHandler(i.onError,[e.reason]),s.log("Unclean disconnect from websocket."+e.reason)):s.log("Websocket closed"),h.reconnect(s)}},s.socket.onmessage=function(e){var n=s._parseResponse(e.data),r=t(s);n&&(t.isEmptyObject(n)||n.M?o.processMessages(s,n,a):r.triggerHandler(i.onReceived,[n]))}),void 0):(c(),void 0)},reconnect:function(t){o.reconnect(t,this.name)},lostConnection:function(t){this.reconnect(t)},stop:function(t){o.clearReconnectTimeout(t),t.socket&&(t.log("Closing the Websocket"),t.socket.close(),t.socket=null)},abort:function(){}}}(window.jQuery,window),function(t,e){var n=t.signalR,i=t.signalR.events,r=t.signalR.changeState,o=n.transports._logic;n.transports.serverSentEvents={name:"serverSentEvents",supportsKeepAlive:!0,timeOut:3e3,start:function(s,a,c){var l,u,h=this,d=!1,p=t(s),f=!a;if(s.eventSource&&(s.log("The connection already has an event source. Stopping it."),s.stop()),!e.EventSource)return c&&(s.log("This browser doesn't support SSE."),c()),void 0;l=o.getUrl(s,this.name,f);try{s.log("Attempting to connect to SSE endpoint '"+l+"'"),s.eventSource=new e.EventSource(l)}catch(g){return s.log("EventSource failed trying to connect with error "+g.Message),c?c():(p.triggerHandler(i.onError,[g]),f&&h.reconnect(s)),void 0}f&&(u=e.setTimeout(function(){d===!1&&s.eventSource.readyState!==e.EventSource.CONNECTING&&s.eventSource.readyState!==e.EventSource.OPEN&&h.reconnect(s)},h.timeOut)),s.eventSource.addEventListener("open",function(){s.log("EventSource connected"),u&&e.clearTimeout(u),o.clearReconnectTimeout(s),d===!1&&(d=!0,r(s,n.connectionState.reconnecting,n.connectionState.connected)===!0&&p.triggerHandler(i.onReconnect))},!1),s.eventSource.addEventListener("message",function(t){"initialized"!==t.data&&o.processMessages(s,s._parseResponse(t.data),a)},!1),s.eventSource.addEventListener("error",function(t){if(this===s.eventSource){if(!d)return c&&c(),void 0;s.log("EventSource readyState: "+s.eventSource.readyState),t.eventPhase===e.EventSource.CLOSED?(s.log("EventSource reconnecting due to the server connection ending"),h.reconnect(s)):(s.log("EventSource error"),p.triggerHandler(i.onError))}},!1)},reconnect:function(t){o.reconnect(t,this.name)},lostConnection:function(t){this.reconnect(t)},send:function(t,e){o.ajaxSend(t,e)},stop:function(t){o.clearReconnectTimeout(t),t&&t.eventSource&&(t.log("EventSource calling close()"),t.eventSource.close(),t.eventSource=null,delete t.eventSource)},abort:function(t,e){o.ajaxAbort(t,e)}}}(window.jQuery,window),function(t,e){var n=t.signalR,i=t.signalR.events,r=t.signalR.changeState,o=n.transports._logic,s=function(){var i=null,r=1e3,o=0;return{prevent:function(){n._.ieVersion<=8&&(0===o&&(i=e.setInterval(function(){var e=t("<iframe style='position:absolute;top:0;left:0;width:0;height:0;visibility:hidden;' src=''></iframe>");t("body").append(e),e.remove(),e=null},r)),o++)},cancel:function(){1===o&&e.clearInterval(i),o>0&&o--}}}();n.transports.foreverFrame={name:"foreverFrame",supportsKeepAlive:!0,start:function(n,i,r){var a,c=this,l=o.foreverFrame.count+=1,u=t("<iframe data-signalr-connection-id='"+n.id+"' style='position:absolute;top:0;left:0;width:0;height:0;visibility:hidden;' src=''></iframe>");return e.EventSource?(r&&(n.log("This browser supports SSE, skipping Forever Frame."),r()),void 0):(s.prevent(),a=o.getUrl(n,this.name),a+="&frameId="+l,t("body").append(u),u.prop("src",a),o.foreverFrame.connections[l]=n,n.log("Binding to iframe's readystatechange event."),u.bind("readystatechange",function(){t.inArray(this.readyState,["loaded","complete"])>=0&&(n.log("Forever frame iframe readyState changed to "+this.readyState+", reconnecting"),c.reconnect(n))}),n.frame=u[0],n.frameId=l,i&&(n.onSuccess=function(){i(),delete n.onSuccess}),void 0)},reconnect:function(t){var n=this;e.setTimeout(function(){if(t.frame&&o.ensureReconnectingState(t)){var e=t.frame,i=o.getUrl(t,n.name,!0)+"&frameId="+t.frameId;t.log("Updating iframe src to '"+i+"'."),e.src=i}},t.reconnectDelay)},lostConnection:function(t){this.reconnect(t)},send:function(t,e){o.ajaxSend(t,e)},receive:function(e,n){var i;o.processMessages(e,n,e.onSuccess),e.frameMessageCount=(e.frameMessageCount||0)+1,e.frameMessageCount>50&&(e.frameMessageCount=0,i=e.frame.contentWindow||e.frame.contentDocument,i&&i.document&&t("body",i.document).empty())},stop:function(e){var n=null;if(s.cancel(),e.frame){if(e.frame.stop)e.frame.stop();else try{n=e.frame.contentWindow||e.frame.contentDocument,n.document&&n.document.execCommand&&n.document.execCommand("Stop")}catch(i){e.log("SignalR: Error occured when stopping foreverFrame transport. Message = "+i.message)}t(e.frame).remove(),delete o.foreverFrame.connections[e.frameId],e.frame=null,e.frameId=null,delete e.frame,delete e.frameId,delete e.onSuccess,e.log("Stopping forever frame")}},abort:function(t,e){o.ajaxAbort(t,e)},getConnection:function(t){return o.foreverFrame.connections[t]},started:function(e){r(e,n.connectionState.reconnecting,n.connectionState.connected)===!0&&t(e).triggerHandler(i.onReconnect)}}}(window.jQuery,window),function(t,e){var n=t.signalR,i=t.signalR.events,r=t.signalR.changeState,o=t.signalR.isDisconnecting,s=n.transports._logic;n.transports.longPolling={name:"longPolling",supportsKeepAlive:!1,reconnectDelay:3e3,start:function(a,c,l){var u=this,h=function(){h=t.noop,c(),l=null,a.log("LongPolling connected")},d=function(){return l?(l(),l=null,a.log("LongPolling failed to connect."),!0):!1},p=0,f=null,g=function(o){e.clearTimeout(f),f=null,r(a,n.connectionState.reconnecting,n.connectionState.connected)===!0&&(a.log("Raising the reconnect event"),t(o).triggerHandler(i.onReconnect))},m=36e5;a.pollXhr&&(a.log("Polling xhr requests already exists, aborting."),a.stop()),a.messageId=null,e.setTimeout(function(){!function r(c,l){var v=c.messageId,y=null===v,w=!y,_=!l,b=s.getUrl(c,u.name,w,_);o(c)!==!0&&(a.log("Attempting to connect to '"+b+"' using longPolling."),c.pollXhr=t.ajax({url:b,global:!1,cache:!1,type:"GET",dataType:a.ajaxDataType,contentType:a.contentType,success:function(n){var i,l=a._parseResponse(n),u=0;p=0,null!==f&&g(),l&&(i=s.maximizePersistentResponse(l)),s.processMessages(c,l,h),i&&"number"===t.type(i.LongPollDelay)&&(u=i.LongPollDelay),i&&i.Disconnect||o(c)!==!0&&(u>0?e.setTimeout(function(){r(c,!1)},u):r(c,!1))},error:function(o,l){return e.clearTimeout(f),f=null,"abort"===l?(a.log("Aborted xhr requst."),void 0):(d()||(p++,a.state!==n.connectionState.reconnecting&&(a.log("An error occurred using longPolling. Status = "+l+". "+o.responseText),t(c).triggerHandler(i.onError,[o.responseText])),s.ensureReconnectingState(c),e.setTimeout(function(){r(c,!0)},u.reconnectDelay)),void 0)}}),w&&l===!0&&(f=e.setTimeout(function(){g(c)},Math.min(1e3*(Math.pow(2,p)-1),m))))}(a)},250)},lostConnection:function(){throw new Error("Lost Connection not handled for LongPolling")},send:function(t,e){s.ajaxSend(t,e)},stop:function(t){t.pollXhr&&(t.pollXhr.abort(),t.pollXhr=null,delete t.pollXhr)},abort:function(t,e){s.ajaxAbort(t,e)}}}(window.jQuery,window),function(t){function e(t){return t+l}function n(t,e,n){var i,r=t.length,o=[];for(i=0;r>i;i+=1)t.hasOwnProperty(i)&&(o[i]=e.call(n,t[i],i,t));return o}function i(e){return t.isFunction(e)?null:"undefined"===t.type(e)?null:e}function r(t){for(var e in t)if(t.hasOwnProperty(e))return!0;return!1}function o(t,e){return new o.fn.init(t,e)}function s(e,n){var i={qs:null,logging:!1,useDefaultPath:!0};return t.extend(i,n),(!e||i.useDefaultPath)&&(e=(e||"")+"/signalr"),new s.fn.init(e,i)}var a=0,c={},l=".hubProxy";o.fn=o.prototype={init:function(t,e){this.state={},this.connection=t,this.hubName=e,this._={callbackMap:{}}},hasSubscriptions:function(){return r(this._.callbackMap)},on:function(n,i){var r=this,o=r._.callbackMap;return n=n.toLowerCase(),o[n]||(o[n]={}),o[n][i]=function(t,e){i.apply(r,e)},t(r).bind(e(n),o[n][i]),r},off:function(n,i){var o,s=this,a=s._.callbackMap;return n=n.toLowerCase(),o=a[n],o&&(o[i]?(t(s).unbind(e(n),o[i]),delete o[i],r(o)||delete a[n]):i||(t(s).unbind(e(n)),delete a[n])),s},invoke:function(e){var r=this,o=t.makeArray(arguments).slice(1),s=n(o,i),l={H:r.hubName,M:e,A:s,I:a},u=t.Deferred(),h=function(e){var n=r._maximizeHubResponse(e);t.extend(r.state,n.State),n.Error?(n.StackTrace&&r.connection.log(n.Error+"\n"+n.StackTrace),u.rejectWith(r,[n.Error])):u.resolveWith(r,[n.Result])};return c[a.toString()]={scope:r,method:h},a+=1,t.isEmptyObject(r.state)||(l.S=r.state),r.connection.send(r.connection.json.stringify(l)),u.promise()},_maximizeHubResponse:function(t){return{State:t.S,Result:t.R,Id:t.I,Error:t.E,StackTrace:t.T}}},o.fn.init.prototype=o.fn,s.fn=s.prototype=t.connection(),s.fn.init=function(n,i){var r={qs:null,logging:!1,useDefaultPath:!0},o=this;t.extend(r,i),t.signalR.fn.init.call(o,n,r.qs,r.logging),o.proxies={},o.received(function(n){var i,r,s,a,l,u;n&&("undefined"!=typeof n.I?(s=n.I.toString(),a=c[s],a&&(c[s]=null,delete c[s],a.method.call(a.scope,n))):(i=this._maximizeClientHubInvocation(n),o.log("Triggering client hub event '"+i.Method+"' on hub '"+i.Hub+"'."),l=i.Hub.toLowerCase(),u=i.Method.toLowerCase(),r=this.proxies[l],t.extend(r.state,i.State),t(r).triggerHandler(e(u),[i.Args])))})},s.fn._maximizeClientHubInvocation=function(t){return{Hub:t.H,Method:t.M,Args:t.A,State:t.S}},s.fn._registerSubscribedHubs=function(){var e=this;e._subscribedToHubs||(e._subscribedToHubs=!0,e.starting(function(){var n=[];t.each(e.proxies,function(t){this.hasSubscriptions()&&n.push({name:t})}),e.data=e.json.stringify(n)}))},s.fn.createHubProxy=function(t){t=t.toLowerCase();var e=this.proxies[t];return e||(e=o(this,t),this.proxies[t]=e),this._registerSubscribedHubs(),e},s.fn.init.prototype=s.fn,t.hubConnection=s}(window.jQuery,window),function(t){t.signalR.version="2.0.0-beta2"}(window.jQuery),define("signalr",function(){}),function(t){function e(e,n){return function(){n.apply(e,t.makeArray(arguments))}}function n(n,i){var r,o,s,a,c;for(r in n)if(n.hasOwnProperty(r)){if(o=n[r],!o.hubName)continue;c=i?o.on:o.off;for(s in o.client)if(o.client.hasOwnProperty(s)){if(a=o.client[s],!t.isFunction(a))continue;c.call(o,s,e(o,a))}}}if("function"!=typeof t.signalR)throw new Error("SignalR: SignalR is not loaded. Please ensure jquery.signalR-x.js is referenced before ~/signalr/js.");var i=t.signalR;t.hubConnection.prototype.createHubProxies=function(){var e={};return this.starting(function(){n(e,!0),this._registerSubscribedHubs()}).disconnected(function(){n(e,!1)}),e.sharingHub=this.createHubProxy("sharingHub"),e.sharingHub.client={},e.sharingHub.server={subscribe:function(){return e.sharingHub.invoke.apply(e.sharingHub,t.merge(["Subscribe"],t.makeArray(arguments)))},unsubscribe:function(){return e.sharingHub.invoke.apply(e.sharingHub,t.merge(["Unsubscribe"],t.makeArray(arguments)))},update:function(){return e.sharingHub.invoke.apply(e.sharingHub,t.merge(["Update"],t.makeArray(arguments)))}},e},i.hub=t.hubConnection("/signalr",{useDefaultPath:!1}),t.extend(i,i.hub.createHubProxies())}(window.jQuery,window),define("hubsproxies",function(){});var __bind=function(t,e){return function(){return t.apply(e,arguments)}};define("application/sharing",["require","jquery","underscore","backbone","./events","signalr","hubsproxies"],function(t){var e,n,i,r,o,s,a;return e=t("jquery"),a=t("underscore"),i=t("backbone"),o=t("./events"),t("signalr"),t("hubsproxies"),s=e.connection.sharingHub,n=1e3,r=function(){function t(t){this.onBroadcast=__bind(this.onBroadcast,this),this.onDocumentChanged=__bind(this.onDocumentChanged,this),this.onUnsubscribed=__bind(this.onUnsubscribed,this),this.onUpdated=__bind(this.onUpdated,this),this.onSubscribed=__bind(this.onSubscribed,this),a(this).extend(i.Events),this.context=t.context,s.client.subscribed=this.onSubscribed,s.client.updated=this.onUpdated,s.client.unsubscribed=this.onUnsubscribed}return t.prototype.start=function(){var t=this;return e.connection.hub.start().done(function(){return t.listenTo(o,"documentChanged",t.onDocumentChanged),t.listenTo(o,"broadcastDocumentContentChange",a(t.onBroadcast).debounce(n))})},t.prototype.stop=function(){return this.stopListening(o),e.connection.hub.stop()},t.prototype.onSubscribed=function(t,e){return this.trigger("userJoined",{documentId:parseInt(t,10),user:e})},t.prototype.onUpdated=function(t,e,n){return this.trigger("documentUpdated",{documentId:parseInt(t,10),content:e,user:n})},t.prototype.onUnsubscribed=function(t,e){return this.trigger("userLeft",{documentId:parseInt(t,10),user:e})},t.prototype.onDocumentChanged=function(){var t,e=this;return t=this.documentId,t&&s.server.unsubscribe(t).done(function(){return e.documentId=void 0}),this.context.isCurrentDocumentShared()?(t=this.context.getCurrentDocumentId(),s.server.subscribe(t).done(function(){return e.documentId=t})):void 0},t.prototype.onBroadcast=function(t){return this.context.canShareCurrentDocumentUpdate()?s.server.update(this.context.getCurrentDocumentId(),t.content):!1},t}()}),function(t,e,n){function i(n){o[n]||(o[n]=!0,t.migrateWarnings.push(n),e.console&&console.warn&&!t.migrateMute&&(console.warn("JQMIGRATE: "+n),t.migrateTrace&&console.trace&&console.trace()))}function r(e,n,r,o){if(Object.defineProperty)try{return Object.defineProperty(e,n,{configurable:!0,enumerable:!0,get:function(){return i(o),r},set:function(t){i(o),r=t}}),void 0}catch(s){}t._definePropertyBroken=!0,e[n]=r}var o={};t.migrateWarnings=[],!t.migrateMute&&e.console&&console.log&&console.log("JQMIGRATE: Logging is active"),t.migrateTrace===n&&(t.migrateTrace=!0),t.migrateReset=function(){o={},t.migrateWarnings.length=0},"BackCompat"===document.compatMode&&i("jQuery is not compatible with Quirks Mode");var s=t("<input/>",{size:1}).attr("size")&&t.attrFn,a=t.attr,c=t.attrHooks.value&&t.attrHooks.value.get||function(){return null},l=t.attrHooks.value&&t.attrHooks.value.set||function(){return n},u=/^(?:input|button)$/i,h=/^[238]$/,d=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,p=/^(?:checked|selected)$/i;r(t,"attrFn",s||{},"jQuery.attrFn is deprecated"),t.attr=function(e,r,o,c){var l=r.toLowerCase(),f=e&&e.nodeType;return c&&(a.length<4&&i("jQuery.fn.attr( props, pass ) is deprecated"),e&&!h.test(f)&&(s?r in s:t.isFunction(t.fn[r])))?t(e)[r](o):("type"===r&&o!==n&&u.test(e.nodeName)&&e.parentNode&&i("Can't change the 'type' of an input or button in IE 6/7/8"),!t.attrHooks[l]&&d.test(l)&&(t.attrHooks[l]={get:function(e,i){var r,o=t.prop(e,i);return o===!0||"boolean"!=typeof o&&(r=e.getAttributeNode(i))&&r.nodeValue!==!1?i.toLowerCase():n},set:function(e,n,i){var r;return n===!1?t.removeAttr(e,i):(r=t.propFix[i]||i,r in e&&(e[r]=!0),e.setAttribute(i,i.toLowerCase())),i}},p.test(l)&&i("jQuery.fn.attr('"+l+"') may use property instead of attribute")),a.call(t,e,r,o))},t.attrHooks.value={get:function(t,e){var n=(t.nodeName||"").toLowerCase();return"button"===n?c.apply(this,arguments):("input"!==n&&"option"!==n&&i("jQuery.fn.attr('value') no longer gets properties"),e in t?t.value:null)},set:function(t,e){var n=(t.nodeName||"").toLowerCase();return"button"===n?l.apply(this,arguments):("input"!==n&&"option"!==n&&i("jQuery.fn.attr('value', val) no longer sets properties"),t.value=e,void 0)}};var f,g,m=t.fn.init,v=t.parseJSON,y=/^(?:[^<]*(<[\w\W]+>)[^>]*|#([\w\-]*))$/;t.fn.init=function(e,n,r){var o;return e&&"string"==typeof e&&!t.isPlainObject(n)&&(o=y.exec(e))&&o[1]&&("<"!==e.charAt(0)&&i("$(html) HTML strings must start with '<' character"),n&&n.context&&(n=n.context),t.parseHTML)?m.call(this,t.parseHTML(t.trim(e),n,!0),n,r):m.apply(this,arguments)},t.fn.init.prototype=t.fn,t.parseJSON=function(t){return t||null===t?v.apply(this,arguments):(i("jQuery.parseJSON requires a valid JSON string"),null)},t.uaMatch=function(t){t=t.toLowerCase();var e=/(chrome)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+)/.exec(t)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(t)||/(msie) ([\w.]+)/.exec(t)||t.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(t)||[];return{browser:e[1]||"",version:e[2]||"0"}},t.browser||(f=t.uaMatch(navigator.userAgent),g={},f.browser&&(g[f.browser]=!0,g.version=f.version),g.chrome?g.webkit=!0:g.webkit&&(g.safari=!0),t.browser=g),r(t,"browser",t.browser,"jQuery.browser is deprecated"),t.sub=function(){function e(t,n){return new e.fn.init(t,n)}t.extend(!0,e,this),e.superclass=this,e.fn=e.prototype=this(),e.fn.constructor=e,e.sub=this.sub,e.fn.init=function(i,r){return r&&r instanceof t&&!(r instanceof e)&&(r=e(r)),t.fn.init.call(this,i,r,n)},e.fn.init.prototype=e.fn;var n=e(document);return i("jQuery.sub() is deprecated"),e},t.ajaxSetup({converters:{"text json":t.parseJSON}});var w=t.fn.data;t.fn.data=function(e){var r,o,s=this[0];return!s||"events"!==e||1!==arguments.length||(r=t.data(s,e),o=t._data(s,e),r!==n&&r!==o||o===n)?w.apply(this,arguments):(i("Use of jQuery.fn.data('events') is deprecated"),o)};var _=/\/(java|ecma)script/i,b=t.fn.andSelf||t.fn.addBack;t.fn.andSelf=function(){return i("jQuery.fn.andSelf() replaced by jQuery.fn.addBack()"),b.apply(this,arguments)},t.clean||(t.clean=function(e,n,r,o){n=n||document,n=!n.nodeType&&n[0]||n,n=n.ownerDocument||n,i("jQuery.clean() is deprecated");var s,a,c,l,u=[];if(t.merge(u,t.buildFragment(e,n).childNodes),r)for(c=function(t){return!t.type||_.test(t.type)?o?o.push(t.parentNode?t.parentNode.removeChild(t):t):r.appendChild(t):void 0},s=0;null!=(a=u[s]);s++)t.nodeName(a,"script")&&c(a)||(r.appendChild(a),"undefined"!=typeof a.getElementsByTagName&&(l=t.grep(t.merge([],a.getElementsByTagName("script")),c),u.splice.apply(u,[s+1,0].concat(l)),s+=l.length));return u});var x=t.event.add,S=t.event.remove,C=t.event.trigger,T=t.fn.toggle,k=t.fn.live,P=t.fn.die,D="ajaxStart|ajaxStop|ajaxSend|ajaxComplete|ajaxError|ajaxSuccess",L=new RegExp("\\b(?:"+D+")\\b"),K=/(?:^|\s)hover(\.\S+|)\b/,A=function(e){return"string"!=typeof e||t.event.special.hover?e:(K.test(e)&&i("'hover' pseudo-event is deprecated, use 'mouseenter mouseleave'"),e&&e.replace(K,"mouseenter$1 mouseleave$1"))};t.event.props&&"attrChange"!==t.event.props[0]&&t.event.props.unshift("attrChange","attrName","relatedNode","srcElement"),t.event.dispatch&&r(t.event,"handle",t.event.dispatch,"jQuery.event.handle is undocumented and deprecated"),t.event.add=function(t,e,n,r,o){t!==document&&L.test(e)&&i("AJAX events should be attached to document: "+e),x.call(this,t,A(e||""),n,r,o)},t.event.remove=function(t,e,n,i,r){S.call(this,t,A(e)||"",n,i,r)},t.fn.error=function(){var t=Array.prototype.slice.call(arguments,0);return i("jQuery.fn.error() is deprecated"),t.splice(0,0,"error"),arguments.length?this.bind.apply(this,t):(this.triggerHandler.apply(this,t),this)},t.fn.toggle=function(e,n){if(!t.isFunction(e)||!t.isFunction(n))return T.apply(this,arguments);i("jQuery.fn.toggle(handler, handler...) is deprecated");var r=arguments,o=e.guid||t.guid++,s=0,a=function(n){var i=(t._data(this,"lastToggle"+e.guid)||0)%s;return t._data(this,"lastToggle"+e.guid,i+1),n.preventDefault(),r[i].apply(this,arguments)||!1};for(a.guid=o;s<r.length;)r[s++].guid=o;return this.click(a)},t.fn.live=function(e,n,r){return i("jQuery.fn.live() is deprecated"),k?k.apply(this,arguments):(t(this.context).on(e,this.selector,n,r),this)},t.fn.die=function(e,n){return i("jQuery.fn.die() is deprecated"),P?P.apply(this,arguments):(t(this.context).off(e,this.selector||"**",n),this)},t.event.trigger=function(t,e,n,r){return n||L.test(t)||i("Global events are undocumented and deprecated"),C.call(this,t,e,n||document,r)},t.each(D.split("|"),function(e,n){t.event.special[n]={setup:function(){var e=this;return e!==document&&(t.event.add(document,n+"."+t.guid,function(){t.event.trigger(n,null,e,!0)}),t._data(this,n,t.guid++)),!1},teardown:function(){return this!==document&&t.event.remove(document,n+"."+t._data(this,n)),!1}}})}(jQuery,window),define("jquery.migrate",function(){}),function(t,e,n){function i(t){return t}function r(t){return o(decodeURIComponent(t.replace(a," ")))}function o(t){return 0===t.indexOf('"')&&(t=t.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\")),t}function s(t){return c.json?JSON.parse(t):t}var a=/\+/g,c=t.cookie=function(o,a,l){if(a!==n){if(l=t.extend({},c.defaults,l),null===a&&(l.expires=-1),"number"==typeof l.expires){var u=l.expires,h=l.expires=new Date;h.setDate(h.getDate()+u)}return a=c.json?JSON.stringify(a):String(a),e.cookie=[encodeURIComponent(o),"=",c.raw?a:encodeURIComponent(a),l.expires?"; expires="+l.expires.toUTCString():"",l.path?"; path="+l.path:"",l.domain?"; domain="+l.domain:"",l.secure?"; secure":""].join("")}for(var d=c.raw?i:r,p=e.cookie.split("; "),f=o?null:{},g=0,m=p.length;m>g;g++){var v=p[g].split("="),y=d(v.shift()),w=d(v.join("="));if(o&&o===y){f=s(w);break}o||(f[y]=s(w))}return f};c.defaults={},t.removeCookie=function(e,n){return null!==t.cookie(e)?(t.cookie(e,null,n),!0):!1}}(jQuery,document),define("jquery.cookie",function(){}),function(t){var e=0;t.fn.splitter=function(n){return n=n||{},this.each(function(){function i(){return t.browser.msie&&parseInt(t.browser.version)<9}function r(t){w.removeClass(p.barStateClasses).addClass(t)}function o(e){1==e.which&&(w.removeClass(p.barHoverClass),p.outline&&(h=h||w.clone(!1).insertAfter(m),w.removeClass(p.barDockedClass)),r(p.barActiveClass),g.css("-webkit-user-select","none").find("iframe").addClass(p.iframeClass),m._posSplit=m[0][p.pxSplit]-e[p.eventPos],t(document).bind("mousemove"+p.eventNamespace,s).bind("mouseup"+p.eventNamespace,a))}function s(t){var e=m._posSplit+t[p.eventPos],n=Math.max(0,Math.min(e,f._DA-w._DA)),i=Math.max(m._min,f._DA-v._max,Math.min(e,m._max,f._DA-w._DA-v._min));p.outline?(p.dockPane==m&&e<Math.max(m._min,w._DA)||p.dockPane==v&&e>Math.min(e,m._max,f._DA-w._DA-v._min)?w.addClass(p.barDockedClass).css(p.origin,n):w.removeClass(p.barDockedClass).css(p.origin,i),w._DA=w[0][p.pxSplit]):c(e),r(e==i?p.barActiveClass:p.barLimitClass)}function a(e){r(p.barNormalClass),w.addClass(p.barHoverClass);var n=m._posSplit+e[p.eventPos];p.outline&&(h&&h.remove(),h=null,c(n)),g.css("-webkit-user-select","text").find("iframe").removeClass(p.iframeClass),t(document).unbind("mousemove"+p.eventNamespace+" mouseup"+p.eventNamespace)}function c(t){w._DA=w[0][p.pxSplit],p.dockPane==m&&t<Math.max(m._min,w._DA)||p.dockPane==v&&t>Math.min(t,m._max,f._DA-w._DA-v._min)?(w.addClass(p.barDockedClass),w._DA=w[0][p.pxSplit],t=p.dockPane==m?0:f._DA-w._DA,null==w._pos&&(w._pos=m[0][p.pxSplit])):(w.removeClass(p.barDockedClass),w._DA=w[0][p.pxSplit],w._pos=null,t=Math.max(m._min,f._DA-v._max,Math.min(t,m._max,f._DA-w._DA-v._min))),w.css(p.origin,t).css(p.fixed,f._DF),m.css(p.origin,0).css(p.split,t).css(p.fixed,f._DF),v.css(p.origin,t+w._DA).css(p.split,f._DA-w._DA-t).css(p.fixed,f._DF),i()||g.triggerHandler("resize")}function l(t){for(var e=0,n=1;n<arguments.length;n++)e+=Math.max(parseInt(t.css(arguments[n]),10)||0,0);return e}function u(t){f._DF=f[0][p.pxFixed]-f._PBF,f._DA=f[0][p.pxSplit]-f._PBA,f._DF<=0||f._DA<=0||(f._oldW!=f.width()||f._oldH!=f.height())&&(f._oldW=f.width(),f._oldH=f.height(),c(isNaN(t)?p.sizeRight||p.sizeBottom?f._DA-v[0][p.pxSplit]-w._DA:m[0][p.pxSplit]:t),r(p.barNormalClass))}if(!t(this).attr("data-splitter-initialized")){var h,d=(n.splitHorizontal?"h":n.splitVertical?"v":n.type)||"v",p=t.extend({splitterClass:"splitter ui-widget ui-widget-content",paneClass:"splitter-pane",barClass:"splitter-bar",barNormalClass:"ui-state-default",barHoverClass:"ui-state-hover",barActiveClass:"ui-state-highlight",barLimitClass:"ui-state-error",iframeClass:"splitter-iframe-hide",eventNamespace:".splitter"+ ++e,pxPerKey:8,tabIndex:0,accessKey:""},{v:{keyLeft:39,keyRight:37,cursor:"e-resize",barStateClass:"splitter-bar-vertical",barDockedClass:"splitter-bar-vertical-docked"},h:{keyTop:40,keyBottom:38,cursor:"n-resize",barStateClass:"splitter-bar-horizontal",barDockedClass:"splitter-bar-horizontal-docked"}}[d],n,{v:{type:"v",eventPos:"pageX",origin:"left",split:"width",pxSplit:"offsetWidth",side1:"Left",side2:"Right",fixed:"height",pxFixed:"offsetHeight",side3:"Top",side4:"Bottom"},h:{type:"h",eventPos:"pageY",origin:"top",split:"height",pxSplit:"offsetHeight",side1:"Top",side2:"Bottom",fixed:"width",pxFixed:"offsetWidth",side3:"Left",side4:"Right"}}[d]);p.barStateClasses=[p.barNormalClass,p.barHoverClass,p.barActiveClass,p.barLimitClass].join(" ");var f=t(this).css({position:"relative"}).addClass(p.splitterClass).attr("data-splitter-initialized",!0),g=t(">*",f[0]).addClass(p.paneClass).css({position:"absolute","z-index":"1","-moz-outline-style":"none"}),m=t(g[0]),v=t(g[1]);p.dockPane=p.dock&&(/right|bottom/.test(p.dock)?v:m);var y=t('<a href="javascript:void(0)"></a>').attr({accessKey:p.accessKey,tabIndex:p.tabIndex,title:p.splitbarClass}).bind((t.browser.opera?"click":"focus")+p.eventNamespace,function(){this.focus(),w.addClass(p.barActiveClass)}).bind("keydown"+p.eventNamespace,function(t){var e=t.which||t.keyCode,n=e==p["key"+p.side1]?1:e==p["key"+p.side2]?-1:0;n&&c(m[0][p.pxSplit]+n*p.pxPerKey,!1)}).bind("blur"+p.eventNamespace,function(){w.removeClass(p.barActiveClass)}),w=t("<div></div>").insertAfter(m).addClass(p.barClass).addClass(p.barStateClass).append(y).attr({unselectable:"on"}).css({position:"absolute","user-select":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","z-index":"100"}).bind("mousedown"+p.eventNamespace,o).bind("mouseover"+p.eventNamespace,function(){t(this).addClass(p.barHoverClass)}).bind("mouseout"+p.eventNamespace,function(){t(this).removeClass(p.barHoverClass)});/^(auto|default|)$/.test(w.css("cursor"))&&w.css("cursor",p.cursor),w._DA=w[0][p.pxSplit],f._PBF=l(f,"border"+p.side3+"Width","border"+p.side4+"Width"),f._PBA=l(f,"border"+p.side1+"Width","border"+p.side2+"Width"),m._pane=p.side1,v._pane=p.side2,t.each([m,v],function(){this._splitter_style=this.style,this._min=p["min"+this._pane]||l(this,"min-"+p.split),this._max=p["max"+this._pane]||l(this,"max-"+p.split)||9999,this._init=p["size"+this._pane]===!0?parseInt(t.css(this[0],p.split),10):p["size"+this._pane]});var _=m._init;isNaN(v._init)||(_=f[0][p.pxSplit]-f._PBA-v._init-w._DA),p.cookie&&(t.cookie||alert("jQuery.splitter(): jQuery cookie plugin required"),_=parseInt(t.cookie(p.cookie),10),t(window).bind("unload"+p.eventNamespace,function(){var e=String(w.css(p.origin));t.cookie(p.cookie,e,{expires:p.cookieExpires||365,path:p.cookiePath||document.location.pathname})})),isNaN(_)&&(_=Math.round((f[0][p.pxSplit]-f._PBA-w._DA)/2)),p.anchorToWindow&&(p.resizeTo=window),p.resizeTo?(f._hadjust=l(f,"borderTopWidth","borderBottomWidth","marginBottom"),f._hmin=Math.max(l(f,"minHeight"),20),t(window).bind("resize"+p.eventNamespace,function(){var e=f.offset().top,n=t(p.resizeTo).height();f.css("height",Math.max(n-e-f._hadjust,f._hmin)+"px"),i()||f.triggerHandler("resize")}).triggerHandler("resize"+p.eventNamespace)):p.resizeToWidth&&!i()&&t(window).bind("resize"+p.eventNamespace,function(){u()}),p.dock&&(f.bind("toggleDock"+p.eventNamespace,function(){var t=p.dockPane[0][p.pxSplit];f.triggerHandler(t?"dock":"undock")}).bind("dock"+p.eventNamespace,function(){var t=m[0][p.pxSplit];if(t){w._pos=t;var e={};e[p.origin]=p.dockPane==m?0:f[0][p.pxSplit]-f._PBA-w[0][p.pxSplit],w.animate(e,p.dockSpeed||1,p.dockEasing,function(){w.addClass(p.barDockedClass),c(e[p.origin])})}}).bind("undock"+p.eventNamespace,function(){var t=p.dockPane[0][p.pxSplit];if(!t){var e={};e[p.origin]=w._pos+"px",w.removeClass(p.barDockedClass).animate(e,p.undockSpeed||p.dockSpeed||1,p.undockEasing||p.dockEasing,function(){c(w._pos),w._pos=null})}}),p.dockKey&&t('<a title="'+p.splitbarClass+' toggle dock" href="javascript:void(0)"></a>').attr({accessKey:p.dockKey,tabIndex:-1}).appendTo(w).bind(t.browser.opera?"click":"focus",function(){f.triggerHandler("toggleDock"),this.blur()
}),w.bind("dblclick",function(){f.triggerHandler("toggleDock")})),f.bind("destroy"+p.eventNamespace,function(){t([window,document]).unbind(p.eventNamespace),w.unbind().remove(),g.removeClass(p.paneClass),f.removeClass(p.splitterClass).add(g).unbind(p.eventNamespace).attr("style",function(){return this._splitter_style||""}),f=w=y=g=m=v=p=n=null}).bind("resize"+p.eventNamespace,function(t,e){u(e)}).trigger("resize",[_])}})}}(jQuery),define("jquery.splitter",function(){}),define("application/layout",["require","jquery","underscore","jquery.splitter"],function(t){var e,n;return e=t("jquery"),n=t("underscore"),t("jquery.splitter"),{init:function(){return e("#content").splitter({type:"v",outline:!0,anchorToWindow:!0,dock:"left",accessKey:"L",cookie:"aside"}).on("toggleDock resize",function(){return n(function(){return e(window).trigger("resize")}).defer()}),e("#main").splitter({type:"v",outline:!0,anchorToWindow:!0,accessKey:"M",cookie:"main"}),e("#editor-container").splitter({type:"h",anchorToWindow:!0,outline:!0,accessKey:"B",cookie:"output"})}}});var __slice=[].slice;define("application/application",["require","jquery","backbone","toastr","./views/navigation","./views/examplelist","./views/editor","./views/canvas","./views/membership","./views/profile","./views/documenttitle","./views/documentbrowser","./views/exporteddocument","./views/sharedocument","./context","./router","./sharing","./events","./layout","flashbar"],function(t){var e,n,i,r,o,s,a,c,l,u,h,d,p,f,g,m,v,y,w,_,b,x,S,C,T,k,P,D;return e=t("jquery"),n=t("backbone"),D=t("toastr"),h=t("./views/navigation"),c=t("./views/examplelist"),a=t("./views/editor"),i=t("./views/canvas"),u=t("./views/membership"),d=t("./views/profile"),s=t("./views/documenttitle"),o=t("./views/documentbrowser"),l=t("./views/exporteddocument"),f=t("./views/sharedocument"),r=t("./context"),p=t("./router"),g=t("./sharing"),S=t("./events"),T=t("./layout"),t("flashbar"),w="#!/",y=function(){var t,e;return e=1<=arguments.length?__slice.call(arguments,0):[],t=e.join("/"),t.length&&0===t.indexOf("/")&&(t=t.substring(1)),w+t},x=y("documents","new"),C=function(){var t;return t=window.location.hash,t.length>w.length?!0:0===w.indexOf(t)?!1:!0},_=null,k=null,P=null,v=function(){return S.on("newDocument",function(){return _.resetCurrentDocument(),S.trigger("documentChanged")}),S.on("saveDocument",function(){return _.isUserSignedIn()?_.isCurrentDocumentNew()?S.trigger("showNewDocumentTitle"):_.saveCurrentDocument(function(){return e.showInfobar("Your document is successfully saved.")}):S.trigger("showMembership")}),S.on("newDocumentTitleAssigned",function(){return _.saveCurrentDocument(function(){var t;return e.showInfobar("Your document is successfully saved."),t=y("documents",_.getCurrentDocumentId()),k.navigate(t)})}),S.on("documentSelected",function(t){return k.navigate(y("documents",t.id),!0)}),S.on("myAccount",function(){var t;return t=_.isUserSignedIn()?"showProfile":"showMembership",S.trigger(t)}),S.on("signedIn",function(){return _.userSignedIn(),P.start(),e.showInfobar("You are now signed in.")}),S.on("passwordResetTokenRequested",function(){return e.showInfobar("An email with a password reset link has been sent to your email address. Please open the link to reset your password.")}),S.on("passwordChanged",function(){return e.showInfobar("Your password is successfully changed.")}),S.on("signedUp",function(){return e.showInfobar("Thank you for signing up, an email with a confirmation link has been sent to your email address. Please open the link to activate your account.")}),S.on("signedOut",function(){return _.userSignedOut(),P.stop(),k.navigate(x,!0),e.showInfobar("You are now signed out.")}),S.on("documentSharing",function(t){var n,i,r;return n=_.documents.get(t.id),n.set("shared",t.shared),r=t.shared?"shared":"unshared",i="You have "+r+" <strong>"+n.get("title")+"</strong>.",e.showInfobar(i)}),P.on("userJoined",function(t){return t.documentId!==_.getCurrentDocumentId()?!1:D.info(""+t.user+" has joined.")}),P.on("documentUpdated",function(t){return t.documentId!==_.getCurrentDocumentId()?!1:(D.info(""+t.user+" has updated the code."),S.trigger("documentContentChanged",{code:t.content}))}),P.on("userLeft",function(t){return t.documentId!==_.getCurrentDocumentId()?!1:D.info(""+t.user+" has left.")})},b=function(){return m.views={navigation:new h,exampleList:new c,editor:new a({context:_}),canvas:new i({context:_}),membership:new u,profile:new d,documentTitle:new s({context:_}),documentBrowser:new o({context:_}),exportedDocument:new l,shareDocumentView:new f({context:_})}},m={start:function(t){return D.options={positionClass:"toast-bottom-right"},T.init(),_=new r(t),k=new p({context:_,defaultUrl:x}),P=new g({context:_}),m.context=_,m.sharing=P,m.router=k,t.userSignedIn&&P.start(),v(),b(),n.history.start(),C()?!0:k.navigate(x,!0)}},window.app=m,m}),define("main.js",["require","jquery","application/application","preloaded-data"],function(t){var e,n,i;return e=t("jquery"),n=t("application/application"),i=t("preloaded-data"),e(function(){return n.start(i)})});
//# sourceMappingURL=app.js.map